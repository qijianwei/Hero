var laya=function(exports){"use strict";class SoundManager{static get ins(){if(!this._ins)this._ins=new SoundManager;return this._ins}constructor(){this.url="remote/sound/";this.suffix=Laya.Render.isConchApp?".wav":".mp3";if(localStorage.getItem("musicSwitchState")||localStorage.getItem("musicSwitchState")=="true"){Laya.SoundManager.musicMuted=true}if(localStorage.getItem("effectSwitchState")||localStorage.getItem("effectSwitchState")=="true"){Laya.SoundManager.soundMuted=true}}playMusic(fileName,loop=0){if(!Laya.SoundManager.musicMuted){var url=this.url+fileName+this.suffix;this.currentChannel=Laya.SoundManager.playMusic(url,loop)}}playSound(fileName,loop,cb){loop===void 0&&(loop=1);cb===void 0&&(cb=null);if(!Laya.SoundManager.soundMuted){var url=this.url+fileName+this.suffix;Laya.SoundManager.playSound(url,loop,Laya.Handler.create(this,cb));Laya.SoundManager.setSoundVolume(1)}}homeBg(){SoundManager.curBg="homeBg";this.playMusic("homeBg")}battleBg(){SoundManager.curBg="battleBg";this.playMusic("battleBg")}passBg(){SoundManager.curBg="passBg";this.playMusic("passBg")}collide(){this.playSound("collide")}injured(){this.playSound("injured")}heroSkill1(){this.playSound("hero1")}heroSkill2(){this.playSound("hero2")}weaponSkill(){this.playSound("weaponLaunch",1,()=>{this.playSound("weaponSkill")})}weaponLaunch(){this.playSound("weaponLaunch")}btn(){this.playSound("btn")}upgrade(){this.playSound("upgrade")}gold(){this.playSound("gold")}round(){this.playSound("round")}win(){this.playMusic("win",1)}lose(){this.playMusic("lose",1)}}SoundManager.curBg="homeBg";var WeaponAniType;(function(WeaponAniType){WeaponAniType[WeaponAniType["aniRepeat1"]=43]="aniRepeat1";WeaponAniType[WeaponAniType["aniRepeat2"]=44]="aniRepeat2";WeaponAniType[WeaponAniType["aniPoison1"]=45]="aniPoison1";WeaponAniType[WeaponAniType["aniPoison2"]=46]="aniPoison2";WeaponAniType[WeaponAniType["aniCrit1"]=47]="aniCrit1";WeaponAniType[WeaponAniType["aniCrit2"]=48]="aniCrit2";WeaponAniType[WeaponAniType["aniBlood"]=53]="aniBlood";WeaponAniType[WeaponAniType["aniBlue"]=54]="aniBlue";WeaponAniType[WeaponAniType["aniReduce"]=55]="aniReduce";WeaponAniType[WeaponAniType["aniThump1"]=56]="aniThump1";WeaponAniType[WeaponAniType["aniThump2"]=57]="aniThump2";WeaponAniType[WeaponAniType["aniFreeze"]=59]="aniFreeze";WeaponAniType[WeaponAniType["aniThump3"]=61]="aniThump3";WeaponAniType[WeaponAniType["aniPetrifie"]=62]="aniPetrifie";WeaponAniType[WeaponAniType["aniHero1"]=88]="aniHero1";WeaponAniType[WeaponAniType["aniHero2"]=89]="aniHero2";WeaponAniType[WeaponAniType["aniHero3"]=90]="aniHero3"})(WeaponAniType||(WeaponAniType={}));class Weapon extends PaoYa.Component{constructor(){super();this.pathsCurvature=[0,0,8e-4,.0015,.0025];this.speedsArr=[0,680/100,680/80,680/100,680/80]}onAwake(){this.tween=new Laya.Tween;let collideSp=new Laya.Sprite;this.collideSp=collideSp;this.imgWeapon.addChild(collideSp);this.startPos={x:180,y:450};this.endPos={x:1150,y:450};this.driftX=this.endPos.x-this.startPos.x;this.driftY=this.endPos.y-this.startPos.y}onEnable(){this.params=this.owner.params;if(this.params.weaponType!=1){this.rotateAngle=360}this.firstAngle=undefined;this.imgWeapon.alpha=1;this.imgWeapon.scaleX=1;this.imgWeapon.scaleY=1;this.effectAni=false;this.boxAniWeapon.visible=false;this.imgWeapon.skin=`remote/weapons/${this.params.weaponId}.png`;this.weaponAttack=this.params.weaponAttack;this.weaponDurable=this.params.weaponDurable;this.owner.zOrder=100-this.weaponDurable;let imgW=this.imgWeapon.width,imgH=this.imgWeapon.height;this.imgWeapon.pivot(imgW/2,imgH/2);let x=this.imgWeapon.x,y=this.imgWeapon.y,skillX=-Math.floor(imgW/2);this.boxAniWeapon.pos(x,y);this.aniPoison1.pos(x,y);this.aniPoison2.pos(skillX,y);this.aniCrit1.pos(x,y);this.aniCrit2.pos(skillX+5,y);this.aniRepeat1.pos(skillX+5,y);this.aniRepeat2.pos(skillX+5,y);this.aniBlood.pos(x,y);this.aniBlue.pos(x,y);this.aniReduce.pos(x,y);this.aniThump1.pos(x,y);this.aniThump2.pos(x,y);this.aniThump3.pos(x,y);this.aniPetrifie.pos(x,y);this.aniHero1.pos(0,y);this.aniHero2.pos(0,y);this.aniHero3.pos(0,y);this.collideSp.size(Math.floor(imgW*.2),imgH);let collideW=this.collideSp.width,collideH=this.collideSp.height;this.collideW=collideW;this.collideH=collideH;this.collideSp.pivot(collideW/2,collideH/2);this.collideSp.pos(imgW/2,imgH/2);this.newX=0;this.newY=0;let speed=this.speedsArr[this.params.weaponType];this.speed=speed;this.curvature=this.pathsCurvature[this.params.weaponType];this.b=(this.driftY-this.curvature*this.driftX*this.driftX)/this.driftX;this.currentAni=null;this.initWeaponInfo();this.initBar();this.initSkillEffect();Laya.timer.frameLoop(1,this,this.startParabola,[speed])}initBar(){this.originHpW=this.imgHp.width;this.originHP=this.curHP=this.weaponDurable;this.boxHpWeapon.visible=false;this.imgHpMask.width=this.originHpW}initSkillEffect(){if(this.params.skillEffect){let skillId=this.params.activeSkill.skillId;if(WeaponAniType[skillId]){this[WeaponAniType[skillId]].visible=true;this[WeaponAniType[skillId]].play(0,true);this.currentAni=this[WeaponAniType[skillId]]}}}stopSkillEffect(){if(this.params.skillEffect){let skillId=this.params.activeSkill.skillId;if(WeaponAniType[skillId]){this[WeaponAniType[skillId]].visible=false;this[WeaponAniType[skillId]].stop();this.currentAni=null}}}initWeaponInfo(){if(this.isSelf){this.selfPlayerComp=GameControl.instance.selfPlayer.comp;this.otherPlayerComp=GameControl.instance.otherPlayer.comp;this.owner.scaleX=1;this.startPos={x:180,y:450};this.endPos={x:1150,y:450}}else{this.selfPlayerComp=GameControl.instance.otherPlayer.comp;this.otherPlayerComp=GameControl.instance.selfPlayer.comp;this.owner.scaleX=-1;this.startPos={x:1150,y:450};this.endPos={x:180,y:450}}this.originX=this.owner.x;this.originY=this.owner.y;this.diffX=Math.abs(this.originX-this.startPos.x);this.beginTime=(new Date).valueOf();this.weaponPoint=[{x:Math.floor(this.originX-this.collideW/2),y:Math.floor(this.originY-this.collideH/2)},{x:Math.floor(this.originX+this.collideW/2),y:Math.floor(this.originY-this.collideH/2)},{x:Math.floor(this.originX+this.collideW/2),y:Math.floor(this.originY+this.collideH/2)},{x:Math.floor(this.originX-this.collideW/2),y:Math.floor(this.originY+this.collideH/2)}]}changeHP(value){this.boxHpWeapon.visible=true;this.curHP+=value;if(this.curHP<=0){this.curHP=0;this.imgMask.width=0;return}else if(this.curHP>this.originHP){this.curHP=this.originHP}let w=Math.floor(this.curHP/this.originHP*this.originHpW);this.imgHpMask.width=w}startParabola(speed){let now=(new Date).valueOf();let x,y,curAngle;x=Math.floor((now-this.beginTime)*.06*speed)+this.diffX;y=Math.floor(this.curvature*x*x+this.b*x);curAngle=Math.floor(x/this.driftX*720);this.doMove(x,y,curAngle)}stopParabola(){Laya.timer.clear(this,this.startParabola)}pause(){Laya.timer.clear(this,this.startParabola);this.pauseTime=(new Date).valueOf();this.playedTime=this.pauseTime-this.beginTime;this.currentAni&&this.currentAni.stop()}resume(){let speed=this.speed;this.beginTime=(new Date).valueOf()-this.playedTime;Laya.timer.frameLoop(1,this,this.startParabola,[speed]);this.currentAni&&this.currentAni.play(0,true)}doMove(x,y,curAngle){if(this.isSelf){this.newX=this.startPos.x+x}else{this.newX=this.startPos.x-x}this.newY=this.originY+y;this.owner.x=this.newX;this.owner.y=this.newY;if(this.firstAngle==undefined){this.firstAngle=this.getDegreeByPos(x,y,this.newX,this.newY)}if(this.params.weaponType!=1){this.imgWeapon.rotation=this.firstAngle+curAngle}else{this.imgWeapon.rotation=this.getDegreeByPos(x,y,this.newX,this.newY)}this.refreshWeaponPoint(this.newX,this.newY);if(this.newX>1334||this.newY>750||this.newX<0||this.selfPlayerComp.killed||this.otherPlayerComp.killed){this.endMove();return}if(this.doPolygonsIntersect(this.weaponPoint,this.otherPlayerComp.collidePoint)){this.postNotification("collide");if(this.otherPlayerComp.dodge){console.log("------无敌状态或者一方已经死亡------");return}if(this.otherPlayerComp.attr.roleId==4){let random=Math.ceil(Math.random()*100);let reboundRate=this.otherPlayerComp.attr.skills[1].skillConfig.reboundRate;if(random<=reboundRate){GameControl.instance.showSkillText(true,"游龙入水");this.goBack();return}}if(this.selfPlayerComp.attr.roleId==2){console.warn("------我是龙儿------");if(this.selfPlayerComp.attr.skills[1].skillType==1){let addHitRecoverMp=this.selfPlayerComp.attr.skills[1].skillConfig.addHitRecoverMp;this.selfPlayerComp.MPComp.changeMP(addHitRecoverMp)}}SoundManager.ins.injured();this.endMove();let skill=this.params.activeSkill;let skillEffect=this.params.skillEffect;let{attackNum:attackNum,isCrit:isCrit}=this.calcAttackNum(skillEffect);this.effectRefiner(this.selfPlayerComp.attr);if(skillEffect){let skillConfig=skill.skillConfig,skillId=skill.skillId;switch(skillId){case 45:case 46:let arr=skillConfig.poison.split("-").map(Number);let time=arr[0];this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.otherPlayerComp.poisonEffect(time*1e3,-arr[1]/time)});break;case 49:case 50:this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.otherPlayerComp.palsyEffect(skillConfig.mabi*1e3)});break;case 53:let stealHp=skillConfig.stealHp;this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.selfPlayerComp.hpRecoverEffect(attackNum*stealHp)});break;case 54:let stealMp=skillConfig.stealMp;this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.selfPlayerComp.mpRecoverEffect(Math.ceil(attackNum*stealMp))});break;case 55:let recoverDown=skillConfig.recoverDown.split("-").map(Number);let recoverDownT=recoverDown[0],recoverDownPer=recoverDown[1];this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,null);this.otherPlayerComp.changePerMp(recoverDownT*1e3,recoverDownPer);break;case 59:let freezeTime=skillConfig.freeze*1e3;this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.otherPlayerComp.freezedEffect(freezeTime)});break;case 89:console.warn("--------释放人物技能89,让对方内力减少100点--------");let downMP=skillConfig.downMp;this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,null);this.otherPlayerComp.MPComp.changeMP(-downMP);break;case 90:let dizzyT=skillConfig.dizziness*1e3;this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit,()=>{this.otherPlayerComp.dizzyEffect(dizzyT)});break;default:this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit);break}}else{this.otherPlayerComp.injuredEffect(this.params.weaponType,-attackNum,isCrit)}}if(this.isSelf){this.collideWithWeapon()}}calcAttackNum(skillEffect){let randomNum=Math.floor(Math.random()*100+1);let selfAttr=this.selfPlayerComp.attr,otherAttr=this.otherPlayerComp.attr,selfStrength=selfAttr.roleStrength,roleCritHarm=selfAttr.calcCritProb,selfCritHarm=randomNum<roleCritHarm?selfAttr.roleCritHarm/100:1,otherBone=otherAttr.roleBone,refinerHurt=this.calcRefinerHurt(selfAttr),otherReduceHurt=this.calcReduceHurt(otherAttr),hurtPer=selfStrength-otherBone<0?1:(selfStrength-otherBone)/selfStrength,skillHurtMulti=1;if(skillEffect){console.warn("--------触发技能伤害，有莫有伤害倍数不知道--------");skillHurtMulti=this.params.activeSkill.skillConfig.hurt?this.params.activeSkill.skillConfig.hurt:1}let attackNum=Math.floor(this.weaponAttack*hurtPer*selfCritHarm*refinerHurt*(1-otherReduceHurt)*skillHurtMulti);if(this.selfPlayerComp.attr.roleId==3&&GameControl.instance.heroSkill2){console.log(`-----伤害加30%---------`);attackNum=attackNum*1.3}return{attackNum:attackNum,isCrit:randomNum<roleCritHarm}}effectRefiner(selfAttr){if(!selfAttr.refiners){return}let len=selfAttr.refiners.length;let refiners=selfAttr.refiners;for(let i=0;i<len;i++){if(this.weaponType==refiners[i].refinerBasics.weaponType){if(refiners[i].id==`refiner_12`){let hitRecoveHp=refiners[i].refinerBasics.hitRecoveHp;this.selfPlayerComp.hpRecoverEffect(hitRecoveHp)}else if(refiners[i].id==`refiner_13`){let hitRivalDownMp=refiners[i].refinerBasics.hitRivalDownMp;this.otherPlayerComp.mpRecoverEffect(-hitRivalDownMp)}else if(refiners[i].id==`refiner_14`){let random=Math.round(Math.random()*100);if(random<=refiners[i].refinerBasics.dizzinessRate){console.log(`----------使对手晕眩三秒----------`)}}}}}calcRefinerHurt(selfAttr){console.log(`------计算炼器伤害百分比------`);let refinerHurt=1;if(!selfAttr.refiners){return refinerHurt}let len=selfAttr.refiners.length;let refiners=selfAttr.refiners;for(let i=0;i<len;i++){if(refiners[i].refinerBasics.hurt){if(this.weaponType==refiners[i].refinerBasics.weaponType){return refiners[i].refinerBasics.hurt}}}return refinerHurt}calcReduceHurt(otherAttr){let otherReduceHurt=0;if(!otherAttr.refiners){return otherReduceHurt}let len=otherAttr.refiners.length;let refiners=otherAttr.refiners;for(let i=0;i<len;i++){if(refiners[i].refinerBasics.reduceHurt){console.warn(`------防御方炼器减伤百分比------`,refiners[i].refinerBasics.reduceHurt);return refiners[i].refinerBasics.reduceHurt}}return otherReduceHurt}goBack(){GameControl.instance.removeWeapon(this);this.isSelf=!this.isSelf;GameControl.instance.selfWeapons.push(this);this.owner.pos(280,450);this.initWeaponInfo()}getDegreeByPos(x,y,newX,newY){let ratio=2*this.curvature*x+this.b;let degree=Math.round(180*Math.atan(ratio)/Math.PI);return degree}refreshWeaponPoint(newX,newY){let ratio=this.imgWeapon.rotation*Math.PI/360;this.weaponPoint=this.CalcCoord(newX,newY,this.collideW,this.collideH,ratio)}CalcCoord(centerX,centerY,rw,rh,radians){var x1=-rw/2+centerX,x2=rw/2+centerX,x3=rw/2+centerX,x4=-rw/2+centerX,y1=-rh/2+centerY,y2=-rh/2+centerY,y3=rh/2+centerY,y4=rh/2+centerY;var x11=(x1-centerX)*Math.cos(radians)-(y1-centerY)*Math.sin(radians)+centerX,y11=(x1-centerX)*Math.sin(radians)+(y1-centerY)*Math.cos(radians)+centerY,x21=(x2-centerX)*Math.cos(radians)-(y2-centerY)*Math.sin(radians)+centerX,y21=(x2-centerX)*Math.sin(radians)+(y2-centerY)*Math.cos(radians)+centerY,x31=(x3-centerX)*Math.cos(radians)-(y3-centerY)*Math.sin(radians)+centerX,y31=(x3-centerX)*Math.sin(radians)+(y3-centerY)*Math.cos(radians)+centerY,x41=(x4-centerX)*Math.cos(radians)-(y4-centerY)*Math.sin(radians)+centerX,y41=(x4-centerX)*Math.sin(radians)+(y4-centerY)*Math.cos(radians)+centerY;return[{x:Math.round(x11),y:Math.round(y11)},{x:Math.round(x21),y:Math.round(y21)},{x:Math.round(x31),y:Math.round(y31)},{x:Math.round(x41),y:Math.round(y41)}]}collideWithWeapon(){for(let i=0;i<GameControl.instance.otherWeapons.length;i++){let otherWeapon=GameControl.instance.otherWeapons[i];if(!this.effectAni&&!otherWeapon.effectAni&&this.weaponType==otherWeapon.weaponType){if(this.doPolygonsIntersect(this.weaponPoint,otherWeapon.weaponPoint)){SoundManager.ins.collide();this.postNotification("weaponsCollide");if(this.weaponDurable>otherWeapon.weaponDurable){otherWeapon.playWeaponCollideEffect();this.weaponDurable-=otherWeapon.weaponDurable;this.owner.zOrder=100-this.weaponDurable;this.changeHP(-otherWeapon.weaponDurable);i-=1}else if(this.weaponDurable<otherWeapon.weaponDurable){this.playWeaponCollideEffect();otherWeapon.weaponDurable-=this.weaponDurable;otherWeapon.owner.zOrder=100-this.weaponDurable;otherWeapon.changeHP(-this.weaponDurable);break}else{this.playWeaponCollideEffect();otherWeapon.endMove();break}}}}}playWeaponCollideEffect(){this.boxAniWeapon.visible=true;this.boxHpWeapon.visible=false;this.effectAni=true;this.stopSkillEffect();this.stopParabola();this.tween.to(this.imgWeapon,{scaleX:1.5,scaleY:1.5,alpha:.3},500,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.endMove()}));this.boxAniCollision.play(0,false)}doPolygonsIntersect(a,b){var polygons=[a,b];var minA,maxA,projected,i,i1,j,minB,maxB;for(i=0;i<polygons.length;i++){var polygon=polygons[i];for(i1=0;i1<polygon.length;i1++){var i2=(i1+1)%polygon.length;var p1=polygon[i1];var p2=polygon[i2];var normal={x:p2.y-p1.y,y:p1.x-p2.x};minA=maxA=undefined;for(j=0;j<a.length;j++){projected=normal.x*a[j].x+normal.y*a[j].y;if(!minA||projected<minA){minA=projected}if(!maxA||projected>maxA){maxA=projected}}minB=maxB=undefined;for(j=0;j<b.length;j++){projected=normal.x*b[j].x+normal.y*b[j].y;if(!minB||projected<minB){minB=projected}if(!maxB||projected>maxB){maxB=projected}}if(maxA<minB||maxB<minA){return false}}}return true}endMove(){this.stopSkillEffect();this.stopParabola();this.owner.removeSelf();GameControl.instance.removeWeapon(this)}onDisable(){Laya.Pool.recover("weapon",this.owner)}onDestroy(){}}var HeroConfig={ladderArr:["","无名小卒","初出茅庐","后起之秀","江湖少侠","武林高手","名震江湖","独步武林","一代宗师","独孤求败"],roleName:"",roleIcon:"",roleHp:100,roleMp:100,roleStrength:2,roleBone:2,roleCritProb:20,roleCritHarm:100,roleSkills:[{skillConfig:{},skillDesc:""},{}],spineMap:{freeze:{path:"spine/freeze/freeze.sk",name:["continue","freeze"],ready_go:1,templet:null},hero_1:{path:"spine/hero/hero_1.sk",name:["dodge1","dodge2","dodge3","stand","attack","injured","dizzy","freeze"],templet:null},hero_2:{path:"spine/hero/hero_2.sk",name:["dodge1","dodge2","dodge3","stand","attack","injured","dizzy","freeze"],templet:null},hero_3:{path:"remote/spine/hero/hero_3.sk",name:["dodge1","dodge2","dodge3","stand","attack","injured","dizzy","freeze"],templet:null},hero_4:{path:"spine/hero/hero_4.sk",name:["dodge1","dodge2","dodge3","stand","attack","injured","dizzy","freeze"],templet:null},npc_1:{path:"remote/spine/npc/npc_1.sk",name:["bomb"],bomb:0,templet:null},npc_2:{path:"remote/spine/npc/npc_2.sk",name:["bomb"],bomb:0,templet:null},npc_3:{path:"remote/spine/npc/npc_3.sk",name:["bomb"],bomb:0,templet:null},npc_4:{path:"remote/spine/npc/npc_4.sk",name:["bomb"],bomb:0,templet:null},npc_5:{path:"remote/spine/npc/npc_5.sk",name:["bomb"],bomb:0,templet:null},npc_6:{path:"remote/spine/npc/npc_6.sk",name:["bomb"],bomb:0,templet:null},npc_7:{path:"remote/spine/npc/npc_7.sk",name:["bomb"],bomb:0,templet:null},scene1:{path:"remote/spine/scene/scene1.sk",templet:null},scene2:{path:"remote/spine/scene/scene2.sk",templet:null},scene3:{path:"remote/spine/scene/scene3.sk",templet:null}},getSkeleton:function(spineName,index=0,cb){var skeleton;if(this.spineMap[spineName].templet){skeleton=this.spineMap[spineName].templet.buildArmature(index)}else{skeleton=new Laya.Skeleton;skeleton.load(this.spineMap[spineName].path)}return skeleton},loadAllSpine:function(){this.loadIndex=0;let spines=Object.keys(this.spineMap);this.preload(spines)},preload:function(spines){var _this=this;var spine=this.spineMap[spines[this.loadIndex]];this.loadSpine(spine.path,function(templet){spine.templet=templet;if(_this.loadIndex==spines.length-1){return}else{_this.loadIndex++;_this.preload(spines)}},function(){if(_this.loadIndex==spines.length-1){return}else{_this.loadIndex++;_this.preload(spines)}})},loadSpine:function(url,completion,error){var templet=new Laya.Templet;templet.on(Laya.Event.COMPLETE,this,function(){completion&&completion(templet)});templet.on(Laya.Event.ERROR,this,function(){console.error("E: Load spine, skin:"+url);error&&error()});templet.loadAni(url)}};class Player extends PaoYa.Component{constructor(){super()}onAwake(){let owner=this.owner;let width=owner.width,height=owner.height;let posX=Math.floor(width/2),posY=height;this.centerX=posX;let dressIcon=this.attr.roleDress;this.dressIcon=dressIcon;let skeleton=HeroConfig.getSkeleton(dressIcon);skeleton.play("stand",true);skeleton.pos(posX,posY-10);skeleton.on(Laya.Event.STOPPED,this,this.stopHandler);skeleton.on(Laya.Event.LABEL,this,this.labelHandler);this.skeleton=skeleton;this.owner.addChild(skeleton);this.typeAniName=["","Bot","Mid","Top","Top"];let freeze=HeroConfig.getSkeleton("freeze");freeze.pos(posX,posY);this.owner.addChild(freeze);this.freeze=freeze;this.index=0}onEnable(){this.killed=false;this.index+=1;this.roleId=this.attr.roleId;if(this.dressIcon!=this.attr.roleDress){this.dressIcon=this.attr.roleDress;let templet=HeroConfig.spineMap[this.dressIcon].templet;this.skeleton.init(templet,0);this.skeleton.play("stand",true)}else{this.skeleton.play("stand",true)}this.canAction=true;this.sectionAni=0;this.plasyState=false;this.freezeState=false;this.dizzyState=false}labelHandler(e){switch(e.name){case"skill1":Laya.timer.once(500,this,()=>{if(!this.plasyState&&!this.freezeState&&!this.dizzyState){this.canAction=true}});GameControl.instance.allResume(this.isSelf);this.skillCallback();break;case"stop":console.log(`------stop-------`);this.canAction=false;GameControl.instance.allPause(this.isSelf);break;case"skill2":Laya.timer.once(500,this,()=>{console.log(`冰冻状态`,this.freezeState);if(!this.plasyState&&!this.freezeState&&!this.dizzyState){this.canAction=true}});GameControl.instance.allResume(this.isSelf);this.skillCallback();if(this["aniSkill2Hero"+this.roleId]){this["aniSkill2Hero"+this.roleId].visible=true;this["aniSkill2Hero"+this.roleId].play(0,true)}break;case"launch":this.attackCallback();break}}stopHandler(){let time=0;if(this.killed){this.owner.removeSelf();return}if(this.sectionAni==1){this.sectionAni+=1;this.skeleton.play("dodge2",true);if(this.roleId==1){time=800}else if(this.roleId==2){time=200}else if(this.roleId==4){time=1e3}else if(this.roleId==3){time=1e3}Laya.timer.once(time,this,()=>{this.sectionAni+=1;this.skeleton.play("dodge3",false)});return}if(this.sectionAni==3){this.removeDodge()}if(this.plasyState||this.freezeState){console.log(`------freeze still-------`);this.skeleton.play("freeze",true);return}if(this.dizzyState){console.log(`------dizzy still-------`);this.skeleton.play("dizzy",true);return}if(!this.isSelf){this.canAction=true}this.skeleton.play("stand",true)}skillCallback(){}attackCallback(){}showSkill1(){this.skeleton.play("skill1",false)}showSkill2(){this.skeleton.play("skill2",false)}removeSkill2(){if(this["aniSkill2Hero"+this.roleId]){this["aniSkill2Hero"+this.roleId].visible=false;this["aniSkill2Hero"+this.roleId].stop()}}skillEffect(){this.aniSkillCommon.visible=true;this.aniSkillCommon.play(0,false)}removeSkillEffect(){this.aniSkillCommon.stop();this.boxAniPoison.visible=false}attackEffect(weaponSkillEffect){this.skeleton.play("attack",false);if(weaponSkillEffect){this.skillEffect()}}injuredEffect(posType,value,isCrit,cb){if(!this.isSelf){this.canAction=false}this.HPComp.changeHP(value);if(isCrit){this.showFontEffect("暴击"+value,"crit")}else{this.showFontEffect(value,"hurt")}if(this.HPComp.curHP<=0){console.warn(`---------------死亡结束---------------`);Laya.timer.clearAll(this);this.removeAllAni();GameControl.instance.deathHandler(this.isSelf);this.killed=true;this.skeleton.play("death",false);return}let aniName=this.typeAniName[posType];this.skeleton.play("injured",false);this["boxAni"+aniName].visible=true;this["ani"+aniName].play(0,false);this.skeleton.once(Laya.Event.LABEL,this,e=>{if(e.name==="injuredEnd"){cb&&cb()}})}removeAllAni(){this.boxAniPoison.visible=false;this.aniPoison.stop();this.freeze.visible=false;this.boxAniPalsy.visible=false;this.aniPalsy.stop();this.boxAniDizzy.visible=false;this.aniDizzy.stop()}hpRecoverEffect(value){this.boxAniHp.visible=true;this.aniHp.play(0,false);this.HPComp.changeHP(value);this.showFontEffect("+"+value,"recoverHP")}mpRecoverEffect(value){this.boxAniMp.visible=true;this.aniMp.play(0,false);this.MPComp.changeMP(value);this.showFontEffect("+"+value,"recoverMP")}poisonEffect(poisonTime,hpValue){if(this.attr.notPoison==1){this.showPlayerState("免疫");return}this.boxAniPoison.visible=true;this.aniPoison.play(0,true);let startTime=(new Date).getTime();let endTime=startTime+poisonTime+1e3;this.showPlayerState("中毒");Laya.timer.loop(1e3,this,this.minusHp,[endTime,hpValue])}minusHp(endTime,hpValue){if((new Date).getTime()>endTime){this.removePoison();return}let showText=hpValue>0?"中毒+"+hpValue:"中毒"+hpValue;this.showFontEffect(showText,"poision");this.HPComp.changeHP(hpValue);if(this.HPComp.curHP<=0){console.error("--------中毒死亡结束--------");this.removePoison();this.killed=true;this.skeleton.play("death",false);GameControl.instance.deathHandler(this.isSelf);return}}removePoison(){Laya.timer.clear(this,this.minusHp);this.boxAniPoison.visible=false;this.aniPoison.stop()}dizzyEffect(dizzyTime){if(this.attr.notDizzy==1){this.showPlayerState("免疫");return}console.log(`------dizzy-------`);this.canAction=false;this.dizzyState=true;if(this.isSelf){GameControl.instance.allBtnsLock()}this.boxAniDizzy.visible=true;this.aniDizzy.play(0,true);this.skeleton.play("dizzy",true);this.showPlayerState("晕眩");Laya.timer.once(dizzyTime,this,this.removeDizzy)}removeDizzy(){console.log(`------remove dizzy-------`);if(!this.freezeState&&!this.plasyState){this.canAction=true;this.skeleton.play("stand",true)}this.dizzyState=false;if(this.isSelf){GameControl.instance.allBtnsUnlock()}this.boxAniDizzy.visible=false;this.aniDizzy.stop()}palsyEffect(palsyTime){if(this.attr.notPalsy==1){this.showPlayerState("免疫");return}console.log(`------palsy-------`);this.plasyState=true;this.canAction=false;if(this.isSelf){GameControl.instance.allBtnsLock()}this.boxAniPalsy.visible=true;this.aniPalsy.play(0,true);this.skeleton.play("freeze",true);this.showPlayerState("麻痹");Laya.timer.once(palsyTime,this,this.removePalsy)}removePalsy(){console.log(`------remove palsy-------`);if(!this.freezeState&&!this.dizzyState){this.canAction=true;this.skeleton.play("stand",true)}this.plasyState=false;if(this.isSelf){GameControl.instance.allBtnsUnlock()}this.boxAniPalsy.visible=false;this.aniPalsy.stop()}freezedEffect(freezeTime=3e3){if(this.attr.notFrozen==1){this.showPlayerState("免疫");return}console.log(`------freeze-------`);this.canAction=false;this.freezeState=true;if(this.isSelf){GameControl.instance.allBtnsLock()}this.freeze.visible=true;this.skeleton.play("freeze",true);this.freeze.play("freeze",false);this.showPlayerState("冰冻");Laya.timer.once(freezeTime,this,this.removeFreeze)}removeFreeze(){console.log(`------remove freeze-------`);if(!this.plasyState&&!this.dizzyState){this.canAction=true;this.skeleton.play("stand",true)}this.freezeState=false;if(this.isSelf){GameControl.instance.allBtnsUnlock()}this.freeze.visible=false}dragonEffect(freezeTime=3e3){this.canAction=false;this.freezeStateDragon=true;if(this.isSelf){GameControl.instance.allBtnsLock()}this.skeleton.play("freeze",true);Laya.timer.once(freezeTime,this,this.removeDragonEffect)}removeDragonEffect(){console.log(`------remove freeze-------`);this.freezeStateDragon=false;if(this.isSelf){GameControl.instance.allBtnsUnlock()}if(!this.plasyState&&!this.freezeState&&!this.dizzyState){this.canAction=true;this.skeleton.play("stand",true)}}dodgeEffect(){this.sectionAni=1;this.dodge=true;this.owner.zOrder=100;this.skeleton.play("dodge1",false);if(this.isSelf){GameControl.instance.allBtnsLock()}}removeDodge(){this.owner.zOrder=20;this.sectionAni=0;this.dodge=false;if(this.isSelf){GameControl.instance.allBtnsUnlock()}}changePerMp(time,valuePer){this.MPComp.changePerMP(this.MPComp.perAddMP*valuePer);Laya.timer.once(time,this,this.recoverPerMp)}recoverPerMp(){this.MPComp.changePerMP(this.MPComp.originPerAddMP)}showPlayerState(value){let lblState=Laya.Pool.getItemByClass("effectState",Laya.Label);this.lblState=lblState;lblState.text=value;lblState.font="playerState";lblState.alpha=1;lblState.leading=30;let endPos;if(this.isSelf){lblState.scaleX=1.5}else{lblState.scaleX=-1.5}lblState.scaleY=1.5;endPos={y:-60};lblState.y=60;lblState.pivot(lblState.width/2,lblState.height/2);lblState.x=this.centerX;this.owner.addChild(lblState);var tween=new Laya.Tween;tween.to(lblState,{y:endPos.y},500,Laya.Ease.linearIn,Laya.Handler.create(this,function(item){item.removeSelf();Laya.Pool.recover("effectLabel",item)},[lblState]))}showFontEffect(value,type){let hurt=Laya.Pool.getItemByClass("effectLabel",Laya.Label);this.hurt=hurt;hurt.text=value;hurt.font=type;hurt.alpha=1;hurt.leading=30;let endPos;let targetScaleX;if(this.isSelf){hurt.scaleX=2.5;targetScaleX=1}else{hurt.scaleX=-2.5;targetScaleX=-1}hurt.scaleY=2.5;endPos={y:-60};hurt.y=40;hurt.pivot(hurt.width/2,hurt.height/2);hurt.x=this.centerX;this.owner.addChild(hurt);var tween=new Laya.Tween;tween.to(hurt,{y:endPos.y,scaleX:targetScaleX,scaleY:1},600,Laya.Ease.linearIn,Laya.Handler.create(this,function(item){item.removeSelf();Laya.Pool.recover("effectLabel",item)},[hurt]))}onDisable(){Laya.Pool.recover("player",this.owner)}onDestroy(){this.skeleton.off(Laya.Event.STOPPED,this);this.skeleton.off(Laya.Event.LABEL,this)}}class MPBar extends PaoYa.Component{constructor(){super()}onAwake(){this.originW=this.owner.width;this.imgMP.mask=this.imgMask;this.loopTime=320}onEnable(){}initBar(MPValue){console.log("初始的体力值:",MPValue);this.originMP=this.curMP=MPValue;this.imgMask.width=this.owner.width;this.perAddMP=Math.ceil(this.originMP/600*20);this.originPerAddMP=this.perAddMP;this.lblMpPct.text=`${this.curMP}/${this.originMP}`;this.startBar()}startBar(){Laya.timer.loop(this.loopTime,this,this.autoIncreaseBar)}autoIncreaseBar(){if(this.curMP>=this.originMP){return}let addedValue=Number((this.curMP+this.perAddMP).toFixed(1));this.curMP=addedValue>this.originMP?this.originMP:addedValue;this.lblMpPct.text=`${this.curMP}/${this.originMP}`;this.imgMask.width=Math.floor(this.curMP/this.originMP*this.originW)}changeMP(value){this.curMP+=value;if(this.curMP<0){this.curMP=0}else if(this.curMP>this.originMP){this.curMP=this.originMP}this.curMP=Math.round(this.curMP);this.imgMask.width=Math.floor(this.curMP/this.originMP*this.originW);this.lblMpPct.text=`${this.curMP}/${this.originMP}`}changePerMP(value){this.perAddMP=value}updateBar(){}stopIncrease(){Laya.timer.clear(this,this.autoIncreaseBar)}pause(){Laya.timer.clear(this,this.autoIncreaseBar)}resume(){Laya.timer.loop(this.loopTime,this,this.autoIncreaseBar)}onDisable(){Laya.timer.clear(this,this.autoIncreaseBar)}onDestroy(){}}class HPBar extends PaoYa.Component{constructor(){super()}onAwake(){}onEnable(){}initBar(HPValue){this.originW=this.owner.width;this.imgMask.width=this.owner.width;console.log("初始的血量值:",HPValue);this.originHP=this.curHP=HPValue;this.lblHpPct.text=`${this.curHP}/${this.originHP}`}changeHP(value){this.curHP+=value;if(this.curHP<=0){this.curHP=0;this.lblHpPct.text=`${this.curHP}/${this.originHP}`;this.imgMask.width=0;return}else if(this.curHP>this.originHP){this.curHP=this.originHP}this.curHP=Math.round(this.curHP);this.lblHpPct.text=`${this.curHP}/${this.originHP}`;let w=Math.floor(this.curHP/this.originHP*this.originW);this.imgMask.width=w}onDisable(){}onDestroy(){}}class WeaponManager extends Laya.Script{constructor(robotWeaponList){super();this.weaponList=[];for(let i=0,len=robotWeaponList.length;i<len;i++){let weapon=new PrivateWeapon(robotWeaponList[i]);this.weaponList.push(weapon)}}seletedWeapon(index){if(index!=undefined){return this.weaponList[index]}let weapons=[];for(let i=0,len=this.weaponList.length;i<len;i++){if(!this.weaponList[i].freezeing){weapons.push(this.weaponList[i])}}let random=Math.floor(Math.random()*weapons.length);return weapons[random]}}class PrivateWeapon{constructor(weaponParams){this.params=deepMerge(weaponParams);this.freezeing=false;this.isSelf=false;this.weaponConsume=this.params.weaponConsume}selectedHandler(){if(this.freezeing){console.error("机器人兵器冷却中，不可使用");return false}}startT(){console.error("机器人兵器进行冷却");this.freezeing=true;Laya.timer.once(this.params.weaponCd*1e3,this,this.changeStatus)}changeStatus(){this.freezeing=false}}function deepMerge(...objs){const result=Object.create(null);objs.forEach(obj=>{if(obj){Object.keys(obj).forEach(key=>{const val=obj[key];if(isPlainObject(val)){if(isPlainObject(result[key])){result[key]=deepMerge(result[key],val)}else{result[key]=deepMerge(val)}}else{result[key]=val}})}});return result}function isPlainObject(val){return Object.prototype.toString.call(val)==="[object Object]"}class Skill extends PaoYa.Component{constructor(){super()}onEnable(){}clickHandler(){if(GameControl.instance.gameState!=`start`){GameControl.instance.showTips("游戏未开始");return}if(!GameControl.instance.selfPlayer.comp.canAction||GameControl.instance.selfPlayer.comp.dodge){GameControl.instance.showTips("无法行动");return}if(this.freezeing){GameControl.instance.showTips("技能未冷却");return}this.postNotification(Skill.CLICK,[this.owner.name])}init(params){let owner=this.owner;this.ownW=owner.width;this.ownH=owner.height;this.centerX=Math.floor(this.ownW/2);this.centerY=Math.floor(this.ownH/2);this.maskArea=new Laya.Sprite;this.spSkill.texture=``;this.maskArea.texture=``;Laya.loader.load(`local/common/${params.skillId}.png`,Laya.Handler.create(this,()=>{this.spSkill.texture=`local/common/${params.skillId}.png`;this.maskArea.texture=`local/common/${params.skillId}.png`}));owner.addChild(this.maskArea);this.spMask=new Laya.Sprite;this.maskArea.mask=this.spMask;this.spMask.graphics.clear();this.freezeing=false;this.maxAngle=270;this.startAngle=-90;this.endAngle=-90;this.cdTime=params.skillCd*1e3;if(!params.status){this.lblLockTips.visible=true;this.lblLockTips.font="weaponNFontT";this.lblLockTips.text=`LV.${params.skillUnlock}解锁`;this.spShadow.visible=true;this.lblLockTips.scale(.5,.5);this.owner.disabled=true}else{this.spShadow.visible=false;this.lblLockTips.visible=false}}onThrottleClick(){this.clickHandler()}setCdTime(cdTime){console.warn("修改cd时间:",cdTime);this.cdTime=cdTime}startT(time){this.spShadow.visible=true;this.maskArea.visible=true;this.freezeing=true;this.beiginTime=(new Date).getTime();this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.centerX,this.centerY,this.ownW,this.startAngle,this.endAngle,"#000000");let cdT=time==undefined?this.cdTime:time;Laya.timer.frameLoop(1,this,this.startCd,[cdT])}startCd(time){if(this.endAngle>=this.maxAngle){this.endCD();return}this.endAngle+=Laya.timer.delta*360/time;this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.centerX,this.centerY,this.ownW,this.startAngle,this.endAngle,"#000000")}pause(){this.freezeing&&Laya.timer.clear(this,this.startCd)}resume(){this.freezeing&&Laya.timer.frameLoop(1,this,this.startCd,[this.cdTime])}endCD(){this.spMask.graphics.clear();Laya.timer.clearAll(this);this.maskArea.visible=false;this.spShadow.visible=false;this.freezeing=false;this.endAngle=-90}}Skill.CLICK="skillClick";class Dodge extends PaoYa.Component{constructor(){super()}onAwake(){let owner=this.owner;this.ownW=owner.width;this.ownH=owner.height;this.spShadow.visible=false;this.maskArea=new Laya.Sprite;this.maskArea.texture="remote/game/dodge.png";owner.addChild(this.maskArea);this.spMask=new Laya.Sprite;this.maskArea.mask=this.spMask;this.cdTime=2e4;this.freezeing=false;this.maxAngle=270;this.startAngle=-90;this.endAngle=-90}onThrottleClick(){this.clickHandler()}clickHandler(){if(GameControl.instance.gameState!=`start`){GameControl.instance.showTips("游戏未开始");return}if(!GameControl.instance.selfPlayer.comp.canAction||GameControl.instance.selfPlayer.comp.dodge){GameControl.instance.showTips("无法行动");return}if(this.freezeing){GameControl.instance.showTips("技能未冷却");return}GameControl.instance.dodgeSkillShow(true)}startT(time){this.spShadow.visible=true;this.maskArea.visible=true;this.freezeing=true;this.beiginTime=(new Date).getTime();this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.ownW/2,this.ownH/2,this.ownW,this.startAngle,this.endAngle,"#000000");let cdT=time==undefined?this.cdTime:time;Laya.timer.frameLoop(1,this,this.startCd,[cdT])}startCd(time){if(this.endAngle>=this.maxAngle){this.endCD();return}this.endAngle+=Laya.timer.delta*360/time;this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.ownW/2,this.ownH/2,this.ownW,this.startAngle,this.endAngle,"#000000")}pause(){this.freezeing&&Laya.timer.clear(this,this.startCd)}resume(){this.freezeing&&Laya.timer.frameLoop(1,this,this.startCd,[this.cdTime])}endCD(){Laya.timer.clearAll(this);this.maskArea.visible=false;this.spShadow.visible=false;this.freezeing=false;this.endAngle=-90}}class PlayerState extends PaoYa.Component{constructor(){super()}onAwake(){}setStateText(value){this.owner.visible=true;this.lblState.text=value;this.lblState.font="playerState";Laya.timer.clear(this,this.hide);Laya.timer.once(500,this,this.hide)}hide(){this.owner.visible=false}onDisable(){}onDestroy(){}}class PlayerSkill extends PaoYa.Component{constructor(){super()}onAwake(){this.tweenImg=new Laya.Tween;this.timeLine=new Laya.TimeLine;this.lblState.font="playerSkill";this.timeLine.to(this.lblState,{scaleX:1.5,scaleY:1.5},500,Laya.Ease.backOut,null).to(this.owner,{alpha:0},300,null,800);this.timeLine.on("complete",this,()=>{this.owner.visible=false})}setSkillText(value){this.owner.visible=true;this.imgBg.alpha=0;this.owner.alpha=1;this.lblState.text=value;this.lblState.scale(5,5);this.tweenImg.complete();this.tweenImg.to(this.imgBg,{alpha:1},500);this.timeLine.play(0,false)}onDisable(){}onDestroy(){this.tweenImg&&this.tweenImg.clear();this.tweenImg=null;this.timeLine&&this.timeLine.destroy();this.timeLine=null}}class WeaponSkill extends PaoYa.Component{constructor(){super()}onAwake(){this.timeLine=new Laya.TimeLine;this.lblWeaponSkill.font="weaponSkill";this.timeLine.on(Laya.Event.COMPLETE,this,this.removeSelf)}onEnable(){let params=this.owner.params;let skillName=params.skillName;this.lblWeaponSkill.text=skillName;let owner=this.owner;owner.alpha=1;let targetX=params.isSelf?0:1170;this.timeLine.to(owner,{x:targetX},500,Laya.Ease.backOut,0).to(owner,{alpha:0},500);this.timeLine.play()}removeSelf(){this.timeLine.reset();this.owner.removeSelf()}onDisable(){Laya.Pool.recover("weaponSkillBox",this.owner)}onDestroy(){this.timeLine&&this.timeLine.destroy();this.timeLine=null}}class GameBanner extends PaoYa.Component{constructor(){super()}onAwake(){this.lblGameType.font="weaponNFontT"}changeStyle(params){if(params.gameType==`battle`){this.lblGameType.text="匹配赛";this.startCount()}else if(params.gameType==`pass`||params.gameType==`adventure`){if(params.gameType==`pass`){this.lblGameType.text=`第${params.curNum}关`}else{this.lblGameType.text=`奇遇`}this.lblTime.text=`${params.battleIndex}/${params.monsterNum}`}}setTimeText(value){this.lblTime.text=value}startCount(){let timerService=new PaoYa.TimerService(1e3,1,true);timerService.on(PaoYa.TimerService.PROGRESS,this,time=>{this.lblTime.text=time.formatTime("M:S")+""});timerService.on(PaoYa.TimerService.STOP,this,()=>{});timerService.start();this.timerService=timerService}pause(){}resume(){}stop(){this.timerService.stop()}onDestroy(){this.timerService&&this.timerService.stop();this.timerService=null}}let instance;class PreOpenManager extends Laya.EventDispatcher{constructor(cb){super();if(instance){Laya.timer.callLater(this,cb);return instance}instance=this;this.cb=cb;Laya.loader.create("gamescenes/prefab/PreOpenView.json",Laya.Handler.create(this,this.onComplete))}onComplete(obj){let preOpenView=new Laya.Prefab;preOpenView.json=obj;let view=Laya.Pool.getItemByCreateFun("PreOpenView",preOpenView.create,preOpenView);Laya.stage.addChild(view);view.width=Laya.stage.width;this.view=view;this.view.on(`end`,this,this.endHandler);this.cb()}init(){}start(data){if(this.view){this.view.visible=true;this.view.start(data)}}endHandler(){if(this.view){this.view.visible=false;this.event(PreOpenManager.TALKEND)}}}PreOpenManager.TALKEND=`talkend`;const config={debug:true,version:"1.0",release:10};var Global={baseUrl:"https://xgamejuedixiaomie.goxiaochengxu.cn/1005/",remoteUrl:"",skTemplate:{},shareNum:0,shareNumSuc:0,shareNumFail:0,AdaptiveWidth:0,gameHeight:null,isShowGrading:false,wpGuide:{userWeapons:`d001_1-1,z001_1-1,g001_1-1`,lightList:[{exp:0,num:1,skills:[{skillCd:0,skillConfig:{weaponNum:2},skillDesc:"发出2件兵器",skillId:43,skillLevel:1,skillName:"双刃",skillProb:18,skillType:1,skillUnlock:0,status:0}],upgradeCost:150,weaponAttack:20,weaponCd:2,weaponConsume:25,weaponDownConsume:0,weaponDurable:10,weaponIcon:"一把极其普通的铜匕首，布满斑驳的铜锈，村口后山随手都可以捡到。",weaponId:"d001_1",weaponLevel:1,weaponName:"铜匕首",weaponPrice:1e3,weaponSalePrice:200,weaponSkills:"43",weaponStar:1,weaponTopLevel:5,weaponType:1,weaponUpAttack:0,weaponUpDurable:0},{exp:0,num:1,skills:[{skillCd:0,skillConfig:{critHarm:5,critProb:1},skillDesc:"暴击+1%，爆伤+5%",skillId:63,skillLevel:1,skillName:"灵巧",skillProb:100,skillType:0,skillUnlock:0,status:0}],upgradeCost:0,weaponAttack:23,weaponCd:1.8,weaponConsume:16,weaponDownConsume:0,weaponDurable:10,weaponIcon:"一把用黄金打造的匕首，想必原主人一定十分阔气。",weaponId:"d003_1",weaponLevel:1,weaponName:"黄金匕首",weaponPrice:0,weaponSalePrice:300,weaponSkills:"63",weaponStar:1,weaponTopLevel:5,weaponType:1,weaponUpAttack:0,weaponUpDurable:0,willBeUse:1}],middleList:[{exp:0,num:1,skills:[{skillCd:0,skillConfig:{stealHp:1},skillDesc:"100%伤害转化为生命",skillId:53,skillLevel:1,skillName:"嗜血",skillProb:18,skillType:1,skillUnlock:0,status:0}],upgradeCost:150,weaponAttack:38,weaponCd:3,weaponConsume:25,weaponDownConsume:0,weaponDurable:10,weaponIcon:"一把极其普通的铁剑，布满斑驳的铁锈，习武之人的入门兵器。",weaponId:"z001_1",weaponLevel:1,weaponName:"铁剑",weaponPrice:1e3,weaponSalePrice:200,weaponSkills:"53",weaponStar:1,weaponTopLevel:5,weaponType:2,weaponUpAttack:0,weaponUpDurable:0}],heavyList:[{exp:0,num:1,skills:[{skillCd:0,skillConfig:{hurt:1.5},skillDesc:"造成1.5倍伤害",skillId:56,skillLevel:1,skillName:"重击",skillProb:15,skillType:1,skillUnlock:0,status:0}],upgradeCost:150,weaponAttack:57,weaponCd:4,weaponConsume:39,weaponDownConsume:0,weaponDurable:10,weaponIcon:"砍树常用的斧子，当然也可以用来砍人。",weaponId:"g001_1",weaponLevel:1,weaponName:"铁斧",weaponPrice:1e3,weaponSalePrice:200,weaponSkills:"56",weaponStar:1,weaponTopLevel:5,weaponType:3,weaponUpAttack:0,weaponUpDurable:0}],shareGrid:0,weaponGridNum:3,buyGrid:0},skBank:{},getTemplate(cb){for(var key in this.skBank){if(this.skTemplate[key]);else{skLoading.call(this,key)}}function skLoading(key){let mFactory=new Laya.Templet;mFactory.on(Laya.Event.COMPLETE,this,()=>{parseComplete.call(this,mFactory,key)});mFactory.loadAni(this.skBank[key])}function parseComplete(mFactory,key){this.skTemplate[key]=mFactory;if(key=="getheroY"){cb&&cb()}}},appointSk(caller,key,cb){if(this.skTemplate[key]){cb&&cb.call(caller,this.skTemplate[key])}else{let mFactory=new Laya.Templet;mFactory.on(Laya.Event.COMPLETE,this,()=>{parseComplete.call(this,mFactory,key)});mFactory.loadAni(this.skBank[key]);function parseComplete(mFactory,key){this.skTemplate[key]=mFactory;cb&&cb.call(caller,this.skTemplate[key])}}},regFont(){var weaponDFont=new Laya.BitmapFont;weaponDFont.loadFont("font/weapon/detailfont.fnt",Laya.Handler.create(this,function(){Laya.Text.registerBitmapFont("weaponDFont",weaponDFont)}));var weaponNFontT=new Laya.BitmapFont;weaponNFontT.loadFont("font/weapon/lvfont.fnt",Laya.Handler.create(this,function(){Laya.Text.registerBitmapFont("weaponNFontT",weaponNFontT)}))},dataPoints(data,obj){{return}if(obj){PaoYa.Request.POST("game_point",obj)}if(typeof wx=="undefined"){return}wx.aldSendEvent(data)},gameStartStat(num){{return}if(typeof wx=="undefined"){return}wx.aldStage.onStart({stageId:`${num}`,stageName:`第${num}关`})},gameEndStat(num,obj){{return}if(typeof wx=="undefined"){return}wx.aldStage.onEnd({stageId:`${num}`,stageName:`第${num}关`,event:obj.static,params:{desc:obj.zhstatic}})},gameUsePropStat(num){{return}if(typeof wx=="undefined"){return}wx.aldStage.onRunning({stageId:`${num}`,stageName:`第${num}关`,event:`tools`,params:{itemName:`电灯泡`}})}};class GameControl extends PaoYa.Component{constructor(){super();GameControl.instance=this;Laya.MouseManager.multiTouchEnabled=false;this.closeRobot=false}onDisappear(){Laya.MouseManager.enabled=true}onAwake(){Laya.Pool.clearBySign("weapon");Laya.Pool.clearBySign("player");Laya.MouseManager.enabled=true;this.params=this.owner.params;this.gameType=this.params.gameType;this.restart();this.dodgeComp=this.owner.dodge.getComponent(Dodge);this.dodgeOwner=this.dodgeComp.owner;this.playerStateComp=this.playerState.getComponent(PlayerState);this.selfSkillText=this.owner.selfSkillText;this.otherSkillText=this.owner.otherSkillText;this.selfSkillTextComp=this.selfSkillText.getComponent(PlayerSkill);this.otherSkillTextComp=this.otherSkillText.getComponent(PlayerSkill);this.weaponsBarArr=[];this.initWeaponsBar()}onEnable(){this.onNotification(WeaponBar.CLICK,this,this.weaponBarClickHandler);this.onNotification(Skill.CLICK,this,this.skillClickHandler);this.fillPlayerInfo();this.initSkill()}onHide(){if(!this.closeRobot&&!this.hasInterstitialAd){this.manager&&(this.manager.view.visible=false);this.navigator.popToRootScene()}}restart(){let _this=this;this.showMaskAni();this.selfMultiMP=1;this.otherMultiMP=1;this.selfWeapons=[];this.otherWeapons=[];this.selfPlayer&&this.selfPlayer.node&&this.selfPlayer.node.removeSelf();this.otherPlayer&&this.otherPlayer.node&&this.otherPlayer.node.removeSelf();this.weaponList=this.params.weaponList;this.robotWeaponList=JSON.parse(JSON.stringify(this.params.robotWeaponList));this.role=JSON.parse(JSON.stringify(this.params.role));this.robotRole=JSON.parse(JSON.stringify(this.params.robotRole));this.dealParams(this.weaponList);this.dealParams(this.robotWeaponList);if(this.gameType==`pass`||this.gameType==`adventure`){this.initGameBanner();SoundManager.ins.passBg()}else{SoundManager.ins.battleBg();Laya.timer.once(1e3,this,()=>{this.boxGameBanner.getComponent(GameBanner).changeStyle({gameType:this.gameType})})}this.resetPlayerInfo();this.errorIndex=0;if(!this.closeRobot){if(this.params.stageId<3||this.params.stageId>7){var adParams={onClose:function onClose(res){_this.gameState="start";console.log(`关闭广告`);_this.beforeGame()},onError:function onError(res){if(_this.errorIndex==0){_this.errorIndex++;_this.gameState="start";console.log(`拉取广告失败`);_this.hasInterstitialAd=false;_this.beforeGame()}}};this.hasInterstitialAd=true;PaoYa.InterstitialAd.show(adParams)}else{this.gameState="start";this.beforeGame()}}}dragonLaunch(skillType=1){console.log(`------召唤神龙1------`);if(skillType==1){this.skillScr1.startT()}else{this.skillScr2.startT()}let dragonBg=new Laya.Sprite;dragonBg.size(Laya.Browser.width,Laya.Browser.height);this.dragonBg=dragonBg;dragonBg.zOrder=2e3;this.owner.addChild(dragonBg);let dragonAni=new Laya.Animation;dragonAni.loadAnimation(`gamescenes/animations/hero4_skill${skillType}.ani`,Laya.Handler.create(this,ani=>{console.log(dragonAni.width);dragonAni.play(0,true);Laya.timer.frameLoop(1,this,this.sportDragon,[skillType])}),`res/atlas/remote/hero_skill/hero4_skill1.atlas`);dragonAni.pos(-80,446);this.dragonAni=dragonAni;dragonBg.addChild(dragonAni);let maskSP=new Laya.Sprite;if(skillType==1){maskSP.graphics.drawRect(310,0,800,750,"#ff0000")}else{maskSP.graphics.drawRect(340,0,770,750,"#ff0000")}dragonBg.mask=maskSP;this.dragonCollide=false;let launchAni=new Laya.Animation;launchAni.loadAnimation(`gamescenes/animations/hero4_launch1.ani`,Laya.Handler.create(this,()=>{launchAni.play(0,false)}),`res/atlas/remote/hero_skill/hero4_skill1.atlas`);if(skillType==1){launchAni.pos(330,430)}else{launchAni.pos(350,426)}launchAni.zOrder=2001;this.launchAni=launchAni;this.owner.addChild(launchAni);console.log(`------召唤神龙2------`)}sportDragon(skillType){this.dragonAni.x+=25;if(!this.dragonCollide&&this.dragonAni.x+423>1120){this.dragonCollide=true;this.addDragonCollideAni(skillType);this.dragonHurt(skillType)}if(this.dragonAni.x>1334||this.gameState==`over`){console.log(`【------移除神龙------】`);this.removeDragons(skillType)}}removeDragons(skillType){Laya.timer.clear(this,this.sportDragon);if(this.dragonAni){this.dragonAni.stop();this.dragonAni.removeSelf()}if(skillType==1){if(this.collideAni){this.collideAni.stop();this.collideAni.removeSelf()}}else{if(this.collideAni1){this.collideAni1.stop();this.collideAni1.removeSelf()}if(this.collideAni2){this.collideAni2.stop();this.collideAni2.removeSelf()}}this.owner.removeChild(this.dragonBg)}addDragonCollideAni(skillType){if(skillType==1){let collideAni=new Laya.Animation;collideAni.loadAnimation(`gamescenes/animations/hero4_injured1.ani`,Laya.Handler.create(this,ani=>{collideAni.play(0,true)}),`res/atlas/remote/hero_skill/hero4_injured1.atlas`);collideAni.pos(1080,420);collideAni.zOrder=2200;this.owner.addChild(collideAni);this.collideAni=collideAni}else if(skillType==2){let collideAni1=new Laya.Animation;collideAni1.loadAnimation(`gamescenes/animations/hero4_injured1.ani`,Laya.Handler.create(this,ani=>{collideAni1.play(0,true)}),`res/atlas/remote/hero_skill/hero4_injured1.atlas`);collideAni1.pos(1092,380);collideAni1.zOrder=2200;this.owner.addChild(collideAni1);this.collideAni1=collideAni1;let collideAni2=new Laya.Animation;collideAni2.loadAnimation(`gamescenes/animations/hero4_injured1.ani`,Laya.Handler.create(this,ani=>{collideAni2.play(0,true)}),`res/atlas/remote/hero_skill/hero4_injured1.atlas`);collideAni2.pos(1060,480);collideAni2.zOrder=2200;this.owner.addChild(collideAni2);this.collideAni2=collideAni2}}dragonHurt(skillType){console.log(skillType);let attackNum=0;if(skillType==1){attackNum=Math.round(this.selfPlayer.comp.attr.roleStrength*.22)}else if(skillType==2){attackNum=Math.round(this.selfPlayer.comp.attr.roleStrength*.5)}let dizzyT=400;this.otherPlayer.comp.injuredEffect(1,-attackNum,false,()=>{this.otherPlayer.comp.dragonEffect(dizzyT)})}beforeGame(){if(this.params.stage){let manager=new PreOpenManager(()=>{manager.start(this.params.stage)});manager.on(PreOpenManager.TALKEND,this,()=>{Laya.timer.once(2e3,this,this.firstWeaponSelect)});this.manager=manager}else{if(!this.closeRobot){if(this.gameType==`battle`){Laya.timer.once(250,this,this.firstWeaponSelect)}else{Laya.timer.once(1e3,this,this.firstWeaponSelect)}}}}showMaskAni(){let maskArea=new Laya.Sprite;maskArea.alpha=.9;maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000");maskArea.mouseEnabled=true;maskArea.zOrder=2e3;Laya.stage.addChild(maskArea);let tween=new Laya.Tween;tween.to(maskArea,{alpha:.4},600,null,Laya.Handler.create(this,()=>{tween.clear();Laya.stage.removeChild(maskArea)}))}fillPlayerInfo(){this.initPlayer(true);this.initPlayer(false)}resetPlayerInfo(){let myRoleName="";let otherRoleName="";if(this.gameType==`battle`){myRoleName=this.params.nickName;otherRoleName=this.params.robotNickName}else{myRoleName=this.role.roleName;otherRoleName=this.robotRole.roleName}this.owner.setInfo({name:myRoleName,icon:`local/common/${this.role.roleDress}.png`},true);this.owner.setInfo({name:otherRoleName,icon:`local/common/${this.robotRole.roleDress}.png`},false)}initGameBanner(){this.monsterNum=this.params.monsterList.length;this.killNum=0;this.battleIndex=1;this.curNum=this.params.stageId;this.boxGameBanner.getComponent(GameBanner)&&this.boxGameBanner.getComponent(GameBanner).changeStyle({gameType:this.gameType,curNum:this.curNum,battleIndex:this.battleIndex,monsterNum:this.monsterNum})}drawParabola(){let space=5;let pathArr=[];this.startPos={x:180,y:450};this.endPos={x:1150,y:450};pathArr.push(["moveTo",0,0]);this.driftX=this.endPos.x-this.startPos.x;this.driftY=this.endPos.y-this.startPos.y;this.b=(this.driftY-this.curvature*this.driftX*this.driftX)/this.driftX;for(let i=5;i<=this.driftX;i+=space){let x=i;let y=Math.floor(this.curvature*x*x+this.b*x);pathArr.push(["lineTo",x,y])}pathArr.push(["closePath"]);this.owner.spDraw.graphics.drawPath(this.startPos.x,this.startPos.y,pathArr,null,{strokeStyle:"#ff0000",lineWidth:2,lineCap:"round"})}dealParams(weaponList){for(var i=0;i<weaponList.length;i++){let weapon=weaponList[i];let weaponSkills=weapon["skills"];for(var j=0;j<weaponSkills.length;j++){if(weaponSkills[j].skillType==1){weapon.activeSkill=JSON.parse(JSON.stringify(weaponSkills[j]))}}}}onUpdate(){if(!this.weaponsBarArr.length||!this.selfPlayer){return}if(this.selfPlayer.comp.dodge){return}let curMP=this.selfPlayer.comp.MPComp.curMP;let originMP=this.selfPlayer.comp.MPComp.originMP;this.weaponsBarArr.forEach(weaponBarComp=>{if(weaponBarComp.weaponConsume>curMP){if(!weaponBarComp.freezeing){weaponBarComp.owner.gray=true}}else{weaponBarComp.owner.gray=false}});if(curMP<originMP*.2){if(!this.dodgeComp.freezeing){this.dodgeOwner.gray=true}}else{this.dodgeOwner.gray=false}if(!this.skillOwner1.disabled){if(curMP<this.selfSkills[0].skillConsume*originMP){if(!this.skillScr1.freezeing){this.skillOwner1.gray=true}}else{this.skillOwner1.gray=false}}if(!this.skillOwner2.disabled){if(curMP<this.selfSkills[2].skillConsume*originMP){if(!this.skillScr1.freezeing){this.skillOwner2.gray=true}}else{this.skillOwner2.gray=false}}}initWeaponsBar(){let owner=this.owner,boxWeapon=owner.boxWeapon;for(let i=0,len=this.weaponList.length;i<len;i++){let weaponBar=null;if(this.weaponBar.create){weaponBar=this.weaponBar.create.call(this.weaponBar)}else{let prefabWeapon=new Laya.Prefab;prefabWeapon.json=this.weaponBar;weaponBar=prefabWeapon.create.call(prefabWeapon)}let weaponBarComp=weaponBar.getComponent(WeaponBar);weaponBarComp.params=this.weaponList[i];weaponBarComp.isSelf=true;weaponBarComp.index=i;this.weaponsBarArr.push(weaponBarComp);boxWeapon.addChild(weaponBar)}}initPlayer(isSelf){let name=isSelf?"self":"other";let role=isSelf?"role":"robotRole";let player=Laya.Pool.getItemByCreateFun("player",this.player.create,this.player);let spCollide=this.owner[name+"Collide"];let spX=spCollide.x,spY=spCollide.y,spW=spCollide.width,spH=spCollide.height;let component=player.getComponent(Player);component.attr=this[role];if(isSelf){this.selfSkills=this[role].skills}component.activeSkills=[];for(let i=0,len=this[role].skills.length;i<len;i++){if(this[role].skills[i].skillType==1){component.activeSkills.push(this[role].skills[i])}}if(component.attr.skillWeapon){component.attr.skillWeapon.activeSkill=component.attr.skillWeapon.skills[0]}component.MPComp=this[name+"MP"].getComponent(MPBar);component.HPComp=this[name+"HP"].getComponent(HPBar);component.MPComp.initBar(this[role].roleMp);component.HPComp.initBar(this[role].roleHp);component.isSelf=isSelf;if(isSelf){player.pos(220,560);player.scaleX=1}else{player.pos(1120,560);player.scaleX=-1}component.collidePoint=[{x:spX,y:spY},{x:spX+spW,y:spY},{x:spX+spW,y:spY+spH},{x:spX,y:spY+spH}];this.owner.addChild(player);this[name+"Player"]={node:player,comp:component}}initSkill(){let owner=this.owner;let activeSkills=this.selfPlayer.comp.activeSkills;for(let i=1;i<3;i++){this["skillScr"+i]=owner["skill"+i].getComponent(Skill);this["skillScr"+i].params=activeSkills[i-1];this["skillScr"+i].init(activeSkills[i-1]);this["skillOwner"+i]=this["skillScr"+i].owner}}skillClickHandler(name){if(name=="skill1"){SoundManager.ins.heroSkill1();if(this.selfPlayer.comp.attr.roleId!=4){this.skillWithWeapon(true)}else{this.skillWithDragon(true)}}else if(name=="skill2"){SoundManager.ins.heroSkill2();if(this.selfPlayer.comp.attr.roleId!=4){this.skillWithoutWeapon(true)}else{this.skillWithTwoDragon(true)}}}skillWithWeapon(isSelf){let name=isSelf?"self":"other";let roleComp=this[name+"Player"].comp,skillWeapon=JSON.parse(JSON.stringify(roleComp.attr.skillWeapon));let skillInfo=this[name+"Player"].comp.activeSkills[0];let originMP=roleComp.MPComp.originMP;let consumeMP=skillInfo.skillConsume*originMP;if(this[name+"Player"].comp.MPComp.curMP<consumeMP){console.warn(name+"Player"+"__体力不足");if(isSelf){this.showTips("内力不足")}return}if(isSelf){this.skillScr1.startT()}this.showSkillText(isSelf,skillInfo.skillName);skillWeapon.isSelf=isSelf;this[name+"Player"].comp.MPComp.changeMP(-consumeMP);skillWeapon.skillEffect=true;let skillId=skillWeapon.activeSkill.skillId;switch(skillId){case 88:let addCritProb=skillWeapon.activeSkill.skillConfig.critProb;this[name+"Player"].comp.attr.calcCritProb=this[name+"Player"].comp.attr.roleCritProb+addCritProb;break;case 89:break;case 90:break;case 91:break}this[name+"Player"].comp.showSkill1();this[name+"Player"].comp.skillCallback=(()=>{this.weaponLaunch(skillWeapon);this[name+"Player"].comp.skillCallback=(()=>{})})}skillWithDragon(isSelf){let name=isSelf?"self":"other";this[name+"Player"].comp.showSkill1();this[name+"Player"].comp.skillCallback=(()=>{this.dragonLaunch(1)})}skillWithTwoDragon(isSelf){let name=isSelf?"self":"other";this[name+"Player"].comp.showSkill2();this[name+"Player"].comp.skillCallback=(()=>{this.dragonLaunch(2)})}skillWithoutWeapon(isSelf){let name=isSelf?"self":"other";let skillInfo=this[name+"Player"].comp.activeSkills[1];let originMP=this[name+"Player"].comp.MPComp.originMP;let consumeMP=skillInfo.skillConsume*originMP;if(this[name+"Player"].comp.MPComp.curMP<consumeMP){console.warn(name+"Player"+"__体力不足");if(isSelf){this.showTips("内力不足")}return}if(isSelf){this.skillScr2.startT()}this[name+"Player"].comp.MPComp.changeMP(-consumeMP);this[name+"Player"].comp.showSkill2();this.showSkillText(isSelf,skillInfo.skillName);switch(skillInfo.skillId){case 33:this.allWeaponsUnfreeze(name,skillInfo);break;case 36:let t=skillInfo.skillConfig.time,perMP=skillInfo.skillConfig.recoverMp,originHP=this[name+"Player"].comp.HPComp.originHP,resumeHP=skillInfo.skillConfig.recoverHp;this[name+"Player"].comp.changePerMp(t*1e3,perMP);this[name+"Player"].comp.HPComp.changeHP(originHP*resumeHP);Laya.timer.once(t*1e3,this,()=>{this[name+"Player"].comp.removeSkill2()});break;case 39:this[name+"MultiMP"]=skillInfo.skillConfig.consumeMp;console.error("内力消耗倍数:",skillInfo.skillConfig.consumeMp);this.heroSkill2=true;Laya.timer.once(skillInfo.skillConfig.time*1e3,this,()=>{console.error("内力消耗倍数恢复:");this.heroSkill2=false;this[name+"MultiMP"]=1;this[name+"Player"].comp.removeSkill2()});break;case 45:break}}allWeaponsUnfreeze(name,skillInfo){let time=skillInfo.skillConfig.time*1e3;this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.endCD();weaponBarComp.setCdTime(0)});Laya.timer.once(time,this,()=>{this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.setCdTime(weaponBarComp.originCdTime)});this[name+"Player"].comp.removeSkill2()})}allBtnsLock(){this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.owner.gray=true});this.dodgeOwner.gray=true;if(!this.skillOwner1.disabled){this.skillOwner1.gray=true}if(!this.skillOwner2.disabled){this.skillOwner2.gray=true}}allBtnsUnlock(){this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.owner.gray=false});this.dodgeOwner.gray=false;if(!this.skillOwner1.disabled){this.skillOwner1.gray=false}if(!this.skillOwner2.disabled){this.skillOwner2.gray=false}}allPause(isSelf){this.selfWeapons.forEach(weapon=>{weapon.pause()});this.otherWeapons.forEach(weapon=>{weapon.pause()});this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.pause()});if(isSelf){this.otherPlayer.comp.skeleton.paused();this.otherPlayer.node.zOrder=100;this.selfPlayer.node.zOrder=101;this.selfSkillText.zOrder=103}else{this.selfPlayer.comp.skeleton.paused();this.otherPlayer.node.zOrder=101;this.selfPlayer.node.zOrder=100}Laya.timer.clear(this,this.startSelect);this.selfPlayer.comp.MPComp.pause();this.otherPlayer.comp.MPComp.pause();this.skillScr1.pause();this.skillScr2.pause();this.dodgeComp.pause()}allResume(isSelf){this.selfWeapons.forEach(weapon=>{weapon.resume()});this.otherWeapons.forEach(weapon=>{weapon.resume()});this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.resume()});if(isSelf){this.otherPlayer.comp.skeleton.resume();this.selfSkillText.zOrder=1}else{this.selfPlayer.comp.skeleton.resume()}if(!this.closeRobot){this.firstWeaponSelect()}this.selfPlayer.comp.MPComp.resume();this.otherPlayer.comp.MPComp.resume();this.skillScr1.resume();this.skillScr2.resume();this.dodgeComp.resume()}firstWeaponSelect(){this.weaponManager=null;this.weaponManager=new WeaponManager(this.robotWeaponList);this.sWeapon=this.weaponManager.seletedWeapon();if(this.gameType==`battle`){this.startSelect()}else{Laya.timer.once(1e3,this,this.startSelect)}}startSelect(){if(this.seletedLaunch){this.sWeapon=this.weaponManager.seletedWeapon();if(!this.sWeapon){Laya.timer.once(1e3,this,this.startSelect);return}}let curMp=this.otherPlayer.comp.MPComp.curMP;if(curMp>=this.sWeapon.params.weaponConsume){this.seletedLaunch=true;if(this.otherPlayer.comp.canAction){this.sWeapon.isSelf=false;this.sWeapon.selectedHandler();console.log(`------可以动弹------`);this.weaponBarClickHandler(this.sWeapon)}else{console.log("-----无法动弹-----")}if(this.gameType==`pass`||this.gameType==`adventure`){Laya.timer.once(800,this,this.startSelect)}else{Laya.timer.once(300,this,this.startSelect)}}else{this.seletedLaunch=false;Laya.timer.once(500,this,this.startSelect)}}showTips(value){this.playerStateComp.setStateText(value)}showSkillText(isSelf,value){let name=isSelf?"self":"other";this[name+"SkillTextComp"].setSkillText(value)}weaponBarClickHandler(targetComp){let name=targetComp.isSelf?"self":"other";let consumeMP=targetComp.weaponConsume;if(this[name+"Player"].comp.MPComp.curMP<consumeMP){if(targetComp.isSelf){console.warn(name+"Player"+"__体力不足");this.playerStateComp.setStateText("内力不足")}return}if(this.isSelf){console.log("用户发射武器........")}this[name+"Player"].comp.attr.calcCritProb=this[name+"Player"].comp.attr.roleCritProb;let params=JSON.parse(JSON.stringify(targetComp.params));params.skillEffect=false;params.isSelf=targetComp.isSelf;if(targetComp.params.activeSkill){let skill=targetComp.params.activeSkill;let skillType=skill.skillType,status=skill.status,skillId=skill.skillId,prob=skill.skillProb;if(skillType==1&&status==1){let random=Math.floor(Math.random()*100+1);if(random<=prob){params.skillEffect=true;this[name+"Player"].comp.attackEffect(params.skillEffect);this[name+"Player"].comp.attackCallback=(()=>{SoundManager.ins.weaponSkill();this.weaponWithSkills(params,skillId);this[name+"Player"].comp.MPComp.changeMP(-consumeMP*this[name+"MultiMP"]);if(skillId==58){targetComp.startT(200)}else{targetComp.startT()}});return}else{console.warn(`不好意思,${name}没有触发技能`)}}}this[name+"Player"].comp.attackEffect(false);this[name+"Player"].comp.attackCallback=(()=>{SoundManager.ins.weaponLaunch();this.weaponLaunch(params);targetComp.startT();this[name+"Player"].comp.MPComp.changeMP(-consumeMP*this[name+"MultiMP"])})}weaponLaunch(params,deltaT){if(params.isSelf){console.log(`【-------武器发射------】`)}let name=params.isSelf?"self":"other";let weapon=Laya.Pool.getItemByCreateFun("weapon",this.weapon.create,this.weapon);let weaponComp=weapon.getComponent(Weapon);weaponComp.weaponType=params.weaponType;weapon.params=params;weaponComp.isSelf=params.isSelf;if(params.isSelf){weapon.pos(280,450)}else{weapon.pos(1050,450)}if(deltaT){Laya.timer.once(deltaT,this,()=>{this.owner.addChild(weapon);this[name+"Weapons"].push(weaponComp)})}else{this.owner.addChild(weapon);this[name+"Weapons"].push(weaponComp)}}weaponWithSkills(params,skillId){let skillConfig=params.activeSkill.skillConfig;let skillName=params.activeSkill.skillName;let hurt=skillConfig.hurt;let durable=skillConfig.durable;params.skillEffect=true;let weaponSkillBox=Laya.Pool.getItemByCreateFun("weaponSkillBox",this.weaponSkill.create,this.weaponSkill);weaponSkillBox.params={skillName:skillName,isSelf:params.isSelf};if(params.isSelf){weaponSkillBox.pos(-164,189)}else{weaponSkillBox.pos(1498,189)}this.owner.addChild(weaponSkillBox);switch(skillId){case 43:case 44:let weaponNum=skillConfig.weaponNum;console.warn("------修改后的值------:",params.weaponAttack);this.weaponLaunch(params);for(var i=0;i<weaponNum-1;i++){this.weaponLaunch(params,350*(i+1))}break;case 47:case 48:this.weaponLaunch(params);break;case 51:params.weaponType=2;this.weaponLaunch(params);params.weaponType=3;this.weaponLaunch(params);break;case 52:params.weaponType=1;this.weaponLaunch(params);params.weaponType=2;this.weaponLaunch(params);params.weaponType=3;this.weaponLaunch(params);break;case 45:case 46:case 49:case 50:case 53:case 54:case 55:case 59:case 58:this.weaponLaunch(params);break;case 60:params.weaponType=4;this.weaponLaunch(params);break;case 56:case 57:case 61:this.weaponLaunch(params);break;case 62:params.weaponDurable=params.weaponDurable*durable;this.weaponLaunch(params);break}}removeWeapon(target){let targetWeapons=target.isSelf?this.selfWeapons:this.otherWeapons;for(let i=0,len=targetWeapons.length;i<len;i++){if(targetWeapons[i]==target){targetWeapons.splice(i,1);break}}console.log("删除后数组"+target.isSelf,targetWeapons.length)}dodgeSkillShow(isSelf){let name=isSelf?"self":"other";let originMP=this[name+"Player"].comp.MPComp.originMP;let consumeMP=0*originMP;if(this[name+"Player"].comp.MPComp.curMP<consumeMP){if(isSelf){this.playerStateComp.setStateText("内力不足")}return}if(isSelf){this.dodgeComp.startT()}this.showSkillText(isSelf,"闪避");this[name+"Player"].comp.MPComp.changeMP(-consumeMP);console.log("闪避技能使用");this[name+"Player"].comp.dodgeEffect()}collisionDetection(){}allCdEnd(){this.weaponsBarArr.forEach(weaponBarComp=>{weaponBarComp.setCdTime(weaponBarComp.originCdTime);weaponBarComp.endCD()});this.skillScr1.endCD();this.skillScr2.endCD();this.dodgeComp.endCD();this.selfPlayer.comp.removeSkill2()}deathHandler(loserIsSelf){if(this.selfPlayer.comp.attr.roleId==4){this.removeDragons(1);this.removeDragons(2)}Laya.MouseManager.enabled=false;Laya.timer.clear(this,this.startSelect);this.gameState="over";console.log(`------有人死亡------`);this.removeAllWeapons();this.allCdEnd();switch(this.gameType){case`adventure`:case`pass`:this.dealPass(loserIsSelf);break;case"battle":this.dealBattle(loserIsSelf);break}}dealPass(loserIsSelf){if(loserIsSelf){this.passOver(loserIsSelf)}else{this.killNum+=1;if(this.killNum==this.monsterNum){console.error(`死亡个数：`,this.killNum);this.passOver(loserIsSelf)}else{Laya.timer.once(1500,this,this.replacePlayer)}}}dealBattle(loserIsSelf){this.gameOver(loserIsSelf);let win=loserIsSelf?0:1;Laya.timer.callLater(this,()=>{this.POST("martial_match_end",{win:win},res=>{PaoYa.DataCenter.user.dailyTaskStatus=res.dailyTaskStatus;Laya.MouseManager.enabled=true;res.result=loserIsSelf?-1:1;res.roleId=this.params.roleId,res.robotRoleId=this.params.robotRoleId;res.nickName=this.params.nickName;res.robotNickName=this.params.robotNickName;this.navigator.popup("/dialog/BattleResultDialog",res)})})}replacePlayer(){Laya.MouseManager.enabled=true;this.selfWeapons=[];this.otherWeapons=[];this.robotRole=JSON.parse(JSON.stringify(this.params.monsterList[this.killNum].robotRole));this.robotWeaponList=JSON.parse(JSON.stringify(this.params.monsterList[this.killNum].robotWeaponList));this.resetPlayerInfo();this.initPlayer(false);this.battleIndex=this.killNum+1;this.boxGameBanner.getComponent(GameBanner).changeStyle({gameType:this.gameType,curNum:this.curNum,battleIndex:this.battleIndex,monsterNum:this.monsterNum});this.gameState="start";this.firstWeaponSelect()}revive(){this.gameState="start";SoundManager.ins.passBg();this.initPlayer(true);this.firstWeaponSelect();this.otherPlayer.comp.MPComp.startBar()}passOver(loserIsSelf){if(this.gameType==`pass`){Global.gameEndStat(this.params.stageId,{static:loserIsSelf?"fail":"complete"})}if(!loserIsSelf){SoundManager.ins.win();PaoYa.DataCenter.user.current=this.curNum+1;this.selfPlayer.comp.skeleton.play("win",true)}else{SoundManager.ins.lose();PaoYa.DataCenter.user.current=this.curNum;this.otherPlayer.comp.skeleton.play("win",true)}this.selfPlayer.comp.MPComp.stopIncrease();this.otherPlayer.comp.MPComp.stopIncrease();Laya.timer.once(1e3,this,()=>{if(this.gameType==`pass`){this.POST("martial_game_end",{killNum:this.killNum},res=>{Laya.MouseManager.enabled=true;res.result=loserIsSelf?-1:1;res.stageId=this.params.stageId;if(JSON.stringify(res.encounter)=="{}"){PaoYa.DataCenter.user.dailyTaskStatus=res.dailyTaskStatus;this.navigator.popup("/dialog/PassResultDialog",res)}else{switch(res.encounter.type){case 1:case 2:this.navigator.popup(`/dialog/AdventDialog`,res);break;case 3:this.navigator.popup(`adventure/ChangeWp`,res);break;case 4:this.navigator.popup(`adventure/GetAward`,res);break;case 5:this.navigator.popup(`/dialog/AdventDialog5`,res);break;case 6:this.navigator.popup(`adventure/BuyWp`,res);break}}})}else if(this.gameType==`adventure`){this.POST("martial_encounter_finish",{result:loserIsSelf?-1:1,complete:loserIsSelf?-1:1},res=>{PaoYa.DataCenter.user.dailyTaskStatus=res.dailyTaskStatus;Laya.MouseManager.enabled=true;res.result=loserIsSelf?-1:1;this.navigator.popup("/dialog/AdventResultDialog",res)})}})}removeAllWeapons(){console.warn(`------移除所有兵器------`);this.selfWeapons.forEach(weapon=>{weapon.endMove()});this.otherWeapons.forEach(weapon=>{weapon.endMove()})}gameOver(loserIsSelf){if(!loserIsSelf){SoundManager.ins.win();this.selfPlayer.comp.skeleton.play("win",true)}else{SoundManager.ins.lose();this.otherPlayer.comp.skeleton.play("win",true)}console.error("游戏结束");this.selfPlayer.comp.MPComp.stopIncrease();this.otherPlayer.comp.MPComp.stopIncrease();this.boxGameBanner.getComponent(GameBanner)}onDestroy(){console.error("destroy111");this.selfWeapons=null;this.otherWeapons=null;this.selfPlayer=null;this.otherPlayer=null;Laya.timer.clearAll(this);Laya.MouseManager.enabled=true}}class WeaponBar extends PaoYa.Component{constructor(){super()}onAwake(){let owner=this.owner;this.ownW=owner.width;this.ownH=owner.height;this.boxAniWarn.pos(this.ownW/2,this.ownH/2);this.spMask=new Laya.Sprite;this.maskArea=new Laya.Sprite;this.maskArea.texture="remote/game/frameBg.png";owner.addChild(this.maskArea);this.maskArea.mask=this.spMask;this.maskArea.visible=false;this.maxAngle=270;this.endAngle=-90;this.startAngle=-90;this.freezeing=false}onThrottleClick(){this.clickHandler()}onEnable(){this.cdTime=this.params.weaponCd*1e3;this.originCdTime=this.cdTime;this.weaponConsume=this.params.weaponConsume;this.initView()}initView(){let skin=`remote/small_weapons/s_${this.params.weaponId}.png`;this.spWeapon.texture=skin;this.maskArea.graphics.drawTexture(Laya.loader.getRes(skin),0,0,this.ownW,this.ownH);this.imgQuality.skin=`remote/game/quality_${this.params.weaponStar}.png`;this.imgType.skin=`remote/game/type_${this.params.weaponType}.png`;if(this.params.weaponLevel){this.lblGrade.text=`LV.${this.params.weaponLevel}`}}onDisable(){}clickHandler(e){if(!GameControl.instance){return}if(GameControl.instance.gameState!=`start`){GameControl.instance.showTips("游戏未开始");return}if(!GameControl.instance.selfPlayer.comp.canAction||GameControl.instance.selfPlayer.comp.dodge){GameControl.instance.showTips("无法行动");return}if(this.freezeing){GameControl.instance.showTips("技能未冷却");return}this.postNotification(WeaponBar.CLICK,[this])}setCdTime(cdTime){this.cdTime=cdTime}drawTexture(skin){this.maskArea.graphics.drawTexture(Laya.loader.getRes(skin),0,0,this.ownW,this.ownH)}startT(time){if(this.cdTime==0){return}this.spShadow.visible=true;this.maskArea.visible=true;this.freezeing=true;this.beiginTime=(new Date).getTime();this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.ownW/2,this.ownH/2,this.ownW,this.startAngle,this.endAngle,"#000000");let cdT=time==undefined?this.cdTime:time;Laya.timer.frameLoop(1,this,this.startCd,[cdT])}startCd(time){if(this.endAngle>=this.maxAngle){this.endCD();this.aniWarn.play(0,false);return}this.endAngle+=Laya.timer.delta*360/time;this.spMask.graphics.clear();this.spMask.graphics.drawPie(this.ownW/2,this.ownH/2,this.ownW,this.startAngle,this.endAngle,"#000000")}pause(){this.freezeing&&Laya.timer.clear(this,this.startCd)}resume(){this.freezeing&&Laya.timer.frameLoop(1,this,this.startCd,[this.cdTime])}endCD(){Laya.timer.clearAll(this);this.maskArea.visible=false;this.spShadow.visible=false;this.freezeing=false;this.endAngle=-90}onDestroy(){}}WeaponBar.CLICK="weanponBarClick";class AlertDialog extends PaoYa.Dialog{constructor(params){super();this.autoDestroyAtClosed=true;params.confirmText=params.confirmText||"知道了";this.params=params;this.addSubviews()}addSubviews(){let imgBg=new Laya.Image("local/common/bg2.png");imgBg.sizeGrid="150,130,100,120";imgBg.size(500,400);this.addChild(imgBg);let lblTitle=new Laya.Label(this.params.title||"");lblTitle.fontSize=40;lblTitle.color="#ffffff";lblTitle.bold=true;lblTitle.centerX=0;lblTitle.y=30;this.addChild(lblTitle);let lblMsg=new Laya.Label(this.params.message||"");lblMsg.fontSize=28;lblMsg.leading=15;lblMsg.color="#4d4d4d";lblMsg.wordWrap=true;lblMsg.align="center";lblMsg.pos(40,150);lblMsg.size(420,30);this.addChild(lblMsg);this.size=imgBg.size;let hBox=new Laya.HBox;hBox.centerX=0;hBox.y=300;hBox.space=15;this.addChild(hBox);if(this.params.cancelText){hBox.addChild(this._makeButton(this.params.cancelText,Laya.Dialog.NO))}hBox.addChild(this._makeButton(this.params.confirmText,Laya.Dialog.YES))}_makeButton(label,name){let btn=new Laya.Button("local/common/btn_1.png");btn.size(200,64);btn.name=name;btn.stateNum=1;let labelF=new Laya.Label;labelF.font=`weaponDFont`;labelF.centerX=0;labelF.centerY=0;labelF.scale(.7,.7);labelF.text=label;btn.addChild(labelF);return btn}onClosed(type){if(type==Laya.Dialog.YES){this.params.confirmHandler&&this.params.confirmHandler()}else if(type==Laya.Dialog.NO){this.params.cancelHandler&&this.params.cancelHandler()}}}var GameGuideData={weaponList:[{exp:0,num:0,skills:[{skillCd:0,skillConfig:{hurt:5},skillDesc:"造成5倍伤害",skillId:48,skillLevel:1,skillName:"诛心",skillProb:18,skillType:1,skillUnlock:0,status:0},{skillCd:0,skillConfig:{critHarm:20,critProb:5},skillDesc:"暴击+5%，暴伤+20% ",skillId:65,skillLevel:1,skillName:"灵猴",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:190,weaponCd:2,weaponConsume:91,weaponDownConsume:27,weaponDurable:22,weaponIcon:"xxxxx",weaponId:"d015_3",weaponLevel:15,weaponName:"小李飞刀",weaponPrice:3e4,weaponSalePrice:6e3,weaponSkills:"48,65",weaponStar:3,weaponTopLevel:15,weaponType:1,weaponUpAttack:70,weaponUpDurable:10},{exp:0,num:0,skills:[{skillCd:0,skillConfig:{recoverDown:"5-0.4"},skillDesc:"使对手内力恢复速度-60%，持续5秒",skillId:55,skillLevel:1,skillName:"气绝",skillProb:22,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{downConsume:10},skillDesc:"所有兵器内力消耗-10%",skillId:80,skillLevel:1,skillName:"轮回",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:242,weaponCd:3,weaponConsume:72,weaponDownConsume:36,weaponDurable:25,weaponIcon:"xxxx",weaponId:"z015_3",weaponLevel:15,weaponName:"倚天",weaponPrice:2e4,weaponSalePrice:4e3,weaponSkills:"55,80",weaponStar:3,weaponTopLevel:15,weaponType:2,weaponUpAttack:97,weaponUpDurable:10},{exp:0,num:0,skills:[{skillCd:0,skillConfig:{cd:0},skillDesc:"兵器立即冷却",skillId:58,skillLevel:1,skillName:"顿悟",skillProb:25,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{allWeaponSkillProb:10},skillDesc:"所有兵器技能触发几率提升10%",skillId:87,skillLevel:1,skillName:"剑圣",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:456,weaponCd:4,weaponConsume:126,weaponDownConsume:50,weaponDurable:25,weaponIcon:"xxxxx",weaponId:"g015_3",weaponLevel:15,weaponName:"紫金降魔杵",weaponPrice:3e4,weaponSalePrice:6e3,weaponSkills:"58,87",weaponStar:3,weaponTopLevel:15,weaponType:3,weaponUpAttack:256,weaponUpDurable:10},{exp:0,num:0,skills:[{skillCd:0,skillConfig:{poison:"6-210"},skillDesc:"使对手中剧毒，6秒损失210点生命",skillId:46,skillLevel:1,skillName:"奇毒",skillProb:25,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{notPoison:1},skillDesc:"免疫中毒",skillId:83,skillLevel:1,skillName:"药师",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:185,weaponCd:2,weaponConsume:81,weaponDownConsume:27,weaponDurable:25,weaponIcon:"xxxxx",weaponId:"d014_3",weaponLevel:15,weaponName:"绝命",weaponPrice:25e3,weaponSalePrice:5e3,weaponSkills:"46,83",weaponStar:3,weaponTopLevel:15,weaponType:1,weaponUpAttack:70,weaponUpDurable:10},{exp:0,num:0,skills:[{skillCd:0,skillConfig:{weaponNum:3},skillDesc:"发出3件兵器",skillId:44,skillLevel:1,skillName:"影刃",skillProb:22,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{downCd:10},skillDesc:"所有兵器冷却时间-10%",skillId:82,skillLevel:1,skillName:"剑豪",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:180,weaponCd:2,weaponConsume:86,weaponDownConsume:27,weaponDurable:25,weaponIcon:"xxxxx",weaponId:"d013_3",weaponLevel:15,weaponName:"七星",weaponPrice:2e4,weaponSalePrice:4e3,weaponSkills:"44,82",weaponStar:3,weaponTopLevel:15,weaponType:1,weaponUpAttack:70,weaponUpDurable:10}],role:{addAllRate:1,addMpRate:0,addStrengthRate:0,addWeaponSkillProb:10,downWeaponCd:10,downWeaponConsume:0,hitRecoveMp:0,notCrit:0,notDizzy:0,notFrozen:0,notPalsy:0,notPoison:1,reboundRate:0,recoverHp:0,recoverMp:1,refiners:[{currentExp:0,currentFullExp:0,id:"refiner_09",refinerBasics:{show:3,weaponType:1,hurt:1.03},refinerDesc:"提升轻型兵器伤害。",refinerEachUp:.03,refinerEffect:"轻型兵器伤害增加d%",refinerLevel:1,refinerName:"轻燕",refinerType:1,refinerUnlock:0,status:0,type:1},{currentExp:0,currentFullExp:0,id:"refiner_10",refinerBasics:{show:3,weaponType:2,hurt:1.03},refinerDesc:"提升中型兵器伤害。",refinerEachUp:.03,refinerEffect:"中型兵器伤害增加d%",refinerLevel:1,refinerName:"锋刃",refinerType:1,refinerUnlock:0,status:0,type:1},{currentExp:0,currentFullExp:0,id:"refiner_11",refinerBasics:{show:3,weaponType:3,hurt:1.03},refinerDesc:"提升重型兵器伤害。",refinerEachUp:.03,refinerEffect:"重型兵器伤害增加d%",refinerLevel:1,refinerName:"沉石",refinerType:1,refinerUnlock:0,status:0,type:1}],roleBone:126,roleCritHarm:180,roleCritProb:0,roleDesc:"飞刀",roleDress:"hero_1",roleHp:1110,roleIcon:"xxx",roleId:1,roleLevel:20,roleMp:259,roleName:"阿强",rolePrice:0,roleSkills:"31,32,33",roleStar:2,roleStatus:0,roleStrength:377,roleTopLevel:20,roleType:0,roleUpBone:5,roleUpHp:42,roleUpMp:10,roleUpStrength:15,skillWeapon:{exp:0,num:0,skills:[{skillCd:0,skillConfig:{critProb:20},skillDesc:"发出1把火焰飞刀，造成臂力*0.18倍伤害。技能暴击+20%。",skillId:88,skillLevel:1,skillName:"酒灼刀",skillProb:100,skillType:1,skillUnlock:0,status:0}],weaponAttack:67,weaponCd:0,weaponConsume:.2,weaponDurable:20,weaponIcon:"3",weaponId:"x001_4",weaponName:"火焰飞刀",weaponPrice:0,weaponSalePrice:0,weaponSkills:"88",weaponStar:4,weaponTopLevel:15,weaponType:1},skills:[{skillCd:20,skillConfig:{weaponId:"x001_4",critProb:20},skillConsume:0,skillDesc:"发出1把火焰飞刀，造成臂力*0.18倍伤害。技能暴击+20%。",skillId:31,skillLevel:1,skillName:"酒灼刀",skillProb:100,skillType:1,skillUnlock:5,status:1},{skillCd:0,skillConfig:{critHarm:20,hurt:.2},skillConsume:0,skillDesc:"所有轻型兵器伤害+20%。暴击伤害+20%。",skillId:32,skillLevel:1,skillName:"江湖老油条",skillProb:12,skillType:0,skillUnlock:10,status:1},{skillCd:60,skillConfig:{weaponCd:0,time:10},skillConsume:0,skillDesc:"所有兵器无冷却时间，持续10秒。",skillId:33,skillLevel:1,skillName:"夺命连环三仙剑",skillProb:100,skillType:1,skillUnlock:15,status:1}],upgradeCost:0},robotWeaponList:[{exp:0,num:0,skills:[{skillCd:0,skillConfig:{recoverDown:"5-0.4"},skillDesc:"使对手内力恢复速度-60%，持续5秒",skillId:55,skillLevel:1,skillName:"气绝",skillProb:22,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{downConsume:10},skillDesc:"所有兵器内力消耗-10%",skillId:80,skillLevel:1,skillName:"轮回",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:242,weaponCd:2.9,weaponConsume:72,weaponDownConsume:36,weaponDurable:25,weaponIcon:"xxxx",weaponId:"z015_3",weaponLevel:15,weaponName:"倚天",weaponPrice:2e4,weaponSalePrice:4e3,weaponSkills:"55,80",weaponStar:3,weaponTopLevel:15,weaponType:2,weaponUpAttack:97,weaponUpDurable:10},{exp:0,num:0,skills:[{skillCd:0,skillConfig:{cd:0},skillDesc:"兵器立即冷却",skillId:58,skillLevel:1,skillName:"顿悟",skillProb:25,skillType:1,skillUnlock:0,status:1},{skillCd:0,skillConfig:{allWeaponSkillProb:10},skillDesc:"所有兵器技能触发几率提升10%",skillId:87,skillLevel:1,skillName:"剑圣",skillProb:100,skillType:0,skillUnlock:0,status:1}],upgradeCost:0,weaponAttack:456,weaponCd:4.4,weaponConsume:126,weaponDownConsume:50,weaponDurable:25,weaponIcon:"xxxxx",weaponId:"g015_3",weaponLevel:15,weaponName:"紫金降魔杵",weaponPrice:3e4,weaponSalePrice:6e3,weaponSkills:"58,87",weaponStar:3,weaponTopLevel:15,weaponType:3,weaponUpAttack:256,weaponUpDurable:10}],robotRole:{addAllRate:1,addMpRate:0,addStrengthRate:0,addWeaponSkillProb:10,downWeaponCd:0,downWeaponConsume:0,hitRecoveMp:5,notCrit:0,notDizzy:0,notFrozen:0,notPalsy:0,notPoison:0,reboundRate:0,recoverHp:0,recoverMp:1,refiners:[{currentExp:0,currentFullExp:0,id:"refiner_09",refinerBasics:{show:3,weaponType:1,hurt:1.03},refinerDesc:"提升轻型兵器伤害。",refinerEachUp:.03,refinerEffect:"轻型兵器伤害增加d%",refinerLevel:1,refinerName:"轻燕",refinerType:1,refinerUnlock:0,status:0,type:1},{currentExp:0,currentFullExp:0,id:"refiner_10",refinerBasics:{show:3,weaponType:2,hurt:1.03},refinerDesc:"提升中型兵器伤害。",refinerEachUp:.03,refinerEffect:"中型兵器伤害增加d%",refinerLevel:1,refinerName:"锋刃",refinerType:1,refinerUnlock:0,status:0,type:1},{currentExp:0,currentFullExp:0,id:"refiner_11",refinerBasics:{show:3,weaponType:3,hurt:1.03},refinerDesc:"提升重型兵器伤害。",refinerEachUp:.03,refinerEffect:"重型兵器伤害增加d%",refinerLevel:1,refinerName:"沉石",refinerType:1,refinerUnlock:0,status:0,type:1}],roleBone:52,roleCritHarm:192,roleCritProb:20,roleDesc:"内力",roleDress:"hero_2",roleHp:835,roleIcon:"xxx",roleId:2,roleLevel:20,roleMp:386,roleName:"龙女",rolePrice:1200,roleSkills:"34,35,36",roleStar:3,roleStatus:0,roleStrength:252,roleTopLevel:20,roleType:0,roleUpBone:2,roleUpHp:31,roleUpMp:15,roleUpStrength:10,skillWeapon:{exp:0,num:0,skills:[{skillCd:0,skillConfig:{downMp:100},skillDesc:"发出一把素心长剑，造成内力*0.24倍伤害。命中后使对手的内力立即减少100点。",skillId:89,skillLevel:1,skillName:"雪女剑法",skillProb:100,skillType:1,skillUnlock:0,status:0}],weaponAttack:.24,weaponCd:0,weaponConsume:.15,weaponDurable:20,weaponIcon:"2",weaponId:"x002_4",weaponName:"素心长剑",weaponPrice:0,weaponSalePrice:0,weaponSkills:"89",weaponStar:4,weaponTopLevel:15,weaponType:2},skills:[{skillCd:24,skillConfig:{downMp:100,weaponId:"x002_4"},skillConsume:0,skillDesc:"发出一把素心长剑，造成内力*0.24倍伤害。命中后使对手的内力立即减少100点。",skillId:34,skillLevel:1,skillName:"雪女剑法",skillProb:100,skillType:1,skillUnlock:5,status:1},{skillCd:0,skillConfig:{addHitRecoverMp:5,mp:.2},skillConsume:0,skillDesc:"内力+20%，兵器命中后立即获得5点内力。",skillId:35,skillLevel:1,skillName:"雪女心经",skillProb:100,skillType:0,skillUnlock:10,status:1},{skillCd:60,skillConfig:{time:10,recoverHp:.2,recoverMp:2},skillConsume:0,skillDesc:"立刻恢复20%生命。内力恢复速度提升100%，持续10秒。",skillId:36,skillLevel:1,skillName:"素心大法",skillProb:100,skillType:1,skillUnlock:15,status:1}],upgradeCost:0}};class SpeakMan extends PaoYa.Component{constructor(){super()}onAwake(){this.lblSpeakName.font="figureDetail";this.target=this.imgArrow;this.curY=this.target.y;let timeLine=new Laya.TimeLine;this.timeLine=timeLine;this.lblSpeakName.scale(.8,.8)}onEnable(){}modify(value){this.lblSpeakName.text=value;this.imgRole.visible=false}refresh(obj){this.lblSpeakName.text=obj.name;this.imgRole.texture=`remote/guide/${obj.dress}.png`}showWord(value){this.str=value;let len=this.str.length;this.index=0;this.lblIntroduct.text="";Laya.timer.loop(60,this,this.wordAni,[len])}wordAni(len){this.lblIntroduct.text+=this.str.substring(this.index,this.index+1);this.index+=1;if(this.index==len){Laya.timer.clear(this,this.wordAni);this.arrowAni()}}arrowAni(){this.imgArrow.visible=true;let originY=this.curY;this.timeLine.to(this.target,{y:originY+20},400,null,0).to(this.target,{y:originY},400,null,1);this.timeLine.play(0,true)}stopTimeLine(){this.timeLine.pause()}onDestroy(){console.log(`销毁对话`);this.timeLine.destroy();this.timeLine=null}}let guideContainer,maskArea,interactionArea,hitArea,selfSpeakMan,otherSpeakMan,selfSpeakManComp,otherSpeakManComp,nextLabel,guideStep=0;class HomeControl extends PaoYa.Component{onAwake(){HomeControl.ins=this;this.rolesName=["","小虾米","龙女","过儿","乔帮主"];let name=PaoYa.DataCenter.user.defaultRoleId;let ladder=PaoYa.DataCenter.user.ladder;let player=new Laya.Skeleton;player.load(HeroConfig.spineMap[`hero_${name}`].path,Laya.Handler.create(this,res=>{player.play("stand",true)}));player.pos(371,590);player.scale(1.5,1.5);this.owner.addChild(player);this.player=player;this.lblName.text=PaoYa.DataCenter.user.nickname;this.lblLadder.font="weaponNFontT";this.lblLadder.scale(.8,.8);this.lblLadder.text=HeroConfig.ladderArr[ladder];PaoYa.DataCenter.user.ladderName=HeroConfig.ladderArr[ladder];this.owner.imgAvstar.skin=PaoYa.DataCenter.user.avstar;this.onNotification("roleIdChanged",this,roleId=>{if(name!=roleId){name=roleId;PaoYa.DataCenter.user.defaultRoleId=roleId;let templet=HeroConfig.spineMap[`hero_`+name].templet;this.player.init(templet,0);if(!PaoYa.DataCenter.userInfoAuth){this.owner.imgAvstar.skin=`local/common/avstar${roleId}.png`;this.lblName.text=this.rolesName[roleId]}}});this.onNotification("AuthOK",this,()=>{this.lblName.text=PaoYa.DataCenter.user.nickname;this.owner.imgAvstar.skin=PaoYa.DataCenter.user.avstar});this.adventBox=new Laya.Box;this.adventBox.size(152,145);this.adventBox.pos(500,500);this.adventBox.visible=true;this.owner.addChild(this.adventBox);let spIcon=new Laya.Sprite;this.spIcon=spIcon;this.adventBox.addChild(spIcon);let adventAni=new Laya.Animation;adventAni.pos(this.adventBox.width/2,this.adventBox.height/2);this.adventAni=adventAni;this.adventBox.addChild(this.adventAni);this.originAdventType=0;this.adventAni.blendMode=`lighter`;this.adventBox.on(Laya.Event.CLICK,this,this.adventIconClick);this.onNotification("adventCancel",this,()=>{if(PaoYa.navigator.scenes.length==1){this.onAppear()}});this.onNotification("adventComplete",this,()=>{if(PaoYa.navigator.scenes.length==1){this.onAppear()}})}onEnable(){this.getLock(179,72,`lock2`);this.owner.lock.visible=PaoYa.DataCenter.user.current>5?false:true;if(this.owner.lock.visible){this.getLock(179,72,`lock`)}if(PaoYa.DataCenter.user.is_first_game==1){this.navigator.push("GameGuide",GameGuideData)}this.showRankList()}onAppear(){if(this.first){this.player.play("stand",true)}else{this.first=true}this.lblLadder.text=PaoYa.DataCenter.user.ladderName;this.owner.taskDot.visible=PaoYa.DataCenter.user.dailyTaskStatus?true:false;this.owner.signDot.visible=PaoYa.DataCenter.user.loginBonusStatus?true:false;this.GET(`martial_encounter_detail`,{},res=>{this.adventParams=res;if(JSON.stringify(res)!="{}"){this.adventBox.visible=true;if(this.originAdventType!=res.type){this.originAdventType=res.type;this.spIcon.texture=`remote/adventure/advent${res.type}.png`;this.adventAni.loadAnimation(`gamescenes/animations/advent_effect${res.type}.ani`,Laya.Handler.create(this,()=>{this.adventAni.play(0,true)}))}else{this.adventAni.play(0,true)}}else{this.adventBox.visible=false}})}adventIconClick(){let res=this.adventParams;switch(this.originAdventType){case 1:case 2:this.navigator.popup(`/dialog/AdventDialog`,res);break;case 3:this.navigator.popup(`adventure/ChangeWp`,res);break;case 4:this.navigator.popup(`adventure/GetAward`,res);break;case 5:if(res.time*1e3>0){if(res.time*1e3-(new Date).valueOf()<0){res.state=`get`;this.navigator.popup(`/dialog/AdventResultDialog5`,res)}else{res.state=`wait`;this.navigator.popup(`/dialog/AdventResultDialog5`,res)}}else{this.navigator.popup(`/dialog/AdventDialog5`,res)}break;case 6:this.navigator.popup(`adventure/BuyWp`,res);break}res=null}onDisappear(){this.player._templet&&this.player.stop();this.adventAni&&this.adventAni.stop()}onThrottleClick(e){if(Global.isShowGrading){return}if(e.target instanceof Laya.Button){SoundManager.ins.btn()}switch(e.target.name){case"btnWeaponHouse":console.log("进入兵器库");this.goWeaponHouse();break;case"btnWeaponStore":console.log("进入兵器商店");this.POST("martial_shop_list",{refresh:0},res=>{if(!res){return}this.POST("martial_user_weapon_list",{},data=>{if(!data){return}let obj={buyList:res,sellList:data};this.navigator.push("WeaponStore",obj)})});break;case"btnRefiner":console.log("进入炼器");this.goRefiner();break;case"btnWeaponSpectrum":this.GET("martial_weapon_list",{},res=>{if(!res){return}this.navigator.push("WeapList",res)});console.log("进入兵器谱");break;case"btnHerosHouse":console.log("进入英雄库");this.goHerosHouse();break;case"btnRegister":this.GET("martial_login_bonus_list",{},res=>{if(!res){return}this.navigator.push("Sign",res)});console.log("打开签到");break;case"btnRoulette":this.navigator.push("Wheel");console.log("去抽奖");break;case"btnStartGame":console.log("开始游戏请求的数据......");this.goPassGame();break;case"btnBattle":console.log("华山论剑");if(PaoYa.DataCenter.user.current<=5){py.showToast({title:"过5关解锁"});return}this.GET("martial_role_list",{},res=>{if(!res){return}this.navigator.push("Grading",res)});break;case"btnBoss":if(PaoYa.DataCenter.user.current<=10){py.showToast({title:"过10关解锁"});return}py.showToast({title:"敬请期待"});console.log("决战");break;case"rank":let _this=this;SoundManager.ins.btn();PaoYa.AuthManager.auth({scope:PaoYa.AuthManager.scope.userInfo,isNecessary:true,next(){_this.GET("ranking_list",{type:1},res=>{if(!res){return}_this.navigator.popup("common/Rank",res)});console.log("进入排行榜")}});break;case"btnPlayRule":console.log("玩法介绍");break;case"btnTask":this.GET("martial_task_list",{},res=>{if(!res){return}this.navigator.popup("common/Task",res)});console.log("任务");break}}goRefiner(num){this.GET("martial_refiner_list",{},res=>{if(!res){return}let obj={isGuide:num,detail:res};this.navigator.push("Refining",obj)})}goHerosHouse(num){this.GET("martial_role_list",{},res=>{if(!res){return}let obj={isGuide:num,detail:res};this.navigator.push("Swordsman",obj)})}goWeaponHouse(num){this.POST("martial_user_weapon_list",{},res=>{if(!res){return}let obj={isGuide:num,detail:num?Global.wpGuide:res};this.navigator.push("WeaponHouse",obj)})}goPassGame(){if(this.firstGoGame){this.firstGoGame=false;this.step4()}let _this=this;this.POST("hero_game_start",{},res=>{res.gameType=`pass`;Global.gameStartStat(res.stageId);this.navigator.push("GameView",res)},(msg,code)=>{let errorDialog;if(code==3018){errorDialog=new AlertDialog({title:"",message:msg})}else{errorDialog=new AlertDialog({title:"",message:msg,confirmText:"前往",confirmHandler:function(){_this.goRefiner()}})}errorDialog.popup()})}setGuide(){this.firstGoGame=true;guideContainer=new Laya.Sprite;guideContainer.zOrder=1e3;this.owner.addChild(guideContainer);guideContainer.cacheAs="bitmap";maskArea=new Laya.Sprite;maskArea.alpha=1;maskArea.graphics.drawRect(0,0,1634,750,"#000");maskArea.pos(-150,0);maskArea.mouseEnabled=true;guideContainer.addChild(maskArea);let tween=new Laya.Tween;tween.to(maskArea,{alpha:.5},2e3,null,Laya.Handler.create(this,()=>{}));interactionArea=new Laya.Sprite;interactionArea.blendMode="destination-out";guideContainer.addChild(interactionArea);hitArea=new Laya.HitArea;hitArea.hit.drawRect(0,0,1634,750,"#000");guideContainer.hitArea=hitArea;guideContainer.mouseEnabled=true;nextLabel=new Laya.Label;nextLabel.text="跳过";nextLabel.font="figureDetail";nextLabel.pos(1100,30);nextLabel.name="next";nextLabel.mouseEnabled=true;console.log(nextLabel.width);guideContainer.addChild(nextLabel);selfSpeakMan=this.selfSpeakMan.create.call(this.selfSpeakMan);selfSpeakManComp=selfSpeakMan.getComponent(SpeakMan);selfSpeakManComp.showWord("阿嚏~~~刚。。刚才是做梦？");selfSpeakMan.y=225;selfSpeakMan.zOrder=1003;this.owner.addChild(selfSpeakMan);otherSpeakMan=this.otherSpeakMan.create.call(this.otherSpeakMan);otherSpeakManComp=otherSpeakMan.getComponent(SpeakMan);otherSpeakMan.pos(315,225);otherSpeakMan.zOrder=1003;this.owner.addChild(otherSpeakMan);otherSpeakManComp.modify(`陌生女子`);otherSpeakMan.visible=false;this.owner.on(Laya.Event.CLICK,this,e=>{guideStep+=1;switch(guideStep){case 1:case 2:case 3:this["step"+guideStep]();break}});nextLabel.on(Laya.Event.CLICK,this,this.nextTick)}step1(){console.log(`---第1步----`);selfSpeakMan.visible=false;otherSpeakMan.visible=true;otherSpeakManComp.showWord(`救命！救命啊！`)}step2(){console.log(`---第2步----`);selfSpeakMan.visible=true;otherSpeakMan.visible=false;selfSpeakManComp.showWord(`大白天的谁在喊救命？去看看再说。`)}step3(){console.log(`---第3步----`);nextLabel.visible=false;selfSpeakMan.visible=false;this.aniFinger.visible=true;this.aniFinger.play(0,true);interactionArea.graphics.clear();interactionArea.graphics.drawRect(730,103,370,165,"#000");hitArea.unHit.clear();hitArea.unHit.drawRect(730,103,370,165,"#000")}step4(){console.log(`---第4步----`);if(this.aniFinger){this.aniFinger.visible=false;this.aniFinger.stop()}interactionArea.graphics.clear();guideContainer.removeSelf();Global.dataPoints("点击开始游戏");console.error(`------首页新手引导删除------`)}nextTick(e){e.stopPropagation();guideStep+=1;this["step"+guideStep]()}showRankList(){let rlist=PaoYa.DataCenter.user.list.slice(0,3);this.owner.rankList.vScrollBarSkin="";this.owner.rankList.renderHandler=new Laya.Handler(this,this.rankListItem);this.owner.rankList.array=rlist}rankListItem(cell,index){cell.y=108*index;let rankicon=cell.getChildByName(`rankicon`);let usericon=cell.getChildByName(`usericon`);usericon.skin=cell.dataSource.member_avstar;rankicon.skin=`local/home/${index+1}.png`}guideF(name){const Sprite=Laya.Sprite;let gameContainer=new Sprite;gameContainer.size(1634,750);gameContainer.pos(-150,0);gameContainer.mouseEnabled=true;this.owner.addChild(gameContainer);let step=null;switch(name){case`btn1`:step=this.owner.btnHerosHouse;break;case`btn2`:step=this.owner.btnWeaponHouse;break;case`btn3`:step=this.owner.btnRefiner;break}gameContainer.on(Laya.Event.CLICK,this,()=>{switch(name){case`btn1`:this.goHerosHouse(1);break;case`btn2`:this.goWeaponHouse(1);break;case`btn3`:this.goRefiner(1);break}this.aniFinger.visible=false;this.owner.removeChild(guideContainer);this.owner.removeChild(gameContainer);this.aniFinger.visible=false});let guideContainer=new Laya.Sprite;guideContainer.zOrder=1e3;this.owner.addChild(guideContainer);guideContainer.cacheAs="bitmap";let maskArea=new Sprite;guideContainer.addChild(maskArea);maskArea.alpha=.5;maskArea.graphics.drawRect(0,0,1634,750,"#000");maskArea.pos(-150,0);let interactionArea=new Sprite;guideContainer.addChild(interactionArea);interactionArea.blendMode="destination-out";let hitArea=new Laya.HitArea;hitArea.hit.drawRect(-150,0,1634,750,"#000");guideContainer.hitArea=hitArea;guideContainer.mouseEnabled=true;this.aniFinger.visible=true;this.aniFinger.pos(step.x+step.width/2-150,step.height/2+step.y);this.aniFinger.play(0,true);hitArea.unHit.clear();hitArea.unHit.drawCircle(step.x+step.width/2-150,step.height/2+step.y,65,"#000000");interactionArea.graphics.clear();interactionArea.graphics.drawCircle(step.width/2+step.x-150,step.height/2+step.y,65,"#000000")}lockBattle(){this.owner.tips.visible=true;Laya.Tween.to(this.owner.tips,{y:this.owner.tips.y-100,alpha:0},1500,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{this.lockAni.play(0,false);this.owner.tips.visible=false;Global.isShowGrading=false}))}getLock(x,y,name){let dragonAni=new Laya.Animation;this.owner[name].addChild(dragonAni);dragonAni.pos(x,y);dragonAni.loadAnimation(`gamescenes/animations/lock.ani`,Laya.Handler.create(this,ani=>{this[`${name}Ani`]=dragonAni}),`res/atlas/remote/lock.atlas`)}onDisappear(){}onDisable(){}onDestroy(){}}class AdventDialog extends PaoYa.Dialog{constructor(){super()}onAwake(){this.autoDestroyAtClosed=true;let _this=this;this.resultParams=JSON.parse(JSON.stringify(this.params));if(this.params.encounter){this.params=this.params.encounter}console.log("hahhahahhh");let type=this.params.type;this.spRole.texture=`remote/guide/${this.params.dress}.png`;if(this.params.dress==`npc_3`){this.spRole.y=177}this.adventType=[{type:1,target:`击杀${this.params.num}个匪徒`,detail:`远处一落魄女子抱着包袱跌跌撞撞地冲你跑来，后面跟着一群拿到的韩非，那女子向你喊到:"救命啊！路上偶遇狂徒，不胜其扰，恳请大侠救救小女子"`,agreeText:`放开那个女孩`,rejectText:`多一事不如少一事`},{type:2,target:`尽可能地打败守擂人`,detail:`城外擂台边人头攒动，原是告示牌上新张贴了一张英雄榜。因这次守擂之人蝉联了四次擂主之位，奖励史无前例的丰厚。很多习武之人都跃跃欲试，要不去看看？`,agreeText:`狭路相逢勇者胜`,rejectText:`小命要紧溜了溜了`}];let advent=this.findAdventByType(type);let lbls=this.boxDetail._children;lbls[0].text=advent.target;lbls[1].text=advent.detail;this.initFont(advent);let weaponBarPromise=new Promise((resolve,reject)=>{Laya.loader.create("gamescenes/prefab/WeaponBar.json",Laya.Handler.create(this,json=>{if(json instanceof Laya.Prefab){resolve(json.json)}else{resolve(json)}}))});let rewardPromise=new Promise((resolve,reject)=>{Laya.loader.create("gamescenes/prefab/Reward.json",Laya.Handler.create(this,json=>{resolve(json)}))});Promise.all([weaponBarPromise,rewardPromise]).then(jsons=>{_this.initReward(jsons)});this.on(Laya.Event.CLICK,this,this.clickHandler)}clickHandler(e){switch(e.target.name){case`btnAgree`:this.agreeHandler();break;case`btnReject`:this.rejectHandler();break;case`closeT`:this.hangUp();break}}hangUp(){this.close();if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}}initReward(jsons){let weaponList=this.params.weaponList;let len=weaponList.length;for(let i=0;i<len;i++){let weaponView=new Laya.Prefab;weaponView.json=jsons[0];this.weaponView=weaponView;let view=Laya.Pool.getItemByCreateFun("WeaponView",weaponView.create,weaponView);let weaponBarsComp=view.getComponent(WeaponBar);weaponBarsComp.params=weaponList[i];view.scale(.6,.6);view.off(Laya.Event.CLICK,weaponBarsComp);this.hboxReward.addChild(view)}if(this.params.diamond){let diamondView=this.createRewardBox(jsons[1]);console.log(diamondView.getChildByName("lblNum").text);diamondView.getChildByName(`lblNum`).scale(.4,.4);diamondView.getChildByName(`lblNum`).text=`× ${this.params.diamond}`;diamondView.getChildByName(`lblNum`).font=`weaponNFontT`;this.hboxReward.addChild(diamondView)}if(this.params.gold){let goldView=this.createRewardBox(jsons[1]);goldView.getChildByName("lblNum").scale(.4,.4);goldView.getChildByName("lblNum").text=`× ${this.params.gold}`;goldView.getChildByName("lblNum").font=`weaponNFontT`;goldView.getChildByName(`spReward`).texture=`local/common/icon.png`;this.hboxReward.addChild(goldView)}}createRewardBox(json){let rewardView=new Laya.Prefab;rewardView.json=json;let view=Laya.Pool.getItemByCreateFun(`RewardView`,rewardView.create,rewardView);return view}initFont(advent){let len=this.boxLbls._children.length;for(let i=0;i<len;i++){this.boxLbls._children[i].font=`adventure`}this.lblAgree.text=advent.agreeText;this.lblReject.text=advent.rejectText;this.lblAgree.font=`adventure`;this.lblReject.font=`adventure`}findAdventByType(type){return this.adventType.filter(item=>{return item.type==type})[0]}agreeHandler(){let _this=this;console.log(`进入奇遇`);PaoYa.Request.POST("hero_game_start",{stageId:this.params.id},res=>{if(PaoYa.navigator.scenes.length>1){let maskArea=new Laya.Sprite;maskArea.alpha=.5;maskArea.graphics.drawRect(0,0,Laya.Browser.width,Laya.Browser.height,"#000");maskArea.mouseEnabled=true;maskArea.zOrder=2e3;Laya.stage.addChild(maskArea);let tween=new Laya.Tween;tween.to(maskArea,{alpha:1},600,null,Laya.Handler.create(this,()=>{res.gameType="adventure";PaoYa.navigator.replace("GameView",res);this.close();tween.clear();Laya.stage.removeChild(maskArea)}))}else{this.close();res.gameType="adventure";PaoYa.navigator.push("GameView",res)}},msg=>{var errorDialog=new AlertDialog({title:`温馨提示`,message:msg,confirmHandler:()=>{_this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).goRefiner()}});errorDialog.popup()})}rejectHandler(){console.log(`放弃奇遇`);PaoYa.Request.POST(`martial_encounter_cancel`,{},()=>{this.close();PaoYa.NotificationCenter.postNotification(`adventCancel`);if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}})}}class AdventureDialog5 extends PaoYa.Dialog{constructor(){super()}onAwake(){this.autoDestroyAtClosed=true;this.isPlaying=false;let type=this.params.type;let advent={type:5,detail:`相传真神应龙曾蛰居在后山，并在此留下了许多珍宝，不如有空的时候去看看，说不定集齐天时地利人和能发现点什么呢？`,agreeText:`开始寻宝`,rejectText:`任性离开`};this.lblDetail.text=advent.detail;this.initFont(advent);this.on(Laya.Event.CLICK,this,this.clickHandler)}clickHandler(e){if(this.isPlaying){return}switch(e.target.name){case`btnAgree`:this.agreeHandler();break;case`btnReject`:this.rejectHandler();break;case`closeT`:this.hangUp();break}}hangUp(){this.close();if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.params)}}agreeHandler(){this.isPlaying=true;console.log(`进入奇遇`);let huntSK=new Laya.Skeleton;huntSK.load(`spine/hunt/hunt.sk`,Laya.Handler.create(this,res=>{this.spHunt.visible=false;huntSK.playbackRate(1.5);huntSK.play("hunt",false)}));huntSK.pos(0,0);huntSK.on(Laya.Event.STOPPED,this,this.stopHandler);this.map.addChild(huntSK)}rejectHandler(){PaoYa.Request.POST(`martial_encounter_cancel`,{},()=>{this.close();if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.params)}PaoYa.NotificationCenter.postNotification(`adventCancel`)})}stopHandler(){Laya.timer.once(200,this,()=>{this.isPlaying=false;PaoYa.Request.POST(`martial_encounter_start`,{},res=>{this.params.state=`wait`;this.params.time=res.time;PaoYa.navigator.popup(`/dialog/AdventResultDialog5`,this.params)})})}initFont(advent){this.detailTxt.font=`adventure`;this.lblAgree.text=advent.agreeText;this.lblReject.text=advent.rejectText;this.lblAgree.font=`adventure`;this.lblReject.font=`adventure`}}class Tool{static numFormat(num){if(num>=1e4){num=Math.floor(num/1e3)+"K"}return num}static addGold(num){PaoYa.DataCenter.user.gold+=num}static getGold(num){return this.numFormat(PaoYa.DataCenter.user.gold)}static addDiamond(num){PaoYa.DataCenter.user.diamond+=num}static setDiamond(num){PaoYa.DataCenter.user.diamond=num}static updataUserInfo(data){var user=PaoYa.DataCenter.user.user_info;user.member_gold=data.gold;user.member_power=data.power;user.member_diamond=data.diamond;user.member_prop=data.prop;user.member_integral=data.integral}static get hasVideoAD(){return PaoYa.game.params.adUnitId?true:false}static showVideoAD(callBack,cancel,err,isAdventure,num){if(typeof wx=="undefined"){callBack&&callBack();return}var p={onLoad:function(){console.log(`视频弹出`)},onError(){Tool.noADshare(callBack);err&&err()},onClose(res){if(res.isEnded){callBack&&callBack()}else{cancel&&cancel()}}};PaoYa.RewardedVideoAd.show(p,isAdventure)}static setUserCanGetJewel(state){PaoYa.DataCenter.user.can_receive=state}static inviteFriend(e,num){if(typeof wx=="undefined"){return}let title=PaoYa.DataCenter.config.game.share_list.randomItem;PaoYa.ShareManager.shareTitle(title,{},()=>{})}static noADshare(suc){if(typeof wx=="undefined"){suc&&suc();return}let startTime=(new Date).getTime();let title=PaoYa.DataCenter.config.game.share_list.randomItem;PaoYa.ShareManager.shareTitle(title,{},()=>{if(Global.shareNumFail>1&&Global.shareNum<5){Global.shareNumFail=0;suc&&suc();Global.shareNum++;return}if(Global.shareNum<1){Global.shareNumFail++;py.showToast({title:"分享失败",icon:"fail",duration:2e3})}if(Global.shareNum>=1&&Global.shareNum<=4){let shareNumD=Math.random()*100<50?true:false;if((new Date).getTime()-startTime>2e3&&shareNumD){Global.shareNumSuc++;suc&&suc()}else{Global.shareNumFail++;py.showToast({title:"分享失败",icon:"fail",duration:2e3})}}if(Global.shareNum>4){let shareNumD=Math.random()*100<10?true:false;if((new Date).getTime()-startTime>2e3&&shareNumD){Global.shareNumSuc++;suc&&suc()}else{Global.shareNumFail++;py.showToast({title:"分享失败",icon:"fail",duration:2e3})}}Global.shareNum++})}static wxShowFriendRank(num){var uerInfo={wxgame:{score:num,update_time:Date.parse(new Date)}};if(typeof wx=="undefined"){return}else{wx.setUserCloudStorage({KVDataList:[{key:"score",value:JSON.stringify(uerInfo)}]})}}static showBanner(){if(typeof wx=="undefined"){return}let bannerAd=wx.createBannerAd({adUnitId:"adunit-1dbbf544daf9456a",style:{left:(wx.getSystemInfoSync().windowWidth-300)/2,top:wx.getSystemInfoSync().screenHeight-90,width:300}});bannerAd.onLoad(()=>{console.log("banner 广告加载成功")});bannerAd.onError(err=>{console.log(err)});bannerAd.onResize(res=>{console.log(res.width,res.height);console.log(bannerAd.style.realWidth,bannerAd.style.realHeight);bannerAd.style.top=wx.getSystemInfoSync().screenHeight-bannerAd.style.realHeight});return bannerAd}}class AdventResultDialog extends PaoYa.Dialog{constructor(){super()}onAwake(){this.autoDestroyAtClosed=true;let params=this.params;let result=this.params.result;let type=this.params.type;if(result==-1){this.spIcon.texture=`remote/pass_result/lose.png`}if(type==1){this.dealType1(result)}else if(type==2){this.dealType2(result)}let weaponBarPromise=new Promise((resolve,reject)=>{Laya.loader.create("gamescenes/prefab/WeaponBar.json",Laya.Handler.create(this,json=>{if(json instanceof Laya.Prefab){resolve(json.json)}else{resolve(json)}}))});let rewardPromise=new Promise((resolve,reject)=>{Laya.loader.create("gamescenes/prefab/RewardBig.json",Laya.Handler.create(this,json=>{resolve(json)}))});Promise.all([weaponBarPromise,rewardPromise]).then(jsons=>{this.showReward(jsons)});this.on(Laya.Event.CLICK,this,this.clickHandler)}clickHandler(e){let name=e.target.name;switch(name){case`btnSure`:this.sureHandler();break;case`btnReject`:this.rejectHandler();break;case`btnShare`:this.shareHandler();break;case`btnVideo`:this.videoHandler();break;case`btnBack`:this.close();PaoYa.navigator.popToRootScene();break}}sureHandler(){console.log(`确认....`);PaoYa.Request.POST("martial_encounter_finish",{result:this.params.result,complete:1},res=>{PaoYa.NotificationCenter.postNotification(`adventComplate`);this.close();PaoYa.navigator.popToRootScene()})}rejectHandler(){console.log(`走人撒`);PaoYa.Request.POST("martial_encounter_finish",{result:this.params.result,complete:1},res=>{this.close();PaoYa.navigator.popToRootScene();PaoYa.NotificationCenter.postNotification(`adventComplate`)})}shareHandler(){console.log(`分享复活`);let _this=this;let random=Math.round(Math.random()*(PaoYa.DataCenter.config.game.share_list.length-1));let title=PaoYa.DataCenter.config.game.share_list[random];PaoYa.ShareManager.imageURL=PaoYa.DataCenter.CDNURL+PaoYa.DataCenter.config.game.share_img[random];if(window["wx"]){PaoYa.ShareManager.shareTitle(title,{},()=>{Global.dataPoints("奇遇a1失败复活");_this.close();GameControl.instance.revive()})}else{_this.close();GameControl.instance.revive()}}videoHandler(){Global.dataPoints("奇遇a激励广告");let _this=this;var params={onClose:function onClose(res){if(res.isEnded){_this.close();GameControl.instance.revive()}else{var errorDialog=new AlertDialog({title:`温馨提示`,message:"看完广告才可复活哦~"});errorDialog.popup()}},onError:function onError(res){Tool.noADshare(()=>{_this.close();GameControl.instance.revive()})}};PaoYa.RewardedVideoAd.show(params,true)}dealType1(result){if(result==1){this.boxWin.visible=true;this.img.skin=`remote/adventure/winText1.png`;this.btnSure.getChildByName(`lbl`).font=`adventure`;this.btnSure.getChildByName(`lbl`).text=`举手之劳，不足挂齿`}else{this.boxWeapons.visible=false;this.boxLose1.visible=true;this.img.skin=`remote/adventure/loseText1.png`;this.btnShare.getChildByName(`lbl`).font=`adventure`;this.boxLose1.getChildByName(`btnReject`).getChildByName(`lbl`).font=`adventure`}}dealType2(result){if(result==1){this.boxWin.visible=true;this.img.skin=`remote/adventure/winText2.png`;this.btnSure.getChildByName(`lbl`).font=`adventure`;this.btnSure.getChildByName(`lbl`).text=`欣然收下赏金`}else{this.boxLose2.visible=true;this.img.skin=`remote/adventure/loseText2.png`;this.btnVideo.getChildByName(`lbl`).font=`adventure`;this.btnReject.getChildByName(`lbl`).font=`adventure`;this.btnReject.getChildByName(`lbl`).scale(.86,.86)}}showReward(jsons){if(this.params.weaponList){let weaponList=this.params.weaponList;let len=weaponList.length;for(let i=0;i<len;i++){let weaponView=new Laya.Prefab;weaponView.json=jsons[0];this.weaponView=weaponView;let view=Laya.Pool.getItemByCreateFun("WeaponView",weaponView.create,weaponView);let weaponBarsComp=view.getComponent(WeaponBar);weaponBarsComp.params=weaponList[i];view.off(Laya.Event.CLICK,weaponBarsComp);view.onThrottleClick=(()=>{});this.boxWeapons.addChild(view)}}if(this.params.diamond){let diamondView=this.createRewardBox(jsons[1]);console.log(diamondView.getChildByName("lblNum").text);diamondView.getChildByName(`lblNum`).scale(.6,.6);diamondView.getChildByName(`lblNum`).text=`× ${this.params.diamond}`;diamondView.getChildByName(`lblNum`).font=`weaponNFontT`;this.boxWeapons.addChild(diamondView)}if(this.params.gold){let goldView=this.createRewardBox(jsons[1]);goldView.getChildByName("lblNum").scale(.6,.6);goldView.getChildByName("lblNum").text=`× ${this.params.gold}`;goldView.getChildByName("lblNum").font=`weaponNFontT`;goldView.getChildByName(`spReward`).texture=`local/common/icon.png`;this.boxWeapons.addChild(goldView)}}createRewardBox(json){let rewardView=new Laya.Prefab;rewardView.json=json;let view=Laya.Pool.getItemByCreateFun(`RewardViewBig`,rewardView.create,rewardView);return view}}class AdventResultDialog5 extends PaoYa.Dialog{constructor(){super()}onAwake(){this.autoDestroyAtClosed=true;let state=this.params.state;let time=this.params.time;if(state==`wait`){this.boxWait.visible=true;this.lbl1.font=`adventure`;this.lbl2.font=`adventure`;this.lbl3.font=`adventure`;this.startCount(time)}else if(state==`get`){this.boxGet.visible=true;this.showGetState();this.lbl3.font=`adventure`}this.on(Laya.Event.CLICK,this,this.clickHandler)}clickHandler(e){switch(e.target.name){case`btnSure`:this.sureHandler();break;case`btnVideo`:this.videoHandler();break;case`btnGet`:this.getHandler();break}}sureHandler(){this.timerService&&this.timerService.stop();this.close();if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.params)}}getHandler(){this.timerService&&this.timerService.stop();PaoYa.Request.POST(`martial_encounter_finish`,{result:1,complete:1},()=>{PaoYa.Request.POST(`martial_encounter_finish`,{result:1,complete:1},()=>{PaoYa.NotificationCenter.postNotification(`adventComplete`);this.close();if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.params)}});console.log(`奇遇5完成`)})}videoHandler(){let _this=this;if(!window["wx"]){this.showGetState();return}Global.dataPoints("奇遇d激励广告");var params={onClose:function onClose(res){if(res.isEnded){console.log(`看完广告`);_this.showGetState()}else{var errorDialog=new AlertDialog({title:`温馨提示`,message:"看完广告才可拥有哦~"});errorDialog.popup()}},onError:function onError(res){Tool.noADshare(()=>{console.log(`没广告,分享成功`);_this.showGetState()})}};PaoYa.RewardedVideoAd.show(params,true)}startCount(time){let timeStamp=(time*1e3-(new Date).valueOf())/1e3;console.log(timeStamp);let timerService=new PaoYa.TimerService(timeStamp,1,false);timerService.on(PaoYa.TimerService.PROGRESS,this,time=>{this.lblTime.text=time.formatTime("M:S")+""});timerService.on(PaoYa.TimerService.STOP,this,()=>{});timerService.start();this.timerService=timerService}showGetState(){let _this=this;this.boxWait.visible=false;this.boxGet.visible=true;let rewardPromise=new Promise((resolve,reject)=>{Laya.loader.create("gamescenes/prefab/RewardBig.json",Laya.Handler.create(this,json=>{resolve(json)}))});rewardPromise.then(json=>{_this.initReward(json)})}initReward(json){if(this.params.diamond){let diamondView=this.createRewardBox(json);diamondView.getChildByName("lblNum").scale(.6,.6);diamondView.getChildByName(`lblNum`).text=`× ${this.params.diamond}`;diamondView.getChildByName(`lblNum`).font=`weaponNFontT`;diamondView.getChildByName(`spBg`).scale(1,1);this.hboxReward.addChild(diamondView)}if(this.params.gold){let goldView=this.createRewardBox(json);goldView.getChildByName("lblNum").scale(.6,.6);goldView.getChildByName("lblNum").text=`× ${this.params.gold}`;goldView.getChildByName("lblNum").font=`weaponNFontT`;goldView.getChildByName(`spBg`).scale(1,1);goldView.getChildByName(`spReward`).texture=`local/common/icon.png`;this.hboxReward.addChild(goldView)}}createRewardBox(json){let rewardView=new Laya.Prefab;rewardView.json=json;let view=Laya.Pool.getItemByCreateFun(`RewardViewBig`,rewardView.create,rewardView);return view}onDestroy(){this.timerService&&this.timerService.stop();this.timerService=null}}class BattleResultDialog extends PaoYa.Dialog{constructor(){super()}onAwake(){console.log(this.params);this.autoDestroyAtClosed=true;let result=this.params.result;this.result=result;if(result==-1){this.spPanel.texture="remote/pass_result/imgLose.png";this.spIcon.texture=`remote/pass_result/lose.png`}else{this.spPanel.texture="remote/pass_result/imgWin.png"}this.lblPrize.text=this.params.diamond;this.spBtn.on(Laya.Event.CLICK,this,this.matchHandler);this.btnBack.on(Laya.Event.CLICK,this,this.backHandler);this.btnHeroHouse.on(Laya.Event.CLICK,this,this.goHeroHouse);this.fillInfo(this.params);PaoYa.DataCenter.user.ladderName=HeroConfig.ladderArr[this.params.ladder]}fillInfo(params){this.selfName.text=params.nickName;this.otherName.text=params.robotNickName;this.selfAvstar.texture=`local/common/hero_${params.roleId}.png`;this.otherAvstar.texture=`local/common/hero_${params.robotRoleId}.png`}goHeroHouse(){console.log("进入英雄库");this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).goHerosHouse()}matchHandler(){console.log("重新匹配");SoundManager.ins.btn();this.close();PaoYa.navigator.popToScene("Grading");PaoYa.Request.POST("hero_match_game_start",{roleId:this.params.roleId},res=>{res.gameType="battle";PaoYa.navigator.push("MatchView",res)})}backHandler(){SoundManager.ins.btn();this.close();PaoYa.navigator.popToRootScene()}}class PassResultDialog extends PaoYa.Dialog{constructor(){super()}onAwake(){this.autoDestroyAtClosed=true;let result=this.params.result;this.result=result;if(result==-1){this.spIcon.texture="remote/pass_result/lose.png";this.spBtn.texture="remote/pass_result/btnAgain.png";this.boxWeapons.visible=false;this.spPanel.texture="remote/pass_result/losePanel.png";this.boxPrize.y=460}else{this.spIcon.texture="remote/pass_result/win.png";this.spBtn.texture="remote/pass_result/btnNext.png";this.boxWeapons.visible=true;this.spPanel.texture="remote/pass_result/winPanel.png";this.boxPrize.y=379;let weaponBarsArr=this.boxWeapons._children;let weaponList=this.params.weaponList;let len=weaponList.length;for(let i=0;i<len;i++){weaponBarsArr[i].visible=true;let weaponBarsComp=weaponBarsArr[i].getComponent(WeaponBar);weaponBarsComp.params=weaponList[i];weaponBarsComp.initView();weaponBarsArr[i].off(Laya.Event.CLICK,weaponBarsComp)}}this.lblPrize.text=this.params.gold;this.spBtn.on(Laya.Event.CLICK,this,this.clickHandler);this.btnBack.on(Laya.Event.CLICK,this,this.backHandler);let warnDialog;if(this.params.refinerNew==1){warnDialog=new AlertDialog({message:"提高武器属性，去炼器室试试",confirmText:"前往",confirmHandler:()=>{this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).guideF("btn3")}});warnDialog.popup()}else if(this.params.roleNew==1){warnDialog=new AlertDialog({message:"胜不骄败不馁，尝试升级英雄！",confirmText:"前往",confirmHandler:()=>{this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).guideF("btn1")}});warnDialog.popup()}else if(this.params.weaponNew==1){warnDialog=new AlertDialog({message:"想要神兵相助，去兵器库逛逛！",confirmText:"前往",confirmHandler:()=>{this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).guideF("btn2")}});warnDialog.popup()}else{if(this.params.stageId<3||this.params.stageId>7){this.showAD()}}}showAD(){var params={onClose:function onClose(res){if(res.isEnded){console.log(`看完广告`)}else{var errorDialog=new AlertDialog({title:`温馨提示`,message:"看完广告才可拥有哦~"});errorDialog.popup()}},onError:function onError(res){console.warn(`------拉取广告失败------`)}};PaoYa.InterstitialAd.show(params)}clickHandler(){SoundManager.ins.btn();if(this.result==-1){this.close();GameControl.instance.restart();GameControl.instance.fillPlayerInfo()}else{console.log("继续闯关");PaoYa.Request.POST("hero_game_start",{stageId:1},res=>{let maskArea=new Laya.Sprite;maskArea.alpha=.5;maskArea.graphics.drawRect(0,0,Laya.Browser.width,Laya.Browser.height,"#000");maskArea.mouseEnabled=true;maskArea.zOrder=2e3;Laya.stage.addChild(maskArea);let tween=new Laya.Tween;tween.to(maskArea,{alpha:1},600,null,Laya.Handler.create(this,()=>{res.gameType="pass";PaoYa.navigator.replace("GameView",res);this.close();tween.clear();Laya.stage.removeChild(maskArea)}))},(msg,code)=>{let errorDialog;if(code==3018){errorDialog=new AlertDialog({title:"",message:msg})}else{errorDialog=new AlertDialog({title:"",message:msg,confirmText:"前往",confirmHandler:()=>{this.close();PaoYa.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).goRefiner()}})}errorDialog.popup()})}}backHandler(){SoundManager.ins.btn();this.close();PaoYa.navigator.popToRootScene()}}class GameView extends PaoYa.View{constructor(){super()}onAwake(){this.selfMPBarScr=this.boxSelfInfo.getChildByName("boxMPBar").getComponent(MPBar);this.selfHPBarScr=this.boxSelfInfo.getChildByName("boxHPBar").getComponent(HPBar);this.otherMPBarScr=this.boxOtherInfo.getChildByName("boxMPBar").getComponent(MPBar);this.otherHPBarScr=this.boxOtherInfo.getChildByName("boxHPBar").getComponent(HPBar);let sceneSK=new Laya.Skeleton;let sceneURL="";if(GameControl.instance.closeRobot){sceneURL=`remote/spine/scene/scene1.sk`;this.sceneBg.texture=`remote/game/scene1.jpg`}if(this.params.gameType==`pass`||this.params.gameType==`adventure`){if(this.params.stageId<15){sceneURL=`remote/spine/scene/scene1.sk`;this.sceneBg.texture=`remote/game/scene1.jpg`}else if(this.params.stageId>=15&&this.params.stageId<=29){sceneURL=`remote/spine/scene/scene3.sk`;this.sceneBg.texture=`remote/game/scene3.jpg`}else{sceneURL=`remote/spine/scene/scene1.sk`;this.sceneBg.texture=`remote/game/scene1.jpg`}}else if(this.params.gameType==`battle`){sceneURL=`remote/spine/scene/scene2.sk`;this.sceneBg.texture=`remote/game/scene2.jpg`}sceneSK.load(sceneURL,Laya.Handler.create(this,res=>{sceneSK.play("stand",true)}));this.sceneSK=sceneSK;this.scenePoint.addChild(sceneSK)}onEnable(){}initView(){}setInfo(data,isSelf){let boxInfo=isSelf?this.boxSelfInfo:this.boxOtherInfo;let imgIcon=boxInfo.getChildByName(`imgIcon`);let lblName=boxInfo.getChildByName(`lblName`);imgIcon.skin=data.icon;lblName.text=data.name}setHPbar(value,isSelf){let HPBarScr=isSelf?this.selfHPBarScr:this.otherHPBarScr}setMPBar(value,isSelf){let MPBarScr=isSelf?this.selfMPBarScr:this.otherMPBarScr}onDestroy(){}}class GameGuide extends GameView{constructor(){super()}}let guideContainer$1,maskArea$1,interactionArea$1,hitArea$1,selfSpeakMan$1,otherSpeakMan$1,selfSpeakManComp$1,otherSpeakManComp$1,nextLabel$1,guideStep$1=0;class GameGuideControl extends GameControl{constructor(){super();this.closeRobot=true;this.gameState="start"}onClick(e){switch(e.target.name){case"next":e.stopPropagation();console.log("跳过");break;case"mask":console.log("全局");break}}onAwake(){super.onAwake();this.aniFinger.zOrder=1200;this.owner.on(Laya.Event.CLICK,this,e=>{if(this.noCount){return}guideStep$1+=1;switch(guideStep$1){case 1:case 2:case 3:case 5:case 7:case 8:case 9:case 11:case 12:this["step"+guideStep$1]();break}})}arrowAni(){this.target.visible=true;this.timeLine.play(0,true)}stopArrowAni(){this.timeLine.pause()}resumeArrowAni(){this.target.visible=true;this.timeLine.resume()}step1(){selfSpeakMan$1.visible=false;otherSpeakMan$1.visible=true;otherSpeakManComp$1.showWord("小哥哥谦虚了，出招吧。")}step2(){selfSpeakMan$1.visible=true;otherSpeakMan$1.visible=false;selfSpeakManComp$1.showWord("那我就不客气了！")}step3(){selfSpeakMan$1.visible=false;nextLabel$1.visible=false;interactionArea$1.graphics.clear();interactionArea$1.graphics.drawRect(100,617,110,110,"#000");this.noCount=true;hitArea$1.unHit.clear();hitArea$1.unHit.drawRect(100,617,110,110,"#000");this.aniFinger.visible=true;this.aniFinger.pos(150,667);this.aniFinger.play(0,true)}step4(){Global.dataPoints("点击第一格兵器");this.noCount=false;this.aniFinger.visible=false;this.aniFinger.stop();maskArea$1.visible=false;Laya.MouseManager.enabled=false;interactionArea$1.graphics.clear()}step5(){this.noCount=true;nextLabel$1.visible=false;maskArea$1.visible=false;otherSpeakMan$1.visible=false;this.weaponManager=new WeaponManager(this.robotWeaponList);this.sWeapon=this.weaponManager.seletedWeapon(0);this.sWeapon.isSelf=false;this.weaponBarClickHandler(this.sWeapon);Laya.timer.once(1200,this,()=>{this.setPause();this.aniFinger.visible=true;this.aniFinger.pos(310,672);this.aniFinger.play(0,true);maskArea$1.visible=true;Laya.MouseManager.enabled=true;interactionArea$1.graphics.clear();interactionArea$1.graphics.drawRect(260,617,110,110,"#000");this.noCount=true;hitArea$1.unHit.clear();hitArea$1.unHit.drawRect(260,617,110,110,"#000")})}step6(){Global.dataPoints("点击第二格兵器");this.noCount=false;this.aniFinger.visible=false;this.aniFinger.stop();maskArea$1.visible=false;Laya.MouseManager.enabled=false;nextLabel$1.visible=false;this.setResume();interactionArea$1.graphics.clear();Laya.timer.once(550,this,()=>{this.setPause();Laya.MouseManager.enabled=true;maskArea$1.visible=true;nextLabel$1.visible=true;this.addTips()})}step7(){this.target.visible=false;this.imgTip.visible=false;this.imgTip.skin=`remote/guide/8.png`;this.imgTip.y=300;Laya.timer.once(200,this,()=>{this.imgTip.visible=true;this.resumeArrowAni()})}step8(){this.target.visible=false;this.imgTip.visible=false;this.stopArrowAni();maskArea$1.visible=false;Laya.MouseManager.enabled=false;nextLabel$1.visible=false;this.setResume();Laya.timer.scale=1;Laya.timer.once(100,this,()=>{maskArea$1.visible=true;Laya.MouseManager.enabled=true;nextLabel$1.visible=true;otherSpeakMan$1.visible=true;otherSpeakManComp$1.showWord("没想到你的武功那么厉害，看来我要动真格了。")})}step9(){maskArea$1.visible=false;nextLabel$1.visible=false;Laya.MouseManager.enabled=false;otherSpeakMan$1.visible=false;this.skillWithWeapon(false);Laya.timer.once(1500,this,()=>{this.setPause();maskArea$1.visible=true;Laya.MouseManager.enabled=true;this.dodgeOwner.zOrder=1010;this.aniFinger.visible=true;this.aniFinger.pos(1240,660);this.aniFinger.play(0,true);this.noCount=true;hitArea$1.unHit.clear();hitArea$1.unHit.drawRect(1160,580,160,160,"#000");this.dodgeOwner.once(Laya.Event.CLICK,this,e=>{e.stopPropagation();guideStep$1+=1;this.setResume();this.step10()})})}step10(){Global.dataPoints("点击闪避");this.noCount=false;this.aniFinger.visible=false;this.aniFinger.stop();this.dodgeOwner.zOrder=10;maskArea$1.visible=false;Laya.MouseManager.enabled=false;console.log("hha,点击1000");Laya.timer.once(1500,this,()=>{maskArea$1.visible=true;Laya.MouseManager.enabled=true;nextLabel$1.visible=true;selfSpeakMan$1.visible=true;selfSpeakManComp$1.showWord(`呼，还好闪得快，不然够我喝一壶。`)})}step11(){let tween=new Laya.Tween;tween.to(maskArea$1,{alpha:1},2e3,null,Laya.Handler.create(this,()=>{}));selfSpeakManComp$1.showWord(`唉？龙儿姑娘去哪儿了？`);this.otherPlayer.node.removeSelf()}step12(){this.navigator.popToRootScene();PaoYa.navigator.visibleScene.getComponent(HomeControl).setGuide()}setPause(){this.selfWeapons.forEach(weapon=>{weapon.pause()});this.otherWeapons.forEach(weapon=>{weapon.pause()})}setResume(){this.selfWeapons.forEach(weapon=>{weapon.resume()});this.otherWeapons.forEach(weapon=>{weapon.resume()})}addTips(){let imgTip=new Laya.Image;imgTip.skin=`remote/guide/imgRoute.png`;imgTip.y=100;imgTip.centerX=0;imgTip.zOrder=1200;this.imgTip=imgTip;this.owner.addChild(imgTip);this.arrowAni()}onEnable(){super.onEnable();this.spriteBg.on(Laya.Event.CLICK,this,e=>{guideStep$1+=1;switch(guideStep$1){case 4:e.stopPropagation();this.step4();break;case 6:e.stopPropagation();this.step6();break}console.log(`接收到点击`)});this.onNotification("collide",this,()=>{if(this._first){return}Laya.timer.once(500,this,()=>{this._first=true;maskArea$1.visible=true;Laya.MouseManager.enabled=true;nextLabel$1.visible=true;otherSpeakMan$1.visible=true;otherSpeakManComp$1.showWord(`好痛。我生气了！吃我一剑。`)})});guideContainer$1=new Laya.Sprite;guideContainer$1.zOrder=1e3;this.owner.addChild(guideContainer$1);guideContainer$1.cacheAs="bitmap";maskArea$1=new Laya.Sprite;maskArea$1.alpha=.5;maskArea$1.graphics.drawRect(0,0,1634,750,"#000");maskArea$1.pos(-150,0);maskArea$1.mouseEnabled=true;guideContainer$1.addChild(maskArea$1);interactionArea$1=new Laya.Sprite;interactionArea$1.blendMode="destination-out";guideContainer$1.addChild(interactionArea$1);hitArea$1=new Laya.HitArea;hitArea$1.hit.drawRect(0,0,1634,750,"#000");guideContainer$1.hitArea=hitArea$1;guideContainer$1.mouseEnabled=true;let target=new Laya.Sprite;target.pos(885,565);target.texture=`remote/guide/arrow.png`;target.visible=false;this.target=target;this.curY=target.y;let timeLine=new Laya.TimeLine;this.timeLine=timeLine;let originY=this.curY;this.timeLine.to(this.target,{y:originY+20},400,null,0).to(this.target,{y:originY},400,null,1);guideContainer$1.addChild(target);nextLabel$1=new Laya.Label;nextLabel$1.text="跳过";nextLabel$1.font="figureDetail";nextLabel$1.pos(1100,30);nextLabel$1.name="next";nextLabel$1.mouseEnabled=true;nextLabel$1.zOrder=1300;console.log(nextLabel$1.width);guideContainer$1.addChild(nextLabel$1);nextLabel$1.on(Laya.Event.CLICK,this,this.nextTick);selfSpeakMan$1=this.selfSpeakMan.create.call(this.selfSpeakMan);selfSpeakManComp$1=selfSpeakMan$1.getComponent(SpeakMan);selfSpeakManComp$1.showWord("还请龙儿姑娘手下留情啊。");selfSpeakMan$1.y=225;selfSpeakMan$1.zOrder=1003;this.owner.addChild(selfSpeakMan$1);otherSpeakMan$1=this.otherSpeakMan.create.call(this.otherSpeakMan);otherSpeakManComp$1=otherSpeakMan$1.getComponent(SpeakMan);otherSpeakMan$1.pos(50,255);otherSpeakMan$1.zOrder=1003;this.owner.addChild(otherSpeakMan$1);otherSpeakMan$1.visible=false}nextTick(e){e.stopPropagation();guideStep$1+=1;this["step"+guideStep$1]()}}class RefiningControl extends PaoYa.Component{constructor(){super();RefiningControl.ins=this}onAwake(){}onEnable(){}onThrottleClick(e){if(!this.owner){return}let owner=this.owner;switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`figure`:if(owner.figureD.visible){return}SoundManager.ins.btn();owner.figure.skin=`remote/refining/4.png`;owner.weopon.skin=`remote/refining/5.png`;owner.figureD.visible=true;owner.weoponD.visible=false;break;case`weopon`:if(owner.weoponD.visible){return}SoundManager.ins.btn();owner.figure.skin=`remote/refining/2.png`;owner.weopon.skin=`remote/refining/3.png`;owner.figureD.visible=false;owner.weoponD.visible=true;break}}addLv(e){if(e.status){this.POST("martial_user_weapon_list",{refinerId:e.id},data=>{data.isGuide=this.owner.isGuide;this.navigator.push(`Devour`,data)})}else{this.navigator.popup(`refiner/Canlock`,e)}}getMask(){let owner=this.owner;owner.guide1.visible=true;Global.dataPoints("进入炼器引导");this.guideStep=0;this.guideSteps=[{x:120,y:3,radius:53}];const Sprite=Laya.Sprite;this.gameContainer=new Sprite;this.gameContainer.size(1634,750);this.gameContainer.pos(-150,0);this.gameContainer.mouseEnabled=true;owner.addChild(this.gameContainer);this.gameContainer.on(Laya.Event.CLICK,this,()=>{switch(this.guideStep){case 0:this.addLv(owner.params.refiner_list[0]);Global.dataPoints("点击淬体");break;case 1:Global.dataPoints("点击一键选中");Devour$1.ins.nextP();SoundManager.ins.btn();this.guideStep=2;DevourControl.ins.chiocethreeWp();this.nextStep(Devour$1.ins.guide3);break;case 2:Global.dataPoints("点击吞噬升级");SoundManager.ins.btn();DevourControl.ins.eatWp();this.guideStep=3;this.isGuide=false;this.nextStep();Devour$1.ins.guide3.visible=false;Global.isShowGrading=true;break}});this.guideContainer=new Sprite;owner.addChild(this.guideContainer);this.guideContainer.cacheAs="bitmap";owner.guide1.zOrder=2;owner.guide1f(1);this.maskArea=new Sprite;this.guideContainer.addChild(this.maskArea);this.maskArea.alpha=.5;this.maskArea.graphics.drawRect(-150,0,1634,750,"#000");this.interactionArea=new Sprite;this.guideContainer.addChild(this.interactionArea);this.interactionArea.blendMode="destination-out";this.hitArea=new Laya.HitArea;this.hitArea.hit.drawRect(-150,0,1634,750,"#000");this.guideContainer.hitArea=this.hitArea;this.guideContainer.mouseEnabled=true;this.nextStep(owner.guide1)}sceondStep(){this.owner.guide1.visible=false;this.guideStep=1;this.nextStep(Devour$1.ins.guide2)}nextStep(obj){let owner=this.owner;if(this.guideStep===this.guideSteps.length){owner.removeChild(this.guideContainer);owner.removeChild(this.gameContainer);owner.guide1.visible=false;return}let step=this.guideSteps[this.guideStep];this.hitArea.unHit.clear();this.hitArea.unHit.drawCircle(obj.x+step.x,obj.y+step.y,step.radius,"#000000");this.interactionArea.graphics.clear();this.interactionArea.graphics.drawCircle(obj.x+step.x,obj.y+step.y,step.radius,"#000000")}onDisable(){if(Global.isShowGrading){HomeControl.ins.lockBattle()}}}class Refining extends PaoYa.View{constructor(){super();Refining.ins=this}onAwake(){this.isGuide=this.params.isGuide;this.params=this.params.detail}onEnable(){Global.dataPoints("进入炼器页面");this.changeData();if(this.isGuide){RefiningControl.ins.getMask();PaoYa.Request.POST(`martial_change_new_hand`,{type:`refinerNew`})}}lisenClick(e){}changeData(){if(!this.isGuide){this.guide1.visible=false}this.params.refiner_list.forEach((element,index)=>{this[`${element.id}Txt`].text=element.refinerName;this[`${element.id}Txt`].font=`weaponDFont`;this[`${element.id}Txt`].scale(.6,.6);this[`${element.id}Txt`].pos(35,12);this[`${element.id}Lv`].text=element.refinerLevel?`LV.${element.refinerLevel}`:`LV.1`;this[`${element.id}Lv`].font=`weaponNFontT`;this[`${element.id}Lv`].scale(.5,.5);this[`${element.id}Lv`].pos(26,93);this[`${element.id}`].gray=element.status?false:true;this[`${element.id}`].offAll();this[`${element.id}`].on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.ReIndex=index;RefiningControl.ins.addLv(element)})})}guide1f(e){let n=e==1?-1:1;Laya.Tween.to(this.guide1,{x:this.guide1.x+15*n},300,null,Laya.Handler.create(this,()=>{this.guide1f(n)}))}}class DevourControl$1 extends PaoYa.Component{constructor(){super();DevourControl$1.ins=this;this.willBeEatList=[]}onAwake(){}onEnable(){}onThrottleClick(e){switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`eatBtn`:SoundManager.ins.btn();this.eatWp();break;case`choiceBtn`:SoundManager.ins.btn();this.chiocethreeWp()}}getWareList(){let owner=this.owner;this.lightList=owner.params.lightList;this.heavyList=owner.params.heavyList;this.middleList=owner.params.middleList;this.allList=this.lightList.concat(this.heavyList,this.middleList);this.myUserList=[];let arr=owner.params.userWeapons.split(`,`);arr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.myUserList.push(obj)});this.showWareList(this.allList)}showWareList(list){let showList=JSON.parse(JSON.stringify(list));let arr=[];let unShowWeap=JSON.parse(JSON.stringify(this.myUserList));showList.forEach((element,index)=>{for(let i=0;i<unShowWeap.length;i++){if(element.weaponId==unShowWeap[i].name&&element.weaponLevel==unShowWeap[i].lv){element.num-=1}}for(let i=0;i<element.num;i++){let obj=JSON.parse(JSON.stringify(element));obj.WpGrade=obj.weaponStar*100+obj.weaponLevel;arr.push(obj)}});if(this.newWpList){let al=arr.length;let ml=this.newWpList.length;getNewList:for(let j=0;j<ml;j++){for(let i=0;i<al;i++){if(arr[i].weaponId==this.newWpList[j].name&&arr[i].weaponLevel==this.newWpList[j].lv&&!arr[i].isUsingWp&&!this.newWpList[j].isOdd){arr[i].isNew=true;arr[i].idIdx=j;continue getNewList}}}}arr.sort(function(a,b){return a.WpGrade-b.WpGrade});this.isWareChoiceWp=null;this.newAllArr=arr;this.childList=[];this.idList=[];this.owner.warehouseList.array=arr}singleWeapon(cell,idx){this.childList.push(cell);cell.skin=`local/common/frameBg.png`;cell.getChildByName(`wp`).skin=`remote/small_weapons/s_${cell._dataSource.weaponId}.png`;cell.getChildByName(`lv`).text=`LV.${cell._dataSource.weaponLevel}`;cell.getChildByName(`lv`).font=`weaponNFontT`;cell.getChildByName(`lv`).scale(.7,.7);let skinq=``;let skint=``;switch(cell._dataSource.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(cell._dataSource.weaponType){case 3:skint=`local/common/type_1.png`;break;case 2:skint=`local/common/type_2.png`;break;case 1:skint=`local/common/type_3.png`;break}cell.getChildByName(`bgwrap`).skin=skinq;cell.getChildByName(`mark`).skin=skint;if(cell._dataSource.willBeEat){cell.getChildByName(`beChioce`).visible=true}else{cell.getChildByName(`beChioce`).visible=false}}chioceWp(cell,index){let owner=this.owner;if(cell._dataSource.willBeEat){let num=null;this.newAllArr[index].ischiocedd=false;this.willBeEatList.forEach((element,idx)=>{if(element==index){num=idx}});this.willBeEatList.splice(num,1);cell._dataSource.willBeEat=false;cell.getChildByName(`beChioce`).visible=false}else{if(this.willBeEatList.length>2){return}this.newAllArr[index].ischiocedd=true;this.willBeEatList.push(index);cell._dataSource.willBeEat=true;cell.getChildByName(`beChioce`).visible=true}let num=0;let allnum=0;this.childList.forEach((element,index)=>{if(allnum>2){return}if(element._dataSource.willBeEat){allnum++;num+=element._dataSource.exp}});owner.curryExp.width=owner.nextExp.width+num/owner.params.refiner.currentFullExp*224>224?224:owner.nextExp.width+num/owner.params.refiner.currentFullExp*224}eatWp(e){let owner=this.owner;if(this.willBeEatList.length<1){return}let idlist=``;let isHigh=false,highDeatil;let addexp=0;this.willBeEatList.forEach(element=>{if(this.newAllArr[element].weaponStar==3&&!e){isHigh=true;highDeatil=this.newAllArr[element]}addexp+=this.newAllArr[element].exp;idlist=`${idlist}${this.newAllArr[element].weaponId}-${this.newAllArr[element].weaponLevel},`});if(isHigh){let obj={detail:highDeatil,type:`refining`};this.navigator.popup("weapon/StoreSure",obj);return}PaoYa.Request.POST(`martial_update_refiner`,{weaponId:idlist,refinerId:owner.params.refiner.id,addExp:addexp},res=>{if(res.refiner){owner.params.refiner=res.refiner;owner.params.nextRefiner=res.nextRefiner;Refining.ins.params.refiner_list[Refining.ins.ReIndex]=owner.params.refiner}else{owner.params.refiner.currentExp=res.totalExp}owner.initInfo();let arr2=[];this.newAllArr.forEach((element,idx)=>{if(!element.ischiocedd){arr2.push(element)}});this.willBeEatList=[];this.childList=[];this.newAllArr=arr2;owner.warehouseList.array=arr2})}chiocethreeWp(){let owner=this.owner;this.childList.forEach((element,index)=>{if(element.ischiocedd){this.chioceWp(element,index)}});owner.warehouseList.tweenTo(0,200,Laya.Handler.create(this,()=>{for(let i=0;i<3;i++){if(this.childList[i]){this.chioceWp(this.childList[i],i)}}}))}getMask(){let owner=this.owner;this.guideStep=1;this.guideSteps=[{x:120,y:3,radius:53},{x:143,y:0,radius:90},{x:143,y:0,radius:90}];const Sprite=Laya.Sprite;owner.guide2.zOrder=2;owner.guide2.visible=true;owner.guide2f(1);RefiningControl.ins.sceondStep();this.gameContainer=new Sprite;this.gameContainer.size(1634,750);this.gameContainer.pos(-150,0);this.gameContainer.mouseEnabled=true;owner.addChild(this.gameContainer);this.gameContainer.on(Laya.Event.CLICK,this,()=>{switch(this.guideStep){case 0:Global.dataPoints("点击淬体");RefiningControl.ins.addLv(owner.params.refiner_list[0]);break;case 1:owner.nextP();SoundManager.ins.btn();this.guideStep=2;this.chiocethreeWp();this.nextStep(owner.guide3);Global.dataPoints("点击一键选中");break;case 2:SoundManager.ins.btn();this.eatWp();this.guideStep=3;this.isGuide=false;this.nextStep();owner.guide3.visible=false;Global.dataPoints("点击吞噬升级");Global.isShowGrading=true;break}});this.guideContainer=new Sprite;owner.addChild(this.guideContainer);this.guideContainer.cacheAs="bitmap";this.maskArea=new Sprite;this.guideContainer.addChild(this.maskArea);this.maskArea.alpha=.5;this.maskArea.graphics.drawRect(-150,0,1634,750,"#000");this.interactionArea=new Sprite;this.guideContainer.addChild(this.interactionArea);this.interactionArea.blendMode="destination-out";this.hitArea=new Laya.HitArea;this.hitArea.hit.drawRect(-150,0,1634,750,"#000");this.guideContainer.hitArea=this.hitArea;this.guideContainer.mouseEnabled=true;this.nextStep(owner.guide2)}sceondStep(){this.owner.guide1.visible=false;SoundManager.ins.btn();this.guideStep=1;this.nextStep(Devour.ins.guide2)}nextStep(obj){let owner=this.owner;if(this.guideStep===this.guideSteps.length){owner.removeChild(this.guideContainer);owner.removeChild(this.gameContainer);owner.guide2.visible=false;owner.guide3.visible=false;Refining.ins.isGuide=false;return}let step=this.guideSteps[this.guideStep];this.hitArea.unHit.clear();this.hitArea.unHit.drawCircle(obj.x+step.x,obj.y+step.y,step.radius,"#000000");this.interactionArea.graphics.clear();this.interactionArea.graphics.drawCircle(obj.x+step.x,obj.y+step.y,step.radius,"#000000")}}class Devour$1 extends PaoYa.View{constructor(){super();Devour$1.ins=this}onAwake(){}onEnable(){if(this.params.isGuide){DevourControl$1.ins.getMask()}this.warehouseList.vScrollBarSkin="";this.warehouseList.renderHandler=new Laya.Handler(this,this.wareWeaponUpdateItem);PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;PaoYa.DataCenter.user.gold=res.gold;PaoYa.DataCenter.user.diamond=res.diamond;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.goldNum.width*.6)/2,25);function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}});this.title.text=this.params.refiner.refinerName;this.title.font=`weaponDFont`;this.title.scale(.8,.8);this.title.x=(411-this.title.width)/2;this.detail.text=this.params.refiner.refinerDesc;this.next.font=`weaponDFont`;this.next.scale(.6,.6);this.choiceTxt.font=`weaponDFont`;this.choiceTxt.scale(.6,.6);this.choiceTxt.pos(40,13);this.eatTxt.font=`weaponDFont`;this.eatTxt.scale(.6,.6);this.eatTxt.pos(40,13);DevourControl$1.ins.getWareList();this.initInfo()}onAppear(){if(!Refining.ins.isGuide){this.guide2.visible=false;this.guide3.visible=false}}lisenClick(e){}initInfo(){this.pLv.text=`LV.${this.params.refiner.refinerLevel}`;this.pLv.font=`weaponDFont`;this.pLv.scale(.55,.55);this.pLv.pos(28,20);let nowaddtext=null;let arr=[];if(this.params.refiner.refinerEffect.indexOf("+")!=-1){if(this.params.refiner.refinerEffect.indexOf("%")!=-1){arr=this.params.refiner.refinerEffect.split("+d%");nowaddtext=`+${this.params.refiner.refinerBasics.show|0}%`}else{arr=this.params.refiner.refinerEffect.split("+d");nowaddtext=`+${this.params.refiner.refinerBasics.show|0}`}}else{if(this.params.refiner.refinerEffect.indexOf("%")!=-1){arr=this.params.refiner.refinerEffect.split("d%");nowaddtext=`${this.params.refiner.refinerBasics.show|0}%`}else{arr=this.params.refiner.refinerEffect.split("d");nowaddtext=`${this.params.refiner.refinerBasics.show|0}`}}this.pd.text=arr[0];this.pd.x=28;this.add.x=this.pd.width+this.pd.x;this.add.text=nowaddtext;this.pd2.text=arr[1];this.pd2.x=this.add.width+this.add.x;if(this.params.nextRefiner){let nowaddtext2=null;let arrr=[];if(this.params.nextRefiner.refinerEffect.indexOf("+")!=-1){if(this.params.nextRefiner.refinerEffect.indexOf("%")!=-1){arrr=this.params.nextRefiner.refinerEffect.split("+d%");nowaddtext2=`+${this.params.nextRefiner.refinerBasics.show|0}%`}else{arrr=this.params.nextRefiner.refinerEffect.split("+d");nowaddtext2=`+${this.params.nextRefiner.refinerBasics.show|0}`}}else{if(this.params.nextRefiner.refinerEffect.indexOf("%")!=-1){arrr=this.params.nextRefiner.refinerEffect.split("d%");nowaddtext2=`${this.params.nextRefiner.refinerBasics.show|0}%`}else{arrr=this.params.nextRefiner.refinerEffect.split("d");nowaddtext2=`${this.params.nextRefiner.refinerBasics.show|0}`}}this.pnd.text=arrr[0];this.pnd.x=28;this.pnadd.x=this.pnd.width+this.pnd.x;this.pnadd.text=nowaddtext2;this.pnd2.text=arr[1];this.pnd2.x=this.pnadd.width+this.pnadd.x}else{this.eatBtn.disabled=true;this.choiceBtn.disabled=true;this.pnd.text=``;this.pnadd.text=``;this.pnd2.text=``}this.curryExp.width=this.params.refiner.currentExp/this.params.refiner.currentFullExp*224;this.nextExp.width=this.params.refiner.currentExp/this.params.refiner.currentFullExp*224}wareWeaponUpdateItem(cell,index){console.log(this.warehouseList);DevourControl$1.ins.singleWeapon(cell,index);cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();DevourControl$1.ins.chioceWp(cell,index)})}guide2f(e){let n=e==1?-1:1;Laya.Tween.to(this.guide2,{x:this.guide2.x+15*n},300,null,Laya.Handler.create(this,()=>{this.guide2f(n)}))}guide3f(e){let n=e==1?-1:1;Laya.Tween.to(this.guide3,{x:this.guide3.x+15*n},300,null,Laya.Handler.create(this,()=>{this.guide3f(n)}))}nextP(){this.guide2.visible=false;this.guide3.visible=true;this.guide3.zOrder=2;this.guide3f(1)}onDisable(){Laya.stage.removeChild(Devour$1.ins.guide2);Laya.stage.removeChild(Devour$1.ins.guide3);PaoYa.Request.GET("martial_refiner_list",{},res=>{if(!res){return}Refining.ins.params.refiner_list=res.refiner_list;Refining.ins.changeData()})}}class Grading extends PaoYa.View{constructor(){super()}onAwake(){}onEnable(){Global.dataPoints("进入华山论剑");this.gameStartTxt.font=`weaponDFont`;this.gameStartTxt.scale(.7,.7);this.gameStartTxt.pos(22,15);this.gradingNum.skin=`local/common/badge_${this.params.ladder}.png`;this.canUseList=[];this.params.roleList.forEach(element=>{if(element.roleStatus){this.canUseList.push(element)}});this.canUseList.forEach(element=>{if(element.roleId==this.params.defaultRole){this.showDetail=element}});if(this.canUseList.length>3){this.canUseList.splice(2,1)}this.herolist.renderHandler=new Laya.Handler(this,this.figureRender);this.herolist.array=this.canUseList;if(this.params.ladder==9){this.starNum.visible=false;this.starNum2.visible=true;this.starNumTxt.text=`×${this.params.ladderStar}`;this.starNumTxt.font=`weaponNFontT`;this.starNumTxt.scale(.8,.8)}else{this.starNum.visible=true;this.starNum2.visible=false;var arr=new Array(this.params.ladderFullStar);this.starNum.renderHandler=new Laya.Handler(this,this.starNumRender);this.starNum.array=arr;this.starNum.x=224/7*(7-this.params.ladderFullStar)+121}PaoYa.DataCenter.user.config_list.hero.ladderList.forEach(element=>{if(this.params.ladder==element.ladderId){this.gradingNum.skin=`local/common/badge_${element.ladderId}.png`;this.gradingname.text=element.ladderName;this.gradingname.font=`weaponNFontT`;this.gradingname.scale(.8,.8);this.gradingname.pos(258.5,470)}});this.initInfo()}lisenClick(e){}changeGold(){}figureRender(cell,idx){cell.getChildByName(`icon`).skin=`local/common/${cell.dataSource.roleDress}.png`;cell.getChildByName(`bgwarp`).visible=this.showDetail.roleId==cell.dataSource.roleId?true:false;if(this.showDetail.roleId==cell.dataSource.roleId){this.prole=cell}cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.prole.getChildByName(`bgwarp`).visible=false;this.prole=cell;this.showDetail=cell.dataSource;this.initInfo();cell.getChildByName(`bgwarp`).visible=true})}starNumRender(cell,idx){cell.skin=idx+1>this.params.ladderStar?`remote/grading/5.png`:`remote/grading/4.png`}onDisable(){}initInfo(){this.skbox.y=390;this.skbox.x=370;if(this.heroSkin){this.heroSkin.stop();this.heroSkin.destroy();this.heroSkin=null}this.heroSkin=HeroConfig.getSkeleton(this.showDetail.roleDress);this.skbox.addChild(this.heroSkin);this.heroSkin.pos(100,400);this.heroSkin.scale(1.5,1.5);this.heroSkin.play(`stand`,true);for(let i=0;i<5;i++){this[`lv${i+1}`].visible=false;if(i<this.showDetail.roleStar){this[`lv${i+1}`].visible=true}}this.heroname.text=`${this.showDetail.roleName}LV.${this.showDetail.roleLevel}/${this.showDetail.roleTopLevel}`;this.heroname.font=`weaponNFontT`;this.heroname.scale(.8,.8)}}class GradingControl extends PaoYa.Component{constructor(){super();GradingControl.ins=this}onAwake(){}onEnable(){}onThrottleClick(e){if(!this.owner){return}switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`gameStart`:let _this=this;SoundManager.ins.btn();PaoYa.AuthManager.auth({scope:PaoYa.AuthManager.scope.userInfo,isNecessary:false,next(){console.log(`授权成功`);_this.gameRole(_this.owner.showDetail.roleId)}});break}}gameRole(e){this.POST("hero_match_game_start",{roleId:e},res=>{res.gameType="battle";this.navigator.push("MatchView",res)})}}class LoadingView extends PaoYa.View{constructor(type){super();this.type=type||"normal";this.on(Laya.Event.PROGRESS,this,this.onProgress);if(this.type!=="normal"){Laya.timer.frameLoop(1,this,this.onUpdate)}let scene=PaoYa.game.launchOption.scene;if(window.BK&&(scene==318||scene==319)&&this.type=="normal"){this.lblProgress.visible=false;this.progressView.visible=false;this.imgProgressBg.visible=false;this.lblTips.visible=false}}onUpdate(){if(this.type!=="normal"){this.progressView.rotation+=5}}onProgress(progress){this.lblProgress.text=`${Math.ceil(progress*100)}%`;if(this.type=="normal"){let mask=this.progressView.mask;mask.graphics.clear();mask.graphics.drawRect(0,0,Math.ceil(this.progressView.width*progress),this.progressView.height,"#ff0000")}}}class LoadingControl extends PaoYa.Component{onAwake(){this.type=this.type||"normal";this.owner.on(Laya.Event.PROGRESS,this,this.onProgress);if(this.type!=="normal"){let bg=this.progressViewBg;bg.graphics.clear();bg.graphics.drawPath(0,0,PaoYa.Utils.makeAllCornerRoundRectPath(bg.width,bg.height,20),{fillStyle:"#000000"})}}onUpdate(){if(this.type!=="normal"){this.progressView.rotation+=5}}onProgress(progress){this.lblProgress.text=`${Math.ceil(progress*100)}%`;if(this.type=="normal"){let mask=this.progressView.mask;mask.graphics.clear();mask.graphics.drawRect(0,0,Math.ceil(this.progressView.width*progress),this.progressView.height,"#ff0000")}}}class MatchView extends PaoYa.View{constructor(){super()}onAwake(){this.lblTip.font="weaponNFontT";this.selfLadderName.font="weaponNFontT";this.otherLadderName.font="weaponNFontT";this.lblTip.scale(.8,.8);this.ladderNameArr=["无名小卒","初出茅庐","后起之秀","江湖少侠","武林高手","名震江湖","独步武林","一代宗师","独孤求败"];this.initView()}initView(){let params=this.params;this.selfLadderId=params.ladder;this.otherLadderId=params.robotLadder;this.selfName.text=PaoYa.Utils.formatName(params.nickName);this.selfAvstar.texture=`local/common/hero_${params.roleId}.png`;this.selfLadderInfo=this.findLadderById(this.selfLadderId);this.otherLadderInfo=this.findLadderById(this.otherLadderId);this.selfLadder.texture=`local/common/badge_${this.selfLadderInfo.ladderId}.png`;console.log(this.selfLadderInfo.texture);this.selfLadderName.text=this.selfLadderInfo.ladderName;this.resetStar(true);this.resetStar(false);this.otherStars.visible=false}resetStar(isSelf){let name=isSelf?"self":"other";let ladder=isSelf?"ladder":"robotLadder";if(this.params[ladder]>8){let sprite=new Laya.Sprite;sprite.texture=`local/common/starLight.png`;this[name+"Stars"].addChild(sprite);let label=new Laya.Label;label.text="×"+this.params.ladderStar;label.fontSize=30;label.height=56;label.valign="middle";label.color="#ffffff";this[name+"Stars"].addChild(label)}else{let star=this.params[ladder+"Star"];let numStar=this[name+"LadderInfo"].ladderStar;for(let i=0;i<numStar;i++){let sprite=new Laya.Sprite;if(i<star){sprite.texture=`local/common/starLight.png`}else{sprite.texture=`local/common/starDark.png`}this[name+"Stars"].addChild(sprite);console.warn("hbox宽度："+name,this[name+"Stars"].width)}}}startAni(){let point="...";let index=1;let ladderIndex=1;let nameIndex=0;Laya.timer.loop(300,this,()=>{index=index==4?1:index+1;ladderIndex=ladderIndex==9?1:ladderIndex+1;nameIndex=nameIndex==this.ladderNameArr.length-1?0:nameIndex+1;point=point=="..."?".":point+".";this.lblTip.text=`匹配成功,发便当中${point}`;this.otherAvstar.texture=`local/common/hero_${index}.png`;this.otherLadderName.text=this.ladderNameArr[nameIndex];this.otherLadder.texture=`local/common/badge_${ladderIndex}.png`})}matchOK(){this.stopAni();this.otherStars.visible=true;this.otherName.text=this.params.robotNickName;this.otherLadderInfo.texture=`local/common/badge_${this.otherLadderInfo.ladderId}.png`;this.otherLadderName.text=PaoYa.Utils.formatName(this.otherLadderInfo.ladderName)}stopAni(){Laya.timer.clearAll(this)}findLadderById(id){var result=PaoYa.DataCenter.config.hero.ladderList.filter(function(item){return item.id==id});return result[0]}}class MatchControl extends PaoYa.Component{constructor(){super();MatchControl.ins=this}onAwake(){this.params=this.owner.params;this.gameBannerComp=this.boxGameBanner.getComponent(GameBanner)}onAppear(){let timerService=new PaoYa.TimerService(1e3,1,true);timerService.on(PaoYa.TimerService.PROGRESS,this,time=>{this.gameBannerComp.setTimeText(`等待时间:${time}`)});timerService.on(PaoYa.TimerService.STOP,this,()=>{console.log("停止计时器")});timerService.start();this.timerService=timerService;this.owner.startAni();let randomTime=(Math.floor(Math.random()*3)+1)*1e3;Laya.timer.once(randomTime,this,this.matchOK)}onClick(e){switch(e.target.name){case"btnBack":this.timerService.stop();Laya.timer.clearAll(this);this.navigator.pop();break}}matchOK(){this.owner.matchOK();this.timerService&&this.timerService.stop();Laya.timer.once(200,this,()=>{this.navigator.push("GameView",this.params)})}onDisappear(){this.owner.stopAni()}}class Sign extends PaoYa.View{constructor(){super();Sign.ins=this}onAwake(){}onEnable(){Global.dataPoints("进入签到页面");this.initInfo()}lisenClick(e){}initInfo(){this.params.login_days=this.params.login_days%7;let arr=this.params.list.slice(0,6);let arr1=this.params.list.slice(6,7);this.signList.vScrollBarSkin="";this.signList.renderHandler=new Laya.Handler(this,this.signListItem);this.signList.array=arr;this.sevenDay.dataSource=arr1[0];this.signListItem(this.sevenDay,6);if(this.params.status){this.showtips.visible=true;this.showBtn.visible=false;this.video.visible=false;this.tips.font=`figureDetail`;this.tips.scale(.8,.8)}else{this.showtips.visible=false;this.showBtn.visible=true;this.video.visible=true;this.eatTxt.font=`weaponDFont`;this.eatTxt.scale(.6,.6);this.eatTxt.pos(35,13)}}signListItem(cell,index){let arr=cell.dataSource.split(`-`);let wp=cell.getChildByName(`wp`);let icon=cell.getChildByName(`icon`);let awardImage=cell.getChildByName(`awardImage`);let num=cell.getChildByName(`num`);let day=cell.getChildByName(`day`);let choice=cell.getChildByName(`choice`);let mask=cell.getChildByName(`mask1`);let already=cell.getChildByName(`already`);if(index+1>this.params.login_days){mask.visible=false}else{mask.visible=true;already.visible=true}if(index==this.params.login_days&&!this.params.status){choice.visible=true}day.text=`第${index+1}天`;day.font=`weaponNFontT`;day.scale(.75,.75);day.pos(31,235);switch(arr[0]){case`1`:wp.getChildByName(`wp`).skin=`local/common/wp.png`;wp.visible=true;break;case`2`:icon.visible=true;icon.getChildByName(`iconnum`).skin=`local/common/hero_${arr[1]}.png`;console.log(icon);break;case`3`:wp.getChildByName(`wp`).skin=`local/common/wp.png`;wp.visible=true;break;case`8`:awardImage.visible=true;num.visible=true;awardImage.skin=`local/common/icon.png`;num.text=`×${arr[1]}`;num.font=`weaponNFontT`;num.scale(.65,.65);num.pos(28,175);break;case`9`:awardImage.visible=true;num.visible=true;awardImage.skin=`local/common/diamond.png`;num.text=`×${arr[1]}`;num.font=`weaponNFontT`;num.scale(.65,.65);num.pos(28,175);break}}}class Swordsman extends PaoYa.View{constructor(){super();Swordsman.ins=this}onAwake(){}onEnable(){this.isGuide=this.params.isGuide;this.guideBack=false;this.params=this.params.detail;if(this.isGuide){Global.dataPoints("用户进入人物引导页面");this.guide1.visible=true;this.guide1.zOrder=999;PaoYa.Request.POST(`martial_change_new_hand`,{type:`roleNew`});this.guideContainer=new Laya.Sprite;this.addChild(this.guideContainer);this.guideContainer.cacheAs="bitmap";let spmask=new Laya.Sprite;spmask.alpha=.5;this.guideContainer.addChild(spmask);spmask.graphics.drawRect(-150,0,1634,750,"#000");this.sp=new Laya.Sprite;this.guideContainer.addChild(this.sp);this.sp.blendMode="destination-out";this.graR(this.guide1.x+143,this.guide1.y,90);this.guide1f(1)}this.params.roleList.forEach(element=>{if(element.roleId==this.params.defaultRole){this.showDetail=element}});this.params.roleList=this.params.roleList;this.herolist.renderHandler=new Laya.Handler(this,this.figureRender);this.herolist.array=this.params.roleList;this.lvupbtnTxt.font=`weaponDFont`;this.lvupbtnTxt.scale(.8,.8);this.lvupbtnTxt.pos(60,10);this.equipbtnTxt.font=`weaponDFont`;this.equipbtnTxt.scale(.8,.8);this.equipbtnTxt.pos(60,10);this.signGetTxt.font=`weaponDFont`;this.signGetTxt.scale(.8,.8);this.signGetTxt.pos(60,10);this.alreadyTxt.font=`weaponDFont`;this.alreadyTxt.scale(.8,.8);this.alreadyTxt.pos(35,10)}lisenClick(e){}initInfo(){this.skbox.y=390;this.skbox.x=370;if(this.heroSkin){this.heroSkin.stop();this.heroSkin.destroy();this.heroSkin=null}this.heroSkin=HeroConfig.getSkeleton(this.showDetail.roleDress);this.skbox.addChild(this.heroSkin);this.heroSkin.pos(100,400);this.heroSkin.scale(1.5,1.5);this.heroSkin.play(`stand`,true);if(this.showDetail.roleId==this.params.defaultRole){this.isUse.visible=true}else{this.isUse.visible=false}this.speciality.font=`weaponDFont`;this.speciality.text=this.showDetail.roleDesc;switch(this.speciality.text.length){case 2:this.speciality.y=60;this.speciality.scale(1,1);this.speciality.x=20;break;case 3:this.speciality.y=50;this.speciality.scale(.8,.8);this.speciality.x=25;break;case 4:this.speciality.y=35;this.speciality.scale(.7,.7);this.speciality.x=30;break}for(let i=0;i<5;i++){this[`lv${i+1}`].visible=false;if(i<this.showDetail.roleStar){this[`lv${i+1}`].visible=true}}this.showDetail.skills.forEach((element,index)=>{this[`skill${index+1}`].skin=`local/common/${element.skillId}.png`;if(element.status){this[`skill${index+1}`].gray=false;this[`skill${index+1}Txt`].visible=false}else{this[`skill${index+1}`].gray=true;this[`skill${index+1}Txt`].visible=true;this[`skill${index+1}Txt`].text=`LV.${element.skillUnlock}解锁`;this[`skill${index+1}Txt`].font=`weaponNFontT`;this[`skill${index+1}Txt`].scale(.4,.4);this[`skill${index+1}Txt`].pos(15,40)}});this.heroname.text=`${this.showDetail.roleName}LV.${this.showDetail.roleLevel}/${this.showDetail.roleTopLevel}`;this.heroname.font=`weaponNFontT`;this.heroname.scale(.8,.8);this.hp.text=`生命 ${this.showDetail.roleHp-this.showDetail.roleUpHp}`;this.additionHp.text=this.showDetail.roleStatus&&this.showDetail.roleUpHp?`+${this.showDetail.roleUpHp}`:"";this.force.text=`内力 ${this.showDetail.roleMp-this.showDetail.roleUpMp}`;this.adddtionForce.text=this.showDetail.roleStatus&&this.showDetail.roleUpMp?`+${this.showDetail.roleUpMp}`:"";this.muscle.text=`臂力 ${this.showDetail.roleStrength-this.showDetail.roleUpStrength}`;this.additionMuscle.text=this.showDetail.roleStatus&&this.showDetail.roleUpStrength?`+${this.showDetail.roleUpStrength}`:"";this.bone.text=`根骨 ${this.showDetail.roleBone-this.showDetail.roleUpBone}`;this.additionBone.text=this.showDetail.roleStatus&&this.showDetail.roleUpBone?`+${this.showDetail.roleUpBone}`:"";this.critical.text=`暴击 ${this.showDetail.roleCritProb}%`;this.hurt.text=`爆伤 ${this.showDetail.roleCritHarm}%`;this.needGoldNum.font=`weaponNFontT`;this.needGoldNum.text=this.isGuide?0:this.showDetail.upgradeCost;this.needGoldNum.scale(.8,.8);this.equipbtn.visible=false;this.already.visible=false;this.lvupbtn.visible=false;this.buyBtn.visible=false;this.signGet.visible=false;if(this.showDetail.roleStatus){this.lvupbtn.visible=true;if(this.showDetail.roleId==this.params.defaultRole){this.already.visible=true;this.equipbtn.visible=false}else{this.already.visible=false;this.equipbtn.visible=true}}else{if(this.showDetail.rolePrice){this.buyBtn.visible=true;this.needDiamon.text=this.showDetail.rolePrice;this.needDiamon.font=`weaponDFont`;this.needDiamon.scale(.8,.8);this.needDiamon.y=10}else{this.signGet.visible=true}}this.lvupbtn.disabled=this.showDetail.roleLevel>=this.showDetail.roleTopLevel?true:false}changeGold(){PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;this.changeHB(res)})}changeHB(res){PaoYa.DataCenter.user.gold=res.gold;PaoYa.DataCenter.user.diamond=res.diamond;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.goldNum.width*.6)/2,25);function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}}onAppear(){PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;this.changeHB(res)})}figureRender(cell,idx){console.log(cell.dataSource);cell.getChildByName(`icon`).skin=`local/common/${cell.dataSource.roleDress}.png`;cell.getChildByName(`bgwarp`).visible=this.showDetail.roleId==cell.dataSource.roleId?true:false;if(this.showDetail.roleId==cell.dataSource.roleId){this.prole=cell;this.initInfo()}cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{if(this.isGuide){return}SoundManager.ins.btn();this.prole.getChildByName(`bgwarp`).visible=false;this.prole=cell;this.showDetail=cell.dataSource;this.initInfo();cell.getChildByName(`bgwarp`).visible=true})}onDisable(){if(this.heroSkin){this.heroSkin.stop();this.heroSkin.destroy();this.heroSkin=null}this.removeChild(this.guideContainer)}guide1f(e){if(this.guideBack){this.guide1.visible=false;return}let n=e==1?-1:1;Laya.Tween.to(this.guide1,{x:this.guide1.x+15*n},300,null,Laya.Handler.create(this,()=>{this.guide1f(n)}))}guide2f(e){let n=e==1?-1:1;Laya.Tween.to(this.guide2,{y:this.guide2.y+15*n},300,null,Laya.Handler.create(this,()=>{this.guide2f(n)}))}graR(x,y,r){this.sp.graphics.clear();this.sp.graphics.drawCircle(x,y,r,"#000000")}}class SignControl extends PaoYa.Component{constructor(){super();SignControl.ins=this}onAwake(){}onEnable(){}onThrottleClick(e){switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`eatTxt`:Global.dataPoints("签到激励广告");Tool.showVideoAD(()=>{this.getAward()});break}}getAward(){PaoYa.Request.POST(`martial_login_bonus_receive`,{adv:0},res=>{PaoYa.DataCenter.user.loginBonusStatus=false;let obj={type:`sign`,detail:res};this.navigator.popup("common/Award",obj)})}onDisable(){if(this.owner.params.isFromSw){this.GET("martial_role_list",{},res=>{Swordsman.ins.params.roleList=res.roleList;Swordsman.ins.herolist.array=Swordsman.ins.params.roleList})}}}class SwordsmanControl extends PaoYa.Component{constructor(){super();SwordsmanControl.ins=this}onAwake(){}onEnable(){}onThrottleClick(e){if(!this.owner){return}let owner=this.owner;switch(e.target.name){case`benBack`:if(owner.isGuide&&!owner.guideBack){return}SoundManager.ins.btn();this.postNotification(`roleIdChanged`,owner.params.defaultRole);this.navigator.pop();break;case`lvupbtn`:this.roleLevelUp();break;case`equipbtn`:SoundManager.ins.btn();this.changeRole();break;case`buyBtn`:SoundManager.ins.btn();this.navigator.popup("figure/BuyHero",owner.showDetail);break;case`signGet`:SoundManager.ins.btn();PaoYa.Request.GET("martial_login_bonus_list",{},res=>{res.isFromSw=true;if(!res){return}this.navigator.push("Sign",res)});break;case`skill1`:if(owner.isGuide){return}SoundManager.ins.btn();this.showSkillDetail(0);break;case`skill2`:if(owner.isGuide){return}SoundManager.ins.btn();this.showSkillDetail(1);break;case`skill3`:if(owner.isGuide){return}SoundManager.ins.btn();this.showSkillDetail(2);break}}roleLevelUp(){let owner=this.owner;let numNew=0;if(owner.isGuide){owner.guideBack=true;owner.isGuide=false;owner.removeChild(owner.guideContainer);Global.dataPoints("用户点击人物升级");numNew=1}else{if(owner.showDetail.roleLevel>=owner.showDetail.roleTopLevel){return}if(Number(owner.needGoldNum.text)>PaoYa.DataCenter.user.gold){this.navigator.popup("weapon/GoldLack");return}else{let obj={gold:PaoYa.DataCenter.user.gold-Number(owner.needGoldNum.text),diamond:PaoYa.DataCenter.user.diamond};owner.changeHB(obj)}}PaoYa.Request.POST(`martial_update_role`,{roleId:owner.showDetail.roleId,newHand:numNew},res=>{SoundManager.ins.upgrade();owner.heroLvup.visible=true;owner.heroLvup.play(0,false);owner.params.roleList.forEach(element=>{if(element.roleId==res.role.roleId){for(const key in element){element[key]=res.role[key]}owner.showDetail=element}});owner.initInfo();if(res.unlock){let detail=null;owner.showDetail.skills.forEach(element=>{if(element.status){detail=element}});this.navigator.popup("figure/GetNewSkill",detail)}})}changeRole(){let owner=this.owner;PaoYa.Request.POST(`martial_change_role`,{roleId:owner.showDetail.roleId},res=>{owner.params.defaultRole=res.roleId;owner.initInfo()})}showSkillDetail(num){let detail=this.owner.showDetail.skills[num];if(!detail){return}if(detail.status){this.navigator.popup("figure/SkillDetail",detail)}else{this.navigator.popup("figure/SkillDetail",detail)}}openGetD(){this.navigator.popup("weapon/DiamondLack")}}class WeaponListControl extends PaoYa.Component{constructor(){super();WeaponListControl.ins=this}onAwake(){this.currentMyUserIdx=0;this.currentMyUserWeapDetail=null}onEnable(){}onThrottleClick(e){if(!this.owner){return}switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`light`:SoundManager.ins.btn();this.owner.getWareBtnSkin(`light`);this.showWareList(this.owner.params.lightList);break;case`middle`:SoundManager.ins.btn();this.owner.getWareBtnSkin(`middle`);this.showWareList(this.owner.params.middleList);break;case`large`:SoundManager.ins.btn();this.owner.getWareBtnSkin(`large`);this.showWareList(this.owner.params.heavyList);break}}showWareList(list){let showList=JSON.parse(JSON.stringify(list));let arr=[];showList.forEach(element=>{if(element.weaponStar<4){arr.push(element)}});this.owner.warehouseList.array=arr}wareWeaponUpdateItem(cell,idx){cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();if(this.isWareChoiceWp){this.isWareChoiceWp.getChildByName(`beChioce`).visible=false;this.isWareChoiceWp.skin=`local/common/frameBg.png`;this.isWareChoiceWp=cell}cell.getChildByName(`beChioce`).visible=true;cell.skin=`local/common/currutFrameBg.png`;this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData()});this.singleWeapon(cell,idx)}singleWeapon(cell,idx){cell.skin=`local/common/frameBg.png`;cell.getChildByName(`beChioce`).visible=false;if(idx==this.currentMyUserIdx){this.currentMyUserWeapDetail=cell._dataSource;this.isWareChoiceWp=cell;cell.skin=`local/common/currutFrameBg.png`;cell.getChildByName(`beChioce`).visible=true;this.renderCenterData()}cell.getChildByName(`wp`).skin=`remote/small_weapons/s_${cell._dataSource.weaponId}.png`;let skinq=``;let skint=``;switch(cell._dataSource.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(cell._dataSource.weaponType){case 3:skint=`local/common/type_1.png`;break;case 2:skint=`local/common/type_2.png`;break;case 1:skint=`local/common/type_3.png`;break}cell.getChildByName(`bgwrap`).skin=skinq;cell.getChildByName(`mark`).skin=skint}renderCenterData(){this.owner[`skillImg_1`].visible=false;this.owner[`skillImg_2`].visible=false;let detail=this.currentMyUserWeapDetail;this.owner.showWeapon.skin=`remote/small_weapons/s_${detail.weaponId}.png`;let arr=[`light`,`middle`,`large`];arr.forEach(element=>{this.owner[element].skin=`remote/weaponhouse/14.png`});let skinq=``;let skint=``;switch(detail.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(detail.weaponType){case 3:skint=`local/common/type_1.png`;this.owner.large.skin=`remote/weaponhouse/13.png`;break;case 2:skint=`local/common/type_2.png`;this.owner.middle.skin=`remote/weaponhouse/13.png`;break;case 1:skint=`local/common/type_3.png`;this.owner.light.skin=`remote/weaponhouse/13.png`;break}this.owner.showWrap.skin=skinq;this.owner.showMark.skin=skint;this.owner.wpinfo.text=detail.weaponIcon;this.owner.currutWeapon.text=detail.weaponName;this.owner.currutWeapon.font=`weaponDFont`;this.owner.currutWeapon.scale(.8,.8);this.owner.CDTime.text=`LV.${detail.weaponLevel}/${detail.weaponTopLevel}`;this.owner.CDTime.font=`weaponNFontT`;this.owner.CDTime.scale(.7,.7);this.owner.attackNum.text=`攻击： ${detail.weaponAttack}`;this.owner.addattackNum.visible=detail.weaponUpAttack?true:false;this.owner.addattackNum.text=`+${detail.weaponUpAttack}`;this.owner.enduranceNum.text=`耐久： ${detail.weaponDurable}`;this.owner.addenduranceNum.visible=detail.weaponUpDurable?true:false;this.owner.addenduranceNum.text=`+${detail.weaponUpDurable}`;this.owner.consumeNum.text=`消耗： ${detail.weaponConsume}`;this.owner.addconsumeNum.visible=detail.weaponDownConsume?true:false;this.owner.addconsumeNum.text=`-${detail.weaponDownConsume}`;this.owner.wpcdNum.text=`冷却： ${detail.weaponCd}秒`;this.owner[`skillName_1`].text=``;this.owner[`skillGl_1`].text=``;this.owner[`skillDetail_1`].text=``;this.owner[`skillImg_1`].visible=false;this.owner[`skillName_2`].text=``;this.owner[`skillGl_2`].text=``;this.owner[`skillDetail_2`].text=``;this.owner[`skillImg_2`].visible=false;if(detail.skills.length>0){detail.skills.forEach((element,index)=>{this.owner[`skillName_${index+1}`].color=`#4a4948`;this.owner[`skillGl_${index+1}`].color=`#4a4948`;this.owner[`skillDetail_${index+1}`].color=`#4a4948`;this.owner[`skillName_${index+1}`].text=element.skillName;this.owner[`skillGl_${index+1}`].text=`几率${element.skillProb}%`;this.owner[`skillDetail_${index+1}`].text=element.skillDesc;this.owner[`skillImg_${index+1}`].visible=true;if(element.status){this.owner[`skillName_${index+1}`].color=`#004418`;this.owner[`skillGl_${index+1}`].color=`#004418`;this.owner[`skillDetail_${index+1}`].color=`#004418`}})}}}class WeaponList extends PaoYa.View{constructor(){super()}onAwake(){}onEnable(){PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;PaoYa.DataCenter.user.gold=res.gold;PaoYa.DataCenter.user.diamond=res.diamond;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.diamondNum.width*.6)/2,25);function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}});this.warehouseList.vScrollBarSkin="";this.warehouseList.renderHandler=new Laya.Handler(this,this.wareWeaponUpdateItem);this.getWareBtnSkin(`light`);WeaponListControl.ins.showWareList(this.params.lightList)}getWareBtnSkin(name){let arr=[`light`,`middle`,`large`];arr.forEach(element=>{this[element].skin=`remote/weaponhouse/14.png`});this[name].skin=`remote/weaponhouse/13.png`}wareWeaponUpdateItem(cell,index){WeaponListControl.ins.wareWeaponUpdateItem(cell,index)}}class WeaponHouseControl extends PaoYa.Component{constructor(){super();WeaponHouseControl.ins=this}onAwake(){let onwer=this.owner;this.isGuide=onwer.params.isGuide;onwer.params=onwer.params.detail;this.params=onwer.params;this.lightList=this.params.lightList;this.heavyList=this.params.heavyList;this.middleList=this.params.middleList;this.allList=this.lightList.concat(this.heavyList,this.middleList);this.addWpList=[];this.params.newWeapon&&this.chioceNewWp();this.myUserList=[];this.isUsingWeapon={};this.currentMyUserIdx=0;this.currentMyUserWeapDetail=``;let arr=this.params.userWeapons.split(`,`);arr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.myUserList.push(obj)});this.getMyUserDetailList();onwer.userWeaponList.renderHandler=new Laya.Handler(this,this.userWeaponUpdateItem);onwer.userWeaponList.array=this.myUserDetailList;onwer.warehouseList.vScrollBarSkin="";this.isWareChoiceWp=null;onwer.warehouseList.renderHandler=new Laya.Handler(this,this.wareWeaponUpdateItem)}onEnable(){}onThrottleClick(e){if(!this.owner){return}let owner=this.owner;switch(e.target.name){case`light`:SoundManager.ins.btn();owner.getWareBtnSkin(`light`);owner.lightNew.visible=false;this.showWareList(this.lightList);break;case`middle`:SoundManager.ins.btn();owner.getWareBtnSkin(`middle`);owner.middleNew.visible=false;this.showWareList(this.middleList);break;case`large`:SoundManager.ins.btn();owner.getWareBtnSkin(`large`);owner.largeNew.visible=false;this.showWareList(this.heavyList);break;case`benBack`:if(this.isGuide){return}SoundManager.ins.btn();this.navigator.pop();break;case`equip`:if(this.isGuide){return}SoundManager.ins.btn();this.chargeWeapon();break;case`upGrade`:if(this.isGuide){return}this.upgradeWeapon();break}}getMyUserDetailList(){switch(this.params.weaponGridNum){case 3:this.myUserDetailList=[{type:3},{type:3},{type:3},{type:4},{type:5}];break;case 4:if(this.params.shareGrid>0){this.myUserDetailList=[{type:3},{type:3},{type:3},{type:3},{type:4}]}else{this.myUserDetailList=[{type:3},{type:3},{type:3},{type:3},{type:5}]}break;case 5:this.myUserDetailList=[{type:3},{type:3},{type:3},{type:3},{type:3}];break}let al=this.allList.length;let ml=this.myUserList.length;let num=0;getNowWare:for(let j=0;j<ml;j++){if(!this.myUserList[j]){return}for(let i=0;i<al;i++){if(this.allList[i].weaponId==this.myUserList[j].name&&this.allList[i].weaponLevel==this.myUserList[j].lv&&this.allList[i].num>0){this.myUserDetailList[num]=this.allList[i];num++;continue getNowWare}}}}chioceNewWp(){let owner=this.owner;this.newWpList=[];owner.lightNew.visible=this.params.newWeapon.indexOf(`d`)!=-1?true:false;owner.middleNew.visible=this.params.newWeapon.indexOf(`z`)!=-1?true:false;owner.largeNew.visible=this.params.newWeapon.indexOf(`g`)!=-1?true:false;if(this.params.newWeapon){let newaparr=this.params.newWeapon.split(`,`);newaparr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.newWpList.push(obj)})}}userWeaponSelect(cell,idx){console.log(cell,idx)}userWeaponUpdateItem(cell,idx){cell.offAll();let owner=this.owner;if(!cell._dataSource.weaponId){cell.getChildByName(`bgwrap`).visible=false;cell.getChildByName(`mark`).visible=false;cell.getChildByName(`wp`).visible=false;cell.getChildByName(`lv`).visible=false;cell.getChildByName(`add`).visible=false;cell.getChildByName(`invite`).visible=false;switch(cell._dataSource.type){case 3:cell.getChildByName(`add`).visible=true;this.addWpList.push(cell);cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();for(let i=0;i<5;i++){owner[`wpBg_${i+1}`].skin=`remote/weaponhouse/25.png`}this.currentMyUserIdx=idx;cell.getChildByName(`beChioce`).visible=true;owner[`wpBg_${this.currentMyUserIdx+1}`].skin=`remote/weaponhouse/26.png`;this.getMyUserDetailList();this.addWpList=[];owner.userWeaponList.array=this.myUserDetailList});break;case 4:cell.getChildByName(`invite`).visible=true;cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.navigator.popup("weapon/UnlockFour")});break;case 5:cell.getChildByName(`invite`).visible=true;cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.navigator.popup("weapon/UnlockFifth")});break}return}cell.getChildByName(`bgwrap`).visible=true;cell.getChildByName(`mark`).visible=true;cell.getChildByName(`wp`).visible=true;cell.getChildByName(`lv`).visible=true;cell.getChildByName(`add`).visible=false;cell.getChildByName(`invite`).visible=false;cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.addWpList.forEach(element=>{element.getChildByName(`beChioce`).visible=false});for(let i=0;i<5;i++){owner[`wpBg_${i+1}`].skin=`remote/weaponhouse/25.png`}this.currentMyUserIdx=idx;owner[`wpBg_${this.currentMyUserIdx+1}`].skin=`remote/weaponhouse/26.png`;this.getMyUserDetailList();this.addWpList=[];owner.userWeaponList.array=this.myUserDetailList});this.singleWeapon(cell,idx,1)}wareWeaponSelect(cell,idx){console.log(cell,idx)}wareWeaponUpdateItem(cell,idx){cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();if(this.isWareChoiceWp){this.isWareChoiceWp.getChildByName(`beChioce`).visible=false;this.isWareChoiceWp.skin=`local/common/frameBg.png`;this.isWareChoiceWp._dataSource.isShowing=false;this.isWareChoiceWp=cell;this.isWareChoiceWp._dataSource.isShowing=true}else{this.isWareChoiceWp=cell}cell.getChildByName(`beChioce`).visible=true;cell.skin=`local/common/currutFrameBg.png`;this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData();if(cell._dataSource.isNew){cell._dataSource.isNew=false;cell.getChildByName(`new`).visible=false;this.newWpList[cell._dataSource.idIdx].isOdd=true}});this.singleWeapon(cell,idx)}renderCenterData(isUser){let owner=this.owner;owner[`skillImg_1`].visible=false;owner[`skillImg_2`].visible=false;let detail=null;if(this.isEqWp&&this.isWareChoiceWp){detail=this.isWareChoiceWp._dataSource;this.isEqWp=false}else{detail=this.currentMyUserWeapDetail}owner.showWeapon.skin=`remote/small_weapons/s_${detail.weaponId}.png`;let arr=[`light`,`middle`,`large`];arr.forEach(element=>{owner[element].skin=`remote/weaponhouse/14.png`});let skinq=``;let skint=``;let wareList=[];switch(detail.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(detail.weaponType){case 3:skint=`local/common/type_1.png`;wareList=JSON.parse(JSON.stringify(this.heavyList));owner.large.skin=`remote/weaponhouse/13.png`;break;case 2:skint=`local/common/type_2.png`;wareList=JSON.parse(JSON.stringify(this.middleList));owner.middle.skin=`remote/weaponhouse/13.png`;break;case 1:skint=`local/common/type_3.png`;wareList=JSON.parse(JSON.stringify(this.lightList));owner.light.skin=`remote/weaponhouse/13.png`;break}owner.showWrap.skin=skinq;owner.showMark.skin=skint;owner.currutWeapon.text=detail.weaponName;owner.currutWeapon.font=`weaponDFont`;owner.currutWeapon.scale(.8,.8);owner.CDTime.text=`LV.${detail.weaponLevel}/${detail.weaponTopLevel}`;owner.CDTime.font=`weaponNFontT`;owner.CDTime.scale(.7,.7);owner.attackNum.text=`攻击： ${detail.weaponAttack}`;owner.addattackNum.visible=detail.weaponUpAttack?true:false;owner.addattackNum.text=`+${detail.weaponUpAttack}`;owner.enduranceNum.text=`耐久： ${detail.weaponDurable}`;owner.addenduranceNum.visible=detail.weaponUpDurable?true:false;owner.addenduranceNum.text=`+${detail.weaponUpDurable}`;owner.consumeNum.text=`消耗： ${detail.weaponConsume}`;owner.addconsumeNum.visible=detail.weaponDownConsume?true:false;owner.addconsumeNum.text=`-${detail.weaponDownConsume}`;owner.wpcdNum.text=`冷却： ${detail.weaponCd}秒`;owner[`skillName_1`].text=``;owner[`skillGl_1`].text=``;owner[`skillDetail_1`].text=``;owner[`skillImg_1`].visible=false;owner[`skillName_2`].text=``;owner[`skillGl_2`].text=``;owner[`skillDetail_2`].text=``;owner[`skillImg_2`].visible=false;if(detail.skills.length>0){detail.skills.forEach((element,index)=>{owner[`skillName_${index+1}`].color=`#4a4948`;owner[`skillGl_${index+1}`].color=`#4a4948`;owner[`skillDetail_${index+1}`].color=`#4a4948`;owner[`skillName_${index+1}`].text=element.skillName;owner[`skillGl_${index+1}`].text=`几率${element.skillProb}%`;owner[`skillDetail_${index+1}`].text=element.skillDesc;owner[`skillImg_${index+1}`].visible=true;if(element.status){owner[`skillName_${index+1}`].color=`#004418`;owner[`skillGl_${index+1}`].color=`#004418`;owner[`skillDetail_${index+1}`].color=`#004418`}})}owner.needGoldNum.text=detail.upgradeCost;owner.needGoldNum.font=`weaponNFontT`;owner.needGoldNum.scale(.7,.7);owner.upGrade.disabled=detail.weaponLevel>=detail.weaponTopLevel?true:false;owner.equip.skin=detail.isUsingWp?`remote/weaponhouse/20.png`:`remote/weaponhouse/10.png`;if(isUser){this.showWareList(wareList)}}showWareList(list){let detail=this.currentMyUserWeapDetail;let showList=JSON.parse(JSON.stringify(list));let arr=[];let unShowWeap=JSON.parse(JSON.stringify(this.myUserList));unShowWeap.splice(this.currentMyUserIdx,1);let isChoice=false;showList.forEach((element,index)=>{for(let i=0;i<unShowWeap.length;i++){if(element.weaponId==unShowWeap[i].name&&element.weaponLevel==unShowWeap[i].lv){element.num-=1;element.isUsing=true}}for(let i=0;i<element.num;i++){let obj=JSON.parse(JSON.stringify(element));obj.originalIndex=index;obj.isUsingWp=false;if(this.myUserList[this.currentMyUserIdx]&&obj.weaponId==this.myUserList[this.currentMyUserIdx].name&&obj.weaponLevel==this.myUserList[this.currentMyUserIdx].lv&&!isChoice){obj.isUsingWp=true;obj.isShowing=true;isChoice=true}obj.WpGrade=obj.weaponStar*100+obj.weaponLevel;arr.push(obj)}});if(this.newWpList){let al=arr.length;let ml=this.newWpList.length;getNewList:for(let j=0;j<ml;j++){for(let i=0;i<al;i++){if(arr[i].weaponId==this.newWpList[j].name&&arr[i].weaponLevel==this.newWpList[j].lv&&!arr[i].isUsingWp&&!this.newWpList[j].isOdd){arr[i].isNew=true;arr[i].idIdx=j;continue getNewList}}}}arr.sort(function(a,b){return b.WpGrade-a.WpGrade});this.isWareChoiceWp=null;this.owner.warehouseList.array=arr}singleWeapon(cell,idx,isUser){cell.skin=`local/common/frameBg.png`;cell.getChildByName(`beChioce`).visible=false;if(!isUser){cell.getChildByName(`using`).visible=false;cell.getChildByName(`new`).visible=false;if(cell._dataSource.isNew){cell.getChildByName(`new`).visible=true}}else{if(idx==this.currentMyUserIdx){cell.getChildByName(`beChioce`).visible=true;cell.skin=`local/common/currutFrameBg.png`}}if(this.myUserList[this.currentMyUserIdx]&&this.myUserList[this.currentMyUserIdx].name==cell._dataSource.weaponId&&this.myUserList[this.currentMyUserIdx].lv==cell._dataSource.weaponLevel){if(isUser){this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData(isUser)}else if(cell._dataSource.isUsingWp){cell.getChildByName(`using`).visible=true;if(cell._dataSource.isUsingWp){this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData(isUser)}}}if(!this.isGuide){if(cell._dataSource.isShowing&&(!this.isWareChoiceWp||idx==-1)){cell.getChildByName(`beChioce`).visible=true;this.isWareChoiceWp=cell;cell.skin=`local/common/currutFrameBg.png`;if(cell._dataSource.isUsingWp){this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData(isUser)}}}else{if(cell._dataSource.willBeUse){cell.getChildByName(`beChioce`).visible=true;this.isWareChoiceWp=cell;cell.skin=`local/common/currutFrameBg.png`;this.currentMyUserWeapDetail=cell._dataSource;this.renderCenterData(isUser)}}cell.getChildByName(`wp`).skin=`remote/small_weapons/s_${cell._dataSource.weaponId}.png`;cell.getChildByName(`lv`).text=`LV.${cell._dataSource.weaponLevel}`;cell.getChildByName(`lv`).font=`weaponNFontT`;cell.getChildByName(`lv`).scale(.7,.7);let skinq=``;let skint=``;switch(cell._dataSource.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(cell._dataSource.weaponType){case 3:skint=`local/common/type_1.png`;break;case 2:skint=`local/common/type_2.png`;break;case 1:skint=`local/common/type_3.png`;break}cell.getChildByName(`bgwrap`).skin=skinq;cell.getChildByName(`mark`).skin=skint}chargeWeapon(){if(this.isRequesting){return}let detail=this.currentMyUserWeapDetail;let oldDetail=this.myUserDetailList[this.currentMyUserIdx];if(detail.isUsingWp){return}let wpType=0;if(!this.myUserList[this.currentMyUserIdx]){wpType=1}this.isRequesting=true;Laya.timer.once(500,this,()=>{this.isRequesting=false});PaoYa.Request.POST(`martial_change_weapon`,{oldWeaponId:`${oldDetail.weaponId}-${oldDetail.weaponLevel}`,newWeaponId:`${detail.weaponId}-${detail.weaponLevel}`,type:wpType,index:this.currentMyUserIdx},res=>{this.myUserList=[];this.isEqWp=true;let arr=res.userWeapons.split(`,`);arr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.myUserList.push(obj)});this.getMyUserDetailList();this.addWpList=[];this.owner.userWeaponList.array=this.myUserDetailList})}upgradeWeapon(){let owner=this.owner;let numNew=0;if(!this.isGuide){if(this.isRequesting){return}if(Number(owner.needGoldNum.text)>Number(PaoYa.DataCenter.user.gold)){this.navigator.popup("weapon/GoldLack");return}}else{numNew=1}let detail=this.isWareChoiceWp&&this.isWareChoiceWp._dataSource?this.isWareChoiceWp._dataSource:this.currentMyUserWeapDetail;let isusing=detail.isUsingWp?1:0;this.isRequesting=true;Laya.timer.once(500,this,()=>{this.isRequesting=false});PaoYa.Request.POST(`martial_update_weapon`,{weaponId:`${detail.weaponId}-${detail.weaponLevel}`,newHand:numNew,default:isusing,index:this.currentMyUserIdx,time:(new Date).getTime()},res=>{SoundManager.ins.upgrade();let obj={gold:PaoYa.DataCenter.user.gold-Number(owner.needGoldNum.text),diamond:PaoYa.DataCenter.user.diamond};owner.changeHB(obj);let newDetail=null;owner.upeffects.visible=true;owner.upeffects.play(0,false);switch(detail.weaponType){case 3:newDetail=`heavyList`;break;case 2:newDetail=`middleList`;break;case 1:newDetail=`lightList`;break}let al=this[newDetail].length;res.weapon.num=1;let oldNum=1;for(let i=0;i<al;i++){let element=this[newDetail][i];if(element.weaponId==detail.weaponId&&element.weaponLevel==detail.weaponLevel&&element.num>0&&oldNum){element.num-=1;oldNum=0}}this[newDetail].push(res.weapon);this.allList=[];this.allList=this.lightList.concat(this.heavyList,this.middleList);if(res.userWeapons){this.myUserList=[];let arr=res.userWeapons.split(`,`);arr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.myUserList.push(obj)});this.getMyUserDetailList();this.addWpList=[];owner.userWeaponList.array=this.myUserDetailList}else{for(const key in res.weapon){if(this.isWareChoiceWp&&this.isWareChoiceWp._dataSource){this.isWareChoiceWp._dataSource[key]=res.weapon[key]}}if(this.isWareChoiceWp){this.singleWeapon(this.isWareChoiceWp,-1)}this.renderCenterData()}})}}class WeaponHouse extends PaoYa.View{constructor(){super()}onAwake(){}onAppear(){PaoYa.Request.GET("update_chips",{},res=>{this.changeHB(res)})}changeHB(res){this.goldNum.width=null;if(res.gold||res.gold==0){PaoYa.DataCenter.user.gold=res.gold;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25)}if(res.diamond||res.diamond==0){PaoYa.DataCenter.user.diamond=res.diamond;let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.diamondNum.width*.6)/2,25)}function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}}onEnable(){if(WeaponHouseControl.ins.isGuide){this.startGuide();PaoYa.Request.POST(`martial_change_new_hand`,{type:`weaponNew`})}this.Wp_1.font=`weaponDFont`;this.Wp_2.font=`weaponDFont`;this.Wp_3.font=`weaponDFont`;this.Wp_4.font=`weaponDFont`;this.Wp_5.font=`weaponDFont`}lisenClick(e){}getWareBtnSkin(name){let arr=[`light`,`middle`,`large`];arr.forEach(element=>{this[element].skin=`remote/weaponhouse/14.png`});this[name].skin=`remote/weaponhouse/13.png`}startGuide(){Global.dataPoints("进入兵器引导");const Sprite=Laya.Sprite;let gameContainer=new Sprite;gameContainer.size(1634,750);gameContainer.pos(-150,0);gameContainer.mouseEnabled=true;this.addChild(gameContainer);let guideContainer=new Sprite;this.addChild(guideContainer);guideContainer.cacheAs="bitmap";guideContainer.zOrder=10;let maskArea=new Sprite;guideContainer.addChild(maskArea);maskArea.alpha=.5;maskArea.graphics.drawRect(0,0,1634,750,"#000");maskArea.zOrder=10;let interactionArea=new Sprite;guideContainer.addChild(interactionArea);interactionArea.blendMode="destination-out";let hitArea=new Laya.HitArea;hitArea.hit.drawRect(-150+Global.AdaptiveWidth,0,1634,750,"#000");guideContainer.hitArea=hitArea;guideContainer.mouseEnabled=true;this.equip.visible=true;this.equip.zOrder=20;this.equipTips.x=this.equipTips.x;this.equipTips.visible=true;this.equipTips.zOrder=20;this.equip.on(Laya.Event.CLICK,this,()=>{this.equip.zOrder=0;this.equipTips.visible=false;SoundManager.ins.btn();WeaponHouseControl.ins.chargeWeapon();Global.dataPoints("点击装备");this.upGrade.visible=true;this.upGrade.zOrder=20;this.upGradeTips.x=this.upGradeTips.x;this.upGradeTips.visible=true;this.upGradeTips.zOrder=20;this.upGrade.on(Laya.Event.CLICK,this,()=>{this.upGrade.zOrder=0;this.upGradeTips.visible=false;WeaponHouseControl.ins.upgradeWeapon();Global.dataPoints("点击升级");this.benBack.visible=true;this.benBack.zOrder=20;this.benBackTips.x=this.benBackTips.x;this.benBackTips.visible=true;this.benBackTips.zOrder=20;this.benBack.on(Laya.Event.CLICK,this,()=>{Global.dataPoints("点击返回");Laya.stage.removeChild(guideContainer);Laya.stage.removeChild(gameContainer);this.benBack.zOrder=0;this.benBackTips.visible=false;WeaponHouseControl.ins.isGuide=false;SoundManager.ins.btn();WeaponHouseControl.ins.navigator.pop()})})})}onDisable(){}}class WeaponStoreControl extends PaoYa.Component{constructor(){super();WeaponStoreControl.ins=this}onAwake(){let owner=this.owner;this.params=owner.params;this.sellList=this.params.sellList;this.buyList=this.params.buyList.weaponList;this.sellList.newWeapon&&this.chioceNewWp();this.wpdType=`buy`;this.myUserList=[];this.isUsingWeapon={};this.currentMyUserIdx=0;this.currentMyUserWeapDetail=``;let arr=this.sellList.userWeapons.split(`,`);arr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.myUserList.push(obj)});owner.buyList.vScrollBarSkin="";owner.warehouseList.vScrollBarSkin="";owner.buyList.renderHandler=new Laya.Handler(this,this.buyWpUpdateItem);owner.warehouseList.renderHandler=new Laya.Handler(this,this.sellWpUpdateItem);this.getWareHouseList();this.buyPresentIdx=0;this.sellPresentIdx=0;if(this.buyList.length>0){owner.weapon.visible=true;owner.buyBtn.visible=true;owner.sellBtn.visible=true}else{owner.weapon.visible=false;owner.buyBtn.visible=false;owner.sellBtn.visible=false}owner.buyList.array=this.buyList;this.downTimeStartF(this.params.buyList.refreshTime)}onEnable(){}onThrottleClick(e){if(!this.owner){return}let owner=this.owner;switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`sellBtn`:SoundManager.ins.btn();this.sellWp();break;case`refreshBtn`:SoundManager.ins.btn();if(WeaponStore.ins.isRefrshing);let isHigh=false,highDeatil;this.buyList.forEach(element=>{if(element.weaponStar==3){isHigh=true;highDeatil=element}});if(isHigh){let obj={detail:highDeatil,type:`buy`};this.navigator.popup("weapon/StoreSure",obj)}else{this.refresF()}break;case`sell`:SoundManager.ins.btn();this.wpdType=`sell`;owner.sell.skin=`remote/weaponstore/3.png`;owner.buy.skin=`remote/weaponstore/2.png`;owner.sellPage.visible=true;owner.buyPage.visible=false;owner.getWareBtnSkin(`light`);owner.lightNew.visible=false;this.sellPresentIdx=0;this.showWareList(this.lightList);break;case`buy`:SoundManager.ins.btn();this.wpdType=`buy`;owner.sell.skin=`remote/weaponstore/2.png`;owner.buy.skin=`remote/weaponstore/3.png`;owner.sellPage.visible=false;owner.buyPage.visible=true;this.buyPresentIdx=0;if(this.buyList.length>0){owner.weapon.visible=true;owner.sellBtn.visible=true;owner.buyBtn.visible=true}else{owner.weapon.visible=false;owner.buyBtn.visible=false;owner.sellBtn.visible=false}owner.buyList.array=this.buyList;break;case`light`:SoundManager.ins.btn();owner.getWareBtnSkin(`light`);owner.lightNew.visible=false;this.showWareList(this.lightList);break;case`middle`:SoundManager.ins.btn();owner.getWareBtnSkin(`middle`);owner.middleNew.visible=false;this.showWareList(this.middleList);break;case`large`:SoundManager.ins.btn();owner.getWareBtnSkin(`large`);owner.largeNew.visible=false;this.showWareList(this.heavyList);break;case`buyBtn`:SoundManager.ins.btn();let detail=this.currentBuyWeapDetail;if(!detail){return}if(Number(detail.weaponPrice)>PaoYa.DataCenter.user.gold){this.navigator.popup("weapon/GoldLack");return}else{this.buyWp()}break}}onDisable(){}getWareHouseList(){this.lightList=this.sellList.lightList;this.heavyList=this.sellList.heavyList;this.middleList=this.sellList.middleList;this.allList=this.lightList.concat(this.heavyList,this.middleList)}buyWpUpdateItem(cell,idx){this.singleWeapon(cell,idx);cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.buyPresentIdx=idx;this.isBuyChoiceWp.skin=`local/common/frameBg.png`;this.isBuyChoiceWp.getChildByName(`beChioce`).visible=false;cell.skin=`local/common/currutFrameBg.png`;cell.getChildByName(`beChioce`).visible=true;this.currentBuyWeapDetail=cell._dataSource;this.isBuyChoiceWp=cell;this.renderCenterData(this.currentBuyWeapDetail)})}sellWpUpdateItem(cell,idx){this.singleWeapon(cell,idx,1);cell.offAll();cell.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.isSellWareChoiceWp.skin=`local/common/frameBg.png`;this.isSellWareChoiceWp.getChildByName(`beChioce`).visible=false;cell.skin=`local/common/currutFrameBg.png`;cell.getChildByName(`beChioce`).visible=true;this.currentSellWeapDetail=cell._dataSource;this.isSellWareChoiceWp=cell;this.renderCenterData(this.currentSellWeapDetail)})}singleWeapon(cell,idx,isSell){cell.skin=`local/common/frameBg.png`;cell.getChildByName(`beChioce`).visible=false;if(!isSell){if(idx==this.buyPresentIdx){cell.skin=`local/common/currutFrameBg.png`;cell.getChildByName(`beChioce`).visible=true;this.currentBuyWeapDetail=cell._dataSource;this.isBuyChoiceWp=cell;if(this.wpdType==`buy`){this.renderCenterData(this.currentBuyWeapDetail)}}cell.getChildByName(`bg`).getChildByName(`txt`).text=`${cell._dataSource.weaponPrice}`;cell.getChildByName(`bg`).getChildByName(`txt`).font=`weaponNFontT`;cell.getChildByName(`bg`).getChildByName(`txt`).scale(.75,.75)}else{if(idx==this.sellPresentIdx){cell.skin=`local/common/currutFrameBg.png`;cell.getChildByName(`beChioce`).visible=true;this.currentSellWeapDetail=cell._dataSource;this.isSellWareChoiceWp=cell;if(this.wpdType==`sell`){this.renderCenterData(this.currentSellWeapDetail)}}}cell.getChildByName(`wp`).skin=`remote/small_weapons/s_${cell._dataSource.weaponId}.png`;cell.getChildByName(`lv`).text=`LV.${cell._dataSource.weaponLevel}`;cell.getChildByName(`lv`).font=`weaponNFontT`;cell.getChildByName(`lv`).scale(.7,.7);let skinq=``;let skint=``;switch(cell._dataSource.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(cell._dataSource.weaponType){case 3:skint=`local/common/type_1.png`;break;case 2:skint=`local/common/type_2.png`;break;case 1:skint=`local/common/type_3.png`;break}cell.getChildByName(`bgwrap`).skin=skinq;cell.getChildByName(`mark`).skin=skint}renderCenterData(data){let owner=this.owner;owner[`skillImg_1`].visible=false;owner[`skillImg_2`].visible=false;let detail=data;owner.showWeapon.skin=`remote/small_weapons/s_${detail.weaponId}.png`;let arr=[`light`,`middle`,`large`];arr.forEach(element=>{owner[element].skin=`remote/weaponhouse/14.png`});let skinq=``;let skint=``;switch(detail.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(detail.weaponType){case 3:skint=`local/common/type_1.png`;owner.large.skin=`remote/weaponhouse/13.png`;break;case 2:skint=`local/common/type_2.png`;owner.middle.skin=`remote/weaponhouse/13.png`;break;case 1:skint=`local/common/type_3.png`;owner.light.skin=`remote/weaponhouse/13.png`;break}if(detail.weaponSalePrice){owner.needGoldNum.text=detail.weaponSalePrice;owner.needGoldNum.font=`weaponNFontT`;owner.needGoldNum.scale(.8,.8)}owner.showWrap.skin=skinq;owner.showMark.skin=skint;owner.currutWeapon.text=detail.weaponName;owner.currutWeapon.font=`weaponDFont`;owner.currutWeapon.scale(.8,.8);owner.CDTime.text=`LV.${detail.weaponLevel}/${detail.weaponTopLevel}`;owner.CDTime.font=`weaponNFontT`;owner.CDTime.scale(.7,.7);owner.attackNum.text=`攻击： ${detail.weaponAttack}`;owner.addattackNum.visible=detail.weaponUpAttack?true:false;owner.addattackNum.text=`+${detail.weaponUpAttack}`;owner.enduranceNum.text=`耐久： ${detail.weaponDurable}`;owner.addenduranceNum.visible=detail.weaponUpDurable?true:false;owner.addenduranceNum.text=`+${detail.weaponUpDurable}`;owner.consumeNum.text=`消耗： ${detail.weaponConsume}`;owner.addconsumeNum.visible=detail.weaponDownConsume?true:false;owner.addconsumeNum.text=`-${detail.weaponDownConsume}`;owner.wpcdNum.text=`冷却： ${detail.weaponCd}秒`;owner[`skillName_1`].text=``;owner[`skillGl_1`].text=``;owner[`skillDetail_1`].text=``;owner[`skillImg_1`].visible=false;owner[`skillName_2`].text=``;owner[`skillGl_2`].text=``;owner[`skillDetail_2`].text=``;owner[`skillImg_2`].visible=false;if(detail.skills.length>0){detail.skills.forEach((element,index)=>{owner[`skillName_${index+1}`].color=`#4a4948`;owner[`skillGl_${index+1}`].color=`#4a4948`;owner[`skillDetail_${index+1}`].color=`#4a4948`;owner[`skillName_${index+1}`].text=element.skillName;owner[`skillGl_${index+1}`].text=`几率${element.skillProb}%`;owner[`skillDetail_${index+1}`].text=element.skillDesc;owner[`skillImg_${index+1}`].visible=true;if(element.status){owner[`skillName_${index+1}`].color=`#004418`;owner[`skillGl_${index+1}`].color=`#004418`;owner[`skillDetail_${index+1}`].color=`#004418`}})}}downTimeStartF(timeNum){let nowtime=(new Date).getTime();let Stime=timeNum-nowtime/1e3|0;this.getPowerTimeDown(Stime)}getPowerTimeDown(Stime){let owner=this.owner;if(this.isRefrshing){owner.refreshTimeNum.visible=false;return}let Ntime=Stime%3600|0;let h=Stime/3600|0;let m=Ntime/60|0;let s=Ntime%60|0;let hhh=h>9?h:`0${h}`;let mmm=m>9?m:`0${m}`;let sss=s>9?s:`0${s}`;owner.refreshTimeNum.text=`${hhh}:${mmm}:${sss}`;let NewT=Stime-1;if(NewT<1){this.isReadyRefrensh=true;return}Laya.timer.once(1e3,this,()=>{this.getPowerTimeDown(NewT)})}chioceNewWp(){let owner=this.owner;this.newWpList=[];owner.lightNew.visible=this.params.newWeapon.indexOf(`d`)!=-1?true:false;owner.middleNew.visible=this.params.newWeapon.indexOf(`z`)!=-1?true:false;owner.largeNew.visible=this.params.newWeapon.indexOf(`g`)!=-1?true:false;if(this.params.newWeapon){let newaparr=this.params.newWeapon.split(`,`);newaparr.forEach(element=>{let obj={name:element.split(`-`)[0],lv:element.split(`-`)[1]};this.newWpList.push(obj)})}}showWareList(list){let owner=this.owner;let showList=JSON.parse(JSON.stringify(list));let arr=[];let unShowWeap=JSON.parse(JSON.stringify(this.myUserList));showList.forEach((element,index)=>{for(let i=0;i<unShowWeap.length;i++){if(element.weaponId==unShowWeap[i].name&&element.weaponLevel==unShowWeap[i].lv){element.num-=1;element.isUsing=true}}let isChoice=false;for(let i=0;i<element.num;i++){let obj=JSON.parse(JSON.stringify(element));obj.originalIndex=index;obj.isUsingWp=false;if(obj.weaponId==this.myUserList[this.currentMyUserIdx].name&&obj.weaponLevel==this.myUserList[this.currentMyUserIdx].lv&&!isChoice){obj.isUsingWp=true;obj.isShowing=true;isChoice=true}obj.WpGrade=obj.weaponStar*100+obj.weaponLevel;arr.push(obj)}});if(this.newWpList){let al=arr.length;let ml=this.newWpList.length;getNewList:for(let j=0;j<ml;j++){for(let i=0;i<al;i++){if(arr[i].weaponId==this.newWpList[j].name&&arr[i].weaponLevel==this.newWpList[j].lv&&!arr[i].isUsingWp&&!this.newWpList[j].isOdd){arr[i].isNew=true;arr[i].idIdx=j;continue getNewList}}}}arr.sort(function(b,a){return b.WpGrade-a.WpGrade});this.isWareChoiceWp=null;if(arr.length>0){owner.weapon.visible=true;owner.buyBtn.visible=true;owner.sellBtn.visible=true}else{owner.weapon.visible=false;owner.buyBtn.visible=false;owner.sellBtn.visible=false}owner.warehouseList.array=arr}buyWp(){let owner=this.owner;let detail=this.currentBuyWeapDetail;PaoYa.Request.POST(`martial_shop_buy`,{weaponId:detail.weaponId},res=>{owner.changeHB(res)});owner.showaniC.skin=this.isBuyChoiceWp.getChildByName(`wp`)._skin;owner.showaniType.skin=this.isBuyChoiceWp.getChildByName(`mark`)._skin;owner.showaniWrap.skin=this.isBuyChoiceWp.getChildByName(`bgwrap`)._skin;owner.showani.visible=true;owner.showani.x=722+this.isBuyChoiceWp.x+71;owner.showani.y=this.isBuyChoiceWp.y+116+71;owner.ware.visible=true;Laya.Tween.to(owner.showani,{x:296,y:652,scaleX:0,scaleY:0},800,Laya.Ease.quintIn,Laya.Handler.create(this,()=>{owner.showani.visible=false;owner.showani.scale(1,1);Laya.Tween.to(owner.ware,{alpha:0},400,Laya.Ease.quintIn,Laya.Handler.create(this,()=>{owner.ware.visible=false;owner.ware.alpha=1}))}));Laya.timer.once(100,this,()=>{this.buyList.splice(this.buyPresentIdx,1);this.buyPresentIdx=0;let newDetail=null;switch(detail.weaponType){case 3:newDetail=`heavyList`;break;case 2:newDetail=`middleList`;break;case 1:newDetail=`lightList`;break}let isNew=true;this[newDetail].forEach(element=>{if(element.weaponId==detail.weaponId&&element.weaponLevel==detail.weaponLevel){element.num++;isNew=false}});if(isNew){detail.num=1;this[newDetail].push(detail)}if(this.buyList.length>0){owner.weapon.visible=true;owner.buyBtn.visible=true;owner.sellBtn.visible=true}else{owner.weapon.visible=false;owner.buyBtn.visible=false;owner.sellBtn.visible=false}owner.buyList.array=this.buyList})}sellWp(choice){let owner=this.owner;let detail=this.currentSellWeapDetail;if(detail.weaponStar==3&&!choice){let obj={detail:this.currentSellWeapDetail,type:`sell`};this.navigator.popup("weapon/StoreSure",obj);return}PaoYa.Request.POST(`martial_weapon_sale`,{weaponId:`${detail.weaponId}-${detail.weaponLevel}`},res=>{owner.changeHB(res)});let newDetail=null;switch(detail.weaponType){case 3:newDetail=`heavyList`;break;case 2:newDetail=`middleList`;break;case 1:newDetail=`lightList`;break}let orderCarryOut=false;this[newDetail].forEach(element=>{if(element.weaponId==detail.weaponId&&element.weaponLevel==detail.weaponLevel&&detail.num>0&&!orderCarryOut){element.num--;orderCarryOut=true}});this.showWareList(this[newDetail])}refresF(){let num=null;let owner=this.owner;num=this.isReadyRefrensh?0:1;if(PaoYa.DataCenter.user.diamond<Number(owner.needDiamon.text)){this.navigator.popup("weapon/DiamondLack",1);return}let obj={diamond:PaoYa.DataCenter.user.diamond-=Number(owner.needDiamon.text)};owner.changeHB(obj);this.isRefrshing=true;PaoYa.Request.POST(`martial_shop_list`,{refresh:num},res=>{Laya.timer.once(1e3,this,()=>{this.isRefrshing=false;owner.refreshTimeNum.visible=true;this.downTimeStartF(res.refreshTime)});this.buyList=res.weaponList;this.buyPresentIdx=0;if(this.buyList.length>0){owner.weapon.visible=true;owner.buyBtn.visible=true;owner.sellBtn.visible=true}else{owner.weapon.visible=false;owner.buyBtn.visible=false;owner.sellBtn.visible=false}owner.buyList.array=this.buyList})}}class WeaponStore extends PaoYa.View{constructor(){super();WeaponStore.ins=this}onAppear(){PaoYa.Request.GET("update_chips",{},res=>{this.changeHB(res)})}changeHB(res){this.goldNum.width=null;if(res.gold){PaoYa.DataCenter.user.gold=res.gold;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25)}if(res.diamond||res.diamond==0){PaoYa.DataCenter.user.diamond=res.diamond;let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.diamondNum.width*.6)/2,25)}function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}}onEnable(){Global.dataPoints("进入兵器店页面");this.sellText.font=`weaponDFont`;this.buyText.font=`weaponDFont`;this.needDiamon.text=20;this.needDiamon.font=`weaponNFontT`;this.needDiamon.scale(.5,.5);this.refreshTxt.font=`weaponDFont`;this.refreshTxt.scale(.7,.7);this.buyBtnTxt.font=`weaponDFont`;this.buyBtnTxt.scale(.7,.7);this.sellBtnTxt.font=`weaponDFont`;this.sellBtnTxt.scale(.7,.7);this.refreshTimeNum.font=`weaponDFont`;this.refreshTimeNum.scale(.4,.4)}lisenClick(e){}getWareBtnSkin(name){WeaponStoreControl.ins.sellPresentIdx=0;let arr=[`light`,`middle`,`large`];arr.forEach(element=>{this[element].skin=`remote/weaponhouse/14.png`});this[name].skin=`remote/weaponhouse/13.png`}onDisable(){}}class WheelControl extends PaoYa.Component{constructor(){super();WheelControl.ins=this;this.notGetLegendWp=localStorage.getItem(`wheelTime`)?Number(localStorage.getItem(`wheelTime`)):0;this.awardArr=[{id:18,weight:200},{id:19,weight:120},{id:20,weight:50},{id:21,weight:30},{id:22,weight:40},{id:23,weight:10},{id:24,weight:4},{id:25,weight:4}]}onAwake(){}onEnable(){}onThrottleClick(e){if(!this.owner){return}let owner=this.owner;switch(e.target.name){case`benBack`:SoundManager.ins.btn();this.navigator.pop();break;case`addbtn`:if(owner.isRunning){return}if(PaoYa.DataCenter.user.diamond<500){SoundManager.ins.btn();this.navigator.popup("weapon/DiamondLack");return}SoundManager.ins.btn();this.addTimes();break;case`startWheel`:if(owner.isRunning){return}this.wheelTurn();break}}addTimes(){this.navigator.popup("common/BuyWheelTimes")}addTimesD(num){let owner=this.owner;if(PaoYa.DataCenter.user.diamond<Number(owner.num.text)&&!num){this.navigator.popup("common/BuyWheelTimes",1);return}this.POST("martial_wheel_times_buy",{adv:num},res=>{if(!res){return}owner.video.visible=false;owner.startWheelTxt.font=`weaponDFont`;owner.startWheelTxt.scale(.8,.8);owner.startWheelTxt.pos(60,10);PaoYa.DataCenter.user.wheelTimes=res;owner.num.text=res;owner.changeDG()})}wheelTurn(){let owner=this.owner;if(owner.num.text<1){SoundManager.ins.btn();Global.dataPoints("增加转盘次数激励广告");Tool.showVideoAD(()=>{this.addTimesD(1)});return}let obj=this.getWheelAward();this.whellRun(obj)}getWheelAward(){let arrNum=0;this.awardArr.forEach(element=>{let weightNum=element.weight;if(element.id==24||element.id==25){weightNum+=2*this.notGetLegendWp}arrNum+=weightNum});let randomNum=arrNum*Math.random();let countNum=0;let isFisrt=true;let selectObj=null;this.awardArr.forEach(element=>{let countWeightNum=element.weight;if(element.id==24||element.id==25){countWeightNum+=2*this.notGetLegendWp}countNum+=countWeightNum;if(isFisrt&&randomNum-countNum<0){selectObj=element;isFisrt=false;if(element.id==24||element.id==25){localStorage.setItem(`wheelTime`,0)}else{localStorage.setItem(`wheelTime`,Number(localStorage.getItem(`wheelTime`))+1)}this.notGetLegendWp=Number(localStorage.getItem(`wheelTime`))}});return selectObj}whellRun(res){let owner=this.owner;this.getWheelAwardHttp(res);let rat=0;PaoYa.DataCenter.user.config_list.hero.wheelList.forEach((element,index)=>{if(element.id==res.id){let num=Math.random()>.5?1:-1;rat=index*45+22.5+2160+(Math.random()*20|0)*num;res.wheel=element;switch(element.propId){case 8:res.gold}}});owner.isRunning=true;SoundManager.ins.round();Laya.Tween.to(owner.pointer,{rotation:rat},4e3,Laya.Ease.circOut,Laya.Handler.create(this,()=>{this.isRunFinish=true;if(this.awardDetail){this.dialogPopup(this.awardDetail);this.awardDetail=null}}))}getWheelAwardHttp(obj){let owner=this.owner;PaoYa.Request.POST("martial_adv_receive",{exchangeId:obj.id,adv:0},res=>{owner.num.text=res.wheelTimes;if(res.wheelTimes==0){owner.video.visible=true;owner.startWheelTxt.font=`weaponDFont`;owner.startWheelTxt.scale(.8,.8);owner.startWheelTxt.pos(90,10)}PaoYa.DataCenter.user.wheelTimes=res.wheelTimes;this.awardDetail=res;res.wheel=res.wheel?res.wheel:obj;if(this.isRunFinish){this.isRunFinish=null;this.dialogPopup(res)}})}dialogPopup(res){let owner=this.owner;let obj={type:`wheel`,detail:res};this.navigator.popup("common/Award",obj,Laya.Handler.create(this,()=>{this.awardDetail=null;this.isRunFinish=null;owner.pointer.rotation=0;owner.isRunning=false}))}}class Wheel extends PaoYa.View{constructor(){super();Wheel.ins=this}onAwake(){}onEnable(){this.tip.font=`weaponNFontT`;this.tip.scale(.6,.6);this.num.text=PaoYa.DataCenter.user.wheelTimes;this.num.font=`recoverHP`;this.num.pos(370,508);this.num.scale(1.2,1.2);if(PaoYa.DataCenter.user.wheelTimes==0){this.video.visible=true;this.startWheelTxt.font=`weaponDFont`;this.startWheelTxt.scale(.8,.8);this.startWheelTxt.pos(90,10)}else{this.startWheelTxt.font=`weaponDFont`;this.startWheelTxt.scale(.8,.8);this.startWheelTxt.pos(60,10)}PaoYa.DataCenter.user.config_list.hero.wheelList.forEach((element,index)=>{this.showList(this[`award${index+1}`],element,index)})}lisenClick(e){switch(e.target.name){case`benBack`:SoundManager.ins.btn();WheelControl.ins.navigator.pop();break;case`addbtn`:if(this.isRunning){return}if(PaoYa.DataCenter.user.diamond<500){SoundManager.ins.btn();WheelControl.ins.navigator.popup("weapon/DiamondLack");return}SoundManager.ins.btn();WheelControl.ins.addTimes();break;case`startWheel`:if(this.isRunning){return}WheelControl.ins.wheelTurn();break}}onAppear(){this.changeDG()}changeDG(){PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;if(res.gold||res.gold==0){PaoYa.DataCenter.user.gold=res.gold;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25)}if(res.diamond||res.diamond==0){PaoYa.DataCenter.user.diamond=res.diamond;let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.diamondNum.width*.6)/2,25)}function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}})}showList(cell,data,index){let role=cell.getChildByName(`role`);let wp=cell.getChildByName(`wp`);let godo=cell.getChildByName(`godo`);let awardImage=godo.getChildByName(`icon`);let num=godo.getChildByName(`num`);switch(data.propId){case 1:wp.visible=true;wp.getChildByName(`wp`).skin=`local/common/wp.png`;wp.getChildByName(`bgwrap`).skin=`local/common/quality_3.png`;break;case 2:role.visible=true;break;case 3:wp.visible=true;break;case 8:godo.visible=true;awardImage.visible=true;awardImage.skin=`local/common/icon.png`;num.visible=true;num.text=data.propNum;num.font=`weaponNFontT`;num.scale(.65,.65);break;case 9:godo.visible=true;awardImage.visible=true;num.visible=true;awardImage.skin=`local/common/diamond.png`;num.text=data.propNum;num.font=`weaponNFontT`;num.scale(.65,.65);break}}}class BuyWp extends PaoYa.Dialog{constructor(){super();BuyWp.ins=this}onEnable(){this.autoDestroyAtClosed=true;this.resultParams=JSON.parse(JSON.stringify(this.params));if(this.params.encounter){this.params=this.params.encounter}this.heroImage.skin=`remote/guide/hero_${PaoYa.DataCenter.user.defaultRoleId}.png`;this.tips.font=`adventure`;this.tips.x=630;this.buyBtnText.font=`adventure`;this.buyBtnText.pos(10,10);this.closeBtnText.font=`adventure`;this.closeBtnText.pos(25,10);this.closeBtn.on(Laya.Event.CLICK,this,()=>{PaoYa.Request.POST("martial_encounter_cancel",{},res=>{PaoYa.NotificationCenter.postNotification(`adventCancel`);this.close()})});this.closeBtn2.on(Laya.Event.CLICK,this,()=>{this.close()});this.buyBtn.on(Laya.Event.CLICK,this,()=>{this.buyWp()});this.warehouseList.vScrollBarSkin="";this.warehouseList.renderHandler=new Laya.Handler(this,this.wareWeaponUpdateItem);this.showlist=this.params.weaponList;this.cellList=[];this.warehouseList.array=this.showlist}wareWeaponUpdateItem(cell,idx){this.cellList.push(cell);cell.getChildByName(`beChioce`).visible=false;if(cell._dataSource.isChioced){cell.getChildByName(`beChioce`).visible=true}cell.getChildByName(`bg`).getChildByName(`txt`).text=`${cell._dataSource.weaponPrice}`;cell.getChildByName(`bg`).getChildByName(`txt`).font=`weaponNFontT`;cell.getChildByName(`bg`).getChildByName(`txt`).scale(.75,.75);cell.getChildByName(`wp`).skin=`remote/small_weapons/s_${cell._dataSource.weaponId}.png`;let skinq=``;let skint=``;switch(cell._dataSource.weaponStar){case 1:skinq=`local/common/quality_1.png`;break;case 2:skinq=`local/common/quality_2.png`;break;case 3:skinq=`local/common/quality_3.png`;break}switch(cell._dataSource.weaponType){case 3:skint=`local/common/type_1.png`;break;case 2:skint=`local/common/type_2.png`;break;case 1:skint=`local/common/type_3.png`;break}cell.getChildByName(`bgwrap`).skin=skinq;cell.getChildByName(`mark`).skin=skint;cell.offAll();cell.on(Laya.Event.MOUSE_DOWN,this,()=>{this.count=0;this.pressIdx=idx;Laya.timer.loop(100,this,this.addTime)});cell.on(Laya.Event.MOUSE_UP,this,()=>{if(this.count<=5){if(this.showlist[idx].isChioced){this.showlist[idx].isChioced=false}else{this.showlist[idx].isChioced=true}this.cellList=[];this.warehouseList.array=this.showlist}this.changeStatus()})}addTime(){if(this.count>5){Laya.timer.clear(this,this.addTime);this.renderDetail()}else{this.count++}}changeStatus(){if(this.wpInfo.visible){this.wpInfo.visible=false}this.pressIdx=-1;Laya.timer.clear(this,this.addTime)}buyWp(){let moveArr=[],wpString=null,num=0;this.showlist.forEach((element,index)=>{if(element.isChioced){wpString=wpString?`${wpString},${element.weaponId}`:`${element.weaponId}`;num+=Number(element.weaponPrice);let obj={idx:index,detail:this.cellList[index]};moveArr.push(obj)}});if(moveArr.length==0){py.showToast({title:"请先选择相应兵器"});return}if(num>PaoYa.DataCenter.user.diamond){this.close();PaoYa.navigator.popup("weapon/DiamondLack",1);return}PaoYa.Request.POST("martial_encounter_finish",{result:1,complete:1,weaponId:wpString},res=>{this.ware.visible=true;PaoYa.Request.GET("update_chips",{},res=>{PaoYa.DataCenter.gold.value=res.gold;PaoYa.DataCenter.diamond.value=res.diamond});PaoYa.NotificationCenter.postNotification(`adventComplete`);moveArr.forEach(element=>{this[`showani${element.idx}`].x=749.5+128*element.idx;this[`showani${element.idx}`].y=391;this[`showani${element.idx}`].visible=true;this[`bgwrap${element.idx}`].skin=element.detail.getChildByName(`bgwrap`).skin;this[`mark${element.idx}`].skin=element.detail.getChildByName(`mark`).skin;this[`wp${element.idx}`].skin=element.detail.getChildByName(`wp`).skin;Laya.Tween.to(this[`showani${element.idx}`],{x:296,y:652,scaleX:0,scaleY:0},800,Laya.Ease.quintIn,Laya.Handler.create(this,()=>{this[`showani${element.idx}`].visible=false;Laya.Tween.to(this.ware,{alpha:0},400,Laya.Ease.quintIn,Laya.Handler.create(this,()=>{this.ware.visible=false;this.ware.alpha=1;this.close()}))}))})})}renderDetail(){this.wpInfo.visible=true;this.wpInfo.x=698+120*this.pressIdx;let detail=this.showlist[this.pressIdx];this.currutWeapon.text=detail.weaponName;this.currutWeapon.font=`weaponDFont`;this.currutWeapon.scale(.5,.5);this.currtWeaponLevel.text=`LV.${detail.weaponLevel}/${detail.weaponTopLevel}`;this.currtWeaponLevel.font=`weaponNFontT`;this.currtWeaponLevel.scale(.6,.6);this.attackNum.text=`攻击： ${detail.weaponAttack}`;this.enduranceNum.text=`耐久： ${detail.weaponDurable}`;this.consumeNum.text=`消耗： ${detail.weaponConsume}`;this.wpcdNum.text=`冷却： ${detail.weaponCd}秒`;this[`skillName_1`].text=``;this[`skillGl_1`].text=``;this[`skillDetail_1`].text=``;this[`skillImg_1`].visible=false;this[`skillName_2`].text=``;this[`skillGl_2`].text=``;this[`skillDetail_2`].text=``;this[`skillImg_2`].visible=false;if(detail.skills.length>0){detail.skills.forEach((element,index)=>{this[`skillName_${index+1}`].color=`#4a4948`;this[`skillGl_${index+1}`].color=`#4a4948`;this[`skillDetail_${index+1}`].color=`#4a4948`;this[`skillName_${index+1}`].text=element.skillName;this[`skillGl_${index+1}`].text=`几率${element.skillProb}%`;this[`skillDetail_${index+1}`].text=element.skillDesc;this[`skillImg_${index+1}`].visible=true;if(element.status){this[`skillName_${index+1}`].color=`#004418`;this[`skillGl_${index+1}`].color=`#004418`;this[`skillDetail_${index+1}`].color=`#004418`}})}}onClosed(){if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}}}class ChangeWp extends PaoYa.Dialog{constructor(){super();ChangeWp.ins=this}onEnable(){this.autoDestroyAtClosed=true;this.resultParams=JSON.parse(JSON.stringify(this.params));if(this.params.encounter){this.params=this.params.encounter}this.tips.font=`adventure`;this.tips.x=630;let name="八卦斧";this.label2.text=`年轻人，请问你有没有一把${name}。如果你能把它让给我的话，谢某定当重谢`;this.buyBtnText.font=`adventure`;this.buyBtnText.pos(40,10);this.closeBtnText.font=`adventure`;this.closeBtnText.pos(60,10);this.getWp.font=`adventure`;this.infoDetail();this.closeBtn.on(Laya.Event.CLICK,this,()=>{PaoYa.Request.POST("martial_encounter_cancel",{},res=>{PaoYa.NotificationCenter.postNotification(`adventCancel`);this.close()})});this.closeBtn2.on(Laya.Event.CLICK,this,()=>{this.close()});this.buyBtn.on(Laya.Event.CLICK,this,()=>{if(this.params.weaponId){this.sellyWp()}else{Global.dataPoints("奇遇b激励广告");Tool.showVideoAD(()=>{this.params.weaponId=`video`;this.infoDetail()},null,null,1)}})}infoDetail(){let hhnum=this.params.weaponId?1:0;if(!hhnum){this.buyBtnText.visible=false;this.tips2.visible=true;this.getWp.visible=true;this.get.visible=true}else{this.buyBtnText.visible=true;this.tips2.visible=false;this.getWp.visible=false;this.get.visible=false}this.num.font=`weaponNFontT`;this.wpnum.text=`${hhnum}/1`;this.wpnum.font=`weaponNFontT`;this.num.scale(.7,.7);this.wpnum.scale(.7,.7)}sellyWp(){PaoYa.Request.POST("martial_encounter_finish",{result:1,complete:1,weaponId:this.params.weaponId},res=>{PaoYa.Request.GET("update_chips",{},res=>{PaoYa.DataCenter.gold.value=res.gold;PaoYa.DataCenter.diamond.value=res.diamond});PaoYa.NotificationCenter.postNotification(`adventComplete`);this.close()})}onClosed(){if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}}}class GetAward extends PaoYa.Dialog{constructor(){super();GetAward.ins=this}onEnable(){this.autoDestroyAtClosed=true;this.resultParams=JSON.parse(JSON.stringify(this.params));if(this.params.encounter){this.params=this.params.encounter}this.tips.font=`adventure`;this.tips.x=630;this.closeBtnText.font=`adventure`;this.closeBtnText.scale(.9,.9);this.closeBtnText.pos(10,15);this.getWp.font=`adventure`;this.closeBtn.on(Laya.Event.CLICK,this,()=>{PaoYa.Request.POST("martial_encounter_cancel",{},res=>{if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}PaoYa.NotificationCenter.postNotification(`adventCancel`);this.close()})});this.closeBtn2.on(Laya.Event.CLICK,this,()=>{if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.resultParams)}this.close()});this.buyBtn.on(Laya.Event.CLICK,this,()=>{Global.dataPoints("奇遇c激励广告");Tool.showVideoAD(()=>{PaoYa.Request.POST("martial_encounter_finish",{result:1,complete:1},res=>{PaoYa.Request.GET("update_chips",{},res=>{PaoYa.DataCenter.gold.value=res.gold;PaoYa.DataCenter.diamond.value=res.diamond});this.close();let obj={type:`sign`,detail:{gold:res.gold},isAdventure:true,resultParams:this.resultParams};PaoYa.navigator.popup("common/Award",obj)})},null,null,1)})}onClosed(){}}class Award extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.tips.font=`weaponDFont`;this.tips.scale(.7,.7);switch(this.params.type){case`sign`:this.sign.visible=true;this.btnClose.visible=true;this.sure.font=`weaponDFont`;this.sure.scale(.6,.6);this.sure.pos(60,13);this.btnClose.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});break;case`wheel`:this.wheel.visible=true;this.noThank.visible=true;this.again.visible=true;this.noThankTxt.font=`weaponDFont`;this.noThankTxt.scale(.6,.6);this.noThankTxt.pos(75,15);this.againTxt.font=`weaponDFont`;this.againTxt.scale(.6,.6);this.againTxt.pos(100,15);this.again.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();Global.dataPoints("转盘倍数领取激励广告");Tool.showVideoAD(()=>{PaoYa.Request.POST("martial_adv_receive",{exchangeId:this.params.detail.wheel.id,adv:1},()=>{Wheel.ins.changeDG();this.close()})})});this.noThank.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});break}for(const key in this.params.detail){switch(key){case`weaponId`:this.again.visible=false;if(this.params.detail.weaponId.indexOf(`g`)!=-1){this.mark.skin=`local/common/type_1.png`}if(this.params.detail.weaponId.indexOf(`z`)!=-1){this.mark.skin=`local/common/type_2.png`}if(this.params.detail.weaponId.indexOf(`d`)!=-1){this.mark.skin=`local/common/type_3.png`}let arr4=this.params.detail.weaponId.split("-");this.wpimage.skin=`remote/small_weapons/s_${arr4[0]}.png`;this.wp.visible=true;break;case`roleId`:this.icon.visible=true;this.iconnum.skin=`local/common/hero_${this.params.detail.roleId}.png`;break;case`gold`:SoundManager.ins.gold();this.awardImage.visible=true;this.num.visible=true;this.awardImage.skin=`local/common/icon.png`;this.num.text=`×${this.params.detail.gold}`;this.num.font=`weaponNFontT`;this.num.scale(.65,.65);switch(this.params.type){case`sign`:break;case`wheel`:break}break;case`diamond`:SoundManager.ins.gold();this.awardImage.visible=true;this.num.visible=true;this.awardImage.skin=`local/common/diamond.png`;this.num.text=`×${this.params.detail.diamond}`;this.num.font=`weaponNFontT`;this.num.scale(.65,.65);switch(this.params.type){case`sign`:break;case`wheel`:break}break}}}onDisable(){}onClosed(){if(this.params.isAdventure){PaoYa.NotificationCenter.postNotification(`adventComplete`);if(PaoYa.navigator.scenes.length>1){PaoYa.navigator.popup("/dialog/PassResultDialog",this.params.resultParams)}return}switch(this.params.type){case`sign`:Sign.ins.params.status++;Sign.ins.params.login_days++;Sign.ins.initInfo();break;case`wheel`:Wheel.ins.changeDG();break}}}class BuyWheelTimes extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.buybtnTxt.font=`weaponDFont`;this.buybtnTxt.scale(.8,.8);this.buybtnTxt.pos(55,10);this.title.font=`figureDetail`;this.title.scale(.75,.75);this.title.x=(544-this.title.width*.75)/2;this.buy.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close();if(PaoYa.DataCenter.user.diamond>=500){WheelControl.ins.addTimesD(0)}else{PaoYa.navigator.popup("weapon/DiamondLack",1)}});this.closeBtn.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()})}}class Task extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.btnClose.on(Laya.Event.CLICK,this,()=>{this.close();SoundManager.ins.btn()});this.title.font=`weaponDFont`;this.title.scale(.6,.6);this.title.pos(480,78);this.params.list.forEach((element,index)=>{element.ranking=index});this.rankList.vScrollBarSkin="";this.rankList.renderHandler=new Laya.Handler(this,this.rankListItem);this.rankList.array=this.params.list;console.log(this.params.list);this.myRank.dataSource={};this.myRank.dataSource.member_avstar=this.params.member_avstar;this.myRank.dataSource.member_nick=this.params.member_nick;this.myRank.dataSource.ranking=this.params.ranking==-1?-1:Number(this.params.ranking)-1;this.myRank.dataSource.score=this.params.score;this.rankListItem(this.myRank,this.myRank.dataSource.ranking)}rankListItem(cell,index){console.log(cell.dataSource.ranking);let rankicon=cell.getChildByName(`rankicon`);let ranknum=cell.getChildByName(`ranknum`);let usericon=cell.getChildByName(`usericon`);let name=cell.getChildByName(`name`);let rankdetail=cell.getChildByName(`rankdetail`);let award1=cell.getChildByName(`award1`);let award2=cell.getChildByName(`award2`);name.text=PaoYa.Utils.formatName(cell.dataSource.member_nick);let num1=cell.dataSource.score%1e3;let num2=cell.dataSource.score/1e3|0;rankdetail.text=`${PaoYa.DataCenter.user.config_list.hero.ladderList[num2-1].ladderName}×${num1}`;name.visible=true;rankdetail.visible=true;usericon.skin=cell.dataSource.member_avstar;usericon.visible=true;if(cell.dataSource.ranking<3&&cell.dataSource.ranking!=-1){rankicon.skin=`remote/task/100${cell.dataSource.ranking+1}.png`;rankicon.visible=true;ranknum.visible=false}else{rankicon.visible=false;if(cell.dataSource.ranking==-1){ranknum.text=`榜外`;ranknum.scale(.8,.8);ranknum.x=37;ranknum.y=27;ranknum.visible=true;ranknum.font=`weaponDFont`}else{ranknum.text=cell.dataSource.ranking+1;ranknum.visible=true;ranknum.font=`weaponDFont`}}}}class Task$1 extends PaoYa.Dialog{constructor(){super()}onEnable(){Global.dataPoints("进入任务页面");this.autoDestroyAtClosed=true;PaoYa.Request.GET("update_chips",{},res=>{this.goldNum.width=null;PaoYa.DataCenter.user.gold=res.gold;PaoYa.DataCenter.user.diamond=res.diamond;let goldnum=addNumberUnit(PaoYa.DataCenter.user.gold);let diamondnum=addNumberUnit(PaoYa.DataCenter.user.diamond);this.goldNum.text=goldnum;this.goldNum.font=`weaponNFontT`;this.goldNum.scale(.6,.6);this.goldNum.pos(365+(149-this.goldNum.width*.6)/2,25);this.diamondNum.text=diamondnum;this.diamondNum.font=`weaponNFontT`;this.diamondNum.scale(.6,.6);this.diamondNum.pos(600+(149-this.diamondNum.width*.6)/2,25);function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}});this.btnClose.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.title.font=`weaponDFont`;this.title.scale(.6,.6);this.title.pos(515,78);this.taskList.vScrollBarSkin="";this.taskList.renderHandler=new Laya.Handler(this,this.taskListItem);this.taskList.array=this.getNewList(this.params)}getNewList(arr){let arr2=[];arr.forEach(element=>{if(element.status!=2){arr2.push(element)}});return arr2}taskListItem(cell,index){console.log(cell.dataSource,index);let bg=cell.getChildByName(`bg`);let num=cell.getChildByName(`num`);let detail2=cell.getChildByName(`detail2`);let detail=cell.getChildByName(`detail`);let img=cell.getChildByName(`img`);let diamondNum=cell.getChildByName(`diamondNum`);let btn=cell.getChildByName(`btn`);let noThankTxt=cell.getChildByName(`noThankTxt`);let sp=cell.getChildByName(`sp`);sp.visible=false;bg.visible=cell.dataSource.finish>=cell.dataSource.num;img.width=cell.dataSource.finish/cell.dataSource.num>=1?144:cell.dataSource.finish/cell.dataSource.num*144;diamondNum.text=cell.dataSource.diamond;diamondNum.font=`weaponDFont`;diamondNum.scale(.65,.65);diamondNum.pos(598,24);btn.skin=cell.dataSource.finish/cell.dataSource.num>=1?`local/common/btn_1.png`:`local/common/btn_2.png`;btn.offAll();btn.disabled=false;if(cell.dataSource.status==2){noThankTxt.text=`已领取`;noThankTxt.font=`weaponDFont`;noThankTxt.scale(.65,.65);noThankTxt.pos(751+(172-noThankTxt.width*.65)/2,15);btn.disabled=true}else{if(cell.dataSource.finish/cell.dataSource.num>=1){noThankTxt.text=`领取`;noThankTxt.font=`weaponDFont`;noThankTxt.scale(.65,.65);noThankTxt.pos(751+(172-noThankTxt.width*.65)/2+30,15);sp.visible=true;btn.on(Laya.Event.CLICK,this,()=>{Global.dataPoints("任务奖励领取激励广告");Tool.showVideoAD(()=>{PaoYa.Request.POST(`martial_task_receive`,{taskKey:cell.dataSource.task},res=>{SoundManager.ins.gold();PaoYa.DataCenter.user.diamond+=cell.dataSource.diamond;this.diamondNum.text=addNumberUnit(PaoYa.DataCenter.user.diamond);function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}let statuss=false;this.params.forEach(element=>{if(element.task==cell.dataSource.task){for(const key in res){element[key]=res[key]}}if(element.status==1){statuss=true}});PaoYa.DataCenter.user.dailyTaskStatus=statuss;HomeControl.ins.owner.taskDot.visible=PaoYa.DataCenter.user.dailyTaskStatus?true:false;this.taskList.array=this.getNewList(this.params)})})})}else{noThankTxt.text=`去完成`;noThankTxt.font=`weaponDFont`;noThankTxt.scale(.65,.65);noThankTxt.pos(751+(172-noThankTxt.width*.65)/2,15);btn.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()})}}switch(cell.dataSource.task){case"taskMonster":detail.text=`击败了`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}个敌人`;detail2.x=num.width+num.x;break;case"taskBoss":detail.text=`击败`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}个BOSS`;detail2.x=num.width+num.x;break;case"taskWin":detail.text=`对局胜利`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}局`;detail2.x=num.width+num.x;break;case"taskEncounter":detail.text=`完成`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}次奇遇`;detail2.x=num.width+num.x;break;case"taskUpWeapon":detail.text=`升级`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}次兵器`;detail2.x=num.width+num.x;break;case"taskGetWeapon":detail.text=`获得`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}个兵器`;detail2.x=num.width+num.x;break;case"taskShare":detail.text=`分享`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}次`;detail2.x=num.width+num.x;break;case"taskRefresh":detail.text=`刷新`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}次商店`;detail2.x=num.width+num.x;break;case"taskInvite":detail.text=`邀请`;num.text=cell.dataSource.finish;num.x=detail.width+detail.x;num.color=cell.dataSource.finish>=cell.dataSource.num?"#000000":"#d10000";detail2.text=`/${cell.dataSource.num}个好友`;detail2.x=num.width+num.x;break}}onClosed(){PaoYa.Request.GET("update_chips",{},res=>{PaoYa.DataCenter.gold.value=res.gold;PaoYa.DataCenter.diamond.value=res.diamond});if(Wheel&&Wheel.ins){Wheel.ins.changeDG()}}}class BuyHero extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.closeBtn.on(Laya.Event.CLICK,this,()=>{this.close();SoundManager.ins.btn()});this.buybtnTxt.font=`weaponDFont`;this.buybtnTxt.scale(.8,.8);this.buybtnTxt.pos(55,10);this.needNum.text=this.params.rolePrice;this.needNum.font=`figureDetail`;this.needNum.scale(1.5,1.5);this.needNum.pos(755,167);this.roleImg.skin=`remote/figure/role_${this.params.roleId}.png`;this.nameImg.skin=`remote/figure/name_${this.params.roleId}.png`;this.buy.on(Laya.Event.CLICK,this,()=>{if(PaoYa.DataCenter.user.diamond<this.params.rolePrice){this.close();SoundManager.ins.btn();SwordsmanControl.ins.openGetD();return}PaoYa.Request.POST(`martial_role_buy`,{roleId:this.params.roleId},res=>{PaoYa.DataCenter.user.diamond-=Number(this.params.rolePrice);Swordsman.ins.changeGold();SwordsmanControl.ins.owner.params.roleList.forEach((element,index)=>{if(element.roleId==res.role.roleId){element=res.role;SwordsmanControl.ins.owner.params.roleList[index]=element;SwordsmanControl.ins.owner.showDetail=element}});SwordsmanControl.ins.owner.herolist.array=SwordsmanControl.ins.owner.params.roleList;SwordsmanControl.ins.owner.initInfo();this.close()})})}onDisable(){}}class GoldLack extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.btn.on(Laya.Event.CLICK,this,()=>{this.close();SoundManager.ins.btn()});this.skillName.text=this.params.skillName;this.skillName.font=`figureDetail`;this.skillName.scale(.75,.75);this.skillName.x=(450-this.skillName.width*.75)/2;this.skillName.y=130;this.skilldetail.text=`    ${this.params.skillDesc}`;this.skilldetail.letterSpacing=4;this.sure.font=`weaponDFont`;this.sure.scale(.8,.8);this.sure.pos(55,10)}onDisable(){}}class SkillDetail extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.maskBg.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.skillName.text=this.params.skillName;this.skillName.font=`figureDetail`;this.skillName.scale(.75,.75);this.skillName.x=(450-this.skillName.width*.75)/2;this.unlock.text=`${this.params.skillUnlock}级解锁`;this.skilldetail.text=`    ${this.params.skillDesc}`;this.skilldetail.letterSpacing=4;this.cd.text=`冷却：${this.params.skillCd}`;this.cost.text=`消耗：${this.params.skillConsume}内力`}onDisable(){}}class Canlock extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.title.font=`figureDetail`;this.title.scale(.8,.8);this.title.x=(543-this.title.width)/2;this.btn2Txt.font=`weaponDFont`;this.btn2Txt.scale(.7,.7);this.btn2Txt.pos(42,15);this.btn2.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});let arr=this.params.refinerId.split(`,`);let ll=RefiningControl.ins.owner.params.refiner_list.length;let showList=[];for(let i=0;i<arr.length;i++){for(let j=0;j<ll;j++){if(RefiningControl.ins.owner.params.refiner_list[j].id==arr[i]){showList.push(RefiningControl.ins.owner.params.refiner_list[j])}}}this.skillList.x=arr.length==2?75:152;switch(arr.length){case 1:this.skillList.x=152;break;case 2:this.skillList.x=75;break;case 3:this.skillList.x=0;break}this.skillList.renderHandler=new Laya.Handler(this,this.skillRender);this.skillList.array=showList}onDisable(){}skillRender(cell,idx){console.log(cell._dataSource);cell.skin=cell._dataSource.type?`remote/refining/6.png`:`remote/refining/7.png`;cell.getChildByName(`refinerTxt`).text=cell._dataSource.refinerName;cell.getChildByName(`refinerTxt`).font=`weaponDFont`;cell.getChildByName(`refinerTxt`).scale(.6,.6);cell.getChildByName(`refinerTxt`).pos(35,12);cell.getChildByName(`refinerLv`).text=`LV.${this.params.refinerUnlock}`;cell.getChildByName(`refinerLv`).font=`weaponNFontT`;cell.getChildByName(`refinerLv`).scale(.5,.5);cell.getChildByName(`refinerLv`).pos(20,93)}}class DiamondLack extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.tipTxt.font=`weaponDFont`;this.tipTxt.scale(.7,.7);this.tipTxt.pos(45,12);this.btn.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close();HomeControl.ins.GET("martial_task_list",{},res=>{if(!res){return}PaoYa.navigator.popup("common/Task",res)})})}onDisable(){}}class GoldLack$1 extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.maskBg.on(Laya.Event.CLICK,this,()=>{this.close()});this.tipTxt.font=`weaponDFont`;this.tipTxt.scale(.7,.7);this.tipTxt.pos(45,12);this.btn.on(Laya.Event.CLICK,this,()=>{this.close();SoundManager.ins.btn();PaoYa.navigator.push("Wheel")})}onDisable(){}}class StoreSure extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.btn1.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.btn4.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.btn2.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close();WeaponStoreControl.ins.refresF()});this.btn3.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close();WeaponStoreControl.ins.sellWp(1)});this.btn5.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close();DevourControl$1.ins.eatWp(1)});this.closeBtn.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});if(this.params.type==`buy`){this.title.skin=`remote/weaponstore/6.png`;this.title.x=(543-this.title.width)/2;this.btn1.visible=true;this.btn2.visible=true;this.btn3.visible=false;this.btn4.visible=false;this.btn5.visible=false}else{this.title.skin=`remote/weaponstore/7.png`;this.title.x=(543-this.title.width)/2;this.btn1.visible=false;this.btn2.visible=false;if(this.params.type==`refining`){this.btn4.text=`点错了，不吞`;this.btn3.visible=false;this.btn5.visible=true}else{this.btn4.text=`点错了，不卖`;this.btn3.visible=true;this.btn5.visible=false}this.btn4.visible=true}this.btn1Txt.font=`weaponDFont`;this.btn1Txt.scale(.45,.45);this.btn4Txt.font=`weaponDFont`;this.btn4Txt.scale(.45,.45);this.btn2Txt.font=`weaponDFont`;this.btn2Txt.scale(.45,.45);this.btn3Txt.font=`weaponDFont`;this.btn3Txt.scale(.45,.45);this.btn5Txt.font=`weaponDFont`;this.btn5Txt.scale(.45,.45);let showMarkUrl=null;switch(this.params.detail.weaponType){case 3:showMarkUrl=`local/common/type_1.png`;break;case 2:showMarkUrl=`local/common/type_2.png`;break;case 1:showMarkUrl=`local/common/type_3.png`;break}this.showWeapon.skin=`remote/small_weapons/s_${this.params.detail.weaponId}.png`;this.showMark.skin=showMarkUrl;this.currtWeaponLevel.text=`LV.${this.params.detail.weaponLevel}`;this.currtWeaponLevel.font=`weaponNFontT`;this.currtWeaponLevel.scale(.6,.6)}onDisable(){}}class UnlockFifth extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.maskBg.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.btn.on(Laya.Event.CLICK,this,()=>{Global.dataPoints("五号兵器格分享");SoundManager.ins.btn();Tool.inviteFriend()})}onDisable(){}}class UnlockFour extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.maskBg.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();this.close()});this.btn.on(Laya.Event.CLICK,this,()=>{SoundManager.ins.btn();PaoYa.Request.POST(`martial_buy_grid`,{},res=>{WeaponHouseControl.ins.owner.diamondNum.text=addNumberUnit(res.diamond);WeaponHouseControl.ins.params.weaponGridNum+=1;WeaponHouseControl.ins.getMyUserDetailList();WeaponHouseControl.ins.owner.userWeaponList.array=WeaponHouseControl.ins.myUserDetailList;this.close();function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}},()=>{this.close();HomeControl.ins.navigator.popup("weapon/DiamondLack")})})}onDisable(){}}class UnlockTips extends PaoYa.Dialog{constructor(){super()}onEnable(){this.autoDestroyAtClosed=true;this.btn.on(Laya.Event.CLICK,this,()=>{this.close();SoundManager.ins.btn()})}onDisable(){}}class BeanBox extends PaoYa.Component{onAwake(){this.boxType=this.boxType||"1";this.integBg=this.owner.getChildByName("beanBg");this.labelBg=this.owner.getChildByName("labelBgCircle");this.skinLeft=this.owner.getChildByName("imgLeft");this.label=this.owner.getChildByName("label");this.label.font=`weaponNFontT`;this.label.scale(.6,.6);this.changeBox()}changeBox(){switch(this.boxType){case"1":PaoYa.DataCenter.gold.addObserver(this,this.handleGoldChange);break;case"2":this.skinLeft.skin="local/common/diamond.png";this.skinLeft.y=-5;this.skinLeft.size(60,60);PaoYa.DataCenter.diamond.addObserver(this,this.handleDiamondChange);break}}onClick(){switch(this.boxType){case"1":console.log("点击金币");break;case"2":console.log("点击砖石");break}}handleDiamondChange(value){addNumberUnit(value)=="undefined"?this.label.text="":this.label.text=addNumberUnit(value)}handleGoldChange(value){addNumberUnit(value)=="undefined"?this.label.text="":this.label.text=addNumberUnit(value)}onDestroy(){PaoYa.DataCenter.diamond.removeObserver(this,this.handleIntegralChange);PaoYa.DataCenter.gold.removeObserver(this,this.handleGoldChange)}}function addNumberUnit(num){switch(true){case num>=1e4&&num<1e8:let integ=num/1e4;return Math.floor(integ*100)/100+"万";break;case num>=1e8:let integ1=num/1e8;return Math.floor(integ1*100)/100+"亿";break;default:return num+"";break}}class PreOpenView extends PaoYa.View{constructor(){super()}onAwake(){this.selfSpeakMan=this.getChildByName("selfSpeakMan");this.otherSpeakMan=this.getChildByName("otherSpeakMan");console.log(this.selfSpeakMan.getComponent(SpeakMan));this.selfSpeakManComp=this.selfSpeakMan.getComponent(SpeakMan);this.otherSpeakManComp=this.otherSpeakMan.getComponent(SpeakMan);this.selfSpeakMan.visible=false;this.otherSpeakMan.visible=false;this.selfSpeakMan.x=-50;this.otherSpeakMan.right=0;this.on(Laya.Event.CLICK,this,this.clickHandler)}clickHandler(){this.indexId+=1;if(this.indexId>this.dialogues.length-1){console.log(`没有内容展示了`);this.event(`end`)}else{this.refresh(this.dialogues[this.indexId])}}start(res){this.indexId=0;this.stageInfo=JSON.parse(JSON.stringify(res));this.selfDress=this.stageInfo.selfDress;this.otherDress=this.stageInfo.otherDress;this.dialogues=this.stageInfo.dialogues;this.selfSpeakManComp.refresh({dress:res.selfDress,name:res.selfName});this.otherSpeakManComp.refresh({dress:res.otherDress,name:res.otherName});this.refresh(this.dialogues[this.indexId])}refresh(item){if(item.o){this.selfSpeakMan.visible=false;this.otherSpeakMan.visible=true;this.otherSpeakManComp.showWord(item.o)}else if(item.s){this.otherSpeakMan.visible=false;this.selfSpeakMan.visible=true;this.selfSpeakManComp.showWord(item.s)}}}PreOpenView.END=`end`;class GameConfig{static init(){let reg=Laya.ClassUtils.regClass;reg("gamescripts/dialog/AdventDialog.js",AdventDialog);reg("gamescripts/dialog/AdventDialog5.js",AdventureDialog5);reg("gamescripts/dialog/AdventResultDialog.js",AdventResultDialog);reg("gamescripts/dialog/AdventResultDialog5.js",AdventResultDialog5);reg("gamescripts/dialog/BattleResultDialog.js",BattleResultDialog);reg("gamescripts/dialog/PassResultDialog.js",PassResultDialog);reg("gamescripts/prefab/WeaponBar.js",WeaponBar);reg("gamescripts/GameGuide/GameGuide.js",GameGuide);reg("gamescripts/prefab/MPBar.js",MPBar);reg("gamescripts/prefab/HPBar.js",HPBar);reg("gamescripts/prefab/Dodge.js",Dodge);reg("gamescripts/prefab/GameBanner.js",GameBanner);reg("gamescripts/prefab/PlayerState.js",PlayerState);reg("gamescripts/prefab/PlayerSkill.js",PlayerSkill);reg("gamescripts/prefab/Skill.js",Skill);reg("gamescripts/gameGuide/GameGuideControl.js",GameGuideControl);reg("gamescripts/GameView.js",GameView);reg("gamescripts/GameControl.js",GameControl);reg("scripts/common/refiner/Devour.js",Devour$1);reg("scripts/common/refiner/DevourControl.js",DevourControl$1);reg("scripts/common/figure/Grading.js",Grading);reg("scripts/common/figure/GradingControl.js",GradingControl);reg("scripts/common/Loading/LoadingView.js",LoadingView);reg("scripts/common/Loading/LoadingControl.js",LoadingControl);reg("scripts/common/Match/MatchView.js",MatchView);reg("scripts/common/Match/MatchControl.js",MatchControl);reg("scripts/common/refiner/Refining.js",Refining);reg("scripts/common/refiner/RefiningControl.js",RefiningControl);reg("scripts/common/sign/Sign.js",Sign);reg("scripts/common/sign/SignControl.js",SignControl);reg("scripts/common/figure/Swordsman.js",Swordsman);reg("scripts/common/figure/SwordsmanControl.js",SwordsmanControl);reg("scripts/common/task/WeaponList.js",WeaponList);reg("scripts/common/task/WeaponListControl.js",WeaponListControl);reg("scripts/common/weapon/WeaponHouse.js",WeaponHouse);reg("scripts/common/weapon/WeaponHouseControl.js",WeaponHouseControl);reg("scripts/common/weapon/WeaponStore.js",WeaponStore);reg("scripts/common/weapon/WeaponStoreControl.js",WeaponStoreControl);reg("scripts/common/wheel/Wheel.js",Wheel);reg("scripts/common/wheel/WheelControl.js",WheelControl);reg("scripts/dialog/adventure/BuyWp.js",BuyWp);reg("scripts/dialog/adventure/ChangeWp.js",ChangeWp);reg("scripts/dialog/adventure/GetAward.js",GetAward);reg("scripts/dialog/common/Award.js",Award);reg("scripts/dialog/common/BuyWheelTimes.js",BuyWheelTimes);reg("scripts/dialog/common/Rank.js",Task);reg("scripts/dialog/common/Task.js",Task$1);reg("scripts/dialog/figure/BuyHero.js",BuyHero);reg("scripts/dialog/figure/GetNewSkill.js",GoldLack);reg("scripts/dialog/figure/SkillDetail.js",SkillDetail);reg("scripts/dialog/refiner/Canlock.js",Canlock);reg("scripts/dialog/weapon/DiamondLack.js",DiamondLack);reg("scripts/dialog/weapon/GoldLack.js",GoldLack$1);reg("scripts/dialog/weapon/StoreSure.js",StoreSure);reg("scripts/dialog/weapon/UnlockFifth.js",UnlockFifth);reg("scripts/dialog/weapon/UnlockFour.js",UnlockFour);reg("scripts/dialog/weapon/UnlockTips.js",UnlockTips);reg("scripts/prefab/BeanBox.js",BeanBox);reg("scripts/common/HomeControl.js",HomeControl);reg("gamescripts/gameGuide/SpeakMan.js",SpeakMan);reg("gamescripts/prefab/Player.js",Player);reg("gamescripts/preOpen/PreOpenView.js",PreOpenView);reg("gamescripts/prefab/Weapon.js",Weapon);reg("gamescripts/prefab/WeaponSkill.js",WeaponSkill)}}GameConfig.width=1134;GameConfig.height=750;GameConfig.scaleMode="fixedwidth";GameConfig.screenMode="horizontal";GameConfig.alignV="top";GameConfig.alignH="left";GameConfig.startScene="gamescenes/GameView.scene";GameConfig.sceneRoot="";GameConfig.debug=false;GameConfig.stat=false;GameConfig.physicsDebug=false;GameConfig.exportSceneToJson=true;GameConfig.init();class GameMain extends PaoYa.Main{setupOthers(){}setupConfig(){PaoYa.DataCenter.GAMERES=this.setupGameRes();PaoYa.ShareManager.makeShareImageURLHandler=function(){return PaoYa.DataCenter.CDNURL+PaoYa.DataCenter.config.game.share_img.randomItem}}setupLoadingView(cb){Laya.Scene.load("scenes/common/Loading/LoadWaitingView.scene",Laya.Handler.create(this,function(scene){PaoYa.Navigator.adjustViewPosition(scene,false);Laya.Scene.setLoadingPage(scene);Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,cb))}))}initRootScene(launchInfo,isFirstLaunch){PaoYa.ShareManager.isShare=false;this.navigator.push("HomeView",{},null,Laya.Handler.create(this,()=>{PaoYa.LaunchScreenView.hide()}),null)}onHide(res){if(PaoYa.ShareManager.isShare){return}if(PaoYa.navigator.visibleScene.url.indexOf("FBView")>=0){console.warn("在邀请界面");return}if(res&&res.mode!=undefined&&res.targetAction!=undefined&&!(res.mode=="hide"&&res.targetAction==8)){this.socket.sendMessage(PaoYa.Client.LEAVE_ROOM,{});Laya.Dialog.manager.closeAll();this.navigator.popToRootScene()}}}class Main extends GameMain{constructor(){var params={gameId:1006,baseURL:"https://juedi001test.goxiaochengxu.cn/ServiceCore/",zone:"cate",showStat:false,showDebugTool:true,userId:11120,offerId:"1450014295",version:config.version,rankingType:PaoYa.RankingType.WIN,release:config.release,debug:config.debug,ignoreCmds:["defeated","message"],showBannerAdWhenDialogPopup:false,adUnitId:"adunit-f54386c29a35dd95",interstitialUnitId:"adunit-92a0cb233fbbaacb",bannerUnitId:"adunit-4bec7f17587df319",adUnitIdLong:"adunit-e2f9bd1a37b91681",portrait:false,loadNetworkRes:true,is_config:0};super(params)}setupConfig(){let _this=this;Laya.MouseManager.multiTouchEnabled=false;super.setupConfig();if(typeof wx!="undefined"){Global.gameHeight=wx.getSystemInfoSync().windowWidth;Global.AdaptiveWidth=Global.gameHeight>800?142:0}PaoYa.Navigator.scenesMap={WeaponHouse:`scenes/common/WeaponHouse`,WeaponStore:`scenes/common/WeaponStore`,Swordsman:`scenes/common/Swordsman`,Swordsman:`scenes/common/Swordsman`,MatchView:"scenes/common/Match/MatchView",Grading:"scenes/common/Grading",Devour:"scenes/common/Devour",Refining:"scenes/common/Refining",Sign:"scenes/common/Sign",Wheel:"scenes/common/Wheel",WeapList:"scenes/common/WeapList"};PaoYa.DataCenter.GAMEPREPARE={sync(){_this.loadFontFnt(0);console.log("【同步】准备工作已完成")}};if(typeof wx!="undefined"||Laya.Render.isConchApp){wx.onMemoryWarning(function(){console.error("内存不足")})}PaoYa.SoundManager.onShowHandler=function(){SoundManager.ins.playMusic(SoundManager.curBg)};this.arrayFont=[{fontUrl:"font/weapon/lvfont.fnt",fontAni:"weaponNFontT"},{fontUrl:"font/recMP.fnt",fontAni:"recoverMP"},{fontUrl:"font/recHP.fnt",fontAni:"recoverHP"},{fontUrl:"font/hurt.fnt",fontAni:"hurt"},{fontUrl:"font/crit.fnt",fontAni:"crit"},{fontUrl:"font/poision.fnt",fontAni:"poision"},{fontUrl:"font/playerState.fnt",fontAni:"playerState"},{fontUrl:"font/playerSkill.fnt",fontAni:"playerSkill"},{fontUrl:"font/weaponSkill.fnt",fontAni:"weaponSkill"},{fontUrl:"font/weapon/detailfont.fnt",fontAni:"weaponDFont"},{fontUrl:"font/figure/msz.fnt",fontAni:"figureDetail"},{fontUrl:"font/adventure.fnt",fontAni:"adventure"}];HeroConfig.loadAllSpine()}setupAsyncRes(){let prepareList=["res/atlas/remote/weapon_effect/weapon_blood.atlas","res/atlas/remote/weapon_effect/weapon_blue.atlas","res/atlas/remote/weapon_effect/weapon_crits.atlas","res/atlas/remote/weapon_effect/weapon_freeze.atlas","res/atlas/remote/weapon_effect/weapon_palsy.atlas","res/atlas/remote/weapon_effect/weapon_poison.atlas","res/atlas/remote/weapon_effect/weapon_reduce.atlas","res/atlas/remote/weapon_effect/weapon_repeat.atlas","res/atlas/remote/weapon_effect/weapon_thump.atlas","res/atlas/remote/trigger_skill.atlas","res/atlas/remote/debuff_dizzy.atlas","res/atlas/remote/debuff_palsy.atlas","res/atlas/remote/debuff_poison.atlas","res/atlas/remote/injured.atlas","res/atlas/remote/recover_blood.atlas","res/atlas/remote/recover_power.atlas","res/atlas/remote/trigger_skill.atlas","res/atlas/remote/warn_arms.atlas","res/atlas/remote/collision.atlas"];return prepareList}loadFontFnt(index){if(index<this.arrayFont.length){var font=new Laya.BitmapFont;var itemFont=this.arrayFont[index];var _this=this;font.loadFont(itemFont.fontUrl,Laya.Handler.create(_this,function(){Laya.Text.registerBitmapFont(itemFont.fontAni,font);index++;_this.loadFontFnt(index)}))}}setupGameRes(){let list=["scenes/HomeView.scene","local/home/homeNewBg.jpg","local/home/homeBg.jpg","res/atlas/local/common.atlas","res/atlas/local/home.atlas","res/atlas/remote/guide.atlas","res/atlas/remote/grading.atlas","res/atlas/remote/adventure.atlas","remote/game/scene1.jpg","res/atlas/remote/debuff_dizzy.atlas","res/atlas/remote/debuff_palsy.atlas","res/atlas/remote/debuff_poison.atlas","res/atlas/remote/injured.atlas","res/atlas/remote/recover_blood.atlas","res/atlas/remote/recover_power.atlas","res/atlas/remote/trigger_skill.atlas","res/atlas/remote/warn_arms.atlas","res/atlas/remote/collision.atlas","res/atlas/remote/weapon_effect/weapon_blood.atlas","res/atlas/remote/weapon_effect/weapon_blue.atlas","res/atlas/remote/weapon_effect/weapon_crits.atlas","res/atlas/remote/weapon_effect/weapon_freeze.atlas","res/atlas/remote/weapon_effect/weapon_palsy.atlas","res/atlas/remote/weapon_effect/weapon_poison.atlas","res/atlas/remote/weapon_effect/weapon_reduce.atlas","res/atlas/remote/weapon_effect/weapon_repeat.atlas","res/atlas/remote/weapon_effect/weapon_thump.atlas","res/atlas/remote/hero_skill/hero1_skill1.atlas","res/atlas/remote/hero_skill/hero1_skill2.atlas","res/atlas/remote/hero_skill/hero2_skill1.atlas","res/atlas/remote/hero_skill/hero2_skill2.atlas","res/atlas/remote/recover_blood.atlas","res/atlas/remote/recover_power.atlas","res/atlas/remote/weapons.atlas","res/atlas/remote/small_weapons.atlas","res/atlas/remote/game.atlas"];return list}onShareAppMessage(){let random=Math.round(Math.random()*(PaoYa.DataCenter.config.game.share_list.length-1));return{title:PaoYa.DataCenter.config.game.share_list[random],imageUrl:PaoYa.DataCenter.CDNURL+PaoYa.DataCenter.config.game.share_img[random],query:""}}}new Main;Laya.UIConfig.closeDialogOnSide=false;{if(window[`wx`]){console.log=function(){};console.warn=function(){};console.error=function(){}}Laya.Stat.show()}exports.Main=Main;return exports}({});