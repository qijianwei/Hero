(function(J,Qa,E){var N=E["static"],r=E["class"],A=E.getset,Ra=laya.maths.Bezier,na=laya.resource.Bitmap,M=laya.utils.Browser,S=laya.utils.ColorUtils,X=E.Config,ba=laya.resource.Context,Sa=laya.filters.Filter,xa=laya.utils.FontInfo,oa=laya.resource.HTMLCanvas,Da=laya.resource.HTMLImage,F=laya.maths.Matrix,fa=laya.maths.Point,ga=laya.maths.Rectangle,D=laya.renders.Render,pa=laya.renders.RenderSprite,Ea=laya.resource.Resource,V=laya.utils.RunDriver,Fa=laya.display.Sprite,qa=laya.display.Stage,K=laya.utils.Stat,Ta=laya.utils.StringKey,Ua=laya.system.System,ea=laya.resource.Texture,Va=laya.utils.VectorGraphManager;E["interface"]("laya.webgl.submit.ISubmit");E["interface"]("laya.webgl.canvas.save.ISaveData");var Q=function(){function a(){}r(a,"laya.webgl.canvas.save.SaveBase");var c=a.prototype;E.imps(c,{"laya.webgl.canvas.save.ISaveData":!0});c.isSaveMark=function(){return!1};c.restore=function(b){this._dataObj[this._valueName]=this._value;a.POOL[a.POOL._length++]=this;this._newSubmit&&(b._curSubmit=B.RENDERBASE)};a._createArray=function(){var b=[];b._length=0;return b};a._init=function(){var b=a._namemap={};b[1]="ALPHA";b[2]="fillStyle";b[8]="font";b[256]="lineWidth";b[512]="strokeStyle";b[8192]="_mergeID";b[1024]=b[2048]=b[4096]=[];b[16384]="textBaseline";b[32768]="textAlign";b[65536]="_nBlendType";b[1048576]="shader";b[2097152]="filters";b[8388608]="_colorFiler";return b};a.save=function(b,d,e,c){if((b._saveMark._saveuse&d)!==d){b._saveMark._saveuse|=d;var f=a.POOL,f=0<f._length?f[--f._length]:new a;f._value=e[f._valueName=a._namemap[d]];f._dataObj=e;f._newSubmit=c;b=b._save;b[b._length++]=f}};a.POOL=laya.webgl.canvas.save.SaveBase._createArray();a._namemap=a._init();return a}(),O=function(){function a(b,d){this.size=[0,0];this.ALPHA=this.alpha=1;this.subID=0;this.ref=1;this._cacheID=0;this.clipMatDir=[99999999,0,0,99999999];this.clipMatPos=[0,0];this.clipOff=[0,0];this.defines=new ra;this.mainID=b;this.subID=d;this.u_mmat2=this.colorAdd=this.color=this.texture=this.textureHost=null;this._cacheID=b|d;this._inClassCache=a._cache[this._cacheID];0<b&&!this._inClassCache&&(this._inClassCache=a._cache[this._cacheID]=[],this._inClassCache._length=0);this.clear()}r(a,"laya.webgl.shader.d2.value.Value2D");var c=a.prototype;c.setValue=function(b){};c._ShaderWithCompile=function(){return Y.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Wa.create,this._attribLocation)};c.upload=function(){var b=u;u.worldMatrix4===u.TEMPMAT4_ARRAY||this.defines.addInt(128);this.mmat=b.worldMatrix4;u.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=u.matWVP.elements);var d=Y.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();d._shaderValueWidth!==b.width||d._shaderValueHeight!==b.height?(this.size[0]=b.width,this.size[1]=b.height,d._shaderValueWidth=b.width,d._shaderValueHeight=b.height,d.upload(this,null)):d.upload(this,d._params2dQuick2||d._make2dQuick2())};c.setFilters=function(b){if(this.filters=b)for(var d=b.length,a,c=0;c<d;c++)if(a=b[c])this.defines.add(a.type),a.action.setValue(this)};c.clear=function(){this.defines._value=this.subID+(z.shaderHighPrecision?1024:0);this.clipOff[0]=0};c.release=function(){1>--this.ref&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)};a._initone=function(b,d){a._typeClass[b]=d;a._cache[b]=[];a._cache[b]._length=0};a.__init__=function(){a._initone(4,Xa);a._initone(512,Ya);a._initone(1,Ga);a._initone(9,Ga)};a.create=function(b,d){var e=a._cache[b|d];return e._length?e[--e._length]:new a._typeClass[b|d](d)};a._cache=[];a._typeClass=[];a.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return a}(),Za=function(){function a(){this._mat=new F}r(a,"laya.webgl.canvas.save.SaveTranslate");var c=a.prototype;E.imps(c,{"laya.webgl.canvas.save.ISaveData":!0});c.isSaveMark=function(){return!1};c.restore=function(b){this._mat.copyTo(b._curMat);a.POOL[a.POOL._length++]=this};a.save=function(b){var d=a.POOL,d=0<d._length?d[--d._length]:new a;b._curMat.copyTo(d._mat);b=b._save;b[b._length++]=d};a.POOL=Q._createArray();return a}(),ha=function(){function a(){}r(a,"laya.webgl.resource.WebGLRTMgr");a.getRT=function(c,b){c|=0;b|=0;1E4<=c&&console.error("getRT error! w too big");var d=1E4*b+c,e=a.dict[d];if(e&&0<e.length)return e=e.pop(),e._mgrKey=d,e;e=new T(c,b,1,-1);e._mgrKey=d;return e};a.releaseRT=function(c){if(!(0>=c._mgrKey)){var b=a.dict[c._mgrKey];!b&&(b=[],a.dict[c._mgrKey]=b);c._mgrKey=0;b.push(c)}};a.dict={};return a}(),sa=function(){function a(b,d,a){this.indexNum=this.vertNum=0;this._applied=!1;this._attribInfo=this._vao=this._ib=null;this._quadNum=0;this.canReuse=!1;this._stride=b;this._vb=new Ha(b,35048);d?this._vb._resizeBuffer(d,!1):X.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*b,!1);this._ib=new Ia;a&&this._ib._resizeBuffer(a,!1)}r(a,"laya.webgl.utils.Mesh2D");var c=a.prototype;c.cloneWithNewVB=function(){var b=new a(this._stride,0,0);b._ib=this._ib;b._quadNum=this._quadNum;b._attribInfo=this._attribInfo;return b};c.cloneWithNewVBIB=function(){var b=new a(this._stride,0,0);b._attribInfo=this._attribInfo;return b};c.getVBW=function(){this._vb.setNeedUpload();return this._vb};c.getVBR=function(){return this._vb};c.getIBR=function(){return this._ib};c.getIBW=function(){this._ib.setNeedUpload();return this._ib};c.createQuadIB=function(b){this._quadNum=b;this._ib._resizeBuffer(12*b,!1);this._ib.byteLength=this._ib.bufferLength;for(var d=this._ib.getUint16Array(),a=0,c=0,g=0;g<b;g++)d[a++]=c,d[a++]=c+2,d[a++]=c+1,d[a++]=c,d[a++]=c+3,d[a++]=c+2,c+=4;this._ib.setNeedUpload()};c.setAttributes=function(b){this._attribInfo=b;if(0!=this._attribInfo.length%3)throw"Mesh2D setAttributes error!";};c.configVAO=function(b){if(!this._applied){this._applied=!0;this._vao||(this._vao=new $a);this._vao.bind();this._vb._bindForVAO();this._ib.setNeedUpload();this._ib._bind_uploadForVAO();for(var d=this._attribInfo.length/3,a=0,c=0;c<d;c++){var g=this._attribInfo[a+1],h=this._attribInfo[a],l=this._attribInfo[a+2];b.enableVertexAttribArray(c);b.vertexAttribPointer(c,g,h,!1,this._stride,l);a+=3}this._vao.unBind()}};c.useMesh=function(b){this._applied||this.configVAO(b);this._vao.bind();this._vb.bind();this._ib._bind_upload()||this._ib.bind();this._vb._bind_upload()||this._vb.bind()};c.getEleNum=function(){return this._ib.getBuffer().byteLength/2};c.releaseMesh=function(){};c.destroy=function(){};c.clearVB=function(){this._vb.clear()};a._gvaoid=0;return a}(),u=function(){function a(){}r(a,"laya.webgl.utils.RenderState2D");a.mat2MatArray=function(c,b){b[0]=c.a;b[1]=c.b;b[2]=a.EMPTYMAT4_ARRAY[2];b[3]=a.EMPTYMAT4_ARRAY[3];b[4]=c.c;b[5]=c.d;b[6]=a.EMPTYMAT4_ARRAY[6];b[7]=a.EMPTYMAT4_ARRAY[7];b[8]=a.EMPTYMAT4_ARRAY[8];b[9]=a.EMPTYMAT4_ARRAY[9];b[10]=a.EMPTYMAT4_ARRAY[10];b[11]=a.EMPTYMAT4_ARRAY[11];b[12]=c.tx;b[13]=c.ty;b[14]=a.EMPTYMAT4_ARRAY[14];b[15]=a.EMPTYMAT4_ARRAY[15];return b};a.restoreTempArray=function(){a.TEMPMAT4_ARRAY[0]=1;a.TEMPMAT4_ARRAY[1]=0;a.TEMPMAT4_ARRAY[4]=0;a.TEMPMAT4_ARRAY[5]=1;a.TEMPMAT4_ARRAY[12]=0;a.TEMPMAT4_ARRAY[13]=0};a.clear=function(){a.worldScissorTest=!1;a.worldAlpha=1};a._MAXSIZE=99999999;a.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.worldMatrix4=a.TEMPMAT4_ARRAY;a.matWVP=null;a.worldAlpha=1;a.worldScissorTest=!1;a.worldShaderDefines=null;a.worldFilters=null;a.width=0;a.height=0;N(a,["worldMatrix",function(){return this.worldMatrix=new F}]);return a}(),ia=function(){function a(b){this._color=null;this.setValue(b)}r(a,"laya.webgl.canvas.DrawStyle");var c=a.prototype;c.setValue=function(b){this._color=b?b instanceof laya.utils.ColorUtils?b:S.create(b):S.create("#000000")};c.reset=function(){this._color=S.create("#000000")};c.toInt=function(){return this._color.numColor};c.equal=function(b){return"string"==typeof b?this._color.strColor===b:b instanceof laya.utils.ColorUtils?this._color.numColor===b.numColor:!1};c.toColorStr=function(){return this._color.strColor};a.create=function(b){if(b){var d=b instanceof laya.utils.ColorUtils?b:S.create(b);return d._drawStyle||(d._drawStyle=new a(b))}return a.DEFAULT};N(a,["DEFAULT",function(){return this.DEFAULT=new a("#000000")}]);return a}(),ya=function(){function a(){this.ALPHA=1;this.shaderType=0;this.defines=new ra;this.strokeStyle=this.fillStyle=ia.DEFAULT}r(a,"laya.webgl.shader.d2.Shader2D");a.prototype.destroy=function(){this.filters=this.defines=null};a.__init__=function(){Y.preCompile2D(0,1,"/*\n\ttexture\u548cfillrect\u4f7f\u7528\u7684\u3002\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// \u8fd9\u4e2a\u662f\u5168\u5c40\u7684\uff0c\u4e0d\u7528\u518d\u5e94\u7528\u77e9\u9635\u4e86\u3002\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// \u4f7f\u7528\u8981\u628aclip\u504f\u79fb\u3002cacheas normal\u7528. \u53ea\u7528\u4e86[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos \x3d vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos\x3dmmat*pos;\n#endif\n\tvec4 pos1  \x3dvec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position\x3du_MvpMatrix*pos1;\n#else\n\tgl_Position\x3dpos1;\n#endif\n\tv_texcoordAlpha.xy \x3d posuv.zw;\n\t//v_texcoordAlpha.z \x3d attribColor.a/255.0;\n\tv_color \x3d attribColor/255.0;\n\tv_color.xyz*\x3dv_color.w;//\u53cd\u6b63\u540e\u9762\u4e5f\u8981\u9884\u4e58\n\t\n\tv_useTex \x3d attribFlags.r/255.0;\n\tfloat clipw \x3d length(clipMatDir.xy);\n\tfloat cliph \x3d length(clipMatDir.zw);\n\t\n\tvec2 clpos \x3d clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// \u5982\u679c\u6709mmat\uff0c\u9700\u8981\u4fee\u6539clipMatPos,\u56e0\u4e3a \u8fd9\u662fcacheas normal \uff08\u5982\u679c\u4e0d\u662f\u5c31\u9519\u4e86\uff09\uff0c clipMatPos\u88ab\u53bb\u6389\u4e86\u504f\u79fb\n\t\tif(clipOff[0]\x3e0.0){\n\t\t\tclpos.x+\x3dmmat[3].x;\t//tx\t\u6700\u7b80\u5355\u5904\u7406\n\t\t\tclpos.y+\x3dmmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos \x3d pos.xy - clpos;\t//pos\u5df2\u7ecf\u5e94\u7528\u77e9\u9635\u4e86\uff0c\u4e3a\u4e86\u51cf\u7684\u6709\u610f\u4e49\uff0cclip\u7684\u4f4d\u7f6e\u4e5f\u8981\u7f29\u653e\n\tif(clipw\x3e20000. \x26\x26 cliph\x3e20000.)\n\t\tcliped \x3d vec2(0.5,0.5);\n\telse {\n\t\t//\u8f6c\u62100\u52301\u4e4b\u95f4\u3002/clipw/clipw \u8868\u793aclippos\u4e0enormalize\u4e4b\u540e\u7684clip\u671d\u5411\u70b9\u79ef\u4e4b\u540e\uff0c\u518d\u9664\u4ee5clipw\n\t\tcliped\x3dvec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}","/*\n\ttexture\u548cfillrect\u4f7f\u7528\u7684\u3002\n*/\n\nprecision mediump float;\n//precision highp float;\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw \x3d 9.0;\n    vec4 vec4Color \x3d vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz\x3dvec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos\x3dv_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord \x3d startpos;\n    vec2 step \x3d 1.0/blurInfo;  //\u6bcf\u4e2a\u50cf\u7d20      \n    \n    for(float y \x3d 0.0;y\x3c\x3dblurw; ++y){\n        ctexcoord.x\x3dstartpos.x;\n        for(float x \x3d 0.0;x\x3c\x3dblurw; ++x){\n            //TODO \u7eb9\u7406\u5750\u6807\u7684\u56fa\u5b9a\u504f\u79fb\u5e94\u8be5\u5728vs\u4e2d\u5904\u7406\n            vec4Color +\x3d texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+\x3dstep.x;\n        }\n        ctexcoord.y+\x3dstep.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x\x3c0.) discard;\n\tif(cliped.x\x3e1.) discard;\n\tif(cliped.y\x3c0.) discard;\n\tif(cliped.y\x3e1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color\x3d texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color\x3d texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex\x3c\x3d0.)color \x3d vec4(1.,1.,1.,1.);\n   color.a*\x3dv_color.w;\n   //color.rgb*\x3dv_color.w;\n   color.rgb*\x3dv_color.rgb;\n   gl_FragColor\x3dcolor;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor \x3d vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *\x3d colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor \x3d   blur();\n\tgl_FragColor.w*\x3dv_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat \x3dcolorMat;\n\n\talphaMat[0][3] *\x3d gl_FragColor.a;\n\talphaMat[1][3] *\x3d gl_FragColor.a;\n\talphaMat[2][3] *\x3d gl_FragColor.a;\n\n\tgl_FragColor \x3d gl_FragColor * alphaMat;\n\tgl_FragColor +\x3d colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime \x3d 10.0;\n\tfloat floatIterationTotalTime \x3d c_IterationTime * c_IterationTime;\n\tvec4 vec4Color \x3d vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir \x3d vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff \x3d vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum \x3d u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off \x3d vec2(0.0,0.0);\n\tfloat floatOff \x3d c_IterationTime/2.0;\n\tfor(float i \x3d 0.0;i\x3c\x3dc_IterationTime; ++i){\n\t\tfor(float j \x3d 0.0;j\x3c\x3dc_IterationTime; ++j){\n\t\t\tvec2Off \x3d vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color +\x3d texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor \x3d vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *\x3d gl_FragColor.a;   \n   #endif\n   \n}",null);Y.preCompile2D(0,4,"attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy\x3dvec4(0.9,0.1, -0.1,0.9);\n//vec4 clip\x3dvec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos\x3dmmat*vec4(position.xy,0.,1.);\n\tgl_Position \x3dvec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position \x3dvec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw \x3d length(clipMatDir.xy);\n\tfloat cliph \x3d length(clipMatDir.zw);\n\tvec2 clippos \x3d position.xy - clipMatPos.xy;\t//pos\u5df2\u7ecf\u5e94\u7528\u77e9\u9635\u4e86\uff0c\u4e3a\u4e86\u51cf\u7684\u6709\u610f\u4e49\uff0cclip\u7684\u4f4d\u7f6e\u4e5f\u8981\u7f29\u653e\n\tif(clipw\x3e20000. \x26\x26 cliph\x3e20000.)\n\t\tcliped \x3d vec2(0.5,0.5);\n\telse {\n\t\t//clipdir\u662f\u5e26\u7f29\u653e\u7684\u65b9\u5411\uff0c\u7531\u4e8e\u4e0a\u9762clippos\u662f\u5728\u7f29\u653e\u540e\u7684\u7a7a\u95f4\u8ba1\u7b97\u7684\uff0c\u6240\u4ee5\u9700\u8981\u628a\u65b9\u5411\u5148normalize\u4e00\u4e0b\n\t\tcliped\x3dvec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x \x3d dot(clippos,dirx);\n  color\x3dattribColor/255.;\n}","precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a\x3dvec4(color.r, color.g, color.b, 1);\n\t//a.a*\x3dalpha;\n    gl_FragColor\x3d color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*\x3dcolor.a;\n\tif(cliped.x\x3c0.) discard;\n\tif(cliped.x\x3e1.) discard;\n\tif(cliped.y\x3c0.) discard;\n\tif(cliped.y\x3e1.) discard;\n}",null);Y.preCompile2D(0,512,"attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos\x3dmmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position \x3d vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color \x3d color;\n  v_color.rgb *\x3d v_color.a;\n  v_texcoord \x3d texcoord;  \n}","precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color \x3d texture2D(texture, v_texcoord);\n\tgl_FragColor \x3d t_color.rgba * v_color;\n\tgl_FragColor *\x3d alpha;\n}",null)};return a}(),Ja=function(){function a(b,d,a,c){this._idata=[]}r(a,"laya.layagl.CommandEncoder");var c=a.prototype;c.getArrayData=function(){return this._idata};c.getPtrID=function(){return 0};c.beginEncoding=function(){};c.endEncoding=function(){};c.clearEncoding=function(){this._idata.length=0};c.getCount=function(){return this._idata.length};c.add_ShaderValue=function(b){this._idata.push(b)};c.addShaderUniform=function(b){this.add_ShaderValue(b)};return a}(),Ka=function(){function a(){this.vb=this.ib=null;this.ib=Ia.create(35048);this.vb=Ha.create(8)}r(a,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var c=a.prototype;c.addSkinMesh=function(b){b.getData2(this.vb,this.ib,this.vb._byteLength/32)};c.reset=function(){this.vb.clear();this.ib.clear()};a.getInstance=function(){return a.instance=a.instance||new a};a.instance=null;return a}(),La=function(){function a(b){this.childs=[];this.text="";this.name=this.parent=null;this.noCompile=!1;this.condition=this.includefiles=null;this.conditionType=0;this.useFuns="";this.z=0;this.src=null;this.includefiles=b}r(a,"laya.webgl.utils.ShaderNode");var c=a.prototype;c.setParent=function(b){b.childs.push(this);this.z=b.z+1;this.parent=b};c.setCondition=function(b,d){b&&(this.conditionType=d,b=b.replace(/(\s*$)/g,""),this.condition=function(){return this[b]},this.condition.__condition=b)};c.toscript=function(b,d){return this._toscript(b,d,++a.__id)};c._toscript=function(b,d,a){if(1>this.childs.length&&!this.text)return d;if(this.condition){var e=!!this.condition.call(b);2===this.conditionType&&(e=!e);if(!e)return d}this.text&&d.push(this.text);0<this.childs.length&&this.childs.forEach(function(e,c,f){e._toscript(b,d,a)});if(0<this.includefiles.length&&0<this.useFuns.length)for(var c=0,h=this.includefiles.length;c<h;c++)this.includefiles[c].curUseID!=a&&(e=this.includefiles[c].file.getFunsScript(this.useFuns),0<e.length&&(this.includefiles[c].curUseID=a,d[0]=e+d[0]));return d};a.__id=1;return a}(),B=function(){function a(b){this.clipInfoID=-1;this._blendFn=this._mesh=null;this._renderType=this._id=0;this._parent=null;this._numEle=this._startIdx=0;this._ref=1;this.shaderValue=null;this._key=new ta;void 0===b&&(b=1E4);this._renderType=b;this._id=++a.ID}r(a,"laya.webgl.submit.Submit");var c=a.prototype;E.imps(c,{"laya.webgl.submit.ISubmit":!0});c.getID=function(){return this._id};c.releaseRender=function(){a.RENDERBASE!=this&&1>--this._ref&&(a.POOL[a._poolSize++]=this,this.shaderValue.release(),this._mesh=this.shaderValue=null,this._parent&&(this._parent.releaseRender(),this._parent=null))};c.getRenderType=function(){return this._renderType};c.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var b=this.shaderValue.textureHost;if(b){b=b._getSource();if(!b)return 1;this.shaderValue.texture=b}b=z.mainContext;this._mesh.useMesh(b);this.shaderValue.upload();L.activeBlendFunction!==this._blendFn&&(v.setBlend(b,!0),this._blendFn(b),L.activeBlendFunction=this._blendFn);b.drawElements(4,this._numEle,5123,this._startIdx);K.renderBatches++;K.trianglesFaces+=this._numEle/3;return 1};c._cloneInit=function(b,d,a,c){b._ref=1;b._mesh=a;b._id=this._id;b._key.copyFrom(this._key);b._parent=this;b._blendFn=this._blendFn;b._renderType=this._renderType;b._startIdx=c*Z.BYTES_PIDX;b._numEle=this._numEle;b.shaderValue=this.shaderValue;this.shaderValue.ref++;this._ref++};c.clone=function(b,d,a){return null};c.reUse=function(b,d){return 0};c.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key\x3d"+this._key};a.__init__=function(){var b=a.RENDERBASE=new a(-1);b.shaderValue=new O(0,0);b.shaderValue.ALPHA=1;b._ref=4294967295};a.create=function(b,d,e){var c=a._poolSize?a.POOL[--a._poolSize]:new a;c._ref=1;c._mesh=d;c._key.clear();c._startIdx=d.indexNum*Z.BYTES_PIDX;c._numEle=0;d=b._nBlendType;c._blendFn=b._targets?L.targetFns[d]:L.fns[d];c.shaderValue=e;c.shaderValue.setValue(b._shader2D);(b=b._shader2D.filters)&&c.shaderValue.setFilters(b);return c};a.createShape=function(b,d,e,c){var f=a._poolSize?a.POOL[--a._poolSize]:new a;f._mesh=d;f._numEle=e;f._startIdx=2*d.indexNum;f._ref=1;f.shaderValue=c;f.shaderValue.setValue(b._shader2D);d=b._nBlendType;f._key.blendShader=d;f._blendFn=b._targets?L.targetFns[d]:L.fns[d];return f};a.TYPE_2D=1E4;a.TYPE_CANVAS=10003;a.TYPE_CMDSETRT=10004;a.TYPE_CUSTOM=10005;a.TYPE_BLURRT=10006;a.TYPE_CMDDESTORYPRERT=10007;a.TYPE_DISABLESTENCIL=10008;a.TYPE_OTHERIBVB=10009;a.TYPE_PRIMITIVE=10010;a.TYPE_RT=10011;a.TYPE_BLUR_RT=10012;a.TYPE_TARGET=10013;a.TYPE_CHANGE_VALUE=10014;a.TYPE_SHAPE=10015;a.TYPE_TEXTURE=10016;a.TYPE_FILLTEXTURE=10017;a.KEY_ONCE=-1;a.KEY_FILLRECT=1;a.KEY_DRAWTEXTURE=2;a.KEY_VG=3;a.KEY_TRIANGLES=4;a.RENDERBASE=null;a.ID=1;a.preRender=null;a._poolSize=0;a.POOL=[];return a}(),ua=function(){function a(){this._matrix=new F}r(a,"laya.webgl.canvas.save.SaveTransform");var c=a.prototype;E.imps(c,{"laya.webgl.canvas.save.ISaveData":!0});c.isSaveMark=function(){return!1};c.restore=function(b){b._curMat=this._savematrix;a.POOL[a.POOL._length++]=this};a.save=function(b){var d=b._saveMark;2048!==(d._saveuse&2048)&&(d._saveuse|=2048,d=a.POOL,d=0<d._length?d[--d._length]:new a,d._savematrix=b._curMat,b._curMat=b._curMat.copyTo(d._matrix),b=b._save,b[b._length++]=d)};a.POOL=Q._createArray();return a}(),ab=function(){function a(){}r(a,"laya.webgl.shapes.BasePoly");a.createLine2=function(c,b,d,e,f,g){if(4>c.length)return null;var h=a.tempData.length>c.length+2?a.tempData:Array(c.length+2);h[0]=c[0];h[1]=c[1];var l=2,k,m=c.length;for(k=2;k<m;k+=2).01<Math.abs(c[k]-c[k-2])+Math.abs(c[k+1]-c[k-1])&&(h[l++]=c[k],h[l++]=c[k+1]);g&&.01<Math.abs(c[0]-h[l-2])+Math.abs(c[1]-h[l-1])&&(h[l++]=c[0],h[l++]=c[1]);m=l/2;c=d/2;var p,n,q,x,C,t,r,v,u,y,w;q=h[0];x=h[1];d=h[2];g=h[3];p=-(x-g);n=q-d;u=Math.sqrt(p*p+n*n);p=p/u*c;n=n/u*c;f.push(q-p,x-n,q+p,x+n);for(k=1;k<m-1;k++)q=h[2*(k-1)],x=h[2*(k-1)+1],d=h[2*k],g=h[2*k+1],C=h[2*(k+1)],t=h[2*(k+1)+1],p=-(x-g),n=q-d,u=Math.sqrt(p*p+n*n),p=p/u*c,n=n/u*c,r=-(g-t),v=d-C,u=Math.sqrt(r*r+v*v),r=r/u*c,v=v/u*c,u=-n+x-(-n+g),y=-p+d-(-p+q),q=(-p+q)*(-n+g)-(-p+d)*(-n+x),x=-v+t-(-v+g),w=-r+d-(-r+C),C=(-r+C)*(-v+g)-(-r+d)*(-v+t),t=u*w-x*y,.1>Math.abs(t)?f.push(d-p,g-n,d+p,g+n):(p=(y*C-w*q)/t,n=(x*q-u*C)/t,f.push(p,n,d-(p-d),g-(n-g)));q=h[l-4];x=h[l-3];d=h[l-2];g=h[l-1];p=-(x-g);n=q-d;u=Math.sqrt(p*p+n*n);p=p/u*c;n=n/u*c;f.push(d-p,g-n,d+p,g+n);for(k=1;k<m;k++)b.push(e+2*(k-1),e+2*(k-1)+1,e+2*k+1,e+2*k+1,e+2*k,e+2*(k-1));return f};a.createLineTriangle=function(a,b,d,e,f,g,h){a=a.slice();b=a.length;d=a[0];f=a[1];var c,k,m=c=g=0;h=b/2;if(!(1>=h)&&2!=h){for(var p=Array(4*h),n=0,q=0,x=0;x<h-1;x++)d=a[q++],f=a[q++],c=a[q++],k=a[q++],c-=d,m=k-f,0!=c&&0!=m&&(g=Math.sqrt(c*c+m*m),.001<g&&(k=4*n,p[k]=d,p[k+1]=f,p[k+2]=c/g,p[k+3]=m/g,n++));e?(d=a[b-2],f=a[b-1],c=a[0],k=a[1],c-=d,m=k-f,0!=c&&0!=m&&(g=Math.sqrt(c*c+m*m),.001<g&&(k=4*n,p[k]=d,p[k+1]=f,p[k+2]=c/g,p[k+3]=m/g))):(k=4*n,p[k]=d,p[k+1]=f,p[k+2]=c/g,p[k+3]=m/g);for(x=0;x<h;x++);}};N(a,["tempData",function(){return this.tempData=Array(256)}]);return a}(),bb=function(){function a(){this._clipInfoID=-1;this._globalClipMatrix=new F;this._clipRect=new ga}r(a,"laya.webgl.canvas.save.SaveClipRect");var c=a.prototype;E.imps(c,{"laya.webgl.canvas.save.ISaveData":!0});c.isSaveMark=function(){return!1};c.restore=function(b){this._globalClipMatrix.copyTo(b._globalClipMatrix);this._clipRect.clone(b._clipRect);b._clipInfoID=this._clipInfoID;a.POOL[a.POOL._length++]=this};a.save=function(b){if(131072!=(b._saveMark._saveuse&131072)){b._saveMark._saveuse|=131072;var d=a.POOL,d=0<d._length?d[--d._length]:new a;b._globalClipMatrix.copyTo(d._globalClipMatrix);b._clipRect.clone(d._clipRect);d._clipInfoID=b._clipInfoID;b=b._save;b[b._length++]=d}};a.POOL=Q._createArray();return a}(),Ma=function(){function a(){}r(a,"laya.webgl.resource.ICharRender");var c=a.prototype;c.getWidth=function(b,d){return 0};c.scale=function(b,d){};c.getCharBmp=function(b,d,a,c,g,h,l,k,m,p,n){return null};A(0,c,"canvasWidth",function(){return 0},function(b){});return a}(),cb=function(){function a(){this._data=[];this._ndata=0;this._tex=null;this._imgId=0;this._clipid=-1;this._enbale=!1;this._colorFiler=null;this._clipMatrix=new F}r(a,"laya.webgl.text.CharSubmitCache");var c=a.prototype;c.clear=function(){this._tex=null;this._imgId=-1;this._ndata=0;this._enbale=!1;this._colorFiler=null};c.destroy=function(){this.clear();this._data.length=0;this._data=null};c.add=function(b,d,a,c,g,h){0<this._ndata&&(this._tex!=d||this._imgId!=a||0<=this._clipid&&this._clipid!=b._clipInfoID)&&this.submit(b);this._clipid=b._clipInfoID;b._globalClipMatrix.copyTo(this._clipMatrix);this._tex=d;this._imgId=a;this._colorFiler=b._colorFiler;this._data[this._ndata]=c;this._data[this._ndata+1]=g;this._data[this._ndata+2]=h;this._ndata+=3};c.getPos=function(){return 0==a.__nPosPool?Array(8):a.__posPool[--a.__nPosPool]};c.enable=function(b,d){b!==this._enbale&&((this._enbale=b)||this.submit(d))};c.submit=function(b){var d=this._ndata;if(d){var c=b._mesh,f=b._colorFiler;b._colorFiler=this._colorFiler;var g=ca.create(b,c,O.create(1,0));b._submits[b._submits._length++]=b._curSubmit=g;g.shaderValue.textureHost=this._tex;g._key.other=this._imgId;b._colorFiler=f;b._copyClipInfo(g,this._clipMatrix);g.clipInfoID=this._clipid;for(f=0;f<d;f+=3)c.addQuad(this._data[f],this._data[f+1],this._data[f+2],!0),a.__posPool[a.__nPosPool++]=this._data[f];d/=3;g._numEle+=6*d;c.indexNum+=6*d;c.vertNum+=4*d;b._drawCount+=d;this._ndata=0;0==K.loopCount%100&&(this._data.length=0)}};a.__posPool=[];a.__nPosPool=0;return a}(),db=function(){function a(){this._bindedIndexBuffer=this._nativeVertexArrayObject=null;this._nativeVertexArrayObject=y.instance.createVertexArray()}r(a,"laya.webgl.BufferStateBase");var c=a.prototype;c.bind=function(){a._curBindedBufferState!==this&&(y.instance.bindVertexArray(this._nativeVertexArrayObject),a._curBindedBufferState=this)};c.unBind=function(){if(a._curBindedBufferState===this)y.instance.bindVertexArray(null),a._curBindedBufferState=null;else throw"BufferState: must call bind() function first.";};c.bindForNative=function(){y.instance.bindVertexArray(this._nativeVertexArrayObject);a._curBindedBufferState=this};c.unBindForNative=function(){y.instance.bindVertexArray(null);a._curBindedBufferState=null};c.destroy=function(){y.instance.deleteVertexArray(this._nativeVertexArrayObject)};a._curBindedBufferState=null;return a}();(function(){function a(){this._repaint=this._renderType=0;this._y=this._x=NaN}r(a,"laya.layagl.QuickTestTool");var c=a.prototype;c.render=function(b,d,c){a._addType(this._renderType);a.showRenderTypeInfo(this._renderType);pa.renders[this._renderType]._fun(this,b,d+this._x,c+this._y);this._repaint=0};c._stageRender=function(b,d,c){a._countStart();a._PreStageRender.call(E.stage,b,d,c);a._countEnd()};a.getMCDName=function(b){return a._typeToNameDic[b]};a.showRenderTypeInfo=function(b,d){void 0===d&&(d=!1);if(d||!a.showedDic[b]){a.showedDic[b]=!0;if(!a._rendertypeToStrDic[b]){var c=[],f;for(f=1;f<=b;)f&b&&c.push(a.getMCDName(f&b)),f<<=1;a._rendertypeToStrDic[b]=c.join(",")}console.log("cmd:",a._rendertypeToStrDic[b])}};a.__init__=function(){a._typeToNameDic[1]="ALPHA";a._typeToNameDic[2]="TRANSFORM";a._typeToNameDic[256]="TEXTURE";a._typeToNameDic[512]="GRAPHICS";a._typeToNameDic[4096]="ONECHILD";a._typeToNameDic[8192]="CHILDS";a._typeToNameDic[3]="TRANSFORM|ALPHA";a._typeToNameDic[8]="CANVAS";a._typeToNameDic[4]="BLEND";a._typeToNameDic[16]="FILTERS";a._typeToNameDic[32]="MASK";a._typeToNameDic[64]="CLIP";a._typeToNameDic[1024]="LAYAGL3D"};a._countStart=function(){for(var b in a._countDic)a._countDic[b]=0};a._countEnd=function(){a._i++;60<a._i&&(a.showCountInfo(),a._i=0)};a._addType=function(b){a._countDic[b]=a._countDic[b]?a._countDic[b]+1:1};a.showCountInfo=function(){console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");for(var b in a._countDic)console.log("count:"+a._countDic[b]),a.showRenderTypeInfo(b,!0)};a.enableQuickTest=function(){a.__init__();Fa.prototype.render=a.prototype.render;a._PreStageRender=qa.prototype.render;qa.prototype.render=a.prototype._stageRender};a.showedDic={};a._rendertypeToStrDic={};a._typeToNameDic={};a._PreStageRender=null;a._countDic={};a._i=0;return a})();(function(){function a(){}r(a,"laya.webgl.text.ArabicReshaper");var c=a.prototype;c.characterMapContains=function(b){for(var d=0;d<a.charsMap.length;++d)if(a.charsMap[d][0]===b)return!0;return!1};c.getCharRep=function(b){for(var d=0;d<a.charsMap.length;++d)if(a.charsMap[d][0]===b)return a.charsMap[d];return!1};c.getCombCharRep=function(b,d){for(var c=0;c<a.combCharsMap.length;++c)if(a.combCharsMap[c][0][0]===b&&a.combCharsMap[c][0][1]===d)return a.combCharsMap[c];return!1};c.isTransparent=function(b){for(var d=0;d<a.transChars.length;++d)if(a.transChars[d]===b)return!0;return!1};c.getOriginalCharsFromCode=function(b){var d;for(d=0;d<a.charsMap.length;++d)if(-1<a.charsMap[d].indexOf(b))return String.fromCharCode(a.charsMap[d][0]);for(d=0;d<a.combCharsMap.length;++d)if(-1<a.combCharsMap[d].indexOf(b))return String.fromCharCode(a.combCharsMap[d][0][0])+String.fromCharCode(a.combCharsMap[d][0][1]);return String.fromCharCode(b)};c.convertArabic=function(b){for(var d,a,c="",g=0;g<b.length;++g)if(a=b.charCodeAt(g),this.characterMapContains(a)){var h,l;h=g-1;for(l=g+1;0<=h&&this.isTransparent(b.charCodeAt(h));--h);d=(h=0<=h?b.charCodeAt(h):null)?this.getCharRep(h):!1;if(!d||null==d[2]&&null==d[3])h=null;for(;l<b.length&&this.isTransparent(b.charCodeAt(l));++l);d=(l=l<b.length?b.charCodeAt(l):null)?this.getCharRep(l):!1;if(!d||null==d[3]&&null==d[4])l=null;1604!==a||null==l||1570!==l&&1571!==l&&1573!==l&&1575!==l?(d=this.getCharRep(a),c=null!=h&&null!=l&&null!=d[3]?c+String.fromCharCode(d[3]):null!=h&&null!=d[4]?c+String.fromCharCode(d[4]):null!=l&&null!=d[2]?c+String.fromCharCode(d[2]):c+String.fromCharCode(d[1])):(a=this.getCombCharRep(a,l),c=null!=h?c+String.fromCharCode(a[4]):c+String.fromCharCode(a[1]),++g)}else c+=String.fromCharCode(a);return c};c.convertArabicBack=function(b){var d="",a,c;c=0;for(;c<b.length;++c)a=b.charCodeAt(c),d+=this.getOriginalCharsFromCode(a);return d};N(a,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}]);return a})();var v=function(){function a(){}r(a,"laya.webgl.WebGLContext");var c=a.prototype;c.getContextAttributes=function(){return null};c.isContextLost=function(){};c.getSupportedExtensions=function(){return null};c.getExtension=function(b){return null};c.activeTexture=function(b){};c.attachShader=function(b,d){};c.bindAttribLocation=function(b,d,a){};c.bindBuffer=function(b,d){};c.bindFramebuffer=function(b,d){};c.bindRenderbuffer=function(b,d){};c.bindTexture=function(b,d){};c.useTexture=function(b){};c.blendColor=function(b,d,a,c){};c.blendEquation=function(b){};c.blendEquationSeparate=function(b,d){};c.blendFunc=function(b,d){};c.blendFuncSeparate=function(b,d,a,c){};c.bufferData=function(b,d,a){};c.bufferSubData=function(b,d,a){};c.checkFramebufferStatus=function(b){return null};c.clear=function(b){};c.clearColor=function(b,d,a,c){};c.clearDepth=function(b){};c.clearStencil=function(b){};c.colorMask=function(b,d,a,c){};c.compileShader=function(b){};c.copyTexImage2D=function(b,d,a,c,g,h,l,k){};c.copyTexSubImage2D=function(b,d,a,c,g,h,l,k){};c.createBuffer=function(){};c.createFramebuffer=function(){};c.createProgram=function(){};c.createRenderbuffer=function(){};c.createShader=function(b){};c.createTexture=function(){return null};c.cullFace=function(b){};c.deleteBuffer=function(b){};c.deleteFramebuffer=function(b){};c.deleteProgram=function(b){};c.deleteRenderbuffer=function(b){};c.deleteShader=function(b){};c.deleteTexture=function(b){};c.depthFunc=function(b){};c.depthMask=function(b){};c.depthRange=function(b,d){};c.detachShader=function(b,d){};c.disable=function(b){};c.disableVertexAttribArray=function(b){};c.drawArrays=function(b,d,a){};c.drawElements=function(b,d,a,c){};c.enable=function(b){};c.enableVertexAttribArray=function(b){};c.finish=function(){};c.flush=function(){};c.framebufferRenderbuffer=function(b,d,a,c){};c.framebufferTexture2D=function(b,d,a,c,g){};c.frontFace=function(b){return null};c.generateMipmap=function(b){return null};c.getActiveAttrib=function(b,d){return null};c.getActiveUniform=function(b,d){return null};c.getAttribLocation=function(b,d){return 0};c.getParameter=function(b){return null};c.getBufferParameter=function(b,d){return null};c.getError=function(){return null};c.getFramebufferAttachmentParameter=function(b,d,a){};c.getProgramParameter=function(b,d){return 0};c.getProgramInfoLog=function(b){return null};c.getRenderbufferParameter=function(b,d){return null};c.getShaderPrecisionFormat=function(b){return null};c.getShaderParameter=function(b,d){};c.getShaderInfoLog=function(b){return null};c.getShaderSource=function(b){return null};c.getTexParameter=function(b,d){};c.getUniform=function(b,d){};c.getUniformLocation=function(b,d){return null};c.getVertexAttrib=function(b,d){return null};c.getVertexAttribOffset=function(b,d){return null};c.hint=function(b,d){};c.isBuffer=function(b){};c.isEnabled=function(b){};c.isFramebuffer=function(b){};c.isProgram=function(b){};c.isRenderbuffer=function(b){};c.isShader=function(b){};c.isTexture=function(b){};c.lineWidth=function(b){};c.linkProgram=function(b){};c.pixelStorei=function(b,d){};c.polygonOffset=function(b,d){};c.readPixels=function(b,d,a,c,g,h,l){};c.renderbufferStorage=function(b,d,a,c){};c.sampleCoverage=function(b,d){};c.scissor=function(b,d,a,c){};c.shaderSource=function(b,d){};c.stencilFunc=function(b,d,a){};c.stencilFuncSeparate=function(b,d,a,c){};c.stencilMask=function(b){};c.stencilMaskSeparate=function(b,d){};c.stencilOp=function(b,d,a){};c.stencilOpSeparate=function(b,d,a,c){};c.texImage2D=function(b){};c.texParameterf=function(b,d,a){};c.texParameteri=function(b,d,a){};c.texSubImage2D=function(b){};c.uniform1f=function(b,d){};c.uniform1fv=function(b,d){};c.uniform1i=function(b,d){};c.uniform1iv=function(b,d){};c.uniform2f=function(b,d,a){};c.uniform2fv=function(b,d){};c.uniform2i=function(b,d,a){};c.uniform2iv=function(b,d){};c.uniform3f=function(b,d,a,c){};c.uniform3fv=function(b,d){};c.uniform3i=function(b,d,a,c){};c.uniform3iv=function(b,d){};c.uniform4f=function(b,d,a,c,g){};c.uniform4fv=function(b,d){};c.uniform4i=function(b,d,a,c,g){};c.uniform4iv=function(b,d){};c.uniformMatrix2fv=function(b,d,a){};c.uniformMatrix3fv=function(b,d,a){};c.uniformMatrix4fv=function(b,d,a){};c.useProgram=function(b){};c.validateProgram=function(b){};c.vertexAttrib1f=function(b,d){};c.vertexAttrib1fv=function(b,d){};c.vertexAttrib2f=function(b,d,a){};c.vertexAttrib2fv=function(b,d){};c.vertexAttrib3f=function(b,d,a,c){};c.vertexAttrib3fv=function(b,d){};c.vertexAttrib4f=function(b,d,a,c,g){};c.vertexAttrib4fv=function(b,d){};c.vertexAttribPointer=function(b,d,a,c,g,h){};c.viewport=function(b,d,a,c){};c.configureBackBuffer=function(b,d,a,c,g){};c.compressedTexImage2D=function(b){};c.createVertexArray=function(){throw"not implemented";};c.bindVertexArray=function(b){throw"not implemented";};c.deleteVertexArray=function(b){throw"not implemented";};c.isVertexArray=function(b){throw"not implemented";};a.__init__=function(b){laya.webgl.WebGLContext._checkExtensions(b);if(!z._isWebGL2&&!D.isConchApp){eb;J._setupVertexArrayObject&&(M.onMiniGame&&M.onIOS||M.onBDMiniGame||M.onLimixiu?J._forceSetupVertexArrayObject(b):J._setupVertexArrayObject(b));var d=(b.rawgl||b).getExtension("OES_vertex_array_object");d&&(console.log("EXT:webgl support OES_vertex_array_object\uff01"),b.createVertexArray=function(){return d.createVertexArrayOES()},b.bindVertexArray=function(b){d.bindVertexArrayOES(b)},b.deleteVertexArray=function(b){d.deleteVertexArrayOES(b)},b.isVertexArray=function(b){d.isVertexArrayOES(b)})}};a._getExtension=function(b,d){var c=a._extentionVendorPrefixes,f;for(f in c){var g=b.getExtension(c[f]+d);if(g)return g}return null};a._checkExtensions=function(b){a._extTextureFilterAnisotropic=a._getExtension(b,"EXT_texture_filter_anisotropic");a._compressedTextureS3tc=a._getExtension(b,"WEBGL_compressed_texture_s3tc");a._compressedTexturePvrtc=a._getExtension(b,"WEBGL_compressed_texture_pvrtc");a._compressedTextureEtc1=a._getExtension(b,"WEBGL_compressed_texture_etc1");a._angleInstancedArrays=a._getExtension(b,"ANGLE_instanced_arrays")};a.__init_native=function(){D.supportWebGLPlusRendering&&(a.activeTexture=a.activeTextureForNative,a.bindTexture=a.bindTextureForNative)};a.useProgram=function(b,d){if(a._useProgram===d)return!1;b.useProgram(d);a._useProgram=d;return!0};a.setDepthTest=function(b,d){d!==a._depthTest&&(a._depthTest=d,d?b.enable(2929):b.disable(2929))};a.setDepthMask=function(b,d){d!==a._depthMask&&(a._depthMask=d,b.depthMask(d))};a.setDepthFunc=function(b,d){d!==a._depthFunc&&(a._depthFunc=d,b.depthFunc(d))};a.setBlend=function(b,d){d!==a._blend&&(a._blend=d,d?b.enable(3042):b.disable(3042))};a.setBlendFunc=function(b,d,c){d===a._sFactor&&c===a._dFactor||(a._sFactor=a._srcAlpha=d,a._dFactor=a._dstAlpha=c,b.blendFunc(d,c))};a.setBlendFuncSeperate=function(b,d,c,f,g){if(d!==a._sFactor||c!==a._dFactor||f!==a._srcAlpha||g!==a._dstAlpha)a._sFactor=d,a._dFactor=c,a._srcAlpha=f,a._dstAlpha=g,b.blendFuncSeparate(d,c,f,g)};a.setCullFace=function(b,d){d!==a._cullFace&&(a._cullFace=d,d?b.enable(2884):b.disable(2884))};a.setFrontFace=function(b,d){d!==a._frontFace&&(a._frontFace=d,b.frontFace(d))};a.activeTexture=function(b,d){a._activedTextureID!==d&&(b.activeTexture(d),a._activedTextureID=d)};a.bindTexture=function(b,d,c){a._activeTextures[a._activedTextureID-33984]!==c&&(b.bindTexture(d,c),a._activeTextures[a._activedTextureID-33984]=c)};a.useProgramForNative=function(b,d){b.useProgram(d);return!0};a.setDepthTestForNative=function(b,d){d?b.enable(2929):b.disable(2929)};a.setDepthMaskForNative=function(b,d){b.depthMask(d)};a.setDepthFuncForNative=function(b,d){b.depthFunc(d)};a.setBlendForNative=function(b,d){d?b.enable(3042):b.disable(3042)};a.setBlendFuncForNative=function(b,d,a){b.blendFunc(d,a)};a.setCullFaceForNative=function(b,d){d?b.enable(2884):b.disable(2884)};a.setFrontFaceForNative=function(b,d){b.frontFace(d)};a.activeTextureForNative=function(b,d){b.activeTexture(d)};a.bindTextureForNative=function(b,d,a){b.bindTexture(d,a)};a.bindVertexArrayForNative=function(b,d){b.bindVertexArray(d)};a.DEPTH_BUFFER_BIT=256;a.STENCIL_BUFFER_BIT=1024;a.COLOR_BUFFER_BIT=16384;a.POINTS=0;a.LINES=1;a.LINE_LOOP=2;a.LINE_STRIP=3;a.TRIANGLES=4;a.TRIANGLE_STRIP=5;a.TRIANGLE_FAN=6;a.ZERO=0;a.ONE=1;a.SRC_COLOR=768;a.ONE_MINUS_SRC_COLOR=769;a.SRC_ALPHA=770;a.ONE_MINUS_SRC_ALPHA=771;a.DST_ALPHA=772;a.ONE_MINUS_DST_ALPHA=773;a.DST_COLOR=774;a.ONE_MINUS_DST_COLOR=775;a.SRC_ALPHA_SATURATE=776;a.FUNC_ADD=32774;a.BLEND_EQUATION=32777;a.BLEND_EQUATION_RGB=32777;a.BLEND_EQUATION_ALPHA=34877;a.FUNC_SUBTRACT=32778;a.FUNC_REVERSE_SUBTRACT=32779;a.BLEND_DST_RGB=32968;a.BLEND_SRC_RGB=32969;a.BLEND_DST_ALPHA=32970;a.BLEND_SRC_ALPHA=32971;a.CONSTANT_COLOR=32769;a.ONE_MINUS_CONSTANT_COLOR=32770;a.CONSTANT_ALPHA=32771;a.ONE_MINUS_CONSTANT_ALPHA=32772;a.BLEND_COLOR=32773;a.ARRAY_BUFFER=34962;a.ELEMENT_ARRAY_BUFFER=34963;a.ARRAY_BUFFER_BINDING=34964;a.ELEMENT_ARRAY_BUFFER_BINDING=34965;a.STREAM_DRAW=35040;a.STATIC_DRAW=35044;a.DYNAMIC_DRAW=35048;a.BUFFER_SIZE=34660;a.BUFFER_USAGE=34661;a.CURRENT_VERTEX_ATTRIB=34342;a.FRONT=1028;a.BACK=1029;a.CULL_FACE=2884;a.FRONT_AND_BACK=1032;a.BLEND=3042;a.DITHER=3024;a.STENCIL_TEST=2960;a.DEPTH_TEST=2929;a.SCISSOR_TEST=3089;a.POLYGON_OFFSET_FILL=32823;a.SAMPLE_ALPHA_TO_COVERAGE=32926;a.SAMPLE_COVERAGE=32928;a.NO_ERROR=0;a.INVALID_ENUM=1280;a.INVALID_VALUE=1281;a.INVALID_OPERATION=1282;a.OUT_OF_MEMORY=1285;a.CW=2304;a.CCW=2305;a.LINE_WIDTH=2849;a.ALIASED_POINT_SIZE_RANGE=33901;a.ALIASED_LINE_WIDTH_RANGE=33902;a.CULL_FACE_MODE=2885;a.FRONT_FACE=2886;a.DEPTH_RANGE=2928;a.DEPTH_WRITEMASK=2930;a.DEPTH_CLEAR_VALUE=2931;a.DEPTH_FUNC=2932;a.STENCIL_CLEAR_VALUE=2961;a.STENCIL_FUNC=2962;a.STENCIL_FAIL=2964;a.STENCIL_PASS_DEPTH_FAIL=2965;a.STENCIL_PASS_DEPTH_PASS=2966;a.STENCIL_REF=2967;a.STENCIL_VALUE_MASK=2963;a.STENCIL_WRITEMASK=2968;a.STENCIL_BACK_FUNC=34816;a.STENCIL_BACK_FAIL=34817;a.STENCIL_BACK_PASS_DEPTH_FAIL=34818;a.STENCIL_BACK_PASS_DEPTH_PASS=34819;a.STENCIL_BACK_REF=36003;a.STENCIL_BACK_VALUE_MASK=36004;a.STENCIL_BACK_WRITEMASK=36005;a.VIEWPORT=2978;a.SCISSOR_BOX=3088;a.COLOR_CLEAR_VALUE=3106;a.COLOR_WRITEMASK=3107;a.UNPACK_ALIGNMENT=3317;a.PACK_ALIGNMENT=3333;a.MAX_TEXTURE_SIZE=3379;a.MAX_VIEWPORT_DIMS=3386;a.SUBPIXEL_BITS=3408;a.RED_BITS=3410;a.GREEN_BITS=3411;a.BLUE_BITS=3412;a.ALPHA_BITS=3413;a.DEPTH_BITS=3414;a.STENCIL_BITS=3415;a.POLYGON_OFFSET_UNITS=10752;a.POLYGON_OFFSET_FACTOR=32824;a.TEXTURE_BINDING_2D=32873;a.SAMPLE_BUFFERS=32936;a.SAMPLES=32937;a.SAMPLE_COVERAGE_VALUE=32938;a.SAMPLE_COVERAGE_INVERT=32939;a.NUM_COMPRESSED_TEXTURE_FORMATS=34466;a.COMPRESSED_TEXTURE_FORMATS=34467;a.DONT_CARE=4352;a.FASTEST=4353;a.NICEST=4354;a.GENERATE_MIPMAP_HINT=33170;a.BYTE=5120;a.UNSIGNED_BYTE=5121;a.SHORT=5122;a.UNSIGNED_SHORT=5123;a.INT=5124;a.UNSIGNED_INT=5125;a.FLOAT=5126;a.DEPTH_COMPONENT=6402;a.ALPHA=6406;a.RGB=6407;a.RGBA=6408;a.LUMINANCE=6409;a.LUMINANCE_ALPHA=6410;a.UNSIGNED_SHORT_4_4_4_4=32819;a.UNSIGNED_SHORT_5_5_5_1=32820;a.UNSIGNED_SHORT_5_6_5=33635;a.FRAGMENT_SHADER=35632;a.VERTEX_SHADER=35633;a.MAX_VERTEX_ATTRIBS=34921;a.MAX_VERTEX_UNIFORM_VECTORS=36347;a.MAX_VARYING_VECTORS=36348;a.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;a.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;a.MAX_TEXTURE_IMAGE_UNITS=34930;a.MAX_FRAGMENT_UNIFORM_VECTORS=36349;a.SHADER_TYPE=35663;a.DELETE_STATUS=35712;a.LINK_STATUS=35714;a.VALIDATE_STATUS=35715;a.ATTACHED_SHADERS=35717;a.ACTIVE_UNIFORMS=35718;a.ACTIVE_ATTRIBUTES=35721;a.SHADING_LANGUAGE_VERSION=35724;a.CURRENT_PROGRAM=35725;a.NEVER=512;a.LESS=513;a.EQUAL=514;a.LEQUAL=515;a.GREATER=516;a.NOTEQUAL=517;a.GEQUAL=518;a.ALWAYS=519;a.KEEP=7680;a.REPLACE=7681;a.INCR=7682;a.DECR=7683;a.INVERT=5386;a.INCR_WRAP=34055;a.DECR_WRAP=34056;a.VENDOR=7936;a.RENDERER=7937;a.VERSION=7938;a.NEAREST=9728;a.LINEAR=9729;a.NEAREST_MIPMAP_NEAREST=9984;a.LINEAR_MIPMAP_NEAREST=9985;a.NEAREST_MIPMAP_LINEAR=9986;a.LINEAR_MIPMAP_LINEAR=9987;a.TEXTURE_MAG_FILTER=10240;a.TEXTURE_MIN_FILTER=10241;a.TEXTURE_WRAP_S=10242;a.TEXTURE_WRAP_T=10243;a.TEXTURE_2D=3553;a.TEXTURE_3D=32879;a.TEXTURE=5890;a.TEXTURE_CUBE_MAP=34067;a.TEXTURE_BINDING_CUBE_MAP=34068;a.TEXTURE_CUBE_MAP_POSITIVE_X=34069;a.TEXTURE_CUBE_MAP_NEGATIVE_X=34070;a.TEXTURE_CUBE_MAP_POSITIVE_Y=34071;a.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;a.TEXTURE_CUBE_MAP_POSITIVE_Z=34073;a.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;a.MAX_CUBE_MAP_TEXTURE_SIZE=34076;a.TEXTURE0=33984;a.TEXTURE1=33985;a.TEXTURE2=33986;a.TEXTURE3=33987;a.TEXTURE4=33988;a.TEXTURE5=33989;a.TEXTURE6=33990;a.TEXTURE7=33991;a.TEXTURE8=33992;a.TEXTURE9=33993;a.TEXTURE10=33994;a.TEXTURE11=33995;a.TEXTURE12=33996;a.TEXTURE13=33997;a.TEXTURE14=33998;a.TEXTURE15=33999;a.TEXTURE16=34E3;a.TEXTURE17=34001;a.TEXTURE18=34002;a.TEXTURE19=34003;a.TEXTURE20=34004;a.TEXTURE21=34005;a.TEXTURE22=34006;a.TEXTURE23=34007;a.TEXTURE24=34008;a.TEXTURE25=34009;a.TEXTURE26=34010;a.TEXTURE27=34011;a.TEXTURE28=34012;a.TEXTURE29=34013;a.TEXTURE30=34014;a.TEXTURE31=34015;a.ACTIVE_TEXTURE=34016;a.REPEAT=10497;a.CLAMP_TO_EDGE=33071;a.MIRRORED_REPEAT=33648;a.FLOAT_VEC2=35664;a.FLOAT_VEC3=35665;a.FLOAT_VEC4=35666;a.INT_VEC2=35667;a.INT_VEC3=35668;a.INT_VEC4=35669;a.BOOL=35670;a.BOOL_VEC2=35671;a.BOOL_VEC3=35672;a.BOOL_VEC4=35673;a.FLOAT_MAT2=35674;a.FLOAT_MAT3=35675;a.FLOAT_MAT4=35676;a.SAMPLER_2D=35678;a.SAMPLER_CUBE=35680;a.VERTEX_ATTRIB_ARRAY_ENABLED=34338;a.VERTEX_ATTRIB_ARRAY_SIZE=34339;a.VERTEX_ATTRIB_ARRAY_STRIDE=34340;a.VERTEX_ATTRIB_ARRAY_TYPE=34341;a.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;a.VERTEX_ATTRIB_ARRAY_POINTER=34373;a.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;a.COMPILE_STATUS=35713;a.LOW_FLOAT=36336;a.MEDIUM_FLOAT=36337;a.HIGH_FLOAT=36338;a.LOW_INT=36339;a.MEDIUM_INT=36340;a.HIGH_INT=36341;a.FRAMEBUFFER=36160;a.RENDERBUFFER=36161;a.RGBA4=32854;a.RGB5_A1=32855;a.RGB565=36194;a.DEPTH_COMPONENT16=33189;a.STENCIL_INDEX=6401;a.STENCIL_INDEX8=36168;a.DEPTH_STENCIL=34041;a.RENDERBUFFER_WIDTH=36162;a.RENDERBUFFER_HEIGHT=36163;a.RENDERBUFFER_INTERNAL_FORMAT=36164;a.RENDERBUFFER_RED_SIZE=36176;a.RENDERBUFFER_GREEN_SIZE=36177;a.RENDERBUFFER_BLUE_SIZE=36178;a.RENDERBUFFER_ALPHA_SIZE=36179;a.RENDERBUFFER_DEPTH_SIZE=36180;a.RENDERBUFFER_STENCIL_SIZE=36181;a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;a.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;a.COLOR_ATTACHMENT0=36064;a.DEPTH_ATTACHMENT=36096;a.STENCIL_ATTACHMENT=36128;a.DEPTH_STENCIL_ATTACHMENT=33306;a.NONE=0;a.FRAMEBUFFER_COMPLETE=36053;a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;a.FRAMEBUFFER_UNSUPPORTED=36061;a.FRAMEBUFFER_BINDING=36006;a.RENDERBUFFER_BINDING=36007;a.MAX_RENDERBUFFER_SIZE=34024;a.INVALID_FRAMEBUFFER_OPERATION=1286;a.UNPACK_FLIP_Y_WEBGL=37440;a.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;a.CONTEXT_LOST_WEBGL=37442;a.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;a.BROWSER_DEFAULT_WEBGL=37444;a._extTextureFilterAnisotropic=null;a._compressedTextureS3tc=null;a._compressedTexturePvrtc=null;a._compressedTextureEtc1=null;a._angleInstancedArrays=null;a._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991];a._useProgram=null;a._depthTest=!0;a._depthMask=!0;a._blend=!1;a._cullFace=!1;a._activedTextureID=33984;N(a,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_srcAlpha",function(){return this._srcAlpha=1},"_dstAlpha",function(){return this._dstAlpha=0},"_frontFace",function(){return this._frontFace=2305}]);return a}(),W=function(){function a(){this._buffer=this._glBuffer=null;this._byteLength=this._bufferUsage=this._bufferType=0;this._glBuffer=y.instance.createBuffer()}r(a,"laya.webgl.utils.Buffer");var c=a.prototype;c._bindForVAO=function(){};c.bind=function(){return!1};c.destroy=function(){this._glBuffer&&(y.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)};A(0,c,"bufferUsage",function(){return this._bufferUsage});a._bindedVertexBuffer=null;a._bindedIndexBuffer=null;return a}(),fb=function(){function a(b){this.codes={};this.funs={};this.curUseID=-1;this.funnames="";this.script=b;for(var d=0,a,c;;){d=b.indexOf("#begin",d);if(0>d)break;for(c=d+5;;){c=b.indexOf("#end",c);if(0>c)break;if("i"===b.charAt(c+4))c+=5;else break}if(0>c)throw"add include err,no #end:"+b;a=b.indexOf("\n",d);var g=ja.splitToWords(b.substr(d,a-d),null);"code"==g[1]?this.codes[g[2]]=b.substr(a+1,c-a-1):"function"==g[1]&&(a=b.indexOf("function",d),a+=8,this.funs[g[3]]=b.substr(a+1,c-a-1),this.funnames+=g[3]+";");d=c+1}}r(a,"laya.webgl.utils.InlcudeFile");var c=a.prototype;c.getWith=function(b){var d=b?this.codes[b]:this.script;if(!d)throw"get with error:"+b;return d};c.getFunsScript=function(b){var d="",a;for(a in this.funs)0<=b.indexOf(a+";")&&(d+=this.funs[a]);return d};return a}(),L=function(){function a(){}r(a,"laya.webgl.canvas.BlendMode");a._init_=function(c){a.fns=[a.BlendNormal,a.BlendAdd,a.BlendMultiply,a.BlendScreen,a.BlendOverlay,a.BlendLight,a.BlendMask,a.BlendDestinationOut];a.targetFns=[a.BlendNormalTarget,a.BlendAddTarget,a.BlendMultiplyTarget,a.BlendScreenTarget,a.BlendOverlayTarget,a.BlendLightTarget,a.BlendMask,a.BlendDestinationOut]};a.BlendNormal=function(a){v.setBlendFunc(a,1,771)};a.BlendAdd=function(a){v.setBlendFunc(a,1,772)};a.BlendMultiply=function(a){v.setBlendFunc(a,774,771)};a.BlendScreen=function(a){v.setBlendFunc(a,1,1)};a.BlendOverlay=function(a){v.setBlendFunc(a,1,769)};a.BlendLight=function(a){v.setBlendFunc(a,1,1)};a.BlendNormalTarget=function(a){v.setBlendFunc(a,1,771)};a.BlendAddTarget=function(a){v.setBlendFunc(a,1,772)};a.BlendMultiplyTarget=function(a){v.setBlendFunc(a,774,771)};a.BlendScreenTarget=function(a){v.setBlendFunc(a,1,1)};a.BlendOverlayTarget=function(a){v.setBlendFunc(a,1,769)};a.BlendLightTarget=function(a){v.setBlendFunc(a,1,1)};a.BlendMask=function(a){v.setBlendFunc(a,0,770)};a.BlendDestinationOut=function(a){v.setBlendFunc(a,0,0)};a.activeBlendFunction=null;a.NAMES="normal add multiply screen overlay light mask destination-out".split(" ");a.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1};a.NORMAL="normal";a.ADD="add";a.MULTIPLY="multiply";a.SCREEN="screen";a.OVERLAY="overlay";a.LIGHT="light";a.MASK="mask";a.DESTINATIONOUT="destination-out";a.LIGHTER="lighter";a.fns=[];a.targetFns=[];return a}(),z=function(){function a(){}r(a,"laya.webgl.WebGL");a._uint8ArraySlice=function(){for(var a=this.length,b=new Uint8Array(this.length),d=0;d<a;d++)b[d]=this[d];return b};a._float32ArraySlice=function(){for(var a=this.length,b=new Float32Array(this.length),d=0;d<a;d++)b[d]=this[d];return b};a._uint16ArraySlice=function(a){var b=arguments,d,c;if(0===b.length)for(d=this.length,c=new Uint16Array(d),b=0;b<d;b++)c[b]=this[b];else if(2===b.length){d=b[0];var f=b[1];if(f>d)for(c=new Uint16Array(f-d),b=d;b<f;b++)c[b-d]=this[b];else c=new Uint16Array(0)}return c};a._nativeRender_enable=function(){a.isNativeRender_enable||(a.isNativeRender_enable=!0,Da.create=function(a,b){var d=new ka(a,b,1,!1,!1);d.wrapModeU=1;d.wrapModeV=1;return d},v.__init_native(),Y.prototype.uploadTexture2D=function(a){var b=v;b.bindTexture(laya.webgl.WebGL.mainContext,b.TEXTURE_2D,a)},u.width=M.window.innerWidth,u.height=M.window.innerHeight,V.measureText=function(a,b){J.conchTextCanvas.font=b;return J.conchTextCanvas.measureText(a)},V.enableNative=function(){D.supportWebGLPlusRendering&&(Na.uploadShaderUniforms=Na.uploadShaderUniformsForNative,Ja=J.GLCommandEncoder,y=J.LayaGLContext);qa.prototype.render=qa.prototype.renderToNative},V.clear=function(a){da.set2DRenderConfig();a=S.create(a).arrColor;var b=y.instance;a&&b.clearColor(a[0],a[1],a[2],a[3]);b.clear(17664);u.clear()},V.drawToCanvas=function(a,b,d,e,f,g){f-=a.x;g-=a.y;f|=0;g|=0;d|=0;e|=0;var c=new oa(!1),l=c.getContext("2d");c.size(d,e);l.asBitmap=!0;l._targets.start();pa.renders[b]._fun(a,l,f,g);l.flush();l._targets.end();l._targets.restore();return c},T.prototype._uv=T.flipyuv,Object.defineProperty(T.prototype,"uv",{get:function(){return this._uv},set:function(a){this._uv=a}}),oa.prototype.getTexture=function(){this._texture||(this._texture=this.context._targets,this._texture.uv=T.flipyuv,this._texture.bitmap=this._texture);return this._texture})};a._webglRender_enable=function(){D.isWebGL||(D.isWebGL=!0,V.initRender=function(c,b,d){var e=y,f=laya.webgl.WebGL,g;a:{g=D._mainCanvas.source;var h,l=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];X.useWebGL2||l.shift();for(var k=0;k<l.length;k++){try{h=g.getContext(l[k],{stencil:X.isStencil,alpha:X.isAlpha,antialias:X.isAntialias,premultipliedAlpha:X.premultipliedAlpha,preserveDrawingBuffer:X.preserveDrawingBuffer})}catch(m){}if(h){"webgl2"===l[k]&&(laya.webgl.WebGL._isWebGL2=!0);new y;g=h;break a}}g=null}e=e.instance=f.mainContext=g;if(!e)return!1;c.size(b,d);v.__init__(e);da.__init__();B.__init__();b=new da;D._context=b;c._setContext(b);laya.webgl.WebGL.shaderHighPrecision=!1;try{e.getShaderPrecisionFormat(35632,36338).precision?a.shaderHighPrecision=!0:a.shaderHighPrecision=!1}catch(m){}y.instance=e;Ua.__init__();ra.__init__();O.__init__();ya.__init__();za.__int__(e);L._init_(e);return!0},Da.create=function(a,b,d){a=new ka(a,b,d,!1,!1);a.wrapModeU=1;a.wrapModeV=1;return a},V.createRenderSprite=function(a,b){return new gb(a,b)},V.changeWebGLSize=function(a,b){laya.webgl.WebGL.onStageResize(a,b)},V.clear=function(a){da.set2DRenderConfig();u.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var b=D.context;(a=0==b._submits._length||X.preserveDrawingBuffer?S.create(a).arrColor:E.stage._wgColor)?b.clearBG(a[0],a[1],a[2],a[3]):b.clearBG(0,0,0,0);u.clear()},V.drawToCanvas=function(a,b,d,e,f,g){f-=a.x;g-=a.y;f|=0;g|=0;d|=0;e|=0;var c=new da;c.size(d,e);c.asBitmap=!0;c._targets.start();pa.renders[b]._fun(a,c,f,g);c.flush();c._targets.end();c._targets.restore();a=c._targets.getData(0,0,d,e);c.destroy();c=new ImageData(d,e);b=4*d;new Uint8Array(b);f=c.data;g=e-1;for(var l=g*b,k=0;0<=g;g--)f.set(a.subarray(k,k+b),l),l-=b,k+=b;a=new oa(!0);a.size(d,e);a.getContext("2d").putImageData(c,0,0);return a},V.getTexturePixels=function(a,b,d,e,f){var c,h=a.bitmap;c=h.width;var l=h.height;b+e>c&&(e-=b+e-c);d+f>l&&(f-=d+f-l);if(0>=e||0>=f)return null;var k=4*e,m=null;try{m=h.getPixels()}catch(q){}if(m){if(0==b&&0==d&&e==c&&f==l)return m;a=new Uint8Array(e*f*4);k=4*c;c=4*b;b=(d+f-1)*k+4*b;for(--f;0<=f;f--)a.set(n.slice(b,b+4*e),c),c+=k,b-=k;return a}h=new da;h.size(e,f);h.asBitmap=!0;var p=null;if(0!=b||0!=d||e!=c||f!=l)p=a.uv.concat(),n=p[0],m=p[1],c=(p[2]-n)/c,l=(p[7]-m)/l,p=[n+b*c,m+d*l,n+(b+e)*c,m+d*l,n+(b+e)*c,m+(d+f)*l,n+b*c,m+(d+f)*l];h._drawTextureM(a,0,0,e,f,null,1,p);h._targets.start();h.flush();h._targets.end();h._targets.restore();var n=h._targets.getData(0,0,e,f);h.destroy();a=new Uint8Array(e*f*4);c=0;b=(f-1)*k;for(--f;0<=f;f--)a.set(n.slice(b,b+k),c),c+=k,b-=k;return a},Sa._filter=function(a,b,d,e){var c=this._next;if(c){var g=a.filters,h=g.length;if(1==h&&32==g[0].type)b.save(),b.setColorFilter(g[0]),c._fun.call(c,a,b,d,e),b.restore();else{var l=O.create(1,0),k,m=fa.TEMP,p=b._curMat,n=F.create();p.copyTo(n);var q=0,x=0;k=!1;var p=null,C=a._cacheStyle.filterCache||null;if(C&&0==a.getRepaint()){if(k=a._cacheStyle.hasGlowFilter||!1)q=50,x=25;k=a.getBounds();if(0>=k.width||0>=k.height)return;k.width+=q;k.height+=q;m.x=k.x*n.a+k.y*n.c;m.y=k.y*n.d+k.x*n.b;k.x=m.x;k.y=m.y;m.x=k.width*n.a+k.height*n.c;m.y=k.height*n.d+k.width*n.b;k.width=m.x;k.height=m.y}else{if(k=a._isHaveGlowFilter())q=50,x=25;k=new ga;k.copyFrom(a.getSelfBounds());k.x+=a.x;k.y+=a.y;k.x-=a.pivotX+4;k.y-=a.pivotY+4;var t=k.x,r=k.y;k.width+=q+8;k.height+=q+8;m.x=k.x*n.a+k.y*n.c;m.y=k.y*n.d+k.x*n.b;k.x=m.x;k.y=m.y;m.x=k.width*n.a+k.height*n.c;m.y=k.height*n.d+k.width*n.b;k.width=m.x;k.height=m.y;if(0>=k.width||0>=k.height)return;C&&ha.releaseRT(C);p=ha.getRT(k.width,k.height);q=C=ha.getRT(k.width,k.height);a._getCacheStyle().filterCache=C;b.pushRT();b.useRT(p);c._fun.call(c,a,b,a.x-t+x,a.y-r+x);b.useRT(q);for(c=0;c<h;c++)switch(0!=c&&(b.useRT(p),b.drawTarget(q,0,0,k.width,k.height,F.TEMP.identity(),l,null,L.TOINT.overlay),b.useRT(q)),t=g[c],t.type){case 16:t._glRender&&t._glRender.render(p,b,k.width,k.height,t);break;case 8:t._glRender&&t._glRender.render(p,b,k.width,k.height,t);break;case 32:b.setColorFilter(t),b.drawTarget(p,0,0,k.width,k.height,F.EMPTY.identity(),O.create(1,0)),b.setColorFilter(null)}b.popRT()}d=d-x-a.x;e=e-x-a.y;m.setTo(d,e);n.transformPoint(m);d=m.x+k.x;e=m.y+k.y;b._drawRenderTexture(C,d,e,k.width,k.height,F.TEMP.identity(),1,T.defuv);p&&(a=U.create([p],function(d){d.destroy()},this),p=null,b.addRenderObject(a));n.destroy()}}},oa.prototype.getTexture=function(){if(!this._texture){var a=new ka;a.loadImageSource(this.source);this._texture=new ea(a)}return this._texture},Float32Array.prototype.slice||(Float32Array.prototype.slice=a._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=a._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=a._uint8ArraySlice))};a.enable=function(){M.__init__();if(!M._supportWebGL)return!1;a._webglRender_enable();D.isConchApp&&a._nativeRender_enable();return!0};a.onStageResize=function(c,b){null!=a.mainContext&&(a.mainContext.viewport(0,0,c,b),u.width=c,u.height=b)};a.mainContext=null;a.shaderHighPrecision=!1;a._isWebGL2=!1;a.isNativeRender_enable=!1;return a}(),Aa=function(){function a(a,b,d){this.steiner=this.nextZ=this.prevZ=this.z=this.next=this.prev=this.y=this.x=this.i=null;this.i=a;this.x=b;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}r(a,"laya.webgl.shapes.EarcutNode");return a}(),hb=function(){function a(a,d){this.submitEndPos=this.submitStartPos=0;this.context=null;this.touches=[];this.submits=[];this._triangleMesh=this._pathMesh=this._mesh=this.sprite=null;this.meshlist=[];this._oldMeshList=this._oldTriMesh=this._oldPathMesh=this._oldMesh=null;this.oldTy=this.oldTx=0;this.cachedClipInfo=new F;this.invMat=new F;this.context=a;this.sprite=d;a._globalClipMatrix.copyTo(this.cachedClipInfo)}r(a,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var c=a.prototype;c.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));this.context._incache=!0;this.touches.length=0;this.context.touches=this.touches;this.context._globalClipMatrix.copyTo(this.cachedClipInfo);this.submits.length=0;this.submitStartPos=this.context._submits._length;for(var a=0,d=this.meshlist.length;a<d;a++){var c=this.meshlist[a];c.canReuse?c.releaseMesh():c.destroy()}this.meshlist.length=0;this._mesh=aa.getAMesh();this._pathMesh=la.getAMesh();this._triangleMesh=va.getAMesh();this.meshlist.push(this._mesh);this.meshlist.push(this._pathMesh);this.meshlist.push(this._triangleMesh);this.context._curSubmit=B.RENDERBASE;this._oldMesh=this.context._mesh;this._oldPathMesh=this.context._pathMesh;this._oldTriMesh=this.context._triangleMesh;this._oldMeshList=this.context.meshlist;this.context._mesh=this._mesh;this.context._pathMesh=this._pathMesh;this.context._triangleMesh=this._triangleMesh;this.context.meshlist=this.meshlist;this.oldTx=this.context._curMat.tx;this.oldTy=this.context._curMat.ty;this.context._curMat.tx=0;this.context._curMat.ty=0;this.context._curMat.copyTo(this.invMat);this.invMat.invert()};c.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var a=this.context._submits;this.submitEndPos=a._length;for(var d=this.submitEndPos-this.submitStartPos,c=0;c<d;c++)this.submits.push(a[this.submitStartPos+c]);a._length-=d;this.context._mesh=this._oldMesh;this.context._pathMesh=this._oldPathMesh;this.context._triangleMesh=this._oldTriMesh;this.context.meshlist=this._oldMeshList;this.context._curSubmit=B.RENDERBASE;this.context._curMat.tx=this.oldTx;this.context._curMat.ty=this.oldTy;this.context.touches=null;this.context._incache=!1};c.isCacheValid=function(){var a=this.context._globalClipMatrix;return a.a!=this.cachedClipInfo.a||a.b!=this.cachedClipInfo.b||a.c!=this.cachedClipInfo.c||a.d!=this.cachedClipInfo.d||a.tx!=this.cachedClipInfo.tx||a.ty!=this.cachedClipInfo.ty?!1:!0};c.flushsubmit=function(){var a=B.RENDERBASE;this.submits.forEach(function(d){d!=B.RENDERBASE&&(B.preRender=a,a=d,d.renderSubmit())})};c.releaseMem=function(){};N(a,["matI",function(){return this.matI=new F}]);return a}(),Oa=function(){function a(){this["char"]="";this.tex=null;this.deleted=!1;this.touchTick=this.oriy=this.orix=this.bmpHeight=this.bmpWidth=this.height=this.width=this.pos=0;this.isSpace=!1;this.uv=Array(8)}r(a,"laya.webgl.resource.CharRenderInfo");a.prototype.touch=function(){var a=K.loopCount;this.touchTick!=a&&this.tex.touchRect(this,a);this.touchTick=a};return a}(),ja=function(){function a(a,d,c,f){function b(d){d=d.replace(e._clearCR,"");var a=[],b=new La(a);e._compileToTree(b,d.split("\n"),0,a,f);return b}this._clearCR=RegExp("\r","g");var e=this,l=M.now();this._VS=b(a);this._PS=b(d);this._nameMap=c;2<M.now()-l&&console.log("ShaderCompile use time:"+(M.now()-l)+"  size:"+a.length+"/"+d.length)}r(a,"laya.webgl.utils.ShaderCompile");var c=a.prototype;c._compileToTree=function(b,d,c,f,g){var e,l,k,m,p,n,q;for(n=c;n<d.length;n++)if(l=d[n],!(1>l.length)&&(e=l.indexOf("//"),0!==e)){0<=e&&(l=l.substr(0,e));c=p||new La(f);p=null;c.text=l;c.noCompile=!0;if(0<=(e=l.indexOf("#"))){k="#";q=e+1;for(m=l.length;q<m;q++){var x=l.charAt(q);if(" "===x||"\t"===x||"?"===x)break;k+=x}c.name=k;switch(k){case "#ifdef":case "#ifndef":c.src=l;c.noCompile=null!=l.match(/[!&|()=<>]/);c.noCompile?console.log("function():Boolean{return "+l.substr(e+c.name.length)+"}"):(m=l.replace(/^\s*/,"").split(/\s+/),c.setCondition(m[1],"#ifdef"===k?1:2),c.text="//"+c.text);c.setParent(b);b=c;if(g)for(m=l.substr(q).split(a._splitToWordExps3),q=0;q<m.length;q++)l=m[q],l.length&&(g[l]=!0);continue;case "#if":c.src=l;c.noCompile=!0;c.setParent(b);b=c;if(g)for(m=l.substr(q).split(a._splitToWordExps3),q=0;q<m.length;q++)l=m[q],l.length&&"defined"!=l&&(g[l]=!0);continue;case "#else":c.src=l;b=b.parent;e=b.childs[b.childs.length-1];c.noCompile=e.noCompile;c.noCompile||(c.condition=e.condition,c.conditionType=1==e.conditionType?2:1,c.text="//"+c.text+" "+e.text+" "+c.conditionType);c.setParent(b);b=c;continue;case "#endif":b=b.parent;e=b.childs[b.childs.length-1];c.noCompile=e.noCompile;c.noCompile||(c.text="//"+c.text);c.setParent(b);continue;case "#include":m=a.splitToWords(l,null);l=a.includes[m[1]];if(!l)throw"ShaderCompile error no this include file:"+m[1];if(0>(e=m[0].indexOf("?"))){c.setParent(b);l=l.getWith("with"==m[2]?m[3]:null);this._compileToTree(c,l.split("\n"),0,f,g);c.text="";continue}c.setCondition(m[0].substr(e+1),1);c.text=l.getWith("with"==m[2]?m[3]:null);break;case "#import":m=a.splitToWords(l,null);l=m[1];f.push({node:c,file:a.includes[l],ofs:c.text.length});continue}}else{if((e=b.childs[b.childs.length-1])&&!e.name){0<f.length&&a.splitToWords(l,e);p=c;e.text+="\n"+l;continue}0<f.length&&a.splitToWords(l,c)}c.setParent(b)}};c.createShader=function(a,d,c,f){var b={},e="";if(a)for(var l in a)e+="#define "+l+"\n",b[l]=!0;a=this._VS.toscript(b,[]);b=this._PS.toscript(b,[]);return(c||Y.create)(e+a.join("\n"),e+b.join("\n"),d,this._nameMap,f)};a._parseOne=function(b,d,c,f,g,h){var e={type:a.shaderParamsMap[c[f+1]],name:c[f+2],size:isNaN(parseInt(c[f+3]))?1:parseInt(c[f+3])};h&&("attribute"==g?b.push(e):d.push(e));":"==c[f+3]&&(e.type=c[f+4],f+=2);return f+2};a.addInclude=function(b,d){if(!d||0===d.length)throw Error("add shader include file err:"+b);if(a.includes[b])throw Error("add shader include file err, has add:"+b);a.includes[b]=new fb(d)};a.preGetParams=function(b,d){var c=[b,d],f={},g=[],h=[],l={},k=[];f.attributes=g;f.uniforms=h;f.defines=l;for(var m,p,n=0;2>n;n++){c[n]=c[n].replace(a._removeAnnotation,"");var q=c[n].match(a._reg),x;m=0;for(p=q.length;m<p;m++){var C=q[m];if("attribute"!=C&&"uniform"!=C)if("#define"==C)C=q[++m],k[C]=1;else{if("#ifdef"==C)for(x=q[++m],l[x]=l[x]||[],m++;m<p;m++)if(C=q[m],"attribute"!=C&&"uniform"!=C){if("#else"==C)for(m++;m<p;m++)if(C=q[m],"attribute"!=C&&"uniform"!=C){if("#endif"==C)break}else m=a._parseOne(g,h,q,m,C,!k[x])}else m=a._parseOne(g,h,q,m,C,k[x])}else m=a._parseOne(g,h,q,m,C,!0)}}return f};a.splitToWords=function(a,d){for(var b=[],c,g=-1,h=0,l=a.length;h<l;h++)if(c=a.charAt(h),0<=" \t\x3d+-*/\x26%!\x3c\x3e()'\",;".indexOf(c)){0<=g&&1<h-g&&(g=a.substr(g,h-g),b.push(g));if('"'==c||"'"==c){c=a.indexOf(c,h+1);if(0>c)throw"Sharder err:"+a;b.push(a.substr(h+1,c-h-1));h=c}else"("==c&&d&&0<b.length&&(g=b[b.length-1]+";",0>"vec4;main;".indexOf(g)&&(d.useFuns+=g));g=-1}else 0>g&&(g=h);g<l&&1<l-g&&(g=a.substr(g,l-g),b.push(g));return b};a.IFDEF_NO=0;a.IFDEF_YES=1;a.IFDEF_ELSE=2;a.IFDEF_PARENT=3;a._removeAnnotation=RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g");a._reg=RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()\x3d\x3c\x3e{}\\\\]+)|([,;:\\\\])","g");a._splitToWordExps=RegExp("[(\".*\")]+|[('.*')]+|([ \\t\x3d\\+\\-*/\x26%!\x3c\x3e!%(),;])","g");a.includes={};N(a,["shaderParamsMap",function(){return this.shaderParamsMap={"float":5126,"int":5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=RegExp("[ \\t\x3d\\+\\-*/\x26%!\x3c\x3e!%(),;\\|]","g")}]);return a}(),wa=function(){function a(a,d,c){this._value=0;this._name2int=a;this._int2name=d;this._int2nameMap=c}r(a,"laya.webgl.shader.ShaderDefinesBase");var c=a.prototype;c.add=function(a){"string"==typeof a&&(a=this._name2int[a]);return this._value|=a};c.addInt=function(a){return this._value|=a};c.remove=function(a){"string"==typeof a&&(a=this._name2int[a]);return this._value&=~a};c.isDefine=function(a){return(this._value&a)===a};c.getValue=function(){return this._value};c.setValue=function(a){this._value=a};c.toNameDic=function(){var b=this._int2nameMap[this._value];return b?b:a._toText(this._value,this._int2name,this._int2nameMap)};a._reg=function(a,d,c,f){c[a]=d;f[d]=a};a._toText=function(a,d,c){var b=c[a];if(b)return b;for(var b={},e,h=0;32>h;h++){e=1<<h;if(e>a)break;a&e&&(e=d[e])&&(b[e]="")}return c[a]=b};a._toInt=function(a,d){for(var b=a.split("."),c=0,g=0,h=b.length;g<h;g++){var l=d[b[g]];if(!l)throw Error("Defines to int err:"+a+"/"+b[g]);c|=l}return c};return a}(),ma=function(){function a(){this.atlasgrid=null;this.protectDist=1;this.texture=null;this.charMaps={};this.texHeight=this.texWidth=P.atlasWidth;this.texture=Ba.getTextTexture(this.texWidth,this.texHeight);256<this.texWidth/a.atlasGridW&&(a.atlasGridW=Math.ceil(this.texWidth/256));this.atlasgrid=new ib(this.texWidth/a.atlasGridW,this.texHeight/a.atlasGridW,this.texture.id)}r(a,"laya.webgl.text.TextAtlas");var c=a.prototype;c.setProtecteDist=function(a){this.protectDist=a};c.getAEmpty=function(b,d,c){if(b=this.atlasgrid.addRect(1,Math.ceil(b/a.atlasGridW),Math.ceil(d/a.atlasGridW),c))c.x*=a.atlasGridW,c.y*=a.atlasGridW;return b};c.destroy=function(){for(var a in this.charMaps)this.charMaps[a].deleted=!0;this.texture.discard()};c.printDebugInfo=function(){};A(0,c,"usedRate",function(){return this.atlasgrid._used});a.atlasGridW=16;return a}(),jb=function(){function a(){this._mesh=null;this._numEle=this._startIdx=0;this.shaderValue=null;this.blendType=0;this._ref=1;this.srcRT=null;this._key=new ta}r(a,"laya.webgl.submit.SubmitTarget");var c=a.prototype;E.imps(c,{"laya.webgl.submit.ISubmit":!0});c.renderSubmit=function(){this._mesh.useMesh(z.mainContext);var a=this.srcRT;a&&(this.shaderValue.texture=a._getSource(),this.shaderValue.upload(),this.blend(),K.renderBatches++,K.trianglesFaces+=this._numEle/3,z.mainContext.drawElements(4,this._numEle,5123,this._startIdx));return 1};c.blend=function(){if(L.activeBlendFunction!==L.fns[this.blendType]){var a=z.mainContext;a.enable(3042);L.fns[this.blendType](a);L.activeBlendFunction=L.fns[this.blendType]}};c.getRenderType=function(){return 0};c.releaseRender=function(){if(1>--this._ref){var b=a.POOL;b[b._length++]=this}};c.reUse=function(a,d){this._startIdx=d;this._ref++;return d};a.create=function(b,d,c,f){var e=a.POOL._length?a.POOL[--a.POOL._length]:new a;e._mesh=d;e.srcRT=f;e._startIdx=d.indexNum*Z.BYTES_PIDX;e._ref=1;e._key.clear();e._numEle=0;e.blendType=b._nBlendType;e._key.blendShader=e.blendType;e.shaderValue=c;e.shaderValue.setValue(b._shader2D);b._colorFiler&&(b=b._colorFiler,c.defines.add(b.type),c.colorMat=b._mat,c.colorAlpha=b._alpha);return e};a.POOL=(a.POOL=[],a.POOL._length=0,a.POOL);return a}(),P=function(){function a(){this.fontSizeInfo={};this.charRender=null;this.mapFont={};this.fontID=0;this.mapColor=[];this.colorID=0;this.fontScaleY=this.fontScaleX=1;this._curStrPos=0;this.lastFont=this.bmpData32=null;this.fontSizeOffY=this.fontSizeOffX=this.fontSizeH=this.fontSizeW=0;this.renderPerChar=!0;this.textureMem=0;this.fontStr=null;this.textAtlases=[];this.isoTextures=[];this.tmpAtlasPos=new fa;var b=!1,d=E.MiniAdpter;d&&d.systemInfo&&d.systemInfo.system&&(b="ios 10.1.1"===d.systemInfo.system.toLowerCase());M.onMiniGame&&!b&&(a.isWan1Wan=!0);M.onLimixiu&&(a.isWan1Wan=!0);this.charRender=D.isConchApp?new kb:new lb(a.atlasWidth,a.atlasWidth,a.scaleFontWithCtx,!a.isWan1Wan,!1);a.textRenderInst=this;E.textRender=this;a.atlasWidth2=a.atlasWidth*a.atlasWidth}r(a,"laya.webgl.text.TextRender");var c=a.prototype;c.setFont=function(b){if(this.lastFont!=b){this.lastFont=b;var d=this.getFontSizeInfo(b._family),c=b._size/a.standardFontSize;this.fontSizeOffX=Math.ceil((d>>24)*c);this.fontSizeOffY=Math.ceil((d>>16&255)*c);this.fontSizeW=Math.ceil((d>>8&255)*c);this.fontSizeH=Math.ceil((d&255)*c);this.fontStr=b._font.replace("italic","")}};c.getNextChar=function(a){var d=a.length,b=this._curStrPos;if(b>=d)return null;for(var c=b,g=0;c<d;c++){var h=a.charCodeAt(c);if(27==h>>>11){if(1==g)break;g=1;c++}else if(65038!==h&&65039!==h)if(8205==h)g=2;else if(0==g)g=1;else if(1==g)break}this._curStrPos=c;return a.substring(b,c)};c.filltext=function(a,d,c,f,g,h,l,k,m,p){void 0===p&&(p=0);if(!(0>=d.length)){g=xa.Parse(g);var b=0;switch(m){case "center":b=ba.ENUM_TEXTALIGN_CENTER;break;case "right":b=ba.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(a,d,null,c,f,g,h,l,k,b,p)}};c.fillWords=function(a,d,c,f,g,h,l,k){!d||0>=d.length||(g=xa.Parse(g),this._fast_filltext(a,null,d,c,f,g,h,l,k,0,0))};c._fast_filltext=function(b,d,c,f,g,h,l,k,m,p,n){if(!(d&&1>d.length||c&&1>c.length)){0>m&&(m=0);this.setFont(h);this.fontScaleX=this.fontScaleY=1;if(!D.isConchApp&&a.scaleFontWithCtx){var e;D.isConchApp?(n=b._curMat.getScaleX(),e=b._curMat.getScaleY()):(n=b.getMatScaleX(),e=b.getMatScaleY());if(1E-4>n||.1>e)return;1<n&&(this.fontScaleX=n);1<e&&(this.fontScaleY=e)}h._italic&&(b._italicDeg=13);var x=!c&&d instanceof laya.utils.WordText;n=d;e=!!c;var C=x?d.pageChars:[],t;x?(n=d._text,t=d.width,0>t&&(t=d.width=this.charRender.getWidth(this.fontStr,n))):t=n?this.charRender.getWidth(this.fontStr,n):0;switch(p){case ba.ENUM_TEXTALIGN_CENTER:f-=t/2;break;case ba.ENUM_TEXTALIGN_RIGHT:f-=t}d&&C&&this.hasFreedText(C)&&(C=d.pageChars=[]);d=this.renderPerChar=!x||a.forceSplitRender||e||x&&d.splitRender;if(!C||1>C.length)if(d)for(this._curStrPos=p=d=0;;){e?(x=c[this._curStrPos++])?(t=x["char"],d=x.x,p=x.y):t=null:t=this.getNextChar(n);if(!t)break;t=this.getCharRenderInfo(t,h,l,k,m,!1);if(!t)break;t.isSpace||((x=C[t.tex.id])||(C[t.tex.id]=x=[]),D.isConchApp?x.push({ri:t,x:d,y:p,w:t.bmpWidth/this.fontScaleX,h:t.bmpHeight/this.fontScaleY}):x.push({ri:t,x:d+1/this.fontScaleX,y:p,w:(t.bmpWidth-2)/this.fontScaleX,h:(t.bmpHeight-1)/this.fontScaleY}),d+=t.width)}else t=this.getCharRenderInfo(n,h,l,k,m,a.noAtlas||t*this.fontScaleX>a.atlasWidth),C[0]=D.isConchApp?[{ri:t,x:0,y:0,w:t.bmpWidth/this.fontScaleX,h:t.bmpHeight/this.fontScaleY}]:[{ri:t,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(t.bmpWidth-2)/this.fontScaleX,h:(t.bmpHeight-1)/this.fontScaleY}];this._drawResortedWords(b,f,g,C);b._italicDeg=0}};c._drawResortedWords=function(a,d,c,f){var b=a._charSubmitCache&&a._charSubmitCache._enbale,e=a._curMat,l;for(l in f){var k=f[l],m=k.length;if(!(0>=m))for(var p=0;p<m;p++){var n=k[p],q=n.ri;q.isSpace||(q.touch(),a.drawTexAlign=!0,D.isConchApp?a._drawTextureM(q.tex.texture,d+n.x-q.orix,c+n.y-q.oriy,n.w,n.h,null,1,q.uv):a._inner_drawTexture(q.tex.texture,q.tex.texture.bitmap.id,d+n.x-q.orix,c+n.y-q.oriy,n.w,n.h,e,q.uv,1,b),a.touches&&a.touches.push(q))}}};c.hasFreedText=function(a){for(var d in a)for(var b=a[d],c=0,g=b.length;c<g;c++){var h=b[c].ri;if(h.deleted||h.tex.__destroyed)return!0}return!1};c.getCharRenderInfo=function(b,d,c,f,g,h){void 0===h&&(h=!1);var e=this.mapFont[d._family];void 0==e&&(this.mapFont[d._family]=e=this.fontID++);var k=b+"_"+e+"_"+d._size+"_"+c;0<g&&(k+="_"+f+g);d._bold&&(k+="P");if(1!=this.fontScaleX||1!=this.fontScaleY)k+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0);var m,p=this.textAtlases.length,n;if(!h)for(m=0;m<p;m++)if(n=this.textAtlases[m],e=n.charMaps[k])return e.touch(),e;e=new Oa;this.charRender.scale(this.fontScaleX,this.fontScaleY);e["char"]=b;e.height=d._size;d=d._size/3|0;n=Math.ceil(this.charRender.getWidth(this.fontStr,b)*this.fontScaleX);n>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,n+2*d));if(h)b=this.charRender.getCharBmp(b,this.fontStr,g,c,f,e,d,d,d,d,null),c=Ba.getTextTexture(b.width,b.height),c.addChar(b,0,0,e.uv),e.tex=c,e.orix=d,e.oriy=d,c.ri=e,this.isoTextures.push(c);else{m=b.length;h=1*g;var p=Math.ceil((this.fontSizeW+2*h)*this.fontScaleX),q=Math.ceil((this.fontSizeH+2*h)*this.fontScaleY);a.imgdtRect[0]=(d-this.fontSizeOffX-h)*this.fontScaleX|0;a.imgdtRect[1]=(d-this.fontSizeOffY-h)*this.fontScaleY|0;this.renderPerChar||1==m?(a.imgdtRect[2]=Math.max(n,p),a.imgdtRect[3]=Math.max(n,q)):(a.imgdtRect[2]=-1,a.imgdtRect[3]=q);b=this.charRender.getCharBmp(b,this.fontStr,g,c,f,e,d,d,d,d,a.imgdtRect);n=this.addBmpData(b,e);a.isWan1Wan?(e.orix=d,e.oriy=d):(e.orix=this.fontSizeOffX+h,e.oriy=this.fontSizeOffY+h);n.charMaps[k]=e}return e};c.addBmpData=function(a,d){for(var b=a.width,c=a.height,g=this.textAtlases.length,h=null,l=!1,k=0;k<g&&!(h=this.textAtlases[k],l=h.getAEmpty(b,c,this.tmpAtlasPos));k++);if(!l){h=new ma;this.textAtlases.push(h);l=h.getAEmpty(b,c,this.tmpAtlasPos);if(!l)throw"err1";this.cleanAtlases()}l&&(h.texture.addChar(a,this.tmpAtlasPos.x,this.tmpAtlasPos.y,d.uv),d.tex=h.texture);return h};c.GC=function(b){var d=0,c=this.textAtlases.length,f,g=a.destroyAtlasDt;b=0;for(var h=-1,l=0,k,m;d<c;d++){m=this.textAtlases[d];if(k=m.texture)b+=k.curUsedCovRateAtlas,f=m.usedRate-k.curUsedCovRateAtlas,l<f&&(l=f,h=d);f=K.loopCount-m.texture.lastTouchTm;f>g&&(a.showLog&&console.log("TextRender GC delete atlas "+k?m.texture.id:"unk"),m.destroy(),this.textAtlases[d]=this.textAtlases[c-1],c--,d--)}this.textAtlases.length=c;c=this.isoTextures.length;for(d=0;d<c;d++)k=this.isoTextures[d],f=K.loopCount-k.lastTouchTm,f>a.destroyUnusedTextureDt&&(k.ri.deleted=!0,k.ri.tex=null,k.destroy(),this.isoTextures[d]=this.isoTextures[c-1],c--,d--);d=1<this.textAtlases.length&&2<=this.textAtlases.length-b;if(a.atlasWidth*a.atlasWidth*4*this.textAtlases.length>a.cleanMem||d||a.simClean)a.simClean=!1,a.showLog&&console.log("\u6e05\u7406\u4f7f\u7528\u7387\u4f4e\u7684\u8d34\u56fe\u3002\u603b\u4f7f\u7528\u7387:",b,":",this.textAtlases.length,"\u6700\u5dee\u8d34\u56fe:"+h),0<=h&&(m=this.textAtlases[h],m.destroy(),this.textAtlases[h]=this.textAtlases[this.textAtlases.length-1],--this.textAtlases.length);Ba.clean()};c.cleanAtlases=function(){};c.getCharBmp=function(a){};c.checkBmpLine=function(a,d,c,f){this.bmpData32.buffer!=a.data.buffer&&(this.bmpData32=new Uint32Array(a.data.buffer));for(a=a.width*d+c;c<f;c++)if(0!=this.bmpData32[a++])return!0;return!1};c.updateBbx=function(a,d,c){void 0===c&&(c=!1);var b=a.width,e=a.height,h=d[1],l=0,k;if(this.checkBmpLine(a,h,0,b))for(;;){k=(h+l)/2|0;if(k+1>=h){d[1]=k;break}this.checkBmpLine(a,k,0,b)?h=k:l=k}if(d[3]>e)d[3]=e;else if(h=d[3],l=e,this.checkBmpLine(a,h,0,b))for(;;){k=(h+l)/2|0;if(k-1<=h){d[3]=k;break}this.checkBmpLine(a,k,0,b)?h=k:l=k}if(!c){e=d[0];c=b*d[1];for(k=d[1];k<d[3];k++){for(a=0;a<e;a++)if(0!=this.bmpData32[c+a]){e=a;break}c+=b}d[0]=e;e=d[2];c=b*d[1];for(k=d[1];k<d[3];k++){for(a=e;a<b;a++)if(0!=this.bmpData32[c+a]){e=a;break}c+=b}d[2]=e}};c.getFontSizeInfo=function(b){var d=this.fontSizeInfo[b];if(void 0!=d)return d;d="bold "+a.standardFontSize+"px "+b;if(a.isWan1Wan)return this.fontSizeW=1.5*this.charRender.getWidth(d,"\u6709"),this.fontSizeH=1.5*a.standardFontSize,d=this.fontSizeW<<8|this.fontSizeH,this.fontSizeInfo[b]=d;a.pixelBBX[0]=a.standardFontSize/2;a.pixelBBX[1]=a.standardFontSize/2;a.pixelBBX[2]=a.standardFontSize;a.pixelBBX[3]=a.standardFontSize;var c=16,f=16;this.charRender.scale(1,1);a.tmpRI.height=a.standardFontSize;var g=this.charRender.getCharBmp("g",d,0,"red",null,a.tmpRI,c,f,16,16);D.isConchApp&&(g.data=new Uint8ClampedArray(g.data));this.bmpData32=new Uint32Array(g.data.buffer);this.updateBbx(g,a.pixelBBX,!1);g=this.charRender.getCharBmp("\u6709",d,0,"red",null,a.tmpRI,f,f,16,16);D.isConchApp&&(g.data=new Uint8ClampedArray(g.data));this.bmpData32=new Uint32Array(g.data.buffer);a.pixelBBX[2]<c+a.tmpRI.width&&(a.pixelBBX[2]=c+a.tmpRI.width);this.updateBbx(g,a.pixelBBX,!1);D.isConchApp&&(f=c=0);d=Math.max(c-a.pixelBBX[0],0)<<24|Math.max(f-a.pixelBBX[1],0)<<16|a.pixelBBX[2]-a.pixelBBX[0]<<8|a.pixelBBX[3]-a.pixelBBX[1];return this.fontSizeInfo[b]=d};c.printDbgInfo=function(){console.log("\u56fe\u96c6\u4e2a\u6570:"+this.textAtlases.length+",\u6bcf\u4e2a\u56fe\u96c6\u5927\u5c0f:"+a.atlasWidth+"x"+a.atlasWidth," \u7528canvas:",a.isWan1Wan);console.log("\u56fe\u96c6\u5360\u7528\u7a7a\u95f4:"+a.atlasWidth*a.atlasWidth*4/1024/1024*this.textAtlases.length+"M");console.log("\u7f13\u5b58\u7528\u5230\u7684\u5b57\u4f53:");for(var b in this.mapFont){var d=this.getFontSizeInfo(b);console.log("    "+b," off:",d>>24,d>>16&255," size:",d>>8&255,d&255)}var c=0;console.log("\u7f13\u5b58\u6570\u636e:");var f=0,g=0;this.textAtlases.forEach(function(d){var b=d.texture.id,e=K.loopCount-d.texture.lastTouchTm;f+=d.texture.curUsedCovRate;g+=d.texture.curUsedCovRateAtlas;console.log("--\u56fe\u96c6(id:"+b+",\u5f53\u524d\u4f7f\u7528\u7387:"+(1E3*d.texture.curUsedCovRate|0)+"\u2030","\u5f53\u524d\u56fe\u96c6\u4f7f\u7528\u7387:",(100*d.texture.curUsedCovRateAtlas|0)+"%","\u56fe\u96c6\u4f7f\u7528\u7387:",100*d.usedRate|0,"%, \u4f7f\u7528\u4e8e:"+(0<e?""+e+"\u5e27\u4ee5\u524d":"\u5f53\u524d\u5e27")+")--:");for(var h in d.charMaps)b=d.charMaps[h],console.log("     off:",b.orix,b.oriy," bmp\u5bbd\u9ad8:",b.bmpWidth,b.bmpHeight,"\u65e0\u6548:",b.deleted,"touchdt:",K.loopCount-b.touchTick,"\u4f4d\u7f6e:",b.uv[0]*a.atlasWidth|0,b.uv[1]*a.atlasWidth|0,"\u5b57\u7b26:",b["char"],"key:",h),c++});console.log("\u72ec\u7acb\u8d34\u56fe\u6587\u5b57("+this.isoTextures.length+"\u4e2a):");this.isoTextures.forEach(function(a){console.log("    size:",a._texW,a._texH,"touch\u95f4\u9694:",K.loopCount-a.lastTouchTm,"char:",a.ri["char"])});console.log("\u603b\u7f13\u5b58:",c,"\u603b\u4f7f\u7528\u7387:",f,"\u603b\u5f53\u524d\u56fe\u96c6\u4f7f\u7528\u7387:",g)};c.showAtlas=function(b,d,c,f,g,h){if(!this.textAtlases[b])return console.log("\u6ca1\u6709\u8fd9\u4e2a\u56fe\u96c6"),null;var e=new Fa,k=this.textAtlases[b].texture,m={width:a.atlasWidth,height:a.atlasWidth,sourceWidth:a.atlasWidth,sourceHeight:a.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return k._getSource()},bitmap:{id:k.id},_uv:ea.DEF_UV};e.size=function(a,b){this.width=a;this.height=b;e.graphics.clear();e.graphics.drawRect(0,0,e.width,e.height,d);e.graphics.drawTexture(m,0,0,e.width,e.height);return this};e.graphics.drawRect(0,0,g,h,d);e.graphics.drawTexture(m,0,0,g,h);e.pos(c,f);E.stage.addChild(e);return e};c.filltext_native=function(a,d,c,f,g,h,l,k,m,p,n){void 0===n&&(n=0);if(!(d&&0>=d.length||c&&1>c.length)){h=xa.Parse(h);var b=0;switch(p){case "center":b=ba.ENUM_TEXTALIGN_CENTER;break;case "right":b=ba.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(a,d,c,f,g,h,l,k,m,b,n)}};a.useOldCharBook=!1;a.atlasWidth=2048;a.noAtlas=!1;a.forceSplitRender=!1;a.forceWholeRender=!1;a.scaleFontWithCtx=!0;a.standardFontSize=32;a.destroyAtlasDt=10;a.checkCleanTextureDt=2E3;a.destroyUnusedTextureDt=3E3;a.cleanMem=104857600;a.isWan1Wan=!1;a.showLog=!1;a.debugUV=!1;a.atlasWidth2=4194304;a.textRenderInst=null;a.simClean=!1;N(a,["tmpRI",function(){return this.tmpRI=new Oa},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]);return a}(),Na=function(){function a(){}r(a,"laya.layagl.LayaGLRunner");a.uploadShaderUniforms=function(a,b,d,e){a=d._data;b=b.getArrayData();for(var c=d=0,g=b.length;c<g;c++){var h=b[c];if(e||-1!==h.textureID){var l=a[h.dataOffset];null!=l&&(d+=h.fun.call(h.caller,h,l))}}return d};a.uploadCustomUniform=function(a,b,d,e){a=0;(b=b[d])&&null!=e&&(a+=b.fun.call(b.caller,b,e));return a};a.uploadShaderUniformsForNative=function(a,b,d){var c=0;0<d._runtimeCopyValues.length&&(c=1);return a.uploadShaderUniforms(b,d._data,c)};return a}(),ib=function(){function a(a,d,c){this._texCount=this._height=this._width=this.atlasID=0;this._cells=this._rowInfo=null;this._used=0;void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=0);this._rowInfo=this._cells=null;this.atlasID=c;this._init(a,d)}r(a,"laya.webgl.text.AtlasGrid");var c=a.prototype;c.addRect=function(a,d,c,f){if(!this._get(d,c,f))return!1;this._fill(f.x,f.y,d,c,a);this._texCount++;return!0};c._release=function(){this._rowInfo=this._cells=null};c._init=function(a,d){this._width=a;this._height=d;this._release();if(0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3);this._rowInfo=new Uint8Array(this._height);this._used=0;this._clear();return!0};c._get=function(a,d,c){if(a>this._width||d>this._height)return!1;for(var b,e,h=this._width,l=this._height,k=this._cells,m=0;m<l;m++)if(!(this._rowInfo[m]<a))for(var p=0;p<h;){var n=3*(m*h+p);if(0!=k[n]||k[n+1]<a||k[n+2]<d)p+=k[n+1];else{b=p;e=m;for(var q=0;q<a;q++)if(k[3*q+n+2]<d){b=-1;break}if(0>b)p+=k[n+1];else return c.x=b,c.y=e,!0}}return!1};c._fill=function(a,d,c,f,g){var b=this._width,e=this._height;this._check(a+c<=b&&d+f<=e);for(e=d;e<f+d;++e){this._check(this._rowInfo[e]>=c);this._rowInfo[e]-=c;for(var k=0;k<c;k++){var m=3*(a+e*b+k);this._check(0==this._cells[m]);this._cells[m]=g;this._cells[m+1]=c;this._cells[m+2]=f}}if(0<a)for(e=0;e<f;++e){g=0;for(k=a-1;0<=k&&0==this._cells[3*((d+e)*b+k)];--k,++g);for(k=g;0<k;--k)this._cells[3*((d+e)*b+a-k)+1]=k,this._check(0<k)}if(0<d)for(k=a;k<a+c;++k){g=0;for(e=d-1;0<=e&&0==this._cells[3*(k+e*b)];--e,g++);for(e=g;0<e;--e)this._cells[3*(k+(d-e)*b)+2]=e,this._check(0<e)}this._used+=c*f/(this._width*this._height)};c._check=function(a){0==a&&console.log("xtexMerger \u9519\u8bef\u5566")};c._clear=function(){for(var a=this._texCount=0;a<this._height;a++)this._rowInfo[a]=this._width;for(a=0;a<this._height;a++)for(var d=0;d<this._width;d++){var c=3*(a*this._width+d);this._cells[c]=0;this._cells[c+1]=this._width-d;this._cells[c+2]=this._width-a}};return a}();(function(){function a(){}r(a,"laya.webgl.shader.ShaderValue");return a})();(function(){function a(a){this._par=null;this._loaded=!0;this.bitmap={};this.bitmap.id=a.id;this._par=a}r(a,"laya.webgl.resource.CharInternalTexture");a.prototype._getSource=function(){return this._par._source};return a})();var ta=function(){function a(){this.other=this.submitType=this.blendShader=0;this.clear()}r(a,"laya.webgl.submit.SubmitKey");var c=a.prototype;c.clear=function(){this.submitType=-1;this.blendShader=this.other=0};c.copyFrom=function(a){this.other=a.other;this.blendShader=a.blendShader;this.submitType=a.submitType};c.copyFrom2=function(a,d,c){this.other=c;this.submitType=d};c.equal3_2=function(a,d,c){return this.submitType===d&&this.other===c&&this.blendShader===a.blendShader};c.equal4_2=function(a,d,c){return this.submitType===d&&this.other===c&&this.blendShader===a.blendShader};c.equal_3=function(a){return this.submitType===a.submitType&&this.blendShader===a.blendShader};c.equal=function(a){return this.other===a.other&&this.submitType===a.submitType&&this.blendShader===a.blendShader};return a}(),Pa=function(){function a(){this._saveuse=0}r(a,"laya.webgl.canvas.save.SaveMark");var c=a.prototype;E.imps(c,{"laya.webgl.canvas.save.ISaveData":!0});c.isSaveMark=function(){return!0};c.restore=function(b){b._saveMark=this._preSaveMark;a.POOL[a.POOL._length++]=this};a.Create=function(b){var d=a.POOL,d=0<d._length?d[--d._length]:new a;d._saveuse=0;d._preSaveMark=b._saveMark;return b._saveMark=d};a.POOL=Q._createArray();return a}(),y=function(){function a(){}r(a,"laya.layagl.LayaGL");var c=a.prototype;c.createCommandEncoder=function(a,d,c){void 0===a&&(a=128);void 0===d&&(d=64);void 0===c&&(c=!1);return new Ja(this,a,d,c)};c.beginCommandEncoding=function(a){};c.endCommandEncoding=function(){};c.matrix4x4Multiply=function(a,d,c){};c.evaluateClipDatasRealTime=function(a,d,c,f){};a.getFrameCount=function(){return 0};a.syncBufferToRenderThread=function(a,d){};a.createArrayBufferRef=function(a,d,c){};a.createArrayBufferRefs=function(a,d,c,f){};a.EXECUTE_JS_THREAD_BUFFER=0;a.EXECUTE_RENDER_THREAD_BUFFER=1;a.EXECUTE_COPY_TO_RENDER=2;a.EXECUTE_COPY_TO_RENDER3D=3;a.ARRAY_BUFFER_TYPE_DATA=0;a.ARRAY_BUFFER_TYPE_CMD=1;a.ARRAY_BUFFER_REF_REFERENCE=0;a.ARRAY_BUFFER_REF_COPY=1;a.UPLOAD_SHADER_UNIFORM_TYPE_ID=0;a.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1;a.instance=null;return a}(),mb=function(){function a(){}r(a,"laya.webgl.shapes.Earcut");a.earcut=function(c,b,d){d=d||2;var e=b&&b.length,f=e?b[0]*d:c.length,g=a.linkedList(c,0,f,d,!0),h=[];if(!g)return h;var l,k,m,p;e&&(g=a.eliminateHoles(c,b,g,d));if(c.length>80*d){l=b=c[0];k=e=c[1];for(var n=d;n<f;n+=d)m=c[n],p=c[n+1],m<l&&(l=m),p<k&&(k=p),m>b&&(b=m),p>e&&(e=p);m=Math.max(b-l,e-k);m=0!==m?1/m:0}a.earcutLinked(g,h,d,l,k,m);return h};a.linkedList=function(c,b,d,e,f){var g;if(f===0<a.signedArea(c,b,d,e))for(f=b;f<d;f+=e)g=a.insertNode(f,c[f],c[f+1],g);else for(f=d-e;f>=b;f-=e)g=a.insertNode(f,c[f],c[f+1],g);g&&a.equals(g,g.next)&&(a.removeNode(g),g=g.next);return g};a.filterPoints=function(c,b){if(!c)return c;b||(b=c);var d=c,e;do if(e=!1,d.steiner||!a.equals(d,d.next)&&0!==a.area(d.prev,d,d.next))d=d.next;else{a.removeNode(d);d=b=d.prev;if(d===d.next)break;e=!0}while(e||d!==b);return b};a.earcutLinked=function(c,b,d,e,f,g,h){if(c){!h&&g&&a.indexCurve(c,e,f,g);for(var l=c,k,m;c.prev!==c.next;)if(k=c.prev,m=c.next,g?a.isEarHashed(c,e,f,g):a.isEar(c))b.push(k.i/d),b.push(c.i/d),b.push(m.i/d),a.removeNode(c),l=c=m.next;else if(c=m,c===l){h?1===h?(c=a.cureLocalIntersections(c,b,d),a.earcutLinked(c,b,d,e,f,g,2)):2===h&&a.splitEarcut(c,b,d,e,f,g):a.earcutLinked(a.filterPoints(c,null),b,d,e,f,g,1);break}}};a.isEar=function(c){var b=c.prev,d=c.next;if(0<=a.area(b,c,d))return!1;for(var e=c.next.next;e!==c.prev;){if(a.pointInTriangle(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&0<=a.area(e.prev,e,e.next))return!1;e=e.next}return!0};a.isEarHashed=function(c,b,d,e){var f=c.prev,g=c.next;if(0<=a.area(f,c,g))return!1;var h=f.x>c.x?f.x>g.x?f.x:g.x:c.x>g.x?c.x:g.x,l=f.y>c.y?f.y>g.y?f.y:g.y:c.y>g.y?c.y:g.y,k=a.zOrder(f.x<c.x?f.x<g.x?f.x:g.x:c.x<g.x?c.x:g.x,f.y<c.y?f.y<g.y?f.y:g.y:c.y<g.y?c.y:g.y,b,d,e);b=a.zOrder(h,l,b,d,e);for(d=c.nextZ;d&&d.z<=b;){if(d!==c.prev&&d!==c.next&&a.pointInTriangle(f.x,f.y,c.x,c.y,g.x,g.y,d.x,d.y)&&0<=a.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=c.prevZ;d&&d.z>=k;){if(d!==c.prev&&d!==c.next&&a.pointInTriangle(f.x,f.y,c.x,c.y,g.x,g.y,d.x,d.y)&&0<=a.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0};a.cureLocalIntersections=function(c,b,d){var e=c;do{var f=e.prev,g=e.next.next;!a.equals(f,g)&&a.intersects(f,e,e.next,g)&&a.locallyInside(f,g)&&a.locallyInside(g,f)&&(b.push(f.i/d),b.push(e.i/d),b.push(g.i/d),a.removeNode(e),a.removeNode(e.next),e=c=g);e=e.next}while(e!==c);return e};a.splitEarcut=function(c,b,d,e,f,g){var h=c;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&a.isValidDiagonal(h,l)){c=a.splitPolygon(h,l);h=a.filterPoints(h,h.next);c=a.filterPoints(c,c.next);a.earcutLinked(h,b,d,e,f,g);a.earcutLinked(c,b,d,e,f,g);return}l=l.next}h=h.next}while(h!==c)};a.eliminateHoles=function(c,b,d,e){var f=[],g,h,l,k;g=0;for(h=b.length;g<h;g++)l=b[g]*e,k=g<h-1?b[g+1]*e:c.length,l=a.linkedList(c,l,k,e,!1),l===l.next&&(l.steiner=!0),f.push(a.getLeftmost(l));f.sort(a.compareX);for(g=0;g<f.length;g++)a.eliminateHole(f[g],d),d=a.filterPoints(d,d.next);return d};a.compareX=function(a,b){return a.x-b.x};a.eliminateHole=function(c,b){if(b=a.findHoleBridge(c,b)){var d=a.splitPolygon(b,c);a.filterPoints(d,d.next)}};a.findHoleBridge=function(c,b){var d=b,e=c.x,f=c.y,g=-Infinity,h;do{if(f<=d.y&&f>=d.next.y&&d.next.y!==d.y){var l=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(l<=e&&l>g){g=l;if(l===e){if(f===d.y)return d;if(f===d.next.y)return d.next}h=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!h)return null;if(e===g)return h.prev;for(var l=h,k=h.x,m=h.y,p=Infinity,n,d=h.next;d!==l;)e>=d.x&&d.x>=k&&e!==d.x&&a.pointInTriangle(f<m?e:g,f,k,m,f<m?g:e,f,d.x,d.y)&&(n=Math.abs(f-d.y)/(e-d.x),(n<p||n===p&&d.x>h.x)&&a.locallyInside(d,c)&&(h=d,p=n)),d=d.next;return h};a.indexCurve=function(c,b,d,e){var f=c;do null===f.z&&(f.z=a.zOrder(f.x,f.y,b,d,e)),f.prevZ=f.prev,f=f.nextZ=f.next;while(f!==c);f.prevZ.nextZ=null;f.prevZ=null;a.sortLinked(f)};a.sortLinked=function(a){var b,d,c,f,g,h,l,k=1;do{d=a;f=a=null;for(g=0;d;){g++;c=d;for(b=h=0;b<k&&(h++,c=c.nextZ,c);b++);for(l=k;0<h||0<l&&c;)0!==h&&(0===l||!c||d.z<=c.z)?(b=d,d=d.nextZ,h--):(b=c,c=c.nextZ,l--),f?f.nextZ=b:a=b,b.prevZ=f,f=b;d=c}f.nextZ=null;k*=2}while(1<g);return a};a.zOrder=function(a,b,d,e,f){a=32767*(a-d)*f;b=32767*(b-e)*f;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1};a.getLeftmost=function(a){var b=a,d=a;do b.x<d.x&&(d=b),b=b.next;while(b!==a);return d};a.pointInTriangle=function(a,b,d,e,f,g,h,l){return 0<=(f-h)*(b-l)-(a-h)*(g-l)&&0<=(a-h)*(e-l)-(d-h)*(b-l)&&0<=(d-h)*(g-l)-(f-h)*(e-l)};a.isValidDiagonal=function(c,b){return c.next.i!==b.i&&c.prev.i!==b.i&&!a.intersectsPolygon(c,b)&&a.locallyInside(c,b)&&a.locallyInside(b,c)&&a.middleInside(c,b)};a.area=function(a,b,d){return(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)};a.equals=function(a,b){return a.x===b.x&&a.y===b.y};a.intersects=function(c,b,d,e){return a.equals(c,b)&&a.equals(d,e)||a.equals(c,e)&&a.equals(d,b)?!0:0<a.area(c,b,d)!==0<a.area(c,b,e)&&0<a.area(d,e,c)!==0<a.area(d,e,b)};a.intersectsPolygon=function(c,b){var d=c;do{if(d.i!==c.i&&d.next.i!==c.i&&d.i!==b.i&&d.next.i!==b.i&&a.intersects(d,d.next,c,b))return!0;d=d.next}while(d!==c);return!1};a.locallyInside=function(c,b){return 0>a.area(c.prev,c,c.next)?0<=a.area(c,b,c.next)&&0<=a.area(c,c.prev,b):0>a.area(c,b,c.prev)||0>a.area(c,c.next,b)};a.middleInside=function(a,b){var d=a,c=!1,f=(a.x+b.x)/2,g=(a.y+b.y)/2;do d.y>g!==d.next.y>g&&d.next.y!==d.y&&f<(d.next.x-d.x)*(g-d.y)/(d.next.y-d.y)+d.x&&(c=!c),d=d.next;while(d!==a);return c};a.splitPolygon=function(a,b){var d=new Aa(a.i,a.x,a.y),c=new Aa(b.i,b.x,b.y),f=a.next,g=b.prev;a.next=b;b.prev=a;d.next=f;f.prev=d;c.next=d;d.prev=c;g.next=c;c.prev=g;return c};a.insertNode=function(a,b,d,e){a=new Aa(a,b,d);e?(a.next=e.next,a.prev=e,e.next.prev=a,e.next=a):(a.prev=a,a.next=a);return a};a.removeNode=function(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)};a.signedArea=function(a,b,d,e){for(var c=0,g=d-e;b<d;b+=e)c+=(a[g]-a[b])*(a[b+1]+a[g+1]),g=b;return c};return a}(),Ca=function(){function a(){this._lastOriY=this._lastOriX=0;this.paths=[];this._curPath=null}var c;r(a,"laya.webgl.canvas.Path");var b=a.prototype;b.beginPath=function(a){this.paths.length=1;this._curPath=this.paths[0]=new c;this._curPath.convex=a};b.closePath=function(){this._curPath.loop=!0};b.newPath=function(){this._curPath=new c;this.paths.push(this._curPath)};b.addPoint=function(a,b){this._curPath.path.push(a,b)};b.push=function(a,b){this._curPath?0<this._curPath.path.length&&(this._curPath=new c,this.paths.push(this._curPath)):(this._curPath=new c,this.paths.push(this._curPath));var d=this._curPath;d.path=a.slice();d.convex=b};b.reset=function(){this.paths.length=0};a.__init$=function(){c=function(){function a(){this.path=[];this.convex=this.loop=!1}r(a,"");return a}()};return a}(),U=function(){function a(){this.args=this._this=this.fun=null;this._ref=1;this._key=new ta}r(a,"laya.webgl.submit.SubmitCMD");var c=a.prototype;E.imps(c,{"laya.webgl.submit.ISubmit":!0});c.renderSubmit=function(){this.fun.apply(this._this,this.args);return 1};c.getRenderType=function(){return 0};c.reUse=function(a,d){this._ref++;return d};c.releaseRender=function(){if(1>--this._ref){var b=a.POOL;b[b._length++]=this}};c.clone=function(a,d,c){return null};a.create=function(b,d,c){var e=a.POOL._length?a.POOL[--a.POOL._length]:new a;e.fun=d;e.args=b;e._this=c;e._ref=1;e._key.clear();return e};a.POOL=(a.POOL=[],a.POOL._length=0,a.POOL);return a}();(function(){function a(){}r(a,"laya.webgl.utils.MatirxArray");a.ArrayMul=function(c,b,d){if(c)if(b)for(var e,f,g,h,l=0;4>l;l++)e=c[l],f=c[l+4],g=c[l+8],h=c[l+12],d[l]=e*b[0]+f*b[1]+g*b[2]+h*b[3],d[l+4]=e*b[4]+f*b[5]+g*b[6]+h*b[7],d[l+8]=e*b[8]+f*b[9]+g*b[10]+h*b[11],d[l+12]=e*b[12]+f*b[13]+g*b[14]+h*b[15];else a.copyArray(c,d);else a.copyArray(b,d)};a.copyArray=function(a,b){if(a&&b)for(var d=0;d<a.length;d++)b[d]=a[d]};return a})();var eb=function(){function a(){}r(a,"laya.webgl.VertexArrayObject");return a}()(function(){function a(a){var d=a.getError;a.getError=function(){var b;do b=d.apply(a),b!=a.NO_ERROR&&(c[b]=!0);while(b!=a.NO_ERROR);for(b in c)if(c[b])return delete c[b],parseInt(b);return a.NO_ERROR}}var c={},b=function f(a){var d=a.gl;this.ext=a;this.isAlive=!0;this.hasBeenBound=!1;this.elementArrayBuffer=null;this.attribs=Array(a.maxVertexAttribs);for(a=0;a<this.attribs.length;a++){var b=new f.VertexAttrib(d);this.attribs[a]=b}this.maxAttrib=0};b.VertexAttrib=function(a){this.enabled=!1;this.buffer=null;this.size=4;this.type=a.FLOAT;this.normalized=!1;this.stride=16;this.offset=0;this.cached="";this.recache()};b.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var d=function(d){var b=this;this.gl=d;a(d);var c=this.original={getParameter:d.getParameter,enableVertexAttribArray:d.enableVertexAttribArray,disableVertexAttribArray:d.disableVertexAttribArray,bindBuffer:d.bindBuffer,getVertexAttrib:d.getVertexAttrib,vertexAttribPointer:d.vertexAttribPointer};d.getParameter=function(a){return a==b.VERTEX_ARRAY_BINDING_OES?b.currentVertexArrayObject==b.defaultVertexArrayObject?null:b.currentVertexArrayObject:c.getParameter.apply(this,arguments)};d.enableVertexAttribArray=function(a){var d=b.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,a);d.attribs[a].enabled=!0;return c.enableVertexAttribArray.apply(this,arguments)};d.disableVertexAttribArray=function(a){var d=b.currentVertexArrayObject;d.maxAttrib=Math.max(d.maxAttrib,a);d.attribs[a].enabled=!1;return c.disableVertexAttribArray.apply(this,arguments)};d.bindBuffer=function(a,f){switch(a){case d.ARRAY_BUFFER:b.currentArrayBuffer=f;break;case d.ELEMENT_ARRAY_BUFFER:b.currentVertexArrayObject.elementArrayBuffer=f}return c.bindBuffer.apply(this,arguments)};d.getVertexAttrib=function(a,f){var g=b.currentVertexArrayObject.attribs[a];switch(f){case d.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return g.buffer;case d.VERTEX_ATTRIB_ARRAY_ENABLED:return g.enabled;case d.VERTEX_ATTRIB_ARRAY_SIZE:return g.size;case d.VERTEX_ATTRIB_ARRAY_STRIDE:return g.stride;case d.VERTEX_ATTRIB_ARRAY_TYPE:return g.type;case d.VERTEX_ATTRIB_ARRAY_NORMALIZED:return g.normalized;default:return c.getVertexAttrib.apply(this,arguments)}};d.vertexAttribPointer=function(a,d,f,g,h,q){var l=b.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,a);l=l.attribs[a];l.buffer=b.currentArrayBuffer;l.size=d;l.type=f;l.normalized=g;l.stride=h;l.offset=q;l.recache();return c.vertexAttribPointer.apply(this,arguments)};d.instrumentExtension&&d.instrumentExtension(this,"OES_vertex_array_object");d.canvas&&d.canvas.addEventListener&&d.canvas.addEventListener("webglcontextrestored",function(){J.console&&J.console.log&&J.console.log("OESVertexArrayObject emulation library context restored");b.reset_()},!0);this.reset_()};d.prototype.VERTEX_ARRAY_BINDING_OES=34229;d.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var a=0;a<this.vertexArrayObjects.length;++a)this.vertexArrayObjects.isAlive=!1;a=this.gl;this.maxVertexAttribs=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.defaultVertexArrayObject=new b(this);this.currentArrayBuffer=this.currentVertexArrayObject=null;this.vertexArrayObjects=[this.defaultVertexArrayObject];this.bindVertexArrayOES(null)};d.prototype.createVertexArrayOES=function(){var a=new b(this);this.vertexArrayObjects.push(a);return a};d.prototype.deleteVertexArrayOES=function(a){a.isAlive=!1;this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(a),1);this.currentVertexArrayObject==a&&this.bindVertexArrayOES(null)};d.prototype.isVertexArrayOES=function(a){return a&&a instanceof b&&a.hasBeenBound&&a.ext==this?!0:!1};d.prototype.bindVertexArrayOES=function(a){var d=this.gl;if(a&&!a.isAlive)c[d.INVALID_OPERATION]=!0,J.console&&J.console.error&&J.console.error("bindVertexArrayOES: attempt to bind deleted arrayObject");else{var b=this.original,f=this.currentVertexArrayObject;this.currentVertexArrayObject=a||this.defaultVertexArrayObject;this.currentVertexArrayObject.hasBeenBound=!0;a=this.currentVertexArrayObject;if(f!=a){f&&a.elementArrayBuffer==f.elementArrayBuffer||b.bindBuffer.call(d,d.ELEMENT_ARRAY_BUFFER,a.elementArrayBuffer);for(var k=this.currentArrayBuffer,m=Math.max(f?f.maxAttrib:0,a.maxAttrib),p=0;p<=m;p++){var n=a.attribs[p],q=f?f.attribs[p]:null;f&&n.enabled==q.enabled||(n.enabled?b.enableVertexAttribArray.call(d,p):b.disableVertexAttribArray.call(d,p));if(n.enabled){var x=!1;f&&n.buffer==q.buffer||(k!=n.buffer&&(b.bindBuffer.call(d,d.ARRAY_BUFFER,n.buffer),k=n.buffer),x=!0);(x||n.cached!=q.cached)&&b.vertexAttribPointer.call(d,p,n.size,n.type,n.normalized,n.stride,n.offset)}}this.currentArrayBuffer!=k&&b.bindBuffer.call(d,d.ARRAY_BUFFER,this.currentArrayBuffer)}}};J._setupVertexArrayObject=function(a){var b=a.getSupportedExtensions;a.getSupportedExtensions=function(){var a=b.call(this)||[];0>a.indexOf("OES_vertex_array_object")&&a.push("OES_vertex_array_object");return a};var c=a.getExtension;a.getExtension=function(a){var b=c.call(this,a);if(b)return b;if("OES_vertex_array_object"!==a)return null;this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new d(this));return this.__OESVertexArrayObject}};J._forceSetupVertexArrayObject=function(a){var b=a.getSupportedExtensions;a.getSupportedExtensions=function(){var a=b.call(this)||[];0>a.indexOf("OES_vertex_array_object")&&a.push("OES_vertex_array_object");return a};var c=a.getExtension;a.getExtension=function(a){return"OES_vertex_array_object"===a?(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new d(this)),this.__OESVertexArrayObject):(a=c.call(this,a))?a:null}}}()),Z=function(){function a(){}r(a,"laya.webgl.utils.CONST3D2D");a.BYTES_PE=4;a.BYTES_PIDX=2;a.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];a.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];a._TMPARRAY=[];a._OFFSETX=0;a._OFFSETY=0;return a}(),gb=function(a){function c(a,d){c.__super.call(this,a,d)}r(c,"laya.webgl.utils.RenderSprite3D",a);a=c.prototype;a.onCreate=function(a){switch(a){case 4:this._fun=this._blend}};a._mask=function(a,d,c,f){var b=this._next,e=a.mask;if(e){d.save();var l=new ga;l.copyFrom(e.getBounds());l.width=Math.round(l.width);l.height=Math.round(l.height);l.x=Math.round(l.x);l.y=Math.round(l.y);if(0<l.width&&0<l.height){var k=l.width,m=l.height,p=ha.getRT(k,m);d.breakNextMerge();d.pushRT();d.addRenderObject(U.create([d,p,k,m],laya.webgl.utils.RenderSprite3D.tmpTarget,this));e.render(d,-l.x,-l.y);d.breakNextMerge();d.popRT();d.save();d.clipRect(c+l.x-a.getStyle().pivotX,f+l.y-a.getStyle().pivotY,k,m);b._fun.call(b,a,d,c,f);d.restore();b=d.globalCompositeOperation;d.addRenderObject(U.create(["mask"],laya.webgl.utils.RenderSprite3D.setBlendMode,this));var e=O.create(1,0),n=ea.INV_UV;d.drawTarget(p,c+l.x-a.getStyle().pivotX,f+l.y-a.getStyle().pivotY,k,m,F.TEMP.identity(),e,n,6);d.addRenderObject(U.create([p],laya.webgl.utils.RenderSprite3D.recycleTarget,this));d.addRenderObject(U.create([b],laya.webgl.utils.RenderSprite3D.setBlendMode,this))}d.restore()}else b._fun.call(b,a,d,c,f)};a._blend=function(a,d,c,f){var b=a._style,e=this._next;b.blendMode?(d.save(),d.globalCompositeOperation=b.blendMode,e._fun.call(e,a,d,c,f),d.restore()):e._fun.call(e,a,d,c,f)};c.tmpTarget=function(a,d,c,f){d.start();d.clear(0,0,0,0)};c.recycleTarget=function(a){ha.releaseRT(a)};c.setBlendMode=function(a){L.targetFns[L.TOINT[a]](z.mainContext)};N(c,["tempUV",function(){return this.tempUV=Array(8)}]);return c}(pa),da=function(a){function c(){this._drawTriUseAbsMatrix=!1;this._id=++c._COUNT;this._other=null;this._renderNextSubmitIndex=0;this._path=null;this._drawCount=1;this._renderCount=0;this._isConvexCmd=!0;this._triangleMesh=this._pathMesh=this._mesh=this._curSubmit=this._submits=null;this.meshlist=[];this._clipInCache=!1;this._clipInfoID=0;this._curMat=null;this._lastMat_a=this._lastMatScaleY=this._lastMatScaleX=1;this._lastMat_c=this._lastMat_b=0;this._lastMat_d=1;this._nBlendType=0;this.sprite=this._saveMark=this._charSubmitCache=this._targets=this._save=null;this._drawTextureUseColor=!1;this._italicDeg=0;this._lastTex=null;this._flushCnt=this._fillColor=0;this._colorFiler=null;this._incache=this.drawTexAlign=!1;this.mId=-1;this.mHaveLineKey=this.mHaveKey=!1;c.__super.call(this);this._tmpMatrix=new F;this._drawTexToDrawTri_Vert=new Float32Array(8);this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]);this._tempUV=new Float32Array(8);this._height=this._width=99999999;this._submitKey=new ta;this._transedPoints=Array(8);this._temp4Points=Array(8);this._clipRect=c.MAXCLIPRECT;this._globalClipMatrix=new F(99999999,0,0,99999999,0,0);this._shader2D=new ya;this.mOutPoint;c._contextcount++;if(!c.defTexture){var a=new ka(2,2);a.setPixels(new Uint8Array(16));a.lock=!0;c.defTexture=new ea(a)}this._lastTex=c.defTexture;this.clear()}var b;r(c,"laya.webgl.canvas.WebGLContext2D",a);a=c.prototype;a.clearBG=function(a,b,c,g){var d=z.mainContext;d.clearColor(a,b,c,g);d.clear(16384)};a._getSubmits=function(){return this._submits};a._releaseMem=function(){if(this._submits){this._curMat.destroy();this._curMat=null;this._shader2D.destroy();this._shader2D=null;this._charSubmitCache.clear();for(var a=0,b=this._submits._length;a<b;a++)this._submits[a].releaseRender();this._submits.length=0;this._submits._length=0;this._save=this._path=this._curSubmit=this._submits=null;a=0;for(b=this.meshlist.length;a<b;a++)this.meshlist[a].destroy();this.meshlist.length=0;this.sprite=null;this._targets&&this._targets.destroy();this._targets=null}};a.destroy=function(){--c._contextcount;this.sprite=null;this._releaseMem();this._charSubmitCache.destroy();this._targets&&this._targets.destroy();this._targets=null;this._mesh.destroy()};a.clear=function(){this._submits||(this._other=b.DEFAULT,this._curMat=F.create(),this._charSubmitCache=new cb,this._mesh=aa.getAMesh(),this.meshlist.push(this._mesh),this._pathMesh=la.getAMesh(),this.meshlist.push(this._pathMesh),this._triangleMesh=va.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[Pa.Create(this)],this._save.length=10,this._shader2D=new ya);this._submitKey.clear();this._mesh.clearVB();this._renderCount++;this._drawCount=1;this._other=b.DEFAULT;this._other.lineWidth=this._shader2D.ALPHA=1;this._nBlendType=0;this._clipRect=c.MAXCLIPRECT;this._curSubmit=B.RENDERBASE;B.RENDERBASE._ref=16777215;B.RENDERBASE._numEle=0;this._shader2D.fillStyle=this._shader2D.strokeStyle=ia.DEFAULT;for(var a=0,e=this._submits._length;a<e;a++)this._submits[a].releaseRender();this._submits._length=0;this._curMat.identity();this._other.clear();this._saveMark=this._save[0];this._save._length=1};a.size=function(a,b){if(this._width!=a||this._height!=b)this._width=a,this._height=b,this._targets&&(this._targets.destroy(),this._targets=new T(a,b,1,-1)),D._context==this&&(z.mainContext.viewport(0,0,a,b),u.width=a,u.height=b);0===a&&0===b&&this._releaseMem()};a.getMatScaleX=function(){if(this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b)return this._lastMatScaleX;this._lastMatScaleX=this._curMat.getScaleX();this._lastMat_a=this._curMat.a;this._lastMat_b=this._curMat.b;return this._lastMatScaleX};a.getMatScaleY=function(){if(this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d)return this._lastMatScaleY;this._lastMatScaleY=this._curMat.getScaleY();this._lastMat_c=this._curMat.c;this._lastMat_d=this._curMat.d;return this._lastMatScaleY};a.setFillColor=function(a){this._fillColor=a};a.getFillColor=function(){return this._fillColor};a.translate=function(a,b){if(0!==a||0!==b)Za.save(this),this._curMat._bTransform?(ua.save(this),this._curMat.tx+=a*this._curMat.a+b*this._curMat.c,this._curMat.ty+=a*this._curMat.b+b*this._curMat.d):(this._curMat.tx=a,this._curMat.ty=b)};a.save=function(){this._save[this._save._length++]=Pa.Create(this)};a.restore=function(){var a=this._save._length,b=this._nBlendType;if(!(1>a)){for(--a;0<=a;a--){var c=this._save[a];c.restore(this);if(c.isSaveMark()){this._save._length=a;return}}b!=this._nBlendType&&(this._curSubmit=B.RENDERBASE)}};a.fillText=function(a,b,c,g,h,l){this._fillText(a,null,b,c,g,h,null,0,null)};a._fillText=function(a,b,f,g,h,l,k,m,p,n){void 0===n&&(n=0);a?c._textRender.filltext(this,a,f,g,h,l,k,m,p,n):b&&c._textRender.fillWords(this,b,f,g,h,l,k,m)};a._fast_filltext=function(a,b,f,g,h,l,k,m,p){void 0===p&&(p=0);c._textRender._fast_filltext(this,a,null,b,f,g,h,l,k,m,p)};a.fillWords=function(a,b,c,g,h){this._fillText(null,a,b,c,g,h,null,-1,null,0)};a.fillBorderWords=function(a,b,c,g,h,l,k){this._fillBorderText(null,a,b,c,g,h,l,k,null)};a.drawText=function(a,b,c,g,h,l){this._fillText(a,null,b,c,g,S.create(h).strColor,null,-1,l)};a.strokeWord=function(a,b,c,g,h,l,k){this._fillText(a,null,b,c,g,null,S.create(h).strColor,l||1,k)};a.fillBorderText=function(a,b,c,g,h,l,k,m){this._fillBorderText(a,null,b,c,g,S.create(h).strColor,S.create(l).strColor,k,m)};a._fillBorderText=function(a,b,c,g,h,l,k,m,p){this._fillText(a,b,c,g,h,l,k,m||1,p)};a._fillRect=function(a,b,c,g,h){var d=this._curSubmit,e=d&&2===d._key.submitType&&d._key.blendShader===this._nBlendType;65535<this._mesh.vertNum+4&&(this._mesh=aa.getAMesh(),this.meshlist.push(this._mesh),e=!1);e&&(e=e&&this.isSameClipInfo(d));this.transformQuad(a,b,c,g,0,this._curMat,this._transedPoints);this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,ea.NO_UV,h,!1),e||(d=this._curSubmit=ca.create(this,this._mesh,O.create(1,0)),this._submits[this._submits._length++]=d,this._copyClipInfo(d,this._globalClipMatrix),d.shaderValue.textureHost=this._lastTex,d._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,d._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)};a.fillRect=function(a,b,c,g,h){h=h?ia.create(h):this._shader2D.fillStyle;h=this.mixRGBandAlpha(h.toInt());this._fillRect(a,b,c,g,h)};a.fillTexture=function(a,b,c,g,h,l,k,m){a._getSource()?this._fillTexture(a,a.width,a.height,a.uvrect,b,c,g,h,l,k.x,k.y):this.sprite&&E.systemTimer.callLater(this,this._repaintSprite)};a._fillTexture=function(a,b,c,g,h,l,k,m,p,n,q){65535<this._mesh.vertNum+4&&(this._mesh=aa.getAMesh(),this.meshlist.push(this._mesh));var d=!0,e=!0;switch(p){case "repeat-x":e=!1;break;case "repeat-y":d=!1;break;case "no-repeat":d=e=!1}p=this._temp4Points;var f=0,r=0,v,u;0>n?(v=h,f=-n%b/b):v=h+n;0>q?(u=l,r=-q%c/c):u=l+q;k=h+k;m=l+m;!d&&(k=Math.min(k,h+n+b));!e&&(m=Math.min(m,l+q+c));k<h||m<l||v>k||u>m||(b=(k-h-n)/b,c=(m-l-q)/c,this.transformQuad(v,u,k-v,m-u,0,this._curMat,this._transedPoints),p[0]=f,p[1]=r,p[2]=b,p[3]=r,p[4]=b,p[5]=c,p[6]=f,p[7]=c,this.clipedOff(this._transedPoints)||(c=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA),this._mesh.addQuad(this._transedPoints,p,c,!0),p=O.create(1,0),p.defines.add(256),p.u_TexRange=g,g=this._curSubmit=ca.create(this,this._mesh,p),this._submits[this._submits._length++]=g,this._copyClipInfo(g,this._globalClipMatrix),g.shaderValue.textureHost=a,g._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4),this.breakNextMerge())};a.setColorFilter=function(a){Q.save(this,8388608,this,!0);this._colorFiler=a;this._curSubmit=B.RENDERBASE};a.drawTexture=function(a,b,c,g,h){this._drawTextureM(a,b,c,g,h,null,1,null)};a.drawTextures=function(a,b,c,g){if(a._getSource())for(var d=b.length/2,e=0,f=a.bitmap.id,m=0;m<d;m++)this._inner_drawTexture(a,f,b[e++]+c,b[e++]+g,0,0,null,null,1,!1);else this.sprite&&E.systemTimer.callLater(this,this._repaintSprite)};a._drawTextureAddSubmit=function(a,b){var d;d=ca.create(this,this._mesh,O.create(1,0));this._submits[this._submits._length++]=d;d.shaderValue.textureHost=b;d._key.other=a;d._renderType=10016;this._curSubmit=d};a._drawTextureM=function(a,b,c,g,h,l,k,m){return a._getSource()?this._inner_drawTexture(a,a.bitmap.id,b,c,g,h,l,m,k,!1):(this.sprite&&E.systemTimer.callLater(this,this._repaintSprite),!1)};a._drawRenderTexture=function(a,b,c,g,h,l,k,m){return this._inner_drawTexture(a,-1,b,c,g,h,l,m,1,!1)};a.submitDebugger=function(){this._submits[this._submits._length++]=U.create([],function(){debugger},this)};a._copyClipInfo=function(a,b){var d=a.shaderValue.clipMatDir;d[0]=b.a;d[1]=b.b;d[2]=b.c;d[3]=b.d;d=a.shaderValue.clipMatPos;d[0]=b.tx;d[1]=b.ty;a.clipInfoID=this._clipInfoID;this._clipInCache&&(a.shaderValue.clipOff[0]=1)};a.isSameClipInfo=function(a){return a.clipInfoID===this._clipInfoID};a._useNewTex2DSubmit=function(a,b){65535<this._mesh.vertNum+b&&(this._mesh=aa.getAMesh(),this.meshlist.push(this._mesh));var d=ca.create(this,this._mesh,O.create(1,0));this._submits[this._submits._length++]=this._curSubmit=d;d.shaderValue.textureHost=a;this._copyClipInfo(d,this._globalClipMatrix)};a._drawTexRect=function(a,b,c,g,h){this.transformQuad(a,b,c,g,this._italicDeg,this._curMat,this._transedPoints);a=this._transedPoints;a[0]=a[0]+.5|0;a[1]=a[1]+.5|0;a[2]=a[2]+.5|0;a[3]=a[3]+.5|0;a[4]=a[4]+.5|0;a[5]=a[5]+.5|0;a[6]=a[6]+.5|0;a[7]=a[7]+.5|0;this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,h,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)};a.drawCallOptimize=function(a){this._charSubmitCache.enable(a,this);return a};a._inner_drawTexture=function(a,b,c,g,h,l,k,m,p,n){var d=this._curSubmit._key;m=m||a._uv;if(4===d.submitType&&d.other===b){b=this._drawTexToDrawTri_Vert;b[0]=c;b[1]=g;b[2]=c+h;b[3]=g;b[4]=c+h;b[5]=g+l;b[6]=c;b[7]=g+l;this._drawTriUseAbsMatrix=!0;var e=this._tempUV;e[0]=m[0];e[1]=m[1];e[2]=m[2];e[3]=m[3];e[4]=m[4];e[5]=m[5];e[6]=m[6];e[7]=m[7];this.drawTriangles(a,0,0,b,e,this._drawTexToDrawTri_Index,k,p,null,null);this._drawTriUseAbsMatrix=!1;return!0}var e=this._mesh,f=this._curSubmit,t=n?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(c,g,h||a.width,l||a.height,this._italicDeg,k||this._curMat,t);this.drawTexAlign&&(k=Math.round,t[0]=k(t[0]),t[1]=k(t[1]),t[2]=k(t[2]),t[3]=k(t[3]),t[4]=k(t[4]),t[5]=k(t[5]),t[6]=k(t[6]),t[7]=k(t[7]),this.drawTexAlign=!1);p=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*p);if(n)return this._charSubmitCache.add(this,a,b,t,m,p),!0;this._drawCount++;(k=0<=b&&2===d.submitType&&d.other===b)&&(k=k&&this.isSameClipInfo(f));this._lastTex=a;65535<e.vertNum+4&&(e=this._mesh=aa.getAMesh(),this.meshlist.push(e),k=!1);e.addQuad(t,m,p,!0);k||(this._submits[this._submits._length++]=this._curSubmit=f=ca.create(this,e,O.create(1,0)),f.shaderValue.textureHost=a,f._key.other=b,this._copyClipInfo(f,this._globalClipMatrix));f._numEle+=6;e.indexNum+=6;e.vertNum+=4;return!0};a.transform4Points=function(a,b,c){var d=b.tx,e=b.ty,f=b.a,k=b.b,m=b.c,p=b.d,n=a[0],q=a[1],x=a[2],r=a[3],t=a[4],v=a[5],u=a[6];a=a[7];b._bTransform?(c[0]=n*f+q*m+d,c[1]=n*k+q*p+e,c[2]=x*f+r*m+d,c[3]=x*k+r*p+e,c[4]=t*f+v*m+d,c[5]=t*k+v*p+e,c[6]=u*f+a*m+d,c[7]=u*k+a*p+e):(c[0]=n+d,c[1]=q+e,c[2]=x+d,c[3]=r+e,c[4]=t+d,c[5]=v+e,c[6]=u+d,c[7]=a+e)};a.clipedOff=function(a){return 0>=this._clipRect.width||0>=this._clipRect.height?!0:!1};a.transformQuad=function(a,b,c,g,h,l,k){var d=0;0!=h&&(d=Math.tan(h*Math.PI/180)*g);c=a+c;g=b+g;h=l.tx;var e=l.ty,f=l.a,q=l.b,x=l.c,r=l.d,t=a+d,d=c+d;l._bTransform?(k[0]=t*f+b*x+h,k[1]=t*q+b*r+e,k[2]=d*f+b*x+h,k[3]=d*q+b*r+e,k[4]=c*f+g*x+h,k[5]=c*q+g*r+e,k[6]=a*f+g*x+h,k[7]=a*q+g*r+e):(k[0]=t+h,k[1]=b+e,k[2]=d+h,k[3]=b+e,k[4]=c+h,k[5]=g+e,k[6]=a+h,k[7]=g+e)};a.pushRT=function(){this.addRenderObject(U.create(null,T.pushRT,this))};a.popRT=function(){this.addRenderObject(U.create(null,T.popRT,this));this.breakNextMerge()};a.useRT=function(a){this.addRenderObject(U.create([a],function(a){if(a)a.start(),a.clear(0,0,0,0);else throw"error useRT";},this));this.breakNextMerge()};a.RTRestore=function(a){this.addRenderObject(U.create([a],function(a){a.restore()},this));this.breakNextMerge()};a.breakNextMerge=function(){this._curSubmit=B.RENDERBASE};a._repaintSprite=function(){this.sprite&&this.sprite.repaint()};a.drawTextureWithTransform=function(a,b,c,g,h,l,k,m,p,n,q){var d=null,e=this._curMat;n&&(d=this.globalCompositeOperation,this.globalCompositeOperation=n);var f=this._colorFiler;q&&this.setColorFilter(q);if(l){var r=this._tmpMatrix;r.a=l.a;r.b=l.b;r.c=l.c;r.d=l.d;r.tx=l.tx+k;r.ty=l.ty+m;r._bTransform=l._bTransform;l&&e._bTransform?(F.mul(r,e,r),l=r,l._bTransform=!0):l=r;this._drawTextureM(a,b,c,g,h,l,p,null)}else this._drawTextureM(a,b+k,c+m,g,h,e,p,null);n&&(this.globalCompositeOperation=d);q&&this.setColorFilter(f)};a._flushToTarget=function(a,b){u.worldScissorTest=!1;z.mainContext.disable(3089);var d=u.worldAlpha,c=u.worldMatrix4,e=u.worldMatrix;u.worldMatrix=F.EMPTY;u.restoreTempArray();u.worldMatrix4=u.TEMPMAT4_ARRAY;u.worldAlpha=1;R.activeShader=null;b.start();0<a._submits._length&&b.clear(0,0,0,0);a._curSubmit=B.RENDERBASE;a.flush();a.clear();b.restore();a._curSubmit=B.RENDERBASE;R.activeShader=null;u.worldAlpha=d;u.worldMatrix4=c;u.worldMatrix=e};a.drawCanvas=function(a,b,c,g,h){if(a){var d=a.context,e;d._targets?(0<d._submits._length&&(e=U.create([d,d._targets],this._flushToTarget,this),this._submits[this._submits._length++]=e),this._drawRenderTexture(d._targets,b,c,g,h,null,1,T.flipyuv)):(a.touches&&a.touches.forEach(function(a){a.touch()}),e=nb.create(a,this._shader2D.ALPHA,this._shader2D.filters),this._submits[this._submits._length++]=e,e._key.clear(),g=e._matrix,this._curMat.copyTo(g),h=g.tx,d=g.ty,g.tx=g.ty=0,g.transformPoint(fa.TEMP.setTo(b,c)),g.translate(fa.TEMP.x+h,fa.TEMP.y+d),F.mul(a.invMat,g,g));this._curSubmit=B.RENDERBASE}};a.drawTarget=function(a,b,c,g,h,l,k,m,p){void 0===p&&(p=-1);this._drawCount++;this.mixRGBandAlpha(this._drawTextureUseColor?this.fillStyle?this.fillStyle.toInt():0:4294967295);65535<this._mesh.vertNum+4&&(this._mesh=aa.getAMesh(),this.meshlist.push(this._mesh));this.transformQuad(b,c,g,h,0,l||this._curMat,this._transedPoints);if(!this.clipedOff(this._transedPoints))return this._mesh.addQuad(this._transedPoints,m||ea.DEF_UV,4294967295,!0),a=this._curSubmit=jb.create(this,this._mesh,k,a),a.blendType=-1==p?this._nBlendType:p,this._copyClipInfo(a,this._globalClipMatrix),a._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=a,this._curSubmit=B.RENDERBASE,!0;this._curSubmit=B.RENDERBASE;return!1};a.drawTriangles=function(a,b,c,g,h,l,k,m,p,n){if(a._getSource()){this._drawCount++;n=this._tmpMatrix;var d=this._triangleMesh,e=null,f=!1;p&&(e=this._colorFiler,this._colorFiler=p,this._curSubmit=B.RENDERBASE,f=e!=p);p=a.bitmap;var t=this._curSubmit._key,t=4===t.submitType&&t.other===p.id&&t.blendShader==this._nBlendType;65535<d.vertNum+g.length/2&&(d=this._triangleMesh=va.getAMesh(),this.meshlist.push(d),t=!1);t||(t=this._curSubmit=ca.create(this,d,O.create(1,0)),t.shaderValue.textureHost=a,t._renderType=10016,t._key.submitType=4,t._key.other=p.id,this._copyClipInfo(t,this._globalClipMatrix),this._submits[this._submits._length++]=t);a=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*m);this._drawTriUseAbsMatrix?d.addData(g,h,l,k,a):(k?(n.a=k.a,n.b=k.b,n.c=k.c,n.d=k.d,n.tx=k.tx+b,n.ty=k.ty+c):(n.a=1,n.b=0,n.c=0,n.d=1,n.tx=b,n.ty=c),F.mul(n,this._curMat,n),d.addData(g,h,l,n,a));this._curSubmit._numEle+=l.length;f&&(this._colorFiler=e,this._curSubmit=B.RENDERBASE)}else this.sprite&&E.systemTimer.callLater(this,this._repaintSprite)};a.transform=function(a,b,c,g,h,l){ua.save(this);F.mul(F.TEMP.setTo(a,b,c,g,h,l),this._curMat,this._curMat);this._curMat._checkTransform()};a._transformByMatrix=function(a,b,c){a.setTranslate(b,c);F.mul(a,this._curMat,this._curMat);a.setTranslate(0,0);this._curMat._bTransform=!0};a.setTransformByMatrix=function(a){a.copyTo(this._curMat)};a.rotate=function(a){ua.save(this);this._curMat.rotateEx(a)};a.scale=function(a,b){ua.save(this);this._curMat.scaleEx(a,b)};a.clipRect=function(a,b,f,g){bb.save(this);this._clipRect==c.MAXCLIPRECT?this._clipRect=new ga(a,b,f,g):(this._clipRect.width=f,this._clipRect.height=g,this._clipRect.x=a,this._clipRect.y=b);c._clipID_Gen++;c._clipID_Gen%=1E4;this._clipInfoID=c._clipID_Gen;a=this._globalClipMatrix;b=a.tx;f=a.ty;g=b+a.a;var d=f+a.d;99999999<=this._clipRect.width?(a.a=a.d=99999999,a.b=a.c=a.tx=a.ty=0):(this._curMat._bTransform?(a.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,a.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,a.a=this._clipRect.width*this._curMat.a,a.b=this._clipRect.width*this._curMat.b,a.c=this._clipRect.height*this._curMat.c,a.d=this._clipRect.height*this._curMat.d):(a.tx=this._clipRect.x+this._curMat.tx,a.ty=this._clipRect.y+this._curMat.ty,a.a=this._clipRect.width,a.b=a.c=0,a.d=this._clipRect.height),this._incache&&(this._clipInCache=!0));if(0<a.a&&0<a.d){var e=a.tx+a.a,k=a.ty+a.d;e<=b||k<=f||a.tx>=g||a.ty>=d?(a.a=-.1,a.d=-.1):(a.tx<b&&(a.a-=b-a.tx,a.tx=b),e>g&&(a.a-=e-g),a.ty<f&&(a.d-=f-a.ty,a.ty=f),k>d&&(a.d-=k-d),0>=a.a&&(a.a=-.1),0>=a.d&&(a.d=-.1))}};a.drawMesh=function(a,b,c,g,h,l,k,m,p){};a.addRenderObject=function(a){this._submits[this._submits._length++]=a};a.submitElement=function(a,b){var d=this._submits,c=d._length;0>b&&(b=d._length);for(var e=B.RENDERBASE;a<b;)this._renderNextSubmitIndex=a+1,d[a]===B.RENDERBASE?a++:(B.preRender=e,e=d[a],a+=e.renderSubmit());return c};a.flush=function(){var a=this.submitElement(0,this._submits._length);this._path&&this._path.reset();Ka.instance&&Ka.getInstance().reset();this._curSubmit=B.RENDERBASE;for(var b=0,c=this.meshlist.length;b<c;b++){var g=this.meshlist[b];g.canReuse?g.releaseMesh():g.destroy()}this.meshlist.length=0;this._mesh=aa.getAMesh();this._pathMesh=la.getAMesh();this._triangleMesh=va.getAMesh();this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh);this._flushCnt++;0==this._flushCnt%60&&D._context==this&&(b=E.textRender)&&b.GC(!1);return a};a.setPathId=function(a){this.mId=a;-1!=this.mId&&(this.mHaveKey=!1,a=Va.getInstance(),a.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,a.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0))};a.beginPath=function(a){void 0===a&&(a=!1);this._getPath().beginPath(a)};a.closePath=function(){this._path.closePath()};a.addPath=function(a,b,c,g,h){for(var d=b=0,e=a.length/2;d<e;d++){var f=a[b+1]+h;a[b]+=g;a[b+1]=f;b+=2}this._getPath().push(a,c)};a.fill=function(){var a=this._curMat,b=this._getPath(),c=this._curSubmit,g=3===c._key.submitType&&c._key.blendShader===this._nBlendType;g&&(g=g&&this.isSameClipInfo(c));g||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var c=this.mixRGBandAlpha(this.fillStyle.toInt()),g=0,h,l=0,k=b.paths.length;l<k;l++){h=b.paths[l];var m=h.path.length/2;if(!(3>m||3==m&&!h.convex)){var p=h.path.concat(),n,q,x,r,t;if(a._bTransform)for(n=0;n<m;n++)q=n<<1,x=q+1,r=p[q],t=p[x],p[q]=a.a*r+a.c*t+a.tx,p[x]=a.b*r+a.d*t+a.ty;else for(n=0;n<m;n++)q=n<<1,x=q+1,r=p[q],t=p[x],p[q]=r+a.tx,p[x]=t+a.ty;65535<this._pathMesh.vertNum+m&&(this._curSubmit._numEle+=g,g=0,this._pathMesh=la.getAMesh(),this._curSubmit=this.addVGSubmit(this._pathMesh));n=this._pathMesh.vertNum;if(h.convex)for(m-=2,h=Array(3*m),x=q=0;x<m;x++)h[q++]=n,h[q++]=x+1+n,h[q++]=x+2+n;else if(h=mb.earcut(p,null,2),0<n)for(m=0;m<h.length;m++)h[m]+=n;this._pathMesh.addVertAndIBToMesh(this,p,c,h);g+=h.length}}this._curSubmit._numEle+=g};a.addVGSubmit=function(a){a=B.createShape(this,a,0,O.create(4,0));a._key.submitType=3;this._submits[this._submits._length++]=a;this._copyClipInfo(a,this._globalClipMatrix);return a};a.stroke=function(){if(0<this.lineWidth){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor),b=this._getPath(),c=this._curSubmit,g=3===c._key.submitType&&c._key.blendShader===this._nBlendType;g&&(g=g&&this.isSameClipInfo(c));g||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var g=c=0,h=b.paths.length;g<h;g++){var l=b.paths[g];if(!(0>=l.path.length)){var k=[],m=[],p=2*l.path.length;if(!(2>p)){65535<this._pathMesh.vertNum+p&&(this._curSubmit._numEle+=c,c=0,this._pathMesh=la.getAMesh(),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh));ab.createLine2(l.path,k,this.lineWidth,this._pathMesh.vertNum,m,l.loop);var l=m.length/2,p=this._curMat,n,q,r,v,t;if(p._bTransform)for(n=0;n<l;n++)q=n<<1,r=q+1,v=m[q],t=m[r],m[q]=p.a*v+p.c*t+p.tx,m[r]=p.b*v+p.d*t+p.ty;else for(n=0;n<l;n++)q=n<<1,r=q+1,v=m[q],t=m[r],m[q]=v+p.tx,m[r]=t+p.ty;this._pathMesh.addVertAndIBToMesh(this,m,a,k);c+=k.length}}}this._curSubmit._numEle+=c}};a.moveTo=function(a,b){var d=this._getPath();d.newPath();d._lastOriX=a;d._lastOriY=b;d.addPoint(a,b)};a.lineTo=function(a,b){var d=this._getPath();.001>Math.abs(a-d._lastOriX)&&.001>Math.abs(b-d._lastOriY)||(d._lastOriX=a,d._lastOriY=b,d.addPoint(a,b))};a.arcTo=function(a,b,f,g,h){var d,e,m=this._path._lastOriX-a,p=this._path._lastOriY-b,n=Math.sqrt(m*m+p*p);if(!(1E-6>=n)){m/=n;p/=n;f-=a;g-=b;var q=Math.sqrt(f*f+g*g);if(!(1E-6>=q||(f/=q,d=g/q,n=m+f,g=p+d,q=Math.sqrt(n*n+g*g),1E-6>=q))){e=n/q;var r=g/q,v=Math.PI/2-Math.acos(e*m+r*p),n=h/Math.tan(v),q=n*m+a;g=n*p+b;h=Math.sqrt(n*n+h*h);a+=e*h;b+=r*h;p=0<=m*d-p*f?2*v/c.SEGNUM:2*-v/c.SEGNUM;m=Math.sin(p);p=Math.cos(p);h=this._path._lastOriX;f=this._path._lastOriY;if(.1<Math.abs(q-this._path._lastOriX)||.1<Math.abs(g-this._path._lastOriY))h=q,f=g,this._path.addPoint(q,g);d=q-a;n=g-b;for(g=0;g<c.SEGNUM;g++){q=d*p+n*m;n=-d*m+n*p;d=q+a;e=n+b;if(.1<Math.abs(h-d)||.1<Math.abs(f-e))this._path.addPoint(d,e),h=d,f=e;d=q}}}};a.arc=function(a,b,c,g,h,l,k){void 0===l&&(l=!1);var d,e,f;k=h-g;if(l)if(Math.abs(k)>=2*Math.PI)k=2*-Math.PI;else for(;0<k;)k-=2*Math.PI;else if(Math.abs(k)>=2*Math.PI)k=2*Math.PI;else for(;0>k;)k+=2*Math.PI;l=this.getMatScaleX();f=this.getMatScaleY();f=Math.max(2*Math.PI*c*(l>f?l:f)/10,10)|0;var q=this._getPath();for(l=0;l<=f;l++)d=g+l/f*k,e=Math.cos(d),d=Math.sin(d),e=a+e*c,d=b+d*c,e==this._path._lastOriX&&d==this._path._lastOriY||q.addPoint(e,d);e=Math.cos(h);d=Math.sin(h);e=a+e*c;d=b+d*c;e==this._path._lastOriX&&d==this._path._lastOriY||q.addPoint(e,d)};a.quadraticCurveTo=function(a,b,c,g){a=Ra.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,a,b,c,g],30,2);b=0;for(var d=a.length/2;b<d;b++)this.lineTo(a[2*b],a[2*b+1]);this.lineTo(c,g)};a.rect=function(a,b,c,g){this._other=this._other.make();this._other.path||(this._other.path=new Ca);this._other.path.rect(a,b,c,g)};a.mixRGBandAlpha=function(a){return this._mixRGBandAlpha(a,this._shader2D.ALPHA)};a._mixRGBandAlpha=function(a,b){if(1<=b)return a;var d=(a&4278190080)>>>24;return a&16777215|(0!=d?d*b:255*b)<<24};a.strokeRect=function(a,b,c,g,h){if(0<this.lineWidth){h=this.mixRGBandAlpha(this.strokeStyle._color.numColor);var d=this.lineWidth/2;this._fillRect(a-d,b-d,c+this.lineWidth,this.lineWidth,h);this._fillRect(a-d,b-d+g,c+this.lineWidth,this.lineWidth,h);this._fillRect(a-d,b+d,this.lineWidth,g-this.lineWidth,h);this._fillRect(a-d+c,b+d,this.lineWidth,g-this.lineWidth,h)}};a.clip=function(){};a.drawParticle=function(a,b,c){c.x=a;c.y=b;this._submits[this._submits._length++]=c};a._getPath=function(){return this._path||(this._path=new Ca)};a._fillTexture_h=function(a,b,f,g,h,l,k,m){var d=Math.floor(m/g);m%=g;for(var e=0;e<d;e++)this._inner_drawTexture(a,b,l,k,g,h,this._curMat,f,1,!1),l+=g;0<m&&(g=f[0]+m/g*(f[2]-f[0]),d=c.tmpuv1,d[0]=f[0],d[1]=f[1],d[2]=g,d[3]=f[3],d[4]=g,d[5]=f[5],d[6]=f[6],d[7]=f[7],this._inner_drawTexture(a,b,l,k,m,h,this._curMat,d,1,!1))};a._fillTexture_v=function(a,b,f,g,h,l,k,m){var d=Math.floor(m/h);m%=h;for(var e=0;e<d;e++)this._inner_drawTexture(a,b,l,k,g,h,this._curMat,f,1,!1),k+=h;0<m&&(h=f[1]+m/h*(f[7]-f[1]),d=c.tmpuv1,d[0]=f[0],d[1]=f[1],d[2]=f[2],d[3]=f[3],d[4]=f[4],d[5]=h,d[6]=f[6],d[7]=h,this._inner_drawTexture(a,b,l,k,g,m,this._curMat,d,1,!1))};a.drawTextureWithSizeGrid=function(a,b,f,g,h,l,k,m){if(a._getSource()){b+=k;f+=m;var d=a.uv,e=a.bitmap._width,q=a.bitmap._height;k=l[0];m=l[3];var r=k/q,v=m/e,t=l[1],u=l[2],y=t/e,z=u/q,D=l[4];l=!1;g==e&&(m=t=0);h==q&&(k=u=0);m+t>g&&(e=g,l=!0,g=m+t,this.save(),this.clipRect(0+b,0+f,e,h));var e=a.bitmap.id,q=this._curMat,w=this._tempUV,A=d[0],B=d[1],E=d[4],F=d[5],I,G,H;m&&k&&(G=A+v,H=B+r,w[0]=A,w[1]=B,w[2]=G,w[3]=B,w[4]=G,w[5]=H,w[6]=A,w[7]=H,this._inner_drawTexture(a,e,b,f,m,k,q,w,1,!1));t&&k&&(d=E-y,I=B,G=E,H=B+r,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,this._inner_drawTexture(a,e,g-t+b,0+f,t,k,q,w,1,!1));m&&u&&(d=A,I=F-z,G=A+v,H=F,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,this._inner_drawTexture(a,e,0+b,h-u+f,m,u,q,w,1,!1));t&&u&&(d=E-y,I=F-z,G=E,H=F,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,this._inner_drawTexture(a,e,g-t+b,h-u+f,t,u,q,w,1,!1));k&&(d=A+v,I=B,G=E-y,H=B+r,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,D?this._fillTexture_h(a,e,w,a.width-m-t,k,m+b,f,g-m-t):this._inner_drawTexture(a,e,m+b,f,g-m-t,k,q,w,1,!1));u&&(d=A+v,I=F-z,G=E-y,H=F,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,D?this._fillTexture_h(a,e,w,a.width-m-t,u,m+b,h-u+f,g-m-t):this._inner_drawTexture(a,e,m+b,h-u+f,g-m-t,u,q,w,1,!1));m&&(d=A,I=B+r,G=A+v,H=F-z,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,D?this._fillTexture_v(a,e,w,m,a.height-k-u,b,k+f,h-k-u):this._inner_drawTexture(a,e,b,k+f,m,h-k-u,q,w,1,!1));t&&(d=E-y,I=B+r,G=E,H=F-z,w[0]=d,w[1]=I,w[2]=G,w[3]=I,w[4]=G,w[5]=H,w[6]=d,w[7]=H,D?this._fillTexture_v(a,e,w,t,a.height-k-u,g-t+b,k+f,h-k-u):this._inner_drawTexture(a,e,g-t+b,k+f,t,h-k-u,q,w,1,!1));d=A+v;I=B+r;G=E-y;H=F-z;w[0]=d;w[1]=I;w[2]=G;w[3]=I;w[4]=G;w[5]=H;w[6]=d;w[7]=H;D?(r=c.tmpUVRect,r[0]=d,r[1]=I,r[2]=G-d,r[3]=H-I,this._fillTexture(a,a.width-m-t,a.height-k-u,r,m+b,k+f,g-m-t,h-k-u,"repeat",0,0)):this._inner_drawTexture(a,e,m+b,k+f,g-m-t,h-k-u,q,w,1,!1);l&&this.restore()}};A(0,a,"globalCompositeOperation",function(){return L.NAMES[this._nBlendType]},function(a){a=L.TOINT[a];null==a||this._nBlendType===a||(Q.save(this,65536,this,!0),this._curSubmit=B.RENDERBASE,this._nBlendType=a)});A(0,a,"strokeStyle",function(){return this._shader2D.strokeStyle},function(a){this._shader2D.strokeStyle.equal(a)||(Q.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=ia.create(a),this._submitKey.other=-this._shader2D.strokeStyle.toInt())});A(0,a,"globalAlpha",function(){return this._shader2D.ALPHA},function(a){a=Math.floor(1E3*a)/1E3;a!=this._shader2D.ALPHA&&(Q.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=a)});A(0,a,"asBitmap",null,function(a){if(a){if(this._targets||(this._targets=new T(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!");}else this._targets&&this._targets.destroy(),this._targets=null});A(0,a,"fillStyle",function(){return this._shader2D.fillStyle},function(a){this._shader2D.fillStyle.equal(a)||(Q.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=ia.create(a),this._submitKey.other=-this._shader2D.fillStyle.toInt())});A(0,a,"textAlign",function(){return this._other.textAlign},function(a){this._other.textAlign===a||(this._other=this._other.make(),Q.save(this,32768,this._other,!1),this._other.textAlign=a)});A(0,a,"lineWidth",function(){return this._other.lineWidth},function(a){this._other.lineWidth===a||(this._other=this._other.make(),Q.save(this,256,this._other,!1),this._other.lineWidth=a)});A(0,a,"textBaseline",function(){return this._other.textBaseline},function(a){this._other.textBaseline===a||(this._other=this._other.make(),Q.save(this,16384,this._other,!1),this._other.textBaseline=a)});A(0,a,"font",null,function(a){this._other=this._other.make();Q.save(this,8,this._other,!1)});A(0,a,"canvas",function(){return this._canvas});c.__init__=function(){b.DEFAULT=new b;hb};c.set2DRenderConfig=function(){var a=y.instance;v.setBlend(a,!0);v.setBlendFunc(a,1,771);v.setDepthTest(a,!1);v.setCullFace(a,!1);v.setDepthMask(a,!0);v.setFrontFace(a,2305);D.isConchApp||a.viewport(0,0,u.width,u.height)};c._SUBMITVBSIZE=32E3;c._MAXSIZE=99999999;c._MAXVERTNUM=65535;c.MAXCLIPRECT=new ga(0,0,99999999,99999999);c._COUNT=0;c.SEGNUM=32;c._contextcount=0;c._clipID_Gen=0;c.defTexture=null;N(c,["_textRender",function(){return this._textRender=new P},"tmpuv1",function(){return this.tmpuv1=[0,0,0,0,0,0,0,0]},"tmpUV",function(){return this.tmpUV=[0,0,0,0,0,0,0,0]},"tmpUVRect",function(){return this.tmpUVRect=[0,0,0,0]}]);c.__init$=function(){b=function(){function a(){this.lineWidth=1;this.textBaseline=this.textAlign=this.path=null}r(a,"");var b=a.prototype;b.clear=function(){this.lineWidth=1;this.path&&this.path.clear();this.textAlign=this.textBaseline=null};b.make=function(){return this===a.DEFAULT?new a:this};a.DEFAULT=null;return a}()};return c}(ba),Xa=function(a){function c(a){c.__super.call(this,4,0);this._attribLocation=["position",0,"attribColor",1]}r(c,"laya.webgl.shader.d2.value.PrimitiveSV",a);return c}(O),Ya=function(a){function c(a){this.position=this.texcoord=null;this.offsetX=300;this.offsetY=0;c.__super.call(this,512,0);a=8*Z.BYTES_PE;this.position=[2,5126,!1,a,0];this.texcoord=[2,5126,!1,a,2*Z.BYTES_PE];this.color=[4,5126,!1,a,4*Z.BYTES_PE]}r(c,"laya.webgl.shader.d2.skinAnishader.SkinSV",a);return c}(O),Ga=function(a){function c(a){this.u_colorMatrix=null;this.strength=0;this.colorAlpha=this.colorMat=this.blurInfo=null;void 0===a&&(a=0);c.__super.call(this,1,a);this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}r(c,"laya.webgl.shader.d2.value.TextureSV",a);c.prototype.clear=function(){this.shader=this.texture=null;this.defines._value=this.subID+(z.shaderHighPrecision?1024:0)};return c}(O),va=function(a){function c(){c.__super.call(this,24,4,4);this.canReuse=!0;this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}r(c,"laya.webgl.utils.MeshTexture",a);a=c.prototype;a.addData=function(a,d,c,f,g){var b=this._vb,e=this._ib,k=a.length>>1,m=b.needSize(24*k)>>2,p=b._floatArray32||b.getFloat32Array(),n=b._uint32Array,q=0,r=f.a,u=f.b,t=f.c,v=f.d,y=f.tx,z=f.ty;for(f=0;f<k;f++){var A=a[q],w=a[q+1];p[m]=A*r+w*t+y;p[m+1]=A*u+w*v+z;p[m+2]=d[q];p[m+3]=d[q+1];n[m+4]=g;n[m+5]=255;m+=6;q+=2}b.setNeedUpload();a=this.vertNum;g=c.length;f=e.needSize(c.byteLength);d=e.getUint16Array();f>>=1;if(0<a)for(g=f+g,b=0;f<g;f++,b++)d[f]=c[b]+a;else d.set(c,f);e.setNeedUpload();this.vertNum+=k;this.indexNum+=c.length};a.releaseMesh=function(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.indexNum=this.vertNum=0;laya.webgl.utils.MeshTexture._POOL.push(this)};a.destroy=function(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()};c.getAMesh=function(){var a;a=laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new c;a._vb._resizeBuffer(1572864,!1);return a};c.const_stride=24;c._POOL=[];N(c,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]);return c}(sa),la=function(a){function c(){c.__super.call(this,12,4,4);this.canReuse=!0;this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}r(c,"laya.webgl.utils.MeshVG",a);a=c.prototype;a.addVertAndIBToMesh=function(a,d,c,f){a=this._vb.needSize(d.length/2*12)>>2;for(var b=this._vb._floatArray32||this._vb.getFloat32Array(),e=this._vb._uint32Array,l=0,k=d.length/2,m=0;m<k;m++)b[a++]=d[l],b[a++]=d[l+1],l+=2,e[a++]=c;this._vb.setNeedUpload();this._ib.append(new Uint16Array(f));this._ib.setNeedUpload();this.vertNum+=k;this.indexNum+=f.length};a.releaseMesh=function(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.indexNum=this.vertNum=0;laya.webgl.utils.MeshVG._POOL.push(this)};a.destroy=function(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()};c.getAMesh=function(){var a;a=laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new c;a._vb._resizeBuffer(786432,!1);return a};c.const_stride=12;c._POOL=[];N(c,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]);return c}(sa);(function(a){function c(a){c.__super.call(this,116,464*a,4);this.canReuse=!0;this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo);this.createQuadIB(a);this._quadNum=a}r(c,"laya.webgl.utils.MeshParticle2D",a);a=c.prototype;a.setMaxParticleNum=function(a){this._vb._resizeBuffer(464*a,!1);this.createQuadIB(a)};a.releaseMesh=function(){this._vb.setByteLength(0);this.indexNum=this.vertNum=0;laya.webgl.utils.MeshParticle2D._POOL.push(this)};a.destroy=function(){this._ib.destroy();this._vb.destroy();this._vb.deleteBuffer()};c.getAMesh=function(a){if(laya.webgl.utils.MeshParticle2D._POOL.length){var b=laya.webgl.utils.MeshParticle2D._POOL.pop();b.setMaxParticleNum(a);return b}return new c(a)};c.const_stride=116;c._POOL=[];N(c,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}]);return c})(sa);var ca=function(a){function c(a){void 0===a&&(a=1E4);c.__super.call(this,a)}r(c,"laya.webgl.submit.SubmitTexture",a);a=c.prototype;a.clone=function(a,d,e){var b=c._poolSize?c.POOL[--c._poolSize]:new c;this._cloneInit(b,a,d,e);return b};a.releaseRender=function(){1>--this._ref&&(c.POOL[c._poolSize++]=this,this.shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))};a.renderSubmit=function(){if(0===this._numEle)return 1;var a=this.shaderValue.textureHost;if(a){var d=a?a._getSource():null;if(!d)return 1}a=z.mainContext;this._mesh.useMesh(a);var c=B.preRender,f=B.preRender._key;0===this._key.blendShader&&this._key.submitType===f.submitType&&this._key.blendShader===f.blendShader&&R.activeShader&&B.preRender.clipInfoID==this.clipInfoID&&c.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&ra.NOOPTMASK)?R.activeShader.uploadTexture2D(d):(L.activeBlendFunction!==this._blendFn&&(v.setBlend(a,!0),this._blendFn(a),L.activeBlendFunction=this._blendFn),this.shaderValue.texture=d,this.shaderValue.upload());a.drawElements(4,this._numEle,5123,this._startIdx);K.renderBatches++;K.trianglesFaces+=this._numEle/3;return 1};c.create=function(a,d,e){var b=c._poolSize?c.POOL[--c._poolSize]:new c(10016);b._mesh=d;b._key.clear();b._key.submitType=2;b._ref=1;b._startIdx=d.indexNum*Z.BYTES_PIDX;b._numEle=0;d=a._nBlendType;b._key.blendShader=d;b._blendFn=a._targets?L.targetFns[d]:L.fns[d];b.shaderValue=e;a._colorFiler&&(a=a._colorFiler,e.defines.add(a.type),e.colorMat=a._mat,e.colorAlpha=a._alpha);return b};c._poolSize=0;c.POOL=[];return c}(B),aa=function(a){function c(){c.__super.call(this,24,4,4);this.canReuse=!0;this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo);laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=c._maxIB):(this.createQuadIB(c._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}r(c,"laya.webgl.utils.MeshQuadTexture",a);a=c.prototype;a.releaseMesh=function(){this._vb.setByteLength(0);this.indexNum=this.vertNum=0;laya.webgl.utils.MeshQuadTexture._POOL.push(this)};a.destroy=function(){this._vb.destroy();this._vb.deleteBuffer()};a.addQuad=function(a,d,c,f){var b=this._vb,e=b._byteLength>>2;b.setByteLength(e+24<<2);var l=b._floatArray32||b.getFloat32Array(),k=b._uint32Array;f=f?255:0;l[e++]=a[0];l[e++]=a[1];l[e++]=d[0];l[e++]=d[1];k[e++]=c;k[e++]=f;l[e++]=a[2];l[e++]=a[3];l[e++]=d[2];l[e++]=d[3];k[e++]=c;k[e++]=f;l[e++]=a[4];l[e++]=a[5];l[e++]=d[4];l[e++]=d[5];k[e++]=c;k[e++]=f;l[e++]=a[6];l[e++]=a[7];l[e++]=d[6];l[e++]=d[7];k[e++]=c;k[e++]=f;b._upload=!0};c.getAMesh=function(){var a;a=laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new c;a._vb._resizeBuffer(1572864,!1);return a};c.const_stride=24;c._fixib=null;c._maxIB=16384;c._POOL=[];N(c,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]);return c}(sa),za=function(a){function c(){this._maxsize=0;this._upload=!0;this._bufferSize=this._uploadSize=0;this._u8Array=null;c.__super.call(this)}r(c,"laya.webgl.utils.Buffer2D",a);a=c.prototype;a.setByteLength=function(a){this._byteLength!==a&&(a<=this._bufferSize||this._resizeBuffer(2*a+256,!0),this._byteLength=a)};a.needSize=function(a){var b=this._byteLength;a&&(a=this._byteLength+a,a<=this._bufferSize||this._resizeBuffer(a<<1,!0),this._byteLength=a);return b};a._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength);0==K.loopCount%30&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength);this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,y.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage));y.instance.bufferSubData(this._bufferType,0,this._buffer)};a._bufferSubData=function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=0);this._maxsize=Math.max(this._maxsize,this._byteLength);0==K.loopCount%30&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength);this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,y.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage));d||c?(d=this._buffer.slice(d,c),y.instance.bufferSubData(this._bufferType,a,d)):y.instance.bufferSubData(this._bufferType,a,this._buffer)};a._checkArrayUse=function(){};a._bind_uploadForVAO=function(){if(!this._upload)return!1;this._upload=!1;this._bindForVAO();this._bufferData();return!0};a._bind_upload=function(){if(!this._upload)return!1;this._upload=!1;this.bind();this._bufferData();return!0};a._bind_subUpload=function(a,d,c){void 0===a&&(a=0);void 0===d&&(d=0);void 0===c&&(c=0);if(!this._upload)return!1;this._upload=!1;this.bind();this._bufferSubData(a,d,c);return!0};a._resizeBuffer=function(a,d){var b=this._buffer;if(a<=b.byteLength)return this;var c=this._u8Array;if(d&&b&&0<b.byteLength){var g=new ArrayBuffer(a),b=c&&c.buffer==b?c:new Uint8Array(b),c=this._u8Array=new Uint8Array(g);c.set(b,0);b=this._buffer=g}else b=this._buffer=new ArrayBuffer(a),this._u8Array=null;this._checkArrayUse();this._upload=!0;this._bufferSize=b.byteLength;return this};a.append=function(a){this._upload=!0;var b,c;b=a.byteLength;a instanceof Uint8Array?(this._resizeBuffer(this._byteLength+b,!0),c=new Uint8Array(this._buffer,this._byteLength)):a instanceof Uint16Array?(this._resizeBuffer(this._byteLength+b,!0),c=new Uint16Array(this._buffer,this._byteLength)):a instanceof Float32Array&&(this._resizeBuffer(this._byteLength+b,!0),c=new Float32Array(this._buffer,this._byteLength));c.set(a,0);this._byteLength+=b;this._checkArrayUse()};a.appendU16Array=function(a,d){this._resizeBuffer(this._byteLength+2*d,!0);var b=new Uint16Array(this._buffer,this._byteLength,d);if(6==d)b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5];else if(100<=d)b.set(new Uint16Array(a.buffer,0,d));else for(var c=0;c<d;c++)b[c]=a[c];this._byteLength+=2*d;this._checkArrayUse()};a.appendEx=function(a,d){this._upload=!0;var b;b=a.byteLength;this._resizeBuffer(this._byteLength+b,!0);(new d(this._buffer,this._byteLength)).set(a,0);this._byteLength+=b;this._checkArrayUse()};a.appendEx2=function(a,d,c,f){void 0===f&&(f=1);this._upload=!0;f*=c;this._resizeBuffer(this._byteLength+f,!0);d=new d(this._buffer,this._byteLength);var b;for(b=0;b<c;b++)d[b]=a[b];this._byteLength+=f;this._checkArrayUse()};a.getBuffer=function(){return this._buffer};a.setNeedUpload=function(){this._upload=!0};a.getNeedUpload=function(){return this._upload};a.upload=function(){var a=this._bind_upload();y.instance.bindBuffer(this._bufferType,null);34962==this._bufferType&&(W._bindedVertexBuffer=null);34963==this._bufferType&&(W._bindedIndexBuffer=null);R.activeShader=null;return a};a.subUpload=function(a,d,c){a=this._bind_subUpload();y.instance.bindBuffer(this._bufferType,null);34962==this._bufferType&&(W._bindedVertexBuffer=null);34963==this._bufferType&&(W._bindedIndexBuffer=null);R.activeShader=null;return a};a._disposeResource=function(){this._upload=!0;this._uploadSize=0};a.clear=function(){this._byteLength=0;this._upload=!0};A(0,a,"bufferLength",function(){return this._buffer.byteLength});A(0,a,"byteLength",null,function(a){this.setByteLength(a)});c.__int__=function(a){};c.FLOAT32=4;c.SHORT=2;return c}(W),nb=function(a){function c(){this._matrix=new F;this._matrix4=Z.defaultMatrix4.concat();c.__super.call(this,1E4);this.shaderValue=new O(0,0)}r(c,"laya.webgl.submit.SubmitCanvas",a);a=c.prototype;a.renderSubmit=function(){var a=u.worldAlpha,d=u.worldMatrix4,c=u.worldMatrix,f=u.worldFilters,g=u.worldShaderDefines,h=this.shaderValue,l=this._matrix4,k=F.TEMP;F.mul(this._matrix,c,k);l[0]=k.a;l[1]=k.b;l[4]=k.c;l[5]=k.d;l[12]=k.tx;l[13]=k.ty;u.worldMatrix=k.clone();u.worldMatrix4=l;u.worldAlpha*=h.alpha;h.filters&&h.filters.length&&(u.worldFilters=h.filters,u.worldShaderDefines=h.defines);this.canv.flushsubmit();u.worldAlpha=a;u.worldMatrix4=d;u.worldMatrix.destroy();u.worldMatrix=c;u.worldFilters=f;u.worldShaderDefines=g;return 1};a.releaseRender=function(){if(1>--this._ref){var a=c.POOL;this._mesh=null;a[a._length++]=this}};a.clone=function(a,d,c){return null};a.getRenderType=function(){return 10003};c.create=function(a,d,e){var b=c.POOL._length?c.POOL[--c.POOL._length]:new c;b.canv=a;b._ref=1;b._numEle=0;a=b.shaderValue;a.alpha=d;a.defines.setValue(0);e&&e.length&&a.setFilters(e);return b};c.POOL=(c.POOL=[],c.POOL._length=0,c.POOL);return c}(B),$a=function(a){function c(){c.__super.call(this)}r(c,"laya.webgl.BufferState2D",a);return c}(db),lb=function(a){function c(a,d,e,f,g){this.ctx=null;this.lastScaleY=this.lastScaleX=1;this.needResetScale=!1;this.maxTexH=this.maxTexW=0;this.scaleFontSize=!0;this.showDbgInfo=!1;this.supportImageData=!0;c.__super.call(this);void 0===e&&(e=!0);void 0===f&&(f=!0);void 0===g&&(g=!1);this.maxTexW=a;this.maxTexH=d;this.scaleFontSize=e;this.supportImageData=f;this.showDbgInfo=g;c.canvas||(c.canvas=J.document.createElement("canvas"),c.canvas.width=1024,c.canvas.height=512,c.canvas.style.left="-10000px",c.canvas.style.position="absolute",Qa.body.appendChild(c.canvas),this.ctx=c.canvas.getContext("2d"))}r(c,"laya.webgl.resource.CharRender_Canvas",a);a=c.prototype;a.getWidth=function(a,d){if(!this.ctx)return 0;this.ctx._lastFont!=a&&(this.ctx.font=a,this.ctx._lastFont=a);return this.ctx.measureText(d).width};a.scale=function(a,d){if(!this.supportImageData)this.lastScaleX=a,this.lastScaleY=d;else if(this.lastScaleX!=a||this.lastScaleY!=d)this.ctx.setTransform(a,0,0,d,0,0),this.lastScaleX=a,this.lastScaleY=d};a.getCharBmp=function(a,d,c,f,g,h,l,k,m,p,n){if(!this.supportImageData)return this.getCharCanvas(a,d,c,f,g,h,l,k,m,p);var b=this.ctx;b.font!=d&&(b.font=d,b._lastFont=d);h.width=b.measureText(a).width;d=h.width*this.lastScaleX;var e=h.height*this.lastScaleY;d+=(l+m)*this.lastScaleX;e+=(k+p)*this.lastScaleY;d=Math.ceil(d);e=Math.ceil(e);d=Math.min(d,laya.webgl.resource.CharRender_Canvas.canvas.width);e=Math.min(e,laya.webgl.resource.CharRender_Canvas.canvas.height);m=d+2*c+1;p=e+2*c+1;n&&(m=Math.max(m,n[0]+n[2]+1),p=Math.max(p,n[1]+n[3]+1));b.clearRect(0,0,m,p);b.save();b.textBaseline="top";0<c&&(b.strokeStyle=g,b.lineWidth=c,b.strokeText(a,l,k));b.fillStyle=f;b.fillText(a,l,k);this.showDbgInfo&&(b.strokeStyle="#ff0000",b.strokeRect(0,0,d,e),b.strokeStyle="#00ff00",b.strokeRect(l,k,h.width,h.height));n&&-1==n[2]&&(n[2]=Math.ceil((h.width+2*c)*this.lastScaleX));a=n?b.getImageData(n[0],n[1],n[2],n[3]):b.getImageData(0,0,d,e);b.restore();h.bmpWidth=a.width;h.bmpHeight=a.height;return a};a.getCharCanvas=function(a,d,e,f,g,h,l,k,m,p){var b=this.ctx;b.font!=d&&(b.font=d,b._lastFont=d);h.width=b.measureText(a).width;var q=h.width*this.lastScaleX,r=h.height*this.lastScaleY,q=q+(l+m)*this.lastScaleX,r=r+((k+p)*this.lastScaleY+1),q=Math.min(q,this.maxTexW),r=Math.min(r,this.maxTexH);c.canvas.width=Math.min(q+1,this.maxTexW);c.canvas.height=Math.min(r+1,this.maxTexH);b.font=d;b.clearRect(0,0,q+1+e,r+1+e);b.setTransform(1,0,0,1,0,0);b.save();this.scaleFontSize&&b.scale(this.lastScaleX,this.lastScaleY);b.translate(l,k);b.textAlign="left";b.textBaseline="top";0<e?(b.strokeStyle=g,b.fillStyle=f,b.lineWidth=e,b.fillAndStrokeText?b.fillAndStrokeText(a,0,0):(b.strokeText(a,0,0),b.fillText(a,0,0))):(b.fillStyle=f,b.fillText(a,0,0));this.showDbgInfo&&(b.strokeStyle="#ff0000",b.strokeRect(0,0,q,r),b.strokeStyle="#00ff00",b.strokeRect(0,0,h.width,h.height));b.restore();h.bmpWidth=c.canvas.width;h.bmpHeight=c.canvas.height;return c.canvas};A(0,a,"canvasWidth",function(){return c.canvas.width},function(a){c.canvas.width!=a&&(c.canvas.width=a,2048<a&&console.warn("\u753b\u6587\u5b57\u8bbe\u7f6e\u7684\u5bbd\u5ea6\u592a\u5927\uff0c\u8d85\u8fc72048\u4e86"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))});c.canvas=null;return c}(Ma),kb=function(a){function c(){this.lastFont="";c.__super.call(this)}r(c,"laya.webgl.resource.CharRender_Native",a);a=c.prototype;a.getWidth=function(a,d){if(!J.conchTextCanvas)return 0;this.lastFont=J.conchTextCanvas.font=a;return J.conchTextCanvas.measureText(d).width};a.scale=function(a,d){};a.getCharBmp=function(a,d,c,f,g,h,l,k,m,p,n){if(!J.conchTextCanvas)return null;this.lastFont=J.conchTextCanvas.font=d;h.width=J.conchTextCanvas.measureText(a).width;d=S.create(g).numColor;f=S.create(f).numColor;a=J.conchTextCanvas.getTextBitmapData(a,f,2<c?2:c,d);h.bmpWidth=a.width;h.bmpHeight=a.height;return a};return c}(Ma),ra=function(a){function c(){c.__super.call(this,c.__name2int,c.__int2name,c.__int2nameMap)}r(c,"laya.webgl.shader.d2.ShaderDefines2D",a);c.__init__=function(){c.reg("TEXTURE2D",1);c.reg("PRIMITIVE",4);c.reg("GLOW_FILTER",8);c.reg("BLUR_FILTER",16);c.reg("COLOR_FILTER",32);c.reg("COLOR_ADD",64);c.reg("WORLDMAT",128);c.reg("FILLTEXTURE",256);c.reg("FSHIGHPRECISION",1024);c.reg("MVP3D",2048)};c.reg=function(a,d){wa._reg(a,d,c.__name2int,c.__int2name)};c.toText=function(a,d,c){return wa._toText(a,d,c)};c.toInt=function(a){return wa._toInt(a,c.__name2int)};c.TEXTURE2D=1;c.PRIMITIVE=4;c.FILTERGLOW=8;c.FILTERBLUR=16;c.FILTERCOLOR=32;c.COLORADD=64;c.WORLDMAT=128;c.FILLTEXTURE=256;c.SKINMESH=512;c.SHADERDEFINE_FSHIGHPRECISION=1024;c.MVP3D=2048;c.NOOPTMASK=312;c.__name2int={};c.__int2name=[];c.__int2nameMap=[];return c}(wa),R=function(a){function c(){c.__super.call(this)}r(c,"laya.webgl.shader.BaseShader",a);c.activeShader=null;c.bindShader=null;return c}(Ea),Ba=function(a){function c(a,d){this._source=null;this._texH=this._texW=0;this.__destroyed=!1;this.genID=this._discardTm=0;this.bitmap={id:0,_glTexture:null};this.lastTouchTm=this.curUsedCovRateAtlas=this.curUsedCovRate=0;this.ri=null;c.__super.call(this);this._texW=a||P.atlasWidth;this._texH=d||P.atlasWidth;this.bitmap.id=this.id;this.lock=!0}r(c,"laya.webgl.text.TextTexture",a);a=c.prototype;a.recreateResource=function(){if(!this._source){var a=D.isConchApp?y.instance.getDefaultCommandEncoder():z.mainContext,d=this._source=a.createTexture();this.bitmap._glTexture=d;v.bindTexture(a,3553,d);a.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null);a.texParameteri(3553,10241,9729);a.texParameteri(3553,10240,9729);a.texParameteri(3553,10242,33071);a.texParameteri(3553,10243,33071);P.debugUV&&this.fillWhite()}};a.addChar=function(a,d,c,f){if(P.isWan1Wan)return this.addCharCanvas(a,d,c,f);!this._source&&this.recreateResource();var b=D.isConchApp?y.instance.getDefaultCommandEncoder():z.mainContext;v.bindTexture(b,3553,this._source);!D.isConchApp&&b.pixelStorei(37441,!0);var e=a.data;a.data instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));b.texSubImage2D(3553,0,d,c,a.width,a.height,6408,5121,e);!D.isConchApp&&b.pixelStorei(37441,!1);D.isConchApp?(b=d/this._texW,e=c/this._texH,d=(d+a.width)/this._texW,a=(c+a.height)/this._texH):(b=(d+1)/this._texW,e=c/this._texH,d=(d+a.width-1)/this._texW,a=(c+a.height-1)/this._texH);f=f||Array(8);f[0]=b;f[1]=e;f[2]=d;f[3]=e;f[4]=d;f[5]=a;f[6]=b;f[7]=a;return f};a.addCharCanvas=function(a,d,c,f){!this._source&&this.recreateResource();var b=D.isConchApp?y.instance.getDefaultCommandEncoder():z.mainContext;v.bindTexture(b,3553,this._source);!D.isConchApp&&b.pixelStorei(37441,!0);b.texSubImage2D(3553,0,d,c,6408,5121,a);!D.isConchApp&&b.pixelStorei(37441,!1);var e;D.isConchApp?(b=d/this._texW,e=c/this._texH,d=(d+a.width)/this._texW,a=(c+a.height)/this._texH):(b=(d+1)/this._texW,e=(c+1)/this._texH,d=(d+a.width-1)/this._texW,a=(c+a.height-1)/this._texH);f=f||Array(8);f[0]=b;f[1]=e;f[2]=d;f[3]=e;f[4]=d;f[5]=a;f[6]=b;f[7]=a;return f};a.fillWhite=function(){!this._source&&this.recreateResource();var a=D.isConchApp?y.instance.getDefaultCommandEncoder():z.mainContext,d=new Uint8Array(this._texW*this._texH*4);d.fill(255);a.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,d)};a.discard=function(){this._texW!=P.atlasWidth||this._texH!=P.atlasWidth?this.destroy():(this.genID++,c.poolLen>=c.pool.length&&(c.pool=c.pool.concat(Array(10))),this._discardTm=E.stage.getFrameTm(),c.pool[c.poolLen++]=this)};a.destroy=function(){console.log("destroy TextTexture");this.__destroyed=!0;var a=D.isConchApp?y.instance.getDefaultCommandEncoder():z.mainContext;this._source&&a.deleteTexture(this._source);this._source=null};a.touchRect=function(a,d){this.lastTouchTm!=d&&(this.curUsedCovRateAtlas=this.curUsedCovRate=0,this.lastTouchTm=d);var b=P.atlasWidth*P.atlasWidth,c=ma.atlasGridW*ma.atlasGridW;this.curUsedCovRate+=a.bmpWidth*a.bmpHeight/b;this.curUsedCovRateAtlas+=Math.ceil(a.bmpWidth/ma.atlasGridW)*Math.ceil(a.bmpHeight/ma.atlasGridW)/(b/c)};a._getSource=function(){return this._source};a.drawOnScreen=function(a,d){};A(0,a,"texture",function(){return this});c.getTextTexture=function(a,d){if(a!=P.atlasWidth||a!=P.atlasWidth)return new c(a,d);if(0<c.poolLen){var b=c.pool[--c.poolLen];0<c.poolLen&&c.clean();return b}return new c(a,d)};c.clean=function(){var a=E.stage.getFrameTm();0===c.cleanTm&&(c.cleanTm=a);if(a-c.cleanTm>=P.checkCleanTextureDt){for(var d=0;d<c.poolLen;d++){var e=c.pool[d];a-e._discardTm>=P.destroyUnusedTextureDt&&(e.destroy(),c.pool[d]=c.pool[c.poolLen-1],c.poolLen--,d--)}c.cleanTm=a}};c.poolLen=0;c.cleanTm=0;N(c,["pool",function(){return this.pool=Array(10)}]);return c}(Ea),Ha=function(a){function c(a,d){this._uint32Array=this._floatArray32=null;this._vertexStride=0;c.__super.call(this);this._vertexStride=a;this._bufferUsage=d;this._bufferType=34962;this._buffer=new ArrayBuffer(8);this._floatArray32=new Float32Array(this._buffer);this._uint32Array=new Uint32Array(this._buffer)}r(c,"laya.webgl.utils.VertexBuffer2D",a);a=c.prototype;a.getFloat32Array=function(){return this._floatArray32};a.appendArray=function(a){var b=this._byteLength>>2;this.setByteLength(this._byteLength+4*a.length);this.getFloat32Array().set(a,b);this._upload=!0};a._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))};a.deleteBuffer=function(){this._disposeResource()};a._bindForVAO=function(){y.instance.bindBuffer(34962,this._glBuffer)};a.bind=function(){return W._bindedVertexBuffer!==this._glBuffer?(y.instance.bindBuffer(34962,this._glBuffer),W._bindedVertexBuffer=this._glBuffer,!0):!1};a.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this);this._byteLength=0;this._upload=!0;this._floatArray32=this._buffer=null};A(0,a,"vertexStride",function(){return this._vertexStride});c.create=function(a,d){void 0===d&&(d=35048);return new c(a,d)};return c}(za),Ia=function(a){function c(a){this._uint16Array=null;void 0===a&&(a=35044);c.__super.call(this);this._bufferUsage=a;this._bufferType=34963;this._buffer=new ArrayBuffer(8)}r(c,"laya.webgl.utils.IndexBuffer2D",a);a=c.prototype;a._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))};a.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))};a._bindForVAO=function(){y.instance.bindBuffer(34963,this._glBuffer)};a.bind=function(){return W._bindedIndexBuffer!==this._glBuffer?(y.instance.bindBuffer(34963,this._glBuffer),W._bindedIndexBuffer=this._glBuffer,!0):!1};a.destory=function(){this._buffer=this._uint16Array=null};a.disposeResource=function(){this._disposeResource()};c.create=function(a){void 0===a&&(a=35044);return new c(a)};return c}(za),na=function(a){function c(a,d){c.__super.call(this);this._wrapModeV=this._wrapModeU=0;this._filterMode=1;this._readyed=!1;this._height=this._width=-1;this._format=a;this._mipmap=d;this._anisoLevel=1;this._glTexture=y.instance.createTexture()}r(c,"laya.webgl.resource.BaseTexture",a);a=c.prototype;a._isPot=function(a){return 0===(a&a-1)};a._getGLFormat=function(){var a;switch(this._format){case 0:a=6407;break;case 1:a=6408;break;case 2:a=6406;break;case 3:if(v._compressedTextureS3tc)a=v._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;else throw"BaseTexture: not support DXT1 format.";break;case 4:if(v._compressedTextureS3tc)a=v._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw"BaseTexture: not support DXT5 format.";break;case 5:if(v._compressedTextureEtc1)a=v._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;else throw"BaseTexture: not support ETC1RGB format.";break;case 9:if(v._compressedTexturePvrtc)a=v._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_2BPPV format.";break;case 10:if(v._compressedTexturePvrtc)a=v._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";break;case 11:if(v._compressedTexturePvrtc)a=v._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_4BPPV format.";break;case 12:if(v._compressedTexturePvrtc)a=v._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";break;default:throw"BaseTexture: unknown texture format.";}return a};a._setFilterMode=function(a){var b=y.instance;v.bindTexture(b,this._glTextureType,this._glTexture);switch(a){case 0:this._mipmap?b.texParameteri(this._glTextureType,10241,9984):b.texParameteri(this._glTextureType,10241,9728);b.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap?b.texParameteri(this._glTextureType,10241,9985):b.texParameteri(this._glTextureType,10241,9729);b.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap?b.texParameteri(this._glTextureType,10241,9987):b.texParameteri(this._glTextureType,10241,9729);b.texParameteri(this._glTextureType,10240,9729);break;default:throw Error("BaseTexture:unknown filterMode value.");}};a._setWarpMode=function(a,d){var b=y.instance;v.bindTexture(b,this._glTextureType,this._glTexture);if(this._isPot(this._width)&&this._isPot(this._height))switch(d){case 0:b.texParameteri(this._glTextureType,a,10497);break;case 1:b.texParameteri(this._glTextureType,a,33071)}else b.texParameteri(this._glTextureType,a,33071)};a._setAnisotropy=function(a){var b=v._extTextureFilterAnisotropic;if(b&&!M.onLimixiu){a=Math.max(a,1);var c=y.instance;v.bindTexture(c,this._glTextureType,this._glTexture);a=Math.min(c.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT),a);c.texParameterf(this._glTextureType,b.TEXTURE_MAX_ANISOTROPY_EXT,a)}};a._disposeResource=function(){this._glTexture&&(y.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))};a._getSource=function(){return this._readyed?this._glTexture:null};a.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)&&y.instance.generateMipmap(this._glTextureType)};A(0,a,"wrapModeU",function(){return this._wrapModeU},function(a){this._wrapModeU!==a&&(this._wrapModeU=a,-1!==this._width&&this._setWarpMode(10242,a))});A(0,a,"mipmap",function(){return this._mipmap});A(0,a,"format",function(){return this._format});A(0,a,"wrapModeV",function(){return this._wrapModeV},function(a){this._wrapModeV!==a&&(this._wrapModeV=a,-1!==this._height&&this._setWarpMode(10243,a))});A(0,a,"defaulteTexture",function(){throw"BaseTexture:must override it.";});A(0,a,"filterMode",function(){return this._filterMode},function(a){a!==this._filterMode&&(this._filterMode=a,-1!==this._width&&-1!==this._height&&this._setFilterMode(a))});A(0,a,"anisoLevel",function(){return this._anisoLevel},function(a){a!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,a)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(a))});c.WARPMODE_REPEAT=0;c.WARPMODE_CLAMP=1;c.FILTERMODE_POINT=0;c.FILTERMODE_BILINEAR=1;c.FILTERMODE_TRILINEAR=2;c.FORMAT_R8G8B8=0;c.FORMAT_R8G8B8A8=1;c.FORMAT_ALPHA8=2;c.FORMAT_DXT1=3;c.FORMAT_DXT5=4;c.FORMAT_ETC1RGB=5;c.FORMAT_PVRTCRGB_2BPPV=9;c.FORMAT_PVRTCRGBA_2BPPV=10;c.FORMAT_PVRTCRGB_4BPPV=11;c.FORMAT_PVRTCRGBA_4BPPV=12;c.FORMAT_DEPTH_16=0;c.FORMAT_STENCIL_8=1;c.FORMAT_DEPTHSTENCIL_16_8=2;c.FORMAT_DEPTHSTENCIL_NONE=3;return c}(na),Y=function(a){function c(a,d,e,f,g){this._attribInfo=null;this.customCompile=!1;this._curActTexIndex=0;this.tag={};this._params=this._program=null;this._paramsMap={};c.__super.call(this);if(!a||!d)throw"Shader Error";this._attribInfo=g;this._id=++c._count;this._vs=a;this._ps=d;this._nameMap=f?f:{};null!=e&&(c.sharders[e]=this);this.recreateResource();this.lock=!0}r(c,"laya.webgl.shader.Shader",a);a=c.prototype;a.recreateResource=function(){this._compile();this._setGPUMemory(0)};a._disposeResource=function(){z.mainContext.deleteShader(this._vshader);z.mainContext.deleteShader(this._pshader);z.mainContext.deleteProgram(this._program);this._params=this._vshader=this._pshader=this._program=null;this._paramsMap={};this._setGPUMemory(0);this._curActTexIndex=0};a._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0;this._params=[];var a;this.customCompile&&(a=ja.preGetParams(this._vs,this._ps));var d=z.mainContext;this._program=d.createProgram();this._vshader=c._createShader(d,this._vs,35633);this._pshader=c._createShader(d,this._ps,35632);d.attachShader(this._program,this._vshader);d.attachShader(this._program,this._pshader);var e,f,g=this._attribInfo?this._attribInfo.length:0;for(f=0;f<g;f+=2)d.bindAttribLocation(this._program,this._attribInfo[f+1],this._attribInfo[f]);d.linkProgram(this._program);if(!this.customCompile&&!d.getProgramParameter(this._program,35714))throw d.getProgramInfoLog(this._program);g=this.customCompile?a.uniforms.length:d.getProgramParameter(this._program,35718);for(f=0;f<g;f++){var h=this.customCompile?a.uniforms[f]:d.getActiveUniform(this._program,f);e=d.getUniformLocation(this._program,h.name);e={vartype:"uniform",glfun:null,ivartype:1,location:e,name:h.name,type:h.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0};0<e.name.indexOf("[0]")&&(e.name=e.name.substr(0,e.name.length-3),e.isArray=!0,e.location=d.getUniformLocation(this._program,e.name));this._params.push(e)}f=0;for(a=this._params.length;f<a;f++)switch(e=this._params[f],e.indexOfParams=f,e.index=1,e.value=[e.location,null],e.codename=e.name,e.name=this._nameMap[e.codename]?this._nameMap[e.codename]:e.codename,this._paramsMap[e.name]=e,e._this=this,e.uploadedValue=[],e.type){case 5124:e.fun=e.isArray?this._uniform1iv:this._uniform1i;break;case 5126:e.fun=e.isArray?this._uniform1fv:this._uniform1f;break;case 35664:e.fun=e.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:e.fun=e.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:e.fun=e.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:e.fun=this._uniform_sampler2D;break;case 35680:e.fun=this._uniform_samplerCube;break;case 35676:e.glfun=d.uniformMatrix4fv;e.fun=this._uniformMatrix4fv;break;case 35670:e.fun=this._uniform1i;break;case 35674:case 35675:throw Error("compile shader err!");default:throw Error("compile shader err!");}}};a.getUniform=function(a){return this._paramsMap[a]};a._uniform1f=function(a,d){var b=a.uploadedValue;return b[0]!==d?(z.mainContext.uniform1f(a.location,b[0]=d),1):0};a._uniform1fv=function(a,d){if(4>d.length){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]?(z.mainContext.uniform1fv(a.location,d),b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[3],1):0}z.mainContext.uniform1fv(a.location,d);return 1};a._uniform_vec2=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]?(z.mainContext.uniform2f(a.location,b[0]=d[0],b[1]=d[1]),1):0};a._uniform_vec2v=function(a,d){if(2>d.length){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]?(z.mainContext.uniform2fv(a.location,d),b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[3],1):0}z.mainContext.uniform2fv(a.location,d);return 1};a._uniform_vec3=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]?(z.mainContext.uniform3f(a.location,b[0]=d[0],b[1]=d[1],b[2]=d[2]),1):0};a._uniform_vec3v=function(a,d){z.mainContext.uniform3fv(a.location,d);return 1};a._uniform_vec4=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]?(z.mainContext.uniform4f(a.location,b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[3]),1):0};a._uniform_vec4v=function(a,d){z.mainContext.uniform4fv(a.location,d);return 1};a._uniformMatrix2fv=function(a,d){z.mainContext.uniformMatrix2fv(a.location,!1,d);return 1};a._uniformMatrix3fv=function(a,d){z.mainContext.uniformMatrix3fv(a.location,!1,d);return 1};a._uniformMatrix4fv=function(a,d){z.mainContext.uniformMatrix4fv(a.location,!1,d);return 1};a._uniform1i=function(a,d){var b=a.uploadedValue;return b[0]!==d?(z.mainContext.uniform1i(a.location,b[0]=d),1):0};a._uniform1iv=function(a,d){z.mainContext.uniform1iv(a.location,d);return 1};a._uniform_ivec2=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]?(z.mainContext.uniform2i(a.location,b[0]=d[0],b[1]=d[1]),1):0};a._uniform_ivec2v=function(a,d){z.mainContext.uniform2iv(a.location,d);return 1};a._uniform_vec3i=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]?(z.mainContext.uniform3i(a.location,b[0]=d[0],b[1]=d[1],b[2]=d[2]),1):0};a._uniform_vec3vi=function(a,d){z.mainContext.uniform3iv(a.location,d);return 1};a._uniform_vec4i=function(a,d){var b=a.uploadedValue;return b[0]!==d[0]||b[1]!==d[1]||b[2]!==d[2]||b[3]!==d[3]?(z.mainContext.uniform4i(a.location,b[0]=d[0],b[1]=d[1],b[2]=d[2],b[3]=d[3]),1):0};a._uniform_vec4vi=function(a,d){z.mainContext.uniform4iv(a.location,d);return 1};a._uniform_sampler2D=function(a,d){var b=z.mainContext,c=a.uploadedValue;if(null==c[0])return c[0]=this._curActTexIndex,b.uniform1i(a.location,this._curActTexIndex),v.activeTexture(b,33984+this._curActTexIndex),v.bindTexture(b,3553,d),this._curActTexIndex++,1;v.activeTexture(b,33984+c[0]);v.bindTexture(b,3553,d);return 0};a._uniform_samplerCube=function(a,d){var b=z.mainContext,c=a.uploadedValue;if(null==c[0])return c[0]=this._curActTexIndex,b.uniform1i(a.location,this._curActTexIndex),v.activeTexture(b,33984+this._curActTexIndex),v.bindTexture(b,34067,d),this._curActTexIndex++,1;v.activeTexture(b,33984+c[0]);v.bindTexture(b,34067,d);return 0};a._noSetValue=function(a){console.log("no....:"+a.name)};a.uploadOne=function(a,d){v.useProgram(z.mainContext,this._program);var b=this._paramsMap[a];b.fun.call(this,b,d)};a.uploadTexture2D=function(a){var b=v;b._activeTextures[0]!==a&&(b.bindTexture(z.mainContext,b.TEXTURE_2D,a),b._activeTextures[0]=a)};a.upload=function(a,c){R.activeShader=R.bindShader=this;v.useProgram(z.mainContext,this._program);this._reCompile?(c=this._params,this._reCompile=!1):c=c||this._params;for(var b,d,g=c.length,h=0,l=0;l<g;l++)b=c[l],null!==(d=a[b.name])&&(h+=b.fun.call(this,b,d));K.shaderCall+=h};a.uploadArray=function(a,c,e){R.activeShader=this;R.bindShader=this;v.useProgram(z.mainContext,this._program);for(var b,d=0,h=c-2;0<=h;h-=2)if(b=this._paramsMap[a[h]])c=a[h+1],null!=c&&(e&&e[b.name]&&e[b.name].bind(),d+=b.fun.call(this,b,c));K.shaderCall+=d};a.getParams=function(){return this._params};a.setAttributesLocation=function(a){this._attribInfo=a};c.getShader=function(a){return c.sharders[a]};c.create=function(a,d,e,f,g){return new c(a,d,e,f,g)};c.withCompile=function(a,d,e,f){if(e&&c.sharders[e])return c.sharders[e];var b=c._preCompileShader[2E-4*a];if(!b)throw Error("withCompile shader err!"+a);return b.createShader(d,e,f,null)};c.withCompile2D=function(a,d,e,f,g,h){if(f&&c.sharders[f])return c.sharders[f];var b=c._preCompileShader[2E-4*a+d];if(!b)throw Error("withCompile shader err!"+a+" "+d);return b.createShader(e,f,g,h)};c.addInclude=function(a,c){ja.addInclude(a,c)};c.preCompile=function(a,d,e,f){c._preCompileShader[2E-4*a]=new ja(d,e,f)};c.preCompile2D=function(a,d,e,f,g){c._preCompileShader[2E-4*a+d]=new ja(e,f,g)};c._createShader=function(a,c,e){e=a.createShader(e);a.shaderSource(e,c);a.compileShader(e);if(a.getShaderParameter(e,35713))return e;console.log(a.getShaderInfoLog(e));return null};c._count=0;c._preCompileShader={};c.SHADERNAME2ID=2E-4;c.sharders=Array(32);N(c,["nameKey",function(){return this.nameKey=new Ta}]);return c}(R),ka=function(a){function c(a,d,e,f,g){void 0===a&&(a=0);void 0===d&&(d=0);void 0===e&&(e=1);void 0===f&&(f=!0);void 0===g&&(g=!1);c.__super.call(this,e,f);this._glTextureType=3553;this._width=a;this._height=d;this._canRead=g;this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);if(this._mipmap){this._mipmapCount=Math.max(Math.ceil(Math.log2(a))+1,Math.ceil(Math.log2(2))+1);for(e=0;e<this._mipmapCount;e++)this._setPixels(null,e,Math.max(a>>e,1),Math.max(d>>e,1));this._setGPUMemory(a*d*4*(1+1/3))}else this._mipmapCount=1,this._setGPUMemory(a*d*4)}r(c,"laya.webgl.resource.Texture2D",a);a=c.prototype;a._getFormatByteCount=function(){switch(this._format){case 0:return 3;case 1:return 4;case 2:return 1;default:throw"Texture2D: unknown format.";}};a._setPixels=function(a,c,e,f){var b=y.instance,d=this._glTextureType,l=this._getGLFormat();v.bindTexture(b,d,this._glTexture);0===this.format?(b.pixelStorei(3317,1),b.texImage2D(d,c,l,e,f,0,l,5121,a),b.pixelStorei(3317,4)):b.texImage2D(d,c,l,e,f,0,l,5121,a)};a._calcualatesCompressedDataSize=function(a,c,e){switch(a){case 3:case 5:return(c+3>>2)*(e+3>>2)*8;case 4:return(c+3>>2)*(e+3>>2)*16;case 11:case 12:return Math.floor((Math.max(c,8)*Math.max(e,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(c,16)*Math.max(e,8)*2+7)/8);default:return 0}};a._pharseDDS=function(a){var b=new Int32Array(a,0,31);if(542327876!=b[0])throw"Invalid magic number in DDS header";if(!(b[20]&4))throw"Unsupported format, must contain a FourCC code";var c=b[21];switch(this._format){case 3:if(827611204!==c)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==c)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format.";}c=1;if(b[2]&131072){if(c=Math.max(1,b[7]),!this._mipmap)throw"the mipmap is not same with Texture2D.";}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var f=b[4],g=b[3];this._width=f;this._height=g;this._upLoadCompressedTexImage2D(a,f,g,c,b[1]+4,0)};a._pharseKTX=function(a){var b=new Uint8Array(a,0,12);if(171!=b[0]||75!=b[1]||84!=b[2]||88!=b[3]||32!=b[4]||49!=b[5]||49!=b[6]||187!=b[7]||13!=b[8]||10!=b[9]||26!=b[10]||10!=b[11])throw"Invalid fileIdentifier in KTX header";b=new Int32Array(b.buffer,b.length,13);switch(b[4]){case v._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format.";}var c=b[11],f=b[6],g=b[7];this._width=f;this._height=g;this._upLoadCompressedTexImage2D(a,f,g,c,64+b[12],4)};a._pharsePVR=function(a){var b=new Int32Array(a,0,13);if(55727696!=b[0])throw"Invalid magic number in PVR header";switch(b[2]){case 0:this._format=9;break;case 2:this._format=11;break;case 1:this._format=10;break;case 3:this._format=12;break;default:throw"Texture2D:unknown PVR format.";}var c=b[11],f=b[7],g=b[6];this._width=f;this._height=g;this._upLoadCompressedTexImage2D(a,f,g,c,b[12]+52,0)};a._upLoadCompressedTexImage2D=function(a,c,e,f,g,h){var b=y.instance,d=this._glTextureType;v.bindTexture(b,d,this._glTexture);for(var m=this._getGLFormat(),p=0;p<f;p++){g+=h;var n=this._calcualatesCompressedDataSize(this._format,c,e),q=new Uint8Array(a,g,n);b.compressedTexImage2D(d,p,m,c,e,0,q);c=Math.max(c>>1,1);e=Math.max(e>>1,1);g+=n}this._setGPUMemory(g);this._readyed=!0;this._activeResource()};a.loadImageSource=function(a,c){void 0===c&&(c=!1);var b=a.width,d=a.height;this._width=b;this._height=d;this._isPot(b)&&this._isPot(d)||(this._mipmap=!1);this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);var g=y.instance;v.bindTexture(g,this._glTextureType,this._glTexture);var h=this._getGLFormat();D.isConchApp?(a instanceof laya.resource.HTMLCanvas||a.setPremultiplyAlpha(c),g.texImage2D(this._glTextureType,0,6408,6408,5121,a)):(c&&g.pixelStorei(37441,!0),g.texImage2D(this._glTextureType,0,h,h,5121,a),c&&g.pixelStorei(37441,!1));this._mipmap?(g.generateMipmap(this._glTextureType),this._setGPUMemory(b*d*4*(1+1/3))):this._setGPUMemory(b*d*4);this._canRead&&(D.isConchApp?this._pixels=new Uint8Array(a._nativeObj.getImageData(0,0,b,d)):(M.canvas.size(b,d),M.canvas.clear(),M.context.drawImage(a,0,0,b,d),this._pixels=new Uint8Array(M.context.getImageData(0,0,b,d).data.buffer)));this._readyed=!0;this._activeResource()};a.setPixels=function(a,c){void 0===c&&(c=0);if(!a)throw"Texture2D:pixels can't be null.";var b=Math.max(this._width>>c,1),d=Math.max(this._height>>c,1),g=b*d*this._getFormatByteCount();if(a.length<g)throw"Texture2D:pixels length should at least "+g+".";this._setPixels(a,c,b,d);this._canRead&&(this._pixels=a);this._readyed=!0;this._activeResource()};a.setSubPixels=function(a,c,e,f,g,h){void 0===h&&(h=0);if(!g)throw"Texture2D:pixels can't be null.";var b=y.instance,d=this._glTextureType;v.bindTexture(b,d,this._glTexture);var m=this._getGLFormat();0===this._format?(b.pixelStorei(3317,1),b.texSubImage2D(d,h,a,c,e,f,m,5121,g),b.pixelStorei(3317,4)):b.texSubImage2D(d,h,a,c,e,f,m,5121,g);this._readyed=!0;this._activeResource()};a.setCompressData=function(a){switch(this._format){case 3:case 4:this._pharseDDS(a);break;case 5:this._pharseKTX(a);break;case 9:case 10:case 11:case 12:this._pharsePVR(a);break;default:throw"Texture2D:unkonwn format.";}};a._recoverResource=function(){};a.getPixels=function(){if(this._canRead)return this._pixels;throw Error("Texture2D: must set texture canRead is true.");};A(0,a,"mipmapCount",function(){return this._mipmapCount});A(0,a,"defaulteTexture",function(){return laya.webgl.resource.Texture2D.grayTexture});c.__init__=function(){var a=new Uint8Array(3);a[0]=128;a[1]=128;a[2]=128;c.grayTexture=new c(1,1,0,!1,!1);c.grayTexture.setPixels(a);c.grayTexture.lock=!0};c._parse=function(a,d,e){e=e?new c(e[0],e[1],e[2],e[3],e[4]):new c(0,0);d&&(e.wrapModeU=d.wrapModeU,e.wrapModeV=d.wrapModeV,e.filterMode=d.filterMode,e.anisoLevel=d.anisoLevel);switch(e._format){case 0:case 1:e.loadImageSource(a);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:e.setCompressData(a);break;default:throw"Texture2D:unkonwn format.";}return e};c.load=function(a,c){E.loader.create(a,c,null,"TEXTURE2D")};c.grayTexture=null;return c}(na),T=function(a){function c(a,d,e,f){this._mgrKey=0;void 0===e&&(e=0);void 0===f&&(f=0);c.__super.call(this,e,!1);this._glTextureType=3553;this._width=a;this._height=d;this._depthStencilFormat=f;this._create(a,d);this.lock=!0}r(c,"laya.webgl.resource.RenderTexture2D",a);a=c.prototype;a.getIsReady=function(){return!0};a._create=function(a,c){var b=y.instance;this._frameBuffer=b.createFramebuffer();v.bindTexture(b,this._glTextureType,this._glTexture);var d=this._getGLFormat();b.texImage2D(this._glTextureType,0,d,a,c,0,d,5121,null);this._setGPUMemory(a*c*4);b.bindFramebuffer(36160,this._frameBuffer);b.framebufferTexture2D(36160,36064,3553,this._glTexture,0);if(3!==this._depthStencilFormat)switch(this._depthStencilBuffer=b.createRenderbuffer(),b.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:b.renderbufferStorage(36161,33189,a,c);b.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:b.renderbufferStorage(36161,36168,a,c);b.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:b.renderbufferStorage(36161,34041,a,c);b.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:console.log("RenderTexture: unkonw depth format.")}b.bindFramebuffer(36160,null);b.bindRenderbuffer(36161,null);this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);this._readyed=!0;this._activeResource()};a.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,y.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))};a.start=function(){var a=y.instance;y.instance.bindFramebuffer(36160,this._frameBuffer);this._lastRT=c._currentActive;c._currentActive=this;this._readyed=!0;a.viewport(0,0,this._width,this._height);this._lastWidth=u.width;this._lastHeight=u.height;u.width=this._width;u.height=this._height;R.activeShader=null};a.end=function(){y.instance.bindFramebuffer(36160,null);c._currentActive=null;this._readyed=!0};a.restore=function(){var a=y.instance;this._lastRT!=c._currentActive&&(y.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),c._currentActive=this._lastRT);this._readyed=!0;a.viewport(0,0,this._lastWidth,this._lastHeight);u.width=this._lastWidth;u.height=this._lastHeight;R.activeShader=null};a.clear=function(a,c,e,f){void 0===a&&(a=0);void 0===c&&(c=0);void 0===e&&(e=0);void 0===f&&(f=1);var b=y.instance;b.clearColor(a,c,e,f);a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=1280}b.clear(a)};a.getData=function(a,c,e,f){if(D.isConchApp&&2==conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var b=y.instance;b.bindFramebuffer(36160,this._frameBuffer);if(36053!==b.checkFramebufferStatus(36160))return b.bindFramebuffer(36160,null),null;var d=new Uint8Array(this._width*this._height*4),l=this._getGLFormat();b.readPixels(a,c,e,f,l,5121,d);b.bindFramebuffer(36160,null);return d};a.getDataAsync=function(a,c,e,f,g){var b=y.instance;b.bindFramebuffer(36160,this._frameBuffer);b.readPixelsAsync(a,c,e,f,6408,5121,function(a){g(new Uint8Array(a))});b.bindFramebuffer(36160,null)};a.recycle=function(){};a._disposeResource=function(){if(this._frameBuffer){var a=y.instance;a.deleteTexture(this._glTexture);a.deleteFramebuffer(this._frameBuffer);a.deleteRenderbuffer(this._depthStencilBuffer);this._depthStencilBuffer=this._frameBuffer=this._glTexture=null;this._setGPUMemory(0)}};A(0,a,"depthStencilFormat",function(){return this._depthStencilFormat});A(0,a,"defaulteTexture",function(){return ka.grayTexture});A(0,a,"sourceWidth",function(){return this._width});A(0,a,"sourceHeight",function(){return this._height});A(0,a,"offsetX",function(){return 0});A(0,a,"offsetY",function(){return 0});A(1,c,"currentActive",function(){return c._currentActive},laya.webgl.resource.BaseTexture._$SET_currentActive);c.pushRT=function(){c.rtStack.push({rt:c._currentActive,w:u.width,h:u.height})};c.popRT=function(){var a=y.instance,d=c.rtStack.pop();d&&(c._currentActive!=d.rt&&(y.instance.bindFramebuffer(36160,d.rt?d.rt._frameBuffer:null),c._currentActive=d.rt),a.viewport(0,0,d.w,d.h),u.width=d.w,u.height=d.h)};c._currentActive=null;c.rtStack=[];N(c,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]);return c}(na),Wa=function(a){function c(a,b,f,g,h){this._params2dQuick2=null;this._shaderValueHeight=this._shaderValueWidth=0;c.__super.call(this,a,b,f,g,h)}r(c,"laya.webgl.shader.d2.Shader2X",a);var b=c.prototype;b._disposeResource=function(){a.prototype._disposeResource.call(this);this._params2dQuick2=null};b.upload2dQuick2=function(a){this.upload(a,this._params2dQuick2||this._make2dQuick2())};b._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var a=this._params,c,b=0,g=a.length;b<g;b++)c=a[b],"size"!==c.name&&this._params2dQuick2.push(c)}return this._params2dQuick2};c.create=function(a,b,f,g,h){return new c(a,b,f,g,h)};return c}(Y);E.__init([Ca,da])})(window,document,Laya);